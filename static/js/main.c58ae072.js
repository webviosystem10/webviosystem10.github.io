/*! For license information please see main.c58ae072.js.LICENSE.txt */
(()=>{var e={4:(e,t,n)=>{"use strict";var i=n(853),r=n(43),o=n(950);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function c(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(c(e)!==e)throw Error(a(188))}function u(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=u(e)))return t;e=e.sibling}return null}var h=Object.assign,p=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),k=Symbol.for("react.consumer"),T=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope");var R=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var I=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var O=Symbol.iterator;function x(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var _=Symbol.for("react.client.reference");function D(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===_?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case b:return"Profiler";case v:return"StrictMode";case C:return"Suspense";case w:return"SuspenseList";case R:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case f:return"Portal";case T:return(e.displayName||"Context")+".Provider";case k:return(e._context.displayName||"Context")+".Consumer";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case E:return null!==(t=e.displayName||null)?t:D(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return D(e(t))}catch(n){}}return null}var M=Array.isArray,N=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,A=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L={pending:!1,data:null,method:null,action:null},U=[],j=-1;function F(e){return{current:e}}function B(e){0>j||(e.current=U[j],U[j]=null,j--)}function V(e,t){j++,U[j]=e.current,e.current=t}var q=F(null),z=F(null),H=F(null),W=F(null);function K(e,t){switch(V(H,t),V(z,e),V(q,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ru(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=ou(t=ru(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(q),V(q,e)}function G(){B(q),B(z),B(H)}function Q(e){null!==e.memoizedState&&V(W,e);var t=q.current,n=ou(t,e.type);t!==n&&(V(z,e),V(q,n))}function J(e){z.current===e&&(B(q),B(z)),W.current===e&&(B(W),Qu._currentValue=L)}var Y=Object.prototype.hasOwnProperty,$=i.unstable_scheduleCallback,X=i.unstable_cancelCallback,Z=i.unstable_shouldYield,ee=i.unstable_requestPaint,te=i.unstable_now,ne=i.unstable_getCurrentPriorityLevel,ie=i.unstable_ImmediatePriority,re=i.unstable_UserBlockingPriority,oe=i.unstable_NormalPriority,ae=i.unstable_LowPriority,se=i.unstable_IdlePriority,ce=i.log,le=i.unstable_setDisableYieldValue,de=null,ue=null;function he(e){if("function"===typeof ce&&le(e),ue&&"function"===typeof ue.setStrictMode)try{ue.setStrictMode(de,e)}catch(t){}}var pe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(me(e)/fe|0)|0},me=Math.log,fe=Math.LN2;var ge=256,ve=4194304;function be(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ye(e,t,n){var i=e.pendingLanes;if(0===i)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes;e=e.warmLanes;var s=134217727&i;return 0!==s?0!==(i=s&~o)?r=be(i):0!==(a&=s)?r=be(a):n||0!==(n=s&~e)&&(r=be(n)):0!==(s=i&~o)?r=be(s):0!==a?r=be(a):n||0!==(n=i&~e)&&(r=be(n)),0===r?0:0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(n=t&-t)||32===o&&0!==(4194048&n))?t:r}function ke(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Te(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Se(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function Ce(){var e=ve;return 0===(62914560&(ve<<=1))&&(ve=4194304),e}function we(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ee(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Pe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-pe(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194090&n}function Re(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-pe(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function Ie(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Oe(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function xe(){var e=A.p;return 0!==e?e:void 0===(e=window.event)?32:lh(e.type)}var _e=Math.random().toString(36).slice(2),De="__reactFiber$"+_e,Me="__reactProps$"+_e,Ne="__reactContainer$"+_e,Ae="__reactEvents$"+_e,Le="__reactListeners$"+_e,Ue="__reactHandles$"+_e,je="__reactResources$"+_e,Fe="__reactMarker$"+_e;function Be(e){delete e[De],delete e[Me],delete e[Ae],delete e[Le],delete e[Ue]}function Ve(e){var t=e[De];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ne]||n[De]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=yu(e);null!==e;){if(n=e[De])return n;e=yu(e)}return t}n=(e=n).parentNode}return null}function qe(e){if(e=e[De]||e[Ne]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function ze(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function He(e){var t=e[je];return t||(t=e[je]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[Fe]=!0}var Ke=new Set,Ge={};function Qe(e,t){Je(e,t),Je(e+"Capture",t)}function Je(e,t){for(Ge[e]=t,e=0;e<t.length;e++)Ke.add(t[e])}var Ye,$e,Xe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ze={},et={};function tt(e,t,n){if(r=t,Y.call(et,r)||!Y.call(Ze,r)&&(Xe.test(r)?et[r]=!0:(Ze[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function it(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function rt(e){if(void 0===Ye)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ye=t&&t[1]||"",$e=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ye+e+$e}var ot=!1;function at(e,t){if(!e||ot)return"";ot=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var i=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){i=o}e.call(n.prototype)}}else{try{throw Error()}catch(a){i=a}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&i&&"string"===typeof s.stack)return[s.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=i.DetermineComponentFrameRoot(),a=o[0],s=o[1];if(a&&s){var c=a.split("\n"),l=s.split("\n");for(r=i=0;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;for(;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;if(i===c.length||r===l.length)for(i=c.length-1,r=l.length-1;1<=i&&0<=r&&c[i]!==l[r];)r--;for(;1<=i&&0<=r;i--,r--)if(c[i]!==l[r]){if(1!==i||1!==r)do{if(i--,0>--r||c[i]!==l[r]){var d="\n"+c[i].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=i&&0<=r);break}}}finally{ot=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?rt(n):""}function st(e){switch(e.tag){case 26:case 27:case 5:return rt(e.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 15:return at(e.type,!1);case 11:return at(e.type.render,!1);case 1:return at(e.type,!0);case 31:return rt("Activity");default:return""}}function ct(e){try{var t="";do{t+=st(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function lt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ut(e){e._valueTracker||(e._valueTracker=function(e){var t=dt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=dt(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var mt=/[\n"\\]/g;function ft(e){return e.replace(mt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,i,r,o,a,s){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+lt(t)):e.value!==""+lt(t)&&(e.value=""+lt(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?bt(e,a,lt(t)):null!=n?bt(e,a,lt(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=o&&(e.defaultChecked=!!o),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+lt(s):e.removeAttribute("name")}function vt(e,t,n,i,r,o,a,s){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return;n=null!=n?""+lt(n):"",t=null!=t?""+lt(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}i="function"!==typeof(i=null!=i?i:r)&&"symbol"!==typeof i&&!!i,e.checked=s?e.checked:!!i,e.defaultChecked=!!i,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a)}function bt(e,t,n){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function yt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+lt(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function kt(e,t,n){null==t||((t=""+lt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+lt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function Tt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(a(92));if(M(i)){if(1<i.length)throw Error(a(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=lt(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Ct=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wt(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!==typeof n||0===n||Ct.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Et(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var r in t)i=t[r],t.hasOwnProperty(r)&&n[r]!==i&&wt(e,r,i)}else for(var o in t)t.hasOwnProperty(o)&&wt(e,o,t[o])}function Pt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),It=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ot(e){return It.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var xt=null;function _t(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Dt=null,Mt=null;function Nt(e){var t=qe(e);if(t&&(e=t.stateNode)){var n=e[Me]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+ft(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=i[Me]||null;if(!r)throw Error(a(90));gt(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&ht(i)}break e;case"textarea":kt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&yt(e,!!n.multiple,t,!1)}}}var At=!1;function Lt(e,t,n){if(At)return e(t,n);At=!0;try{return e(t)}finally{if(At=!1,(null!==Dt||null!==Mt)&&(Vl(),Dt&&(t=Dt,e=Mt,Mt=Dt=null,Nt(t),e)))for(t=0;t<e.length;t++)Nt(e[t])}}function Ut(e,t){var n=e.stateNode;if(null===n)return null;var i=n[Me]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var jt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Ft=!1;if(jt)try{var Bt={};Object.defineProperty(Bt,"passive",{get:function(){Ft=!0}}),window.addEventListener("test",Bt,Bt),window.removeEventListener("test",Bt,Bt)}catch(Mh){Ft=!1}var Vt=null,qt=null,zt=null;function Ht(){if(zt)return zt;var e,t,n=qt,i=n.length,r="value"in Vt?Vt.value:Vt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[o-t];t++);return zt=r.slice(e,1<t?1-t:void 0)}function Wt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Kt(){return!0}function Gt(){return!1}function Qt(e){function t(t,n,i,r,o){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Kt:Gt,this.isPropagationStopped=Gt,this}return h(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Kt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Kt)},persist:function(){},isPersistent:Kt}),t}var Jt,Yt,$t,Xt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zt=Qt(Xt),en=h({},Xt,{view:0,detail:0}),tn=Qt(en),nn=h({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$t&&($t&&"mousemove"===e.type?(Jt=e.screenX-$t.screenX,Yt=e.screenY-$t.screenY):Yt=Jt=0,$t=e),Jt)},movementY:function(e){return"movementY"in e?e.movementY:Yt}}),rn=Qt(nn),on=Qt(h({},nn,{dataTransfer:0})),an=Qt(h({},en,{relatedTarget:0})),sn=Qt(h({},Xt,{animationName:0,elapsedTime:0,pseudoElement:0})),cn=Qt(h({},Xt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ln=Qt(h({},Xt,{data:0})),dn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},un={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=hn[e])&&!!t[e]}function mn(){return pn}var fn=Qt(h({},en,{key:function(e){if(e.key){var t=dn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Wt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?un[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mn,charCode:function(e){return"keypress"===e.type?Wt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Wt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Qt(h({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),vn=Qt(h({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mn})),bn=Qt(h({},Xt,{propertyName:0,elapsedTime:0,pseudoElement:0})),yn=Qt(h({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),kn=Qt(h({},Xt,{newState:0,oldState:0})),Tn=[9,13,27,32],Sn=jt&&"CompositionEvent"in window,Cn=null;jt&&"documentMode"in document&&(Cn=document.documentMode);var wn=jt&&"TextEvent"in window&&!Cn,En=jt&&(!Sn||Cn&&8<Cn&&11>=Cn),Pn=String.fromCharCode(32),Rn=!1;function In(e,t){switch(e){case"keyup":return-1!==Tn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function On(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var xn=!1;var _n={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!_n[e.type]:"textarea"===t}function Mn(e,t,n,i){Dt?Mt?Mt.push(i):Mt=[i]:Dt=i,0<(t=Hd(t,"onChange")).length&&(n=new Zt("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Nn=null,An=null;function Ln(e){Ld(e,0)}function Un(e){if(ht(ze(e)))return e}function jn(e,t){if("change"===e)return t}var Fn=!1;if(jt){var Bn;if(jt){var Vn="oninput"in document;if(!Vn){var qn=document.createElement("div");qn.setAttribute("oninput","return;"),Vn="function"===typeof qn.oninput}Bn=Vn}else Bn=!1;Fn=Bn&&(!document.documentMode||9<document.documentMode)}function zn(){Nn&&(Nn.detachEvent("onpropertychange",Hn),An=Nn=null)}function Hn(e){if("value"===e.propertyName&&Un(An)){var t=[];Mn(t,An,e,_t(e)),Lt(Ln,t)}}function Wn(e,t,n){"focusin"===e?(zn(),An=n,(Nn=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&zn()}function Kn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Un(An)}function Gn(e,t){if("click"===e)return Un(t)}function Qn(e,t){if("input"===e||"change"===e)return Un(t)}var Jn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Yn(e,t){if(Jn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Y.call(t,r)||!Jn(e[r],t[r]))return!1}return!0}function $n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Xn(e,t){var n,i=$n(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=$n(i)}}function Zn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Zn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ei(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=pt((e=t.contentWindow).document)}return t}function ti(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ni=jt&&"documentMode"in document&&11>=document.documentMode,ii=null,ri=null,oi=null,ai=!1;function si(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ai||null==ii||ii!==pt(i)||("selectionStart"in(i=ii)&&ti(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},oi&&Yn(oi,i)||(oi=i,0<(i=Hd(ri,"onSelect")).length&&(t=new Zt("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ii)))}function ci(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var li={animationend:ci("Animation","AnimationEnd"),animationiteration:ci("Animation","AnimationIteration"),animationstart:ci("Animation","AnimationStart"),transitionrun:ci("Transition","TransitionRun"),transitionstart:ci("Transition","TransitionStart"),transitioncancel:ci("Transition","TransitionCancel"),transitionend:ci("Transition","TransitionEnd")},di={},ui={};function hi(e){if(di[e])return di[e];if(!li[e])return e;var t,n=li[e];for(t in n)if(n.hasOwnProperty(t)&&t in ui)return di[e]=n[t];return e}jt&&(ui=document.createElement("div").style,"AnimationEvent"in window||(delete li.animationend.animation,delete li.animationiteration.animation,delete li.animationstart.animation),"TransitionEvent"in window||delete li.transitionend.transition);var pi=hi("animationend"),mi=hi("animationiteration"),fi=hi("animationstart"),gi=hi("transitionrun"),vi=hi("transitionstart"),bi=hi("transitioncancel"),yi=hi("transitionend"),ki=new Map,Ti="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Si(e,t){ki.set(e,t),Qe(t,[e])}Ti.push("scrollEnd");var Ci=new WeakMap;function wi(e,t){if("object"===typeof e&&null!==e){var n=Ci.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ct(t)},Ci.set(e,t),t)}return{value:e,source:t,stack:ct(t)}}var Ei=[],Pi=0,Ri=0;function Ii(){for(var e=Pi,t=Ri=Pi=0;t<e;){var n=Ei[t];Ei[t++]=null;var i=Ei[t];Ei[t++]=null;var r=Ei[t];Ei[t++]=null;var o=Ei[t];if(Ei[t++]=null,null!==i&&null!==r){var a=i.pending;null===a?r.next=r:(r.next=a.next,a.next=r),i.pending=r}0!==o&&Di(n,r,o)}}function Oi(e,t,n,i){Ei[Pi++]=e,Ei[Pi++]=t,Ei[Pi++]=n,Ei[Pi++]=i,Ri|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function xi(e,t,n,i){return Oi(e,t,n,i),Mi(e)}function _i(e,t){return Oi(e,null,null,t),Mi(e)}function Di(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(i=o.alternate)&&(i.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(r=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,r&&null!==t&&(r=31-pe(n),null===(i=(e=o.hiddenUpdates)[r])?e[r]=[t]:i.push(t),t.lane=536870912|n),o):null}function Mi(e){if(50<Dl)throw Dl=0,Ml=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ni={};function Ai(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Li(e,t,n,i){return new Ai(e,t,n,i)}function Ui(e){return!(!(e=e.prototype)||!e.isReactComponent)}function ji(e,t){var n=e.alternate;return null===n?((n=Li(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Fi(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Bi(e,t,n,i,r,o){var s=0;if(i=e,"function"===typeof e)Ui(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,q.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case R:return(e=Li(31,n,t,r)).elementType=R,e.lanes=o,e;case g:return Vi(n.children,r,o,t);case v:s=8,r|=24;break;case b:return(e=Li(12,n,t,2|r)).elementType=b,e.lanes=o,e;case C:return(e=Li(13,n,t,r)).elementType=C,e.lanes=o,e;case w:return(e=Li(19,n,t,r)).elementType=w,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case y:case T:s=10;break e;case k:s=9;break e;case S:s=11;break e;case E:s=14;break e;case P:s=16,i=null;break e}s=29,n=Error(a(130,null===e?"null":typeof e,"")),i=null}return(t=Li(s,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Vi(e,t,n,i){return(e=Li(7,e,i,t)).lanes=n,e}function qi(e,t,n){return(e=Li(6,e,null,t)).lanes=n,e}function zi(e,t,n){return(t=Li(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hi=[],Wi=0,Ki=null,Gi=0,Qi=[],Ji=0,Yi=null,$i=1,Xi="";function Zi(e,t){Hi[Wi++]=Gi,Hi[Wi++]=Ki,Ki=e,Gi=t}function er(e,t,n){Qi[Ji++]=$i,Qi[Ji++]=Xi,Qi[Ji++]=Yi,Yi=e;var i=$i;e=Xi;var r=32-pe(i)-1;i&=~(1<<r),n+=1;var o=32-pe(t)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,$i=1<<32-pe(t)+r|n<<r|i,Xi=o+e}else $i=1<<o|n<<r|i,Xi=e}function tr(e){null!==e.return&&(Zi(e,1),er(e,1,0))}function nr(e){for(;e===Ki;)Ki=Hi[--Wi],Hi[Wi]=null,Gi=Hi[--Wi],Hi[Wi]=null;for(;e===Yi;)Yi=Qi[--Ji],Qi[Ji]=null,Xi=Qi[--Ji],Qi[Ji]=null,$i=Qi[--Ji],Qi[Ji]=null}var ir=null,rr=null,or=!1,ar=null,sr=!1,cr=Error(a(519));function lr(e){throw fr(wi(Error(a(418,"")),e)),cr}function dr(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[De]=e,t[Me]=i,n){case"dialog":Ud("cancel",t),Ud("close",t);break;case"iframe":case"object":case"embed":Ud("load",t);break;case"video":case"audio":for(n=0;n<Nd.length;n++)Ud(Nd[n],t);break;case"source":Ud("error",t);break;case"img":case"image":case"link":Ud("error",t),Ud("load",t);break;case"details":Ud("toggle",t);break;case"input":Ud("invalid",t),vt(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ut(t);break;case"select":Ud("invalid",t);break;case"textarea":Ud("invalid",t),Tt(t,i.value,i.defaultValue,i.children),ut(t)}"string"!==typeof(n=i.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||Yd(t.textContent,n)?(null!=i.popover&&(Ud("beforetoggle",t),Ud("toggle",t)),null!=i.onScroll&&Ud("scroll",t),null!=i.onScrollEnd&&Ud("scrollend",t),null!=i.onClick&&(t.onclick=$d),t=!0):t=!1,t||lr(e)}function ur(e){for(ir=e.return;ir;)switch(ir.tag){case 5:case 13:return void(sr=!1);case 27:case 3:return void(sr=!0);default:ir=ir.return}}function hr(e){if(e!==ir)return!1;if(!or)return ur(e),or=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||au(e.type,e.memoizedProps)),t=!t),t&&rr&&lr(e),ur(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){rr=vu(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}rr=null}}else 27===n?(n=rr,pu(e.type)?(e=bu,bu=null,rr=e):rr=n):rr=ir?vu(e.stateNode.nextSibling):null;return!0}function pr(){rr=ir=null,or=!1}function mr(){var e=ar;return null!==e&&(null===yl?yl=e:yl.push.apply(yl,e),ar=null),e}function fr(e){null===ar?ar=[e]:ar.push(e)}var gr=F(null),vr=null,br=null;function yr(e,t,n){V(gr,t._currentValue),t._currentValue=n}function kr(e){e._currentValue=gr.current,B(gr)}function Tr(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Sr(e,t,n,i){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=r.dependencies;if(null!==o){var s=r.child;o=o.firstContext;e:for(;null!==o;){var c=o;o=r;for(var l=0;l<t.length;l++)if(c.context===t[l]){o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Tr(o.return,n,e),i||(s=null);break e}o=c.next}}else if(18===r.tag){if(null===(s=r.return))throw Error(a(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),Tr(s,n,e),s=null}else s=r.child;if(null!==s)s.return=r;else for(s=r;null!==s;){if(s===e){s=null;break}if(null!==(r=s.sibling)){r.return=s.return,s=r;break}s=s.return}r=s}}function Cr(e,t,n,i){e=null;for(var r=t,o=!1;null!==r;){if(!o)if(0!==(524288&r.flags))o=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var s=r.alternate;if(null===s)throw Error(a(387));if(null!==(s=s.memoizedProps)){var c=r.type;Jn(r.pendingProps.value,s.value)||(null!==e?e.push(c):e=[c])}}else if(r===W.current){if(null===(s=r.alternate))throw Error(a(387));s.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Qu):e=[Qu])}r=r.return}null!==e&&Sr(t,e,n,i),t.flags|=262144}function wr(e){for(e=e.firstContext;null!==e;){if(!Jn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Er(e){vr=e,br=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Pr(e){return Ir(vr,e)}function Rr(e,t){return null===vr&&Er(e),Ir(e,t)}function Ir(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===br){if(null===e)throw Error(a(308));br=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else br=br.next=t;return n}var Or="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},xr=i.unstable_scheduleCallback,_r=i.unstable_NormalPriority,Dr={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Mr(){return{controller:new Or,data:new Map,refCount:0}}function Nr(e){e.refCount--,0===e.refCount&&xr(_r,function(){e.controller.abort()})}var Ar=null,Lr=0,Ur=0,jr=null;function Fr(){if(0===--Lr&&null!==Ar){null!==jr&&(jr.status="fulfilled");var e=Ar;Ar=null,Ur=0,jr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Br=N.S;N.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Ar){var n=Ar=[];Lr=0,Ur=Od(),jr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Lr++,t.then(Fr,Fr)}(0,t),null!==Br&&Br(e,t)};var Vr=F(null);function qr(){var e=Vr.current;return null!==e?e:il.pooledCache}function zr(e,t){V(Vr,null===t?Vr.current:t.pool)}function Hr(){var e=qr();return null===e?null:{parent:Dr._currentValue,pool:e}}var Wr=Error(a(460)),Kr=Error(a(474)),Gr=Error(a(542)),Qr={then:function(){}};function Jr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Yr(){}function $r(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Yr,Yr),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e;default:if("string"===typeof t.status)t.then(Yr,Yr);else{if(null!==(e=il)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e}throw Xr=t,Wr}}var Xr=null;function Zr(){if(null===Xr)throw Error(a(459));var e=Xr;return Xr=null,e}function eo(e){if(e===Wr||e===Gr)throw Error(a(483))}var to=!1;function no(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function io(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ro(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&nl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=Mi(e),Di(e,null,n),t}return Oi(e,i,t,n),Mi(e)}function ao(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Re(e,n)}}function so(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?r=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var co=!1;function lo(){if(co){if(null!==jr)throw jr}}function uo(e,t,n,i){co=!1;var r=e.updateQueue;to=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var c=s,l=c.next;c.next=null,null===a?o=l:a.next=l,a=c;var d=e.alternate;null!==d&&((s=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===s?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=c))}if(null!==o){var u=r.baseState;for(a=0,d=l=c=null,s=o;;){var p=-536870913&s.lane,m=p!==s.lane;if(m?(ol&p)===p:(i&p)===p){0!==p&&p===Ur&&(co=!0),null!==d&&(d=d.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var f=e,g=s;p=t;var v=n;switch(g.tag){case 1:if("function"===typeof(f=g.payload)){u=f.call(v,u,p);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(p="function"===typeof(f=g.payload)?f.call(v,u,p):f)||void 0===p)break e;u=h({},u,p);break e;case 2:to=!0}}null!==(p=s.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=r.callbacks)?r.callbacks=[p]:m.push(p))}else m={lane:p,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(l=d=m,c=u):d=d.next=m,a|=p;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(m=s).next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}null===d&&(c=u),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=d,null===o&&(r.shared.lanes=0),pl|=a,e.lanes=a,e.memoizedState=u}}function ho(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function po(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ho(n[e],t)}var mo=F(null),fo=F(0);function go(e,t){V(fo,e=ul),V(mo,t),ul=e|t.baseLanes}function vo(){V(fo,ul),V(mo,mo.current)}function bo(){ul=fo.current,B(mo),B(fo)}var yo=0,ko=null,To=null,So=null,Co=!1,wo=!1,Eo=!1,Po=0,Ro=0,Io=null,Oo=0;function xo(){throw Error(a(321))}function _o(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jn(e[n],t[n]))return!1;return!0}function Do(e,t,n,i,r,o){return yo=o,ko=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,N.H=null===e||null===e.memoizedState?Ka:Ga,Eo=!1,o=n(i,r),Eo=!1,wo&&(o=No(t,n,i,r)),Mo(e),o}function Mo(e){N.H=Wa;var t=null!==To&&null!==To.next;if(yo=0,So=To=ko=null,Co=!1,Ro=0,Io=null,t)throw Error(a(300));null===e||Rs||null!==(e=e.dependencies)&&wr(e)&&(Rs=!0)}function No(e,t,n,i){ko=e;var r=0;do{if(wo&&(Io=null),Ro=0,wo=!1,25<=r)throw Error(a(301));if(r+=1,So=To=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}N.H=Qa,o=t(n,i)}while(wo);return o}function Ao(){var e=N.H,t=e.useState()[0];return t="function"===typeof t.then?Vo(t):t,e=e.useState()[0],(null!==To?To.memoizedState:null)!==e&&(ko.flags|=1024),t}function Lo(){var e=0!==Po;return Po=0,e}function Uo(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function jo(e){if(Co){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Co=!1}yo=0,So=To=ko=null,wo=!1,Ro=Po=0,Io=null}function Fo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===So?ko.memoizedState=So=e:So=So.next=e,So}function Bo(){if(null===To){var e=ko.alternate;e=null!==e?e.memoizedState:null}else e=To.next;var t=null===So?ko.memoizedState:So.next;if(null!==t)So=t,To=e;else{if(null===e){if(null===ko.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(To=e).memoizedState,baseState:To.baseState,baseQueue:To.baseQueue,queue:To.queue,next:null},null===So?ko.memoizedState=So=e:So=So.next=e}return So}function Vo(e){var t=Ro;return Ro+=1,null===Io&&(Io=[]),e=$r(Io,e,t),t=ko,null===(null===So?t.memoizedState:So.next)&&(t=t.alternate,N.H=null===t||null===t.memoizedState?Ka:Ga),e}function qo(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Vo(e);if(e.$$typeof===T)return Pr(e)}throw Error(a(438,String(e)))}function zo(e){var t=null,n=ko.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=ko.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(t={data:i.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},ko.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=I;return t.index++,n}function Ho(e,t){return"function"===typeof t?t(e):t}function Wo(e){return Ko(Bo(),To,e)}function Ko(e,t,n){var i=e.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=n;var r=e.baseQueue,o=i.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}t.baseQueue=r=o,i.pending=null}if(o=e.baseState,null===r)e.memoizedState=o;else{var c=s=null,l=null,d=t=r.next,u=!1;do{var h=-536870913&d.lane;if(h!==d.lane?(ol&h)===h:(yo&h)===h){var p=d.revertLane;if(0===p)null!==l&&(l=l.next={lane:0,revertLane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),h===Ur&&(u=!0);else{if((yo&p)===p){d=d.next,p===Ur&&(u=!0);continue}h={lane:0,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===l?(c=l=h,s=o):l=l.next=h,ko.lanes|=p,pl|=p}h=d.action,Eo&&n(o,h),o=d.hasEagerState?d.eagerState:n(o,h)}else p={lane:h,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===l?(c=l=p,s=o):l=l.next=p,ko.lanes|=h,pl|=h;d=d.next}while(null!==d&&d!==t);if(null===l?s=o:l.next=c,!Jn(o,e.memoizedState)&&(Rs=!0,u&&null!==(n=jr)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=l,i.lastRenderedState=o}return null===r&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Go(e){var t=Bo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);Jn(o,t.memoizedState)||(Rs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Qo(e,t,n){var i=ko,r=Bo(),o=or;if(o){if(void 0===n)throw Error(a(407));n=n()}else n=t();var s=!Jn((To||r).memoizedState,n);if(s&&(r.memoizedState=n,Rs=!0),r=r.queue,va(2048,8,$o.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||null!==So&&1&So.memoizedState.tag){if(i.flags|=2048,ma(9,{destroy:void 0,resource:void 0},Yo.bind(null,i,r,n,t),null),null===il)throw Error(a(349));o||0!==(124&yo)||Jo(i,t,n)}return n}function Jo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ko.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},ko.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Yo(e,t,n,i){t.value=n,t.getSnapshot=i,Xo(t)&&Zo(e)}function $o(e,t,n){return n(function(){Xo(t)&&Zo(e)})}function Xo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Jn(e,n)}catch(i){return!0}}function Zo(e){var t=_i(e,2);null!==t&&Ll(t,e,2)}function ea(e){var t=Fo();if("function"===typeof e){var n=e;if(e=n(),Eo){he(!0);try{n()}finally{he(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:e},t}function ta(e,t,n,i){return e.baseState=n,Ko(e,To,"function"===typeof i?i:Ho)}function na(e,t,n,i,r){if(qa(e))throw Error(a(485));if(null!==(e=t.action)){var o={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==N.T?n(!0):o.isTransition=!1,i(o),null===(n=t.pending)?(o.next=t.pending=o,ia(t,o)):(o.next=n.next,t.pending=n.next=o)}}function ia(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var o=N.T,a={};N.T=a;try{var s=n(r,i),c=N.S;null!==c&&c(a,s),ra(e,t,s)}catch(l){aa(e,t,l)}finally{N.T=o}}else try{ra(e,t,o=n(r,i))}catch(d){aa(e,t,d)}}function ra(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){oa(e,t,n)},function(n){return aa(e,t,n)}):oa(e,t,n)}function oa(e,t,n){t.status="fulfilled",t.value=n,sa(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,ia(e,n)))}function aa(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,sa(t),t=t.next}while(t!==i)}e.action=null}function sa(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ca(e,t){return t}function la(e,t){if(or){var n=il.formState;if(null!==n){e:{var i=ko;if(or){if(rr){t:{for(var r=rr,o=sr;8!==r.nodeType;){if(!o){r=null;break t}if(null===(r=vu(r.nextSibling))){r=null;break t}}r="F!"===(o=r.data)||"F"===o?r:null}if(r){rr=vu(r.nextSibling),i="F!"===r.data;break e}}lr(i)}i=!1}i&&(t=n[0])}}return(n=Fo()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ca,lastRenderedState:t},n.queue=i,n=Fa.bind(null,ko,i),i.dispatch=n,i=ea(!1),o=Va.bind(null,ko,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=Fo()).queue=r,n=na.bind(null,ko,r,o,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function da(e){return ua(Bo(),To,e)}function ua(e,t,n){if(t=Ko(e,t,ca)[0],e=Wo(Ho)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var i=Vo(t)}catch(a){if(a===Wr)throw Gr;throw a}else i=t;var r=(t=Bo()).queue,o=r.dispatch;return n!==t.memoizedState&&(ko.flags|=2048,ma(9,{destroy:void 0,resource:void 0},ha.bind(null,r,n),null)),[i,o,e]}function ha(e,t){e.action=t}function pa(e){var t=Bo(),n=To;if(null!==n)return ua(t,n,e);Bo(),t=t.memoizedState;var i=(n=Bo()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function ma(e,t,n,i){return e={tag:e,create:n,deps:i,inst:t,next:null},null===(t=ko.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},ko.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function fa(){return Bo().memoizedState}function ga(e,t,n,i){var r=Fo();i=void 0===i?null:i,ko.flags|=e,r.memoizedState=ma(1|t,{destroy:void 0,resource:void 0},n,i)}function va(e,t,n,i){var r=Bo();i=void 0===i?null:i;var o=r.memoizedState.inst;null!==To&&null!==i&&_o(i,To.memoizedState.deps)?r.memoizedState=ma(t,o,n,i):(ko.flags|=e,r.memoizedState=ma(1|t,o,n,i))}function ba(e,t){ga(8390656,8,e,t)}function ya(e,t){va(2048,8,e,t)}function ka(e,t){return va(4,2,e,t)}function Ta(e,t){return va(4,4,e,t)}function Sa(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ca(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,va(4,4,Sa.bind(null,t,e),n)}function wa(){}function Ea(e,t){var n=Bo();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&_o(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Pa(e,t){var n=Bo();t=void 0===t?null:t;var i=n.memoizedState;if(null!==t&&_o(t,i[1]))return i[0];if(i=e(),Eo){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[i,t],i}function Ra(e,t,n){return void 0===n||0!==(1073741824&yo)?e.memoizedState=t:(e.memoizedState=n,e=Al(),ko.lanes|=e,pl|=e,n)}function Ia(e,t,n,i){return Jn(n,t)?n:null!==mo.current?(e=Ra(e,n,i),Jn(e,t)||(Rs=!0),e):0===(42&yo)?(Rs=!0,e.memoizedState=n):(e=Al(),ko.lanes|=e,pl|=e,t)}function Oa(e,t,n,i,r){var o=A.p;A.p=0!==o&&8>o?o:8;var a=N.T,s={};N.T=s,Va(e,!1,t,n);try{var c=r(),l=N.S;if(null!==l&&l(s,c),null!==c&&"object"===typeof c&&"function"===typeof c.then)Ba(e,t,function(e,t){var n=[],i={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(i.status="rejected",i.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),i}(c,i),Nl());else Ba(e,t,i,Nl())}catch(d){Ba(e,t,{then:function(){},status:"rejected",reason:d},Nl())}finally{A.p=o,N.T=a}}function xa(){}function _a(e,t,n,i){if(5!==e.tag)throw Error(a(476));var r=Da(e).queue;Oa(e,r,t,L,null===n?xa:function(){return Ma(e),n(i)})}function Da(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:L},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ho,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Ma(e){Ba(e,Da(e).next.queue,{},Nl())}function Na(){return Pr(Qu)}function Aa(){return Bo().memoizedState}function La(){return Bo().memoizedState}function Ua(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Nl(),i=oo(t,e=ro(n),n);return null!==i&&(Ll(i,t,n),ao(i,t,n)),t={cache:Mr()},void(e.payload=t)}t=t.return}}function ja(e,t,n){var i=Nl();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},qa(e)?za(t,n):null!==(n=xi(e,t,n,i))&&(Ll(n,e,i),Ha(n,t,i))}function Fa(e,t,n){Ba(e,t,n,Nl())}function Ba(e,t,n,i){var r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(qa(e))za(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(r.hasEagerState=!0,r.eagerState=s,Jn(s,a))return Oi(e,t,r,0),null===il&&Ii(),!1}catch(c){}if(null!==(n=xi(e,t,r,i)))return Ll(n,e,i),Ha(n,t,i),!0}return!1}function Va(e,t,n,i){if(i={lane:2,revertLane:Od(),action:i,hasEagerState:!1,eagerState:null,next:null},qa(e)){if(t)throw Error(a(479))}else null!==(t=xi(e,n,i,2))&&Ll(t,e,2)}function qa(e){var t=e.alternate;return e===ko||null!==t&&t===ko}function za(e,t){wo=Co=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ha(e,t,n){if(0!==(4194048&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Re(e,n)}}var Wa={readContext:Pr,use:qo,useCallback:xo,useContext:xo,useEffect:xo,useImperativeHandle:xo,useLayoutEffect:xo,useInsertionEffect:xo,useMemo:xo,useReducer:xo,useRef:xo,useState:xo,useDebugValue:xo,useDeferredValue:xo,useTransition:xo,useSyncExternalStore:xo,useId:xo,useHostTransitionStatus:xo,useFormState:xo,useActionState:xo,useOptimistic:xo,useMemoCache:xo,useCacheRefresh:xo},Ka={readContext:Pr,use:qo,useCallback:function(e,t){return Fo().memoizedState=[e,void 0===t?null:t],e},useContext:Pr,useEffect:ba,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,ga(4194308,4,Sa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ga(4194308,4,e,t)},useInsertionEffect:function(e,t){ga(4,2,e,t)},useMemo:function(e,t){var n=Fo();t=void 0===t?null:t;var i=e();if(Eo){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=Fo();if(void 0!==n){var r=n(t);if(Eo){he(!0);try{n(t)}finally{he(!1)}}}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=ja.bind(null,ko,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Fo().memoizedState=e},useState:function(e){var t=(e=ea(e)).queue,n=Fa.bind(null,ko,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:wa,useDeferredValue:function(e,t){return Ra(Fo(),e,t)},useTransition:function(){var e=ea(!1);return e=Oa.bind(null,ko,e.queue,!0,!1),Fo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=ko,r=Fo();if(or){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===il)throw Error(a(349));0!==(124&ol)||Jo(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,ba($o.bind(null,i,o,e),[e]),i.flags|=2048,ma(9,{destroy:void 0,resource:void 0},Yo.bind(null,i,o,n,t),null),n},useId:function(){var e=Fo(),t=il.identifierPrefix;if(or){var n=Xi;t="\xab"+t+"R"+(n=($i&~(1<<32-pe($i)-1)).toString(32)+n),0<(n=Po++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Oo++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Na,useFormState:la,useActionState:la,useOptimistic:function(e){var t=Fo();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Va.bind(null,ko,!0,n),n.dispatch=t,[e,t]},useMemoCache:zo,useCacheRefresh:function(){return Fo().memoizedState=Ua.bind(null,ko)}},Ga={readContext:Pr,use:qo,useCallback:Ea,useContext:Pr,useEffect:ya,useImperativeHandle:Ca,useInsertionEffect:ka,useLayoutEffect:Ta,useMemo:Pa,useReducer:Wo,useRef:fa,useState:function(){return Wo(Ho)},useDebugValue:wa,useDeferredValue:function(e,t){return Ia(Bo(),To.memoizedState,e,t)},useTransition:function(){var e=Wo(Ho)[0],t=Bo().memoizedState;return["boolean"===typeof e?e:Vo(e),t]},useSyncExternalStore:Qo,useId:Aa,useHostTransitionStatus:Na,useFormState:da,useActionState:da,useOptimistic:function(e,t){return ta(Bo(),0,e,t)},useMemoCache:zo,useCacheRefresh:La},Qa={readContext:Pr,use:qo,useCallback:Ea,useContext:Pr,useEffect:ya,useImperativeHandle:Ca,useInsertionEffect:ka,useLayoutEffect:Ta,useMemo:Pa,useReducer:Go,useRef:fa,useState:function(){return Go(Ho)},useDebugValue:wa,useDeferredValue:function(e,t){var n=Bo();return null===To?Ra(n,e,t):Ia(n,To.memoizedState,e,t)},useTransition:function(){var e=Go(Ho)[0],t=Bo().memoizedState;return["boolean"===typeof e?e:Vo(e),t]},useSyncExternalStore:Qo,useId:Aa,useHostTransitionStatus:Na,useFormState:pa,useActionState:pa,useOptimistic:function(e,t){var n=Bo();return null!==To?ta(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:zo,useCacheRefresh:La},Ja=null,Ya=0;function $a(e){var t=Ya;return Ya+=1,null===Ja&&(Ja=[]),$r(Ja,e,t)}function Xa(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Za(e,t){if(t.$$typeof===p)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function es(e){return(0,e._init)(e._payload)}function ts(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=ji(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=67108866,n):i:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=qi(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var o=n.type;return o===g?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===P&&es(o)===t.type)?(Xa(t=r(t,n.props),n),t.return=e,t):(Xa(t=Bi(n.type,n.key,n.props,null,e.mode,i),n),t.return=e,t)}function d(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zi(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,o){return null===t||7!==t.tag?((t=Vi(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=qi(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case m:return Xa(n=Bi(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case f:return(t=zi(t,e.mode,n)).return=e,t;case P:return h(e,t=(0,t._init)(t._payload),n)}if(M(t)||x(t))return(t=Vi(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return h(e,$a(t),n);if(t.$$typeof===T)return h(e,Rr(e,t),n);Za(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case m:return n.key===r?l(e,t,n,i):null;case f:return n.key===r?d(e,t,n,i):null;case P:return p(e,t,n=(r=n._init)(n._payload),i)}if(M(n)||x(n))return null!==r?null:u(e,t,n,i,null);if("function"===typeof n.then)return p(e,t,$a(n),i);if(n.$$typeof===T)return p(e,t,Rr(e,n),i);Za(e,n)}return null}function v(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case m:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case f:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case P:return v(e,t,n,i=(0,i._init)(i._payload),r)}if(M(i)||x(i))return u(t,e=e.get(n)||null,i,r,null);if("function"===typeof i.then)return v(e,t,n,$a(i),r);if(i.$$typeof===T)return v(e,t,n,Rr(t,i),r);Za(t,i)}return null}function b(c,l,d,u){if("object"===typeof d&&null!==d&&d.type===g&&null===d.key&&(d=d.props.children),"object"===typeof d&&null!==d){switch(d.$$typeof){case m:e:{for(var y=d.key;null!==l;){if(l.key===y){if((y=d.type)===g){if(7===l.tag){n(c,l.sibling),(u=r(l,d.props.children)).return=c,c=u;break e}}else if(l.elementType===y||"object"===typeof y&&null!==y&&y.$$typeof===P&&es(y)===l.type){n(c,l.sibling),Xa(u=r(l,d.props),d),u.return=c,c=u;break e}n(c,l);break}t(c,l),l=l.sibling}d.type===g?((u=Vi(d.props.children,c.mode,u,d.key)).return=c,c=u):(Xa(u=Bi(d.type,d.key,d.props,null,c.mode,u),d),u.return=c,c=u)}return s(c);case f:e:{for(y=d.key;null!==l;){if(l.key===y){if(4===l.tag&&l.stateNode.containerInfo===d.containerInfo&&l.stateNode.implementation===d.implementation){n(c,l.sibling),(u=r(l,d.children||[])).return=c,c=u;break e}n(c,l);break}t(c,l),l=l.sibling}(u=zi(d,c.mode,u)).return=c,c=u}return s(c);case P:return b(c,l,d=(y=d._init)(d._payload),u)}if(M(d))return function(r,a,s,c){for(var l=null,d=null,u=a,m=a=0,f=null;null!==u&&m<s.length;m++){u.index>m?(f=u,u=null):f=u.sibling;var g=p(r,u,s[m],c);if(null===g){null===u&&(u=f);break}e&&u&&null===g.alternate&&t(r,u),a=o(g,a,m),null===d?l=g:d.sibling=g,d=g,u=f}if(m===s.length)return n(r,u),or&&Zi(r,m),l;if(null===u){for(;m<s.length;m++)null!==(u=h(r,s[m],c))&&(a=o(u,a,m),null===d?l=u:d.sibling=u,d=u);return or&&Zi(r,m),l}for(u=i(u);m<s.length;m++)null!==(f=v(u,r,m,s[m],c))&&(e&&null!==f.alternate&&u.delete(null===f.key?m:f.key),a=o(f,a,m),null===d?l=f:d.sibling=f,d=f);return e&&u.forEach(function(e){return t(r,e)}),or&&Zi(r,m),l}(c,l,d,u);if(x(d)){if("function"!==typeof(y=x(d)))throw Error(a(150));return function(r,s,c,l){if(null==c)throw Error(a(151));for(var d=null,u=null,m=s,f=s=0,g=null,b=c.next();null!==m&&!b.done;f++,b=c.next()){m.index>f?(g=m,m=null):g=m.sibling;var y=p(r,m,b.value,l);if(null===y){null===m&&(m=g);break}e&&m&&null===y.alternate&&t(r,m),s=o(y,s,f),null===u?d=y:u.sibling=y,u=y,m=g}if(b.done)return n(r,m),or&&Zi(r,f),d;if(null===m){for(;!b.done;f++,b=c.next())null!==(b=h(r,b.value,l))&&(s=o(b,s,f),null===u?d=b:u.sibling=b,u=b);return or&&Zi(r,f),d}for(m=i(m);!b.done;f++,b=c.next())null!==(b=v(m,r,f,b.value,l))&&(e&&null!==b.alternate&&m.delete(null===b.key?f:b.key),s=o(b,s,f),null===u?d=b:u.sibling=b,u=b);return e&&m.forEach(function(e){return t(r,e)}),or&&Zi(r,f),d}(c,l,d=y.call(d),u)}if("function"===typeof d.then)return b(c,l,$a(d),u);if(d.$$typeof===T)return b(c,l,Rr(c,d),u);Za(c,d)}return"string"===typeof d&&""!==d||"number"===typeof d||"bigint"===typeof d?(d=""+d,null!==l&&6===l.tag?(n(c,l.sibling),(u=r(l,d)).return=c,c=u):(n(c,l),(u=qi(d,c.mode,u)).return=c,c=u),s(c)):n(c,l)}return function(e,t,n,i){try{Ya=0;var r=b(e,t,n,i);return Ja=null,r}catch(a){if(a===Wr||a===Gr)throw a;var o=Li(29,a,null,e.mode);return o.lanes=i,o.return=e,o}}}var ns=ts(!0),is=ts(!1),rs=F(null),os=null;function as(e){var t=e.alternate;V(ds,1&ds.current),V(rs,e),null===os&&(null===t||null!==mo.current||null!==t.memoizedState)&&(os=e)}function ss(e){if(22===e.tag){if(V(ds,ds.current),V(rs,e),null===os){var t=e.alternate;null!==t&&null!==t.memoizedState&&(os=e)}}else cs()}function cs(){V(ds,ds.current),V(rs,rs.current)}function ls(e){B(rs),os===e&&(os=null),B(ds)}var ds=F(0);function us(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gu(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function hs(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:h({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ps={enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Nl(),r=ro(i);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oo(e,r,i))&&(Ll(t,e,i),ao(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Nl(),r=ro(i);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oo(e,r,i))&&(Ll(t,e,i),ao(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nl(),i=ro(n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=oo(e,i,n))&&(Ll(t,e,n),ao(t,e,n))}};function ms(e,t,n,i,r,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!Yn(n,i)||!Yn(r,o))}function fs(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&ps.enqueueReplaceState(t,t.state,null)}function gs(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=h({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var vs="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function bs(e){vs(e)}function ys(e){console.error(e)}function ks(e){vs(e)}function Ts(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Ss(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Cs(e,t,n){return(n=ro(n)).tag=3,n.payload={element:null},n.callback=function(){Ts(e,t)},n}function ws(e){return(e=ro(e)).tag=3,e}function Es(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"===typeof r){var o=i.value;e.payload=function(){return r(o)},e.callback=function(){Ss(t,n,i)}}var a=n.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){Ss(t,n,i),"function"!==typeof r&&(null===wl?wl=new Set([this]):wl.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Ps=Error(a(461)),Rs=!1;function Is(e,t,n,i){t.child=null===e?is(t,null,n,i):ns(t,e.child,n,i)}function Os(e,t,n,i,r){n=n.render;var o=t.ref;if("ref"in i){var a={};for(var s in i)"ref"!==s&&(a[s]=i[s])}else a=i;return Er(t),i=Do(e,t,n,a,o,r),s=Lo(),null===e||Rs?(or&&s&&tr(t),t.flags|=1,Is(e,t,i,r),t.child):(Uo(e,t,r),Js(e,t,r))}function xs(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Ui(o)||void 0!==o.defaultProps||null!==n.compare?((e=Bi(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,_s(e,t,o,i,r))}if(o=e.child,!Ys(e,r)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:Yn)(a,i)&&e.ref===t.ref)return Js(e,t,r)}return t.flags|=1,(e=ji(o,i)).ref=t.ref,e.return=t,t.child=e}function _s(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(Yn(o,i)&&e.ref===t.ref){if(Rs=!1,t.pendingProps=i=o,!Ys(e,r))return t.lanes=e.lanes,Js(e,t,r);0!==(131072&e.flags)&&(Rs=!0)}}return As(e,t,n,i,r)}function Ds(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode){if(0!==(128&t.flags)){if(i=null!==o?o.baseLanes|n:n,null!==e){for(r=t.child=e.child,o=0;null!==r;)o=o|r.lanes|r.childLanes,r=r.sibling;t.childLanes=o&~i}else t.childLanes=0,t.child=null;return Ms(e,t,i,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Ms(e,t,null!==o?o.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&zr(0,null!==o?o.cachePool:null),null!==o?go(t,o):vo(),ss(t)}else null!==o?(zr(0,o.cachePool),go(t,o),cs(),t.memoizedState=null):(null!==e&&zr(0,null),vo(),cs());return Is(e,t,r,n),t.child}function Ms(e,t,n,i){var r=qr();return r=null===r?null:{parent:Dr._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&zr(0,null),vo(),ss(t),null!==e&&Cr(e,t,i,!0),null}function Ns(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function As(e,t,n,i,r){return Er(t),n=Do(e,t,n,i,void 0,r),i=Lo(),null===e||Rs?(or&&i&&tr(t),t.flags|=1,Is(e,t,n,r),t.child):(Uo(e,t,r),Js(e,t,r))}function Ls(e,t,n,i,r,o){return Er(t),t.updateQueue=null,n=No(t,i,n,r),Mo(e),i=Lo(),null===e||Rs?(or&&i&&tr(t),t.flags|=1,Is(e,t,n,o),t.child):(Uo(e,t,o),Js(e,t,o))}function Us(e,t,n,i,r){if(Er(t),null===t.stateNode){var o=Ni,a=n.contextType;"object"===typeof a&&null!==a&&(o=Pr(a)),o=new n(i,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=ps,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=i,o.state=t.memoizedState,o.refs={},no(t),a=n.contextType,o.context="object"===typeof a&&null!==a?Pr(a):Ni,o.state=t.memoizedState,"function"===typeof(a=n.getDerivedStateFromProps)&&(hs(t,n,a,i),o.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(a=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),a!==o.state&&ps.enqueueReplaceState(o,o.state,null),uo(t,i,o,r),lo(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){o=t.stateNode;var s=t.memoizedProps,c=gs(n,s);o.props=c;var l=o.context,d=n.contextType;a=Ni,"object"===typeof d&&null!==d&&(a=Pr(d));var u=n.getDerivedStateFromProps;d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate,s=t.pendingProps!==s,d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s||l!==a)&&fs(t,o,i,a),to=!1;var h=t.memoizedState;o.state=h,uo(t,i,o,r),lo(),l=t.memoizedState,s||h!==l||to?("function"===typeof u&&(hs(t,n,u,i),l=t.memoizedState),(c=to||ms(t,n,c,i,h,l,a))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=a,i=c):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,io(e,t),d=gs(n,a=t.memoizedProps),o.props=d,u=t.pendingProps,h=o.context,l=n.contextType,c=Ni,"object"===typeof l&&null!==l&&(c=Pr(l)),(l="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==u||h!==c)&&fs(t,o,i,c),to=!1,h=t.memoizedState,o.state=h,uo(t,i,o,r),lo();var p=t.memoizedState;a!==u||h!==p||to||null!==e&&null!==e.dependencies&&wr(e.dependencies)?("function"===typeof s&&(hs(t,n,s,i),p=t.memoizedState),(d=to||ms(t,n,d,i,h,p,c)||null!==e&&null!==e.dependencies&&wr(e.dependencies))?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=c,i=d):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return o=i,Ns(e,t),i=0!==(128&t.flags),o||i?(o=t.stateNode,n=i&&"function"!==typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&i?(t.child=ns(t,e.child,null,r),t.child=ns(t,null,n,r)):Is(e,t,n,r),t.memoizedState=o.state,e=t.child):e=Js(e,t,r),e}function js(e,t,n,i){return pr(),t.flags|=256,Is(e,t,n,i),t.child}var Fs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bs(e){return{baseLanes:e,cachePool:Hr()}}function Vs(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gl),e}function qs(e,t,n){var i,r=t.pendingProps,o=!1,s=0!==(128&t.flags);if((i=s)||(i=(null===e||null!==e.memoizedState)&&0!==(2&ds.current)),i&&(o=!0,t.flags&=-129),i=0!==(32&t.flags),t.flags&=-33,null===e){if(or){if(o?as(t):cs(),or){var c,l=rr;if(c=l){e:{for(c=l,l=sr;8!==c.nodeType;){if(!l){l=null;break e}if(null===(c=vu(c.nextSibling))){l=null;break e}}l=c}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==Yi?{id:$i,overflow:Xi}:null,retryLane:536870912,hydrationErrors:null},(c=Li(18,null,null,0)).stateNode=l,c.return=t,t.child=c,ir=t,rr=null,c=!0):c=!1}c||lr(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return gu(l)?t.lanes=32:t.lanes=536870912,null;ls(t)}return l=r.children,r=r.fallback,o?(cs(),l=Hs({mode:"hidden",children:l},o=t.mode),r=Vi(r,o,n,null),l.return=t,r.return=t,l.sibling=r,t.child=l,(o=t.child).memoizedState=Bs(n),o.childLanes=Vs(e,i,n),t.memoizedState=Fs,r):(as(t),zs(t,l))}if(null!==(c=e.memoizedState)&&null!==(l=c.dehydrated)){if(s)256&t.flags?(as(t),t.flags&=-257,t=Ws(e,t,n)):null!==t.memoizedState?(cs(),t.child=e.child,t.flags|=128,t=null):(cs(),o=r.fallback,l=t.mode,r=Hs({mode:"visible",children:r.children},l),(o=Vi(o,l,n,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,ns(t,e.child,null,n),(r=t.child).memoizedState=Bs(n),r.childLanes=Vs(e,i,n),t.memoizedState=Fs,t=o);else if(as(t),gu(l)){if(i=l.nextSibling&&l.nextSibling.dataset)var d=i.dgst;i=d,(r=Error(a(419))).stack="",r.digest=i,fr({value:r,source:null,stack:null}),t=Ws(e,t,n)}else if(Rs||Cr(e,t,n,!1),i=0!==(n&e.childLanes),Rs||i){if(null!==(i=il)&&(0!==(r=0!==((r=0!==(42&(r=n&-n))?1:Ie(r))&(i.suspendedLanes|n))?0:r)&&r!==c.retryLane))throw c.retryLane=r,_i(e,r),Ll(i,e,r),Ps;"$?"===l.data||Gl(),t=Ws(e,t,n)}else"$?"===l.data?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,rr=vu(l.nextSibling),ir=t,or=!0,ar=null,sr=!1,null!==e&&(Qi[Ji++]=$i,Qi[Ji++]=Xi,Qi[Ji++]=Yi,$i=e.id,Xi=e.overflow,Yi=t),(t=zs(t,r.children)).flags|=4096);return t}return o?(cs(),o=r.fallback,l=t.mode,d=(c=e.child).sibling,(r=ji(c,{mode:"hidden",children:r.children})).subtreeFlags=65011712&c.subtreeFlags,null!==d?o=ji(d,o):(o=Vi(o,l,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,null===(l=e.child.memoizedState)?l=Bs(n):(null!==(c=l.cachePool)?(d=Dr._currentValue,c=c.parent!==d?{parent:d,pool:d}:c):c=Hr(),l={baseLanes:l.baseLanes|n,cachePool:c}),o.memoizedState=l,o.childLanes=Vs(e,i,n),t.memoizedState=Fs,r):(as(t),e=(n=e.child).sibling,(n=ji(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function zs(e,t){return(t=Hs({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Hs(e,t){return(e=Li(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Ws(e,t,n){return ns(t,e.child,null,n),(e=zs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ks(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Tr(e.return,t,n)}function Gs(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Qs(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Is(e,t,i.children,n),0!==(2&(i=ds.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ks(e,n,t);else if(19===e.tag)Ks(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(V(ds,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===us(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Gs(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===us(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Gs(t,!0,n,null,o);break;case"together":Gs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Js(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),pl|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Cr(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=ji(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=ji(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ys(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!wr(e))}function $s(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Rs=!0;else{if(!Ys(e,n)&&0===(128&t.flags))return Rs=!1,function(e,t,n){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),yr(0,Dr,e.memoizedState.cache),pr();break;case 27:case 5:Q(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:yr(0,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(as(t),t.flags|=128,null):0!==(n&t.child.childLanes)?qs(e,t,n):(as(t),null!==(e=Js(e,t,n))?e.sibling:null);as(t);break;case 19:var r=0!==(128&e.flags);if((i=0!==(n&t.childLanes))||(Cr(e,t,n,!1),i=0!==(n&t.childLanes)),r){if(i)return Qs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),V(ds,ds.current),i)break;return null;case 22:case 23:return t.lanes=0,Ds(e,t,n);case 24:yr(0,Dr,e.memoizedState.cache)}return Js(e,t,n)}(e,t,n);Rs=0!==(131072&e.flags)}else Rs=!1,or&&0!==(1048576&t.flags)&&er(t,Gi,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,r=i._init;if(i=r(i._payload),t.type=i,"function"!==typeof i){if(void 0!==i&&null!==i){if((r=i.$$typeof)===S){t.tag=11,t=Os(null,t,i,e,n);break e}if(r===E){t.tag=14,t=xs(null,t,i,e,n);break e}}throw t=D(i)||i,Error(a(306,t,""))}Ui(i)?(e=gs(i,e),t.tag=1,t=Us(null,t,i,e,n)):(t.tag=0,t=As(null,t,i,e,n))}return t;case 0:return As(e,t,t.type,t.pendingProps,n);case 1:return Us(e,t,i=t.type,r=gs(i,t.pendingProps),n);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(a(387));i=t.pendingProps;var o=t.memoizedState;r=o.element,io(e,t),uo(t,i,null,n);var s=t.memoizedState;if(i=s.cache,yr(0,Dr,i),i!==o.cache&&Sr(t,[Dr],n,!0),lo(),i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=js(e,t,i,n);break e}if(i!==r){fr(r=wi(Error(a(424)),t)),t=js(e,t,i,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(rr=vu(e.firstChild),ir=t,or=!0,ar=null,sr=!0,n=is(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pr(),i===r){t=Js(e,t,n);break e}Is(e,t,i,n)}t=t.child}return t;case 26:return Ns(e,t),null===e?(n=Iu(t.type,null,t.pendingProps,null))?t.memoizedState=n:or||(n=t.type,e=t.pendingProps,(i=iu(H.current).createElement(n))[De]=t,i[Me]=e,eu(i,n,e),We(i),t.stateNode=i):t.memoizedState=Iu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Q(t),null===e&&or&&(i=t.stateNode=ku(t.type,t.pendingProps,H.current),ir=t,sr=!0,r=rr,pu(t.type)?(bu=r,rr=vu(i.firstChild)):rr=r),Is(e,t,t.pendingProps.children,n),Ns(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&or&&((r=i=rr)&&(null!==(i=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[Fe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===o)return e}if(null===(e=vu(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,sr))?(t.stateNode=i,ir=t,rr=vu(i.firstChild),sr=!1,r=!0):r=!1),r||lr(t)),Q(t),r=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,i=o.children,au(r,o)?i=null:null!==s&&au(r,s)&&(t.flags|=32),null!==t.memoizedState&&(r=Do(e,t,Ao,null,null,n),Qu._currentValue=r),Ns(e,t),Is(e,t,i,n),t.child;case 6:return null===e&&or&&((e=n=rr)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=vu(e.nextSibling)))return null}return e}(n,t.pendingProps,sr))?(t.stateNode=n,ir=t,rr=null,e=!0):e=!1),e||lr(t)),null;case 13:return qs(e,t,n);case 4:return K(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ns(t,null,i,n):Is(e,t,i,n),t.child;case 11:return Os(e,t,t.type,t.pendingProps,n);case 7:return Is(e,t,t.pendingProps,n),t.child;case 8:case 12:return Is(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,yr(0,t.type,i.value),Is(e,t,i.children,n),t.child;case 9:return r=t.type._context,i=t.pendingProps.children,Er(t),i=i(r=Pr(r)),t.flags|=1,Is(e,t,i,n),t.child;case 14:return xs(e,t,t.type,t.pendingProps,n);case 15:return _s(e,t,t.type,t.pendingProps,n);case 19:return Qs(e,t,n);case 31:return i=t.pendingProps,n=t.mode,i={mode:i.mode,children:i.children},null===e?((n=Hs(i,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=ji(e.child,i)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ds(e,t,n);case 24:return Er(t),i=Pr(Dr),null===e?(null===(r=qr())&&(r=il,o=Mr(),r.pooledCache=o,o.refCount++,null!==o&&(r.pooledCacheLanes|=n),r=o),t.memoizedState={parent:i,cache:r},no(t),yr(0,Dr,r)):(0!==(e.lanes&n)&&(io(e,t),uo(t,null,null,n),lo()),r=e.memoizedState,o=t.memoizedState,r.parent!==i?(r={parent:i,cache:i},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),yr(0,Dr,i)):(i=o.cache,yr(0,Dr,i),i!==r.cache&&Sr(t,[Dr],n,!0))),Is(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function Xs(e){e.flags|=4}function Zs(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Vu(t)){if(null!==(t=rs.current)&&((4194048&ol)===ol?null!==os:(62914560&ol)!==ol&&0===(536870912&ol)||t!==os))throw Xr=Qr,Kr;e.flags|=8192}}function ec(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ce():536870912,e.lanes|=t,vl|=t)}function tc(e,t){if(!or)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function nc(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=65011712&r.subtreeFlags,i|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function ic(e,t,n){var i=t.pendingProps;switch(nr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nc(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),kr(Dr),G(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(hr(t)?Xs(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,mr())),nc(t),null;case 26:return n=t.memoizedState,null===e?(Xs(t),null!==n?(nc(t),Zs(t,n)):(nc(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Xs(t),nc(t),Zs(t,n)):(nc(t),t.flags&=-16777217):(e.memoizedProps!==i&&Xs(t),nc(t),t.flags&=-16777217),null;case 27:J(t),n=H.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Xs(t);else{if(!i){if(null===t.stateNode)throw Error(a(166));return nc(t),null}e=q.current,hr(t)?dr(t):(e=ku(r,i,n),t.stateNode=e,Xs(t))}return nc(t),null;case 5:if(J(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Xs(t);else{if(!i){if(null===t.stateNode)throw Error(a(166));return nc(t),null}if(e=q.current,hr(t))dr(t);else{switch(r=iu(H.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof i.is?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"===typeof i.is?r.createElement(n,{is:i.is}):r.createElement(n)}}e[De]=t,e[Me]=i;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(eu(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Xs(t)}}return nc(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&Xs(t);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(e=H.current,hr(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(r=ir))switch(r.tag){case 27:case 5:i=r.memoizedProps}e[De]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Yd(e.nodeValue,n)))||lr(t)}else(e=iu(e).createTextNode(i))[De]=t,t.stateNode=e}return nc(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=hr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!r)throw Error(a(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[De]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nc(t),r=!1}else r=mr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(ls(t),t):(ls(t),null)}if(ls(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(r=i.alternate.memoizedState.cachePool.pool);var o=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(o=i.memoizedState.cachePool.pool),o!==r&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),ec(t,t.updateQueue),nc(t),null;case 4:return G(),null===e&&Bd(t.stateNode.containerInfo),nc(t),null;case 10:return kr(t.type),nc(t),null;case 19:if(B(ds),null===(r=t.memoizedState))return nc(t),null;if(i=0!==(128&t.flags),null===(o=r.rendering))if(i)tc(r,!1);else{if(0!==hl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=us(e))){for(t.flags|=128,tc(r,!1),e=o.updateQueue,t.updateQueue=e,ec(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Fi(n,e),n=n.sibling;return V(ds,1&ds.current|2),t.child}e=e.sibling}null!==r.tail&&te()>Sl&&(t.flags|=128,i=!0,tc(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=us(o))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,ec(t,e),tc(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!or)return nc(t),null}else 2*te()-r.renderingStartTime>Sl&&536870912!==n&&(t.flags|=128,i=!0,tc(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=te(),t.sibling=null,e=ds.current,V(ds,i?1&e|2:1&e),t):(nc(t),null);case 22:case 23:return ls(t),bo(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?0!==(536870912&n)&&0===(128&t.flags)&&(nc(t),6&t.subtreeFlags&&(t.flags|=8192)):nc(t),null!==(n=t.updateQueue)&&ec(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&B(Vr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),kr(Dr),nc(t),null;case 25:case 30:return null}throw Error(a(156,t.tag))}function rc(e,t){switch(nr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return kr(Dr),G(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return J(t),null;case 13:if(ls(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(ds),null;case 4:return G(),null;case 10:return kr(t.type),null;case 22:case 23:return ls(t),bo(),null!==e&&B(Vr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return kr(Dr),null;default:return null}}function oc(e,t){switch(nr(t),t.tag){case 3:kr(Dr),G();break;case 26:case 27:case 5:J(t);break;case 4:G();break;case 13:ls(t);break;case 19:B(ds);break;case 10:kr(t.type);break;case 22:case 23:ls(t),bo(),null!==e&&B(Vr);break;case 24:kr(Dr)}}function ac(e,t){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next;n=r;do{if((n.tag&e)===e){i=void 0;var o=n.create,a=n.inst;i=o(),a.destroy=i}n=n.next}while(n!==r)}}catch(s){dd(t,t.return,s)}}function sc(e,t,n){try{var i=t.updateQueue,r=null!==i?i.lastEffect:null;if(null!==r){var o=r.next;i=o;do{if((i.tag&e)===e){var a=i.inst,s=a.destroy;if(void 0!==s){a.destroy=void 0,r=t;var c=n,l=s;try{l()}catch(d){dd(r,c,d)}}}i=i.next}while(i!==o)}}catch(d){dd(t,t.return,d)}}function cc(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{po(t,n)}catch(i){dd(e,e.return,i)}}}function lc(e,t,n){n.props=gs(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){dd(e,t,i)}}function dc(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;default:i=e.stateNode}"function"===typeof n?e.refCleanup=n(i):n.current=i}}catch(r){dd(e,t,r)}}function uc(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"===typeof i)try{i()}catch(r){dd(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(o){dd(e,t,o)}else n.current=null}function hc(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){dd(e,e.return,r)}}function pc(e,t,n){try{var i=e.stateNode;!function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,o=null,s=null,c=null,l=null,d=null,u=null;for(m in n){var h=n[m];if(n.hasOwnProperty(m)&&null!=h)switch(m){case"checked":case"value":break;case"defaultValue":l=h;default:i.hasOwnProperty(m)||Xd(e,t,m,null,i,h)}}for(var p in i){var m=i[p];if(h=n[p],i.hasOwnProperty(p)&&(null!=m||null!=h))switch(p){case"type":o=m;break;case"name":r=m;break;case"checked":d=m;break;case"defaultChecked":u=m;break;case"value":s=m;break;case"defaultValue":c=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(a(137,t));break;default:m!==h&&Xd(e,t,p,m,i,h)}}return void gt(e,s,c,l,d,u,o,r);case"select":for(o in m=s=c=p=null,n)if(l=n[o],n.hasOwnProperty(o)&&null!=l)switch(o){case"value":break;case"multiple":m=l;default:i.hasOwnProperty(o)||Xd(e,t,o,null,i,l)}for(r in i)if(o=i[r],l=n[r],i.hasOwnProperty(r)&&(null!=o||null!=l))switch(r){case"value":p=o;break;case"defaultValue":c=o;break;case"multiple":s=o;default:o!==l&&Xd(e,t,r,o,i,l)}return t=c,n=s,i=m,void(null!=p?yt(e,!!n,p,!1):!!i!==!!n&&(null!=t?yt(e,!!n,t,!0):yt(e,!!n,n?[]:"",!1)));case"textarea":for(c in m=p=null,n)if(r=n[c],n.hasOwnProperty(c)&&null!=r&&!i.hasOwnProperty(c))switch(c){case"value":case"children":break;default:Xd(e,t,c,null,i,r)}for(s in i)if(r=i[s],o=n[s],i.hasOwnProperty(s)&&(null!=r||null!=o))switch(s){case"value":p=r;break;case"defaultValue":m=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==o&&Xd(e,t,s,r,i,o)}return void kt(e,p,m);case"option":for(var f in n)if(p=n[f],n.hasOwnProperty(f)&&null!=p&&!i.hasOwnProperty(f))if("selected"===f)e.selected=!1;else Xd(e,t,f,null,i,p);for(l in i)if(p=i[l],m=n[l],i.hasOwnProperty(l)&&p!==m&&(null!=p||null!=m))if("selected"===l)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Xd(e,t,l,p,i,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!i.hasOwnProperty(g)&&Xd(e,t,g,null,i,p);for(d in i)if(p=i[d],m=n[d],i.hasOwnProperty(d)&&p!==m&&(null!=p||null!=m))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,t));break;default:Xd(e,t,d,p,i,m)}return;default:if(Pt(t)){for(var v in n)p=n[v],n.hasOwnProperty(v)&&void 0!==p&&!i.hasOwnProperty(v)&&Zd(e,t,v,void 0,i,p);for(u in i)p=i[u],m=n[u],!i.hasOwnProperty(u)||p===m||void 0===p&&void 0===m||Zd(e,t,u,p,i,m);return}}for(var b in n)p=n[b],n.hasOwnProperty(b)&&null!=p&&!i.hasOwnProperty(b)&&Xd(e,t,b,null,i,p);for(h in i)p=i[h],m=n[h],!i.hasOwnProperty(h)||p===m||null==p&&null==m||Xd(e,t,h,p,i,m)}(i,e.type,n,t),i[Me]=t}catch(r){dd(e,e.return,r)}}function mc(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&pu(e.type)||4===e.tag}function fc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||mc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&pu(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$d));else if(4!==i&&(27===i&&pu(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gc(e,t,n),e=e.sibling;null!==e;)gc(e,t,n),e=e.sibling}function vc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&(27===i&&pu(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(vc(e,t,n),e=e.sibling;null!==e;)vc(e,t,n),e=e.sibling}function bc(e){var t=e.stateNode,n=e.memoizedProps;try{for(var i=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);eu(t,i,n),t[De]=e,t[Me]=n}catch(o){dd(e,e.return,o)}}var yc=!1,kc=!1,Tc=!1,Sc="function"===typeof WeakSet?WeakSet:Set,Cc=null;function wc(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:Uc(e,n),4&i&&ac(5,n);break;case 1:if(Uc(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(a){dd(n,n.return,a)}else{var r=gs(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){dd(n,n.return,s)}}64&i&&cc(n),512&i&&dc(n,n.return);break;case 3:if(Uc(e,n),64&i&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{po(e,t)}catch(a){dd(n,n.return,a)}}break;case 27:null===t&&4&i&&bc(n);case 26:case 5:Uc(e,n),null===t&&4&i&&hc(n),512&i&&dc(n,n.return);break;case 12:Uc(e,n);break;case 13:Uc(e,n),4&i&&xc(e,n),64&i&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var i=function(){t(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}(e,n=md.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||yc)){t=null!==t&&null!==t.memoizedState||kc,r=yc;var o=kc;yc=i,(kc=t)&&!o?Fc(e,n,0!==(8772&n.subtreeFlags)):Uc(e,n),yc=r,kc=o}break;case 30:break;default:Uc(e,n)}}function Ec(e){var t=e.alternate;null!==t&&(e.alternate=null,Ec(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Be(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Pc=null,Rc=!1;function Ic(e,t,n){for(n=n.child;null!==n;)Oc(e,t,n),n=n.sibling}function Oc(e,t,n){if(ue&&"function"===typeof ue.onCommitFiberUnmount)try{ue.onCommitFiberUnmount(de,n)}catch(o){}switch(n.tag){case 26:kc||uc(n,t),Ic(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:kc||uc(n,t);var i=Pc,r=Rc;pu(n.type)&&(Pc=n.stateNode,Rc=!1),Ic(e,t,n),Tu(n.stateNode),Pc=i,Rc=r;break;case 5:kc||uc(n,t);case 6:if(i=Pc,r=Rc,Pc=null,Ic(e,t,n),Rc=r,null!==(Pc=i))if(Rc)try{(9===Pc.nodeType?Pc.body:"HTML"===Pc.nodeName?Pc.ownerDocument.body:Pc).removeChild(n.stateNode)}catch(a){dd(n,t,a)}else try{Pc.removeChild(n.stateNode)}catch(a){dd(n,t,a)}break;case 18:null!==Pc&&(Rc?(mu(9===(e=Pc).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Rh(e)):mu(Pc,n.stateNode));break;case 4:i=Pc,r=Rc,Pc=n.stateNode.containerInfo,Rc=!0,Ic(e,t,n),Pc=i,Rc=r;break;case 0:case 11:case 14:case 15:kc||sc(2,n,t),kc||sc(4,n,t),Ic(e,t,n);break;case 1:kc||(uc(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount&&lc(n,t,i)),Ic(e,t,n);break;case 21:Ic(e,t,n);break;case 22:kc=(i=kc)||null!==n.memoizedState,Ic(e,t,n),kc=i;break;default:Ic(e,t,n)}}function xc(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Rh(e)}catch(n){dd(t,t.return,n)}}function _c(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Sc),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Sc),t;default:throw Error(a(435,e.tag))}}(e);t.forEach(function(t){var i=fd.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}function Dc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i],o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 27:if(pu(c.type)){Pc=c.stateNode,Rc=!1;break e}break;case 5:Pc=c.stateNode,Rc=!1;break e;case 3:case 4:Pc=c.stateNode.containerInfo,Rc=!0;break e}c=c.return}if(null===Pc)throw Error(a(160));Oc(o,s,r),Pc=null,Rc=!1,null!==(o=r.alternate)&&(o.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Nc(t,e),t=t.sibling}var Mc=null;function Nc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Dc(t,e),Ac(e),4&i&&(sc(3,e,e.return),ac(3,e),sc(5,e,e.return));break;case 1:Dc(t,e),Ac(e),512&i&&(kc||null===n||uc(n,n.return)),64&i&&yc&&(null!==(e=e.updateQueue)&&(null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var r=Mc;if(Dc(t,e),Ac(e),512&i&&(kc||null===n||uc(n,n.return)),4&i){var o=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":(!(o=r.getElementsByTagName("title")[0])||o[Fe]||o[De]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=r.createElement(i),r.head.insertBefore(o,r.querySelector("head > title"))),eu(o,i,n),o[De]=e,We(o),i=o;break e;case"link":var s=Fu("link","href",r).get(i+(n.href||""));if(s)for(var c=0;c<s.length;c++)if((o=s[c]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(c,1);break t}eu(o=r.createElement(i),i,n),r.head.appendChild(o);break;case"meta":if(s=Fu("meta","content",r).get(i+(n.content||"")))for(c=0;c<s.length;c++)if((o=s[c]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(c,1);break t}eu(o=r.createElement(i),i,n),r.head.appendChild(o);break;default:throw Error(a(468,i))}o[De]=e,We(o),i=o}e.stateNode=i}else Bu(r,e.type,e.stateNode);else e.stateNode=Nu(r,i,e.memoizedProps);else o!==i?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===i?Bu(r,e.type,e.stateNode):Nu(r,i,e.memoizedProps)):null===i&&null!==e.stateNode&&pc(e,e.memoizedProps,n.memoizedProps)}break;case 27:Dc(t,e),Ac(e),512&i&&(kc||null===n||uc(n,n.return)),null!==n&&4&i&&pc(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Dc(t,e),Ac(e),512&i&&(kc||null===n||uc(n,n.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(m){dd(e,e.return,m)}}4&i&&null!=e.stateNode&&pc(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&i&&(Tc=!0);break;case 6:if(Dc(t,e),Ac(e),4&i){if(null===e.stateNode)throw Error(a(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(m){dd(e,e.return,m)}}break;case 3:if(ju=null,r=Mc,Mc=wu(t.containerInfo),Dc(t,e),Mc=r,Ac(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Rh(t.containerInfo)}catch(m){dd(e,e.return,m)}Tc&&(Tc=!1,Lc(e));break;case 4:i=Mc,Mc=wu(e.stateNode.containerInfo),Dc(t,e),Ac(e),Mc=i;break;case 12:default:Dc(t,e),Ac(e);break;case 13:Dc(t,e),Ac(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(Tl=te()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,_c(e,i)));break;case 22:r=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,d=yc,u=kc;if(yc=d||r,kc=u||l,Dc(t,e),kc=u,yc=d,Ac(e),8192&i)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===n||l||yc||kc||jc(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(o=l.stateNode,r)"function"===typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{c=l.stateNode;var h=l.memoizedProps.style,p=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;c.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(m){dd(l,l.return,m)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=r?"":l.memoizedProps}catch(m){dd(l,l.return,m)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,_c(e,n))));break;case 19:Dc(t,e),Ac(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,_c(e,i)));case 30:case 21:}}function Ac(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(mc(i)){n=i;break}i=i.return}if(null==n)throw Error(a(160));switch(n.tag){case 27:var r=n.stateNode;vc(e,fc(e),r);break;case 5:var o=n.stateNode;32&n.flags&&(St(o,""),n.flags&=-33),vc(e,fc(e),o);break;case 3:case 4:var s=n.stateNode.containerInfo;gc(e,fc(e),s);break;default:throw Error(a(161))}}catch(c){dd(e,e.return,c)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Lc(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Lc(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Uc(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)wc(e,t.alternate,t),t=t.sibling}function jc(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:sc(4,t,t.return),jc(t);break;case 1:uc(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&lc(t,t.return,n),jc(t);break;case 27:Tu(t.stateNode);case 26:case 5:uc(t,t.return),jc(t);break;case 22:null===t.memoizedState&&jc(t);break;default:jc(t)}e=e.sibling}}function Fc(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,o=t,a=o.flags;switch(o.tag){case 0:case 11:case 15:Fc(r,o,n),ac(4,o);break;case 1:if(Fc(r,o,n),"function"===typeof(r=(i=o).stateNode).componentDidMount)try{r.componentDidMount()}catch(l){dd(i,i.return,l)}if(null!==(r=(i=o).updateQueue)){var s=i.stateNode;try{var c=r.shared.hiddenCallbacks;if(null!==c)for(r.shared.hiddenCallbacks=null,r=0;r<c.length;r++)ho(c[r],s)}catch(l){dd(i,i.return,l)}}n&&64&a&&cc(o),dc(o,o.return);break;case 27:bc(o);case 26:case 5:Fc(r,o,n),n&&null===i&&4&a&&hc(o),dc(o,o.return);break;case 12:Fc(r,o,n);break;case 13:Fc(r,o,n),n&&4&a&&xc(r,o);break;case 22:null===o.memoizedState&&Fc(r,o,n),dc(o,o.return);break;case 30:break;default:Fc(r,o,n)}t=t.sibling}}function Bc(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Nr(n))}function Vc(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Nr(e))}function qc(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)zc(e,t,n,i),t=t.sibling}function zc(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:qc(e,t,n,i),2048&r&&ac(9,t);break;case 1:case 13:default:qc(e,t,n,i);break;case 3:qc(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Nr(e)));break;case 12:if(2048&r){qc(e,t,n,i),e=t.stateNode;try{var o=t.memoizedProps,a=o.id,s=o.onPostCommit;"function"===typeof s&&s(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(c){dd(t,t.return,c)}}else qc(e,t,n,i);break;case 23:break;case 22:o=t.stateNode,a=t.alternate,null!==t.memoizedState?2&o._visibility?qc(e,t,n,i):Wc(e,t):2&o._visibility?qc(e,t,n,i):(o._visibility|=2,Hc(e,t,n,i,0!==(10256&t.subtreeFlags))),2048&r&&Bc(a,t);break;case 24:qc(e,t,n,i),2048&r&&Vc(t.alternate,t)}}function Hc(e,t,n,i,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,a=t,s=n,c=i,l=a.flags;switch(a.tag){case 0:case 11:case 15:Hc(o,a,s,c,r),ac(8,a);break;case 23:break;case 22:var d=a.stateNode;null!==a.memoizedState?2&d._visibility?Hc(o,a,s,c,r):Wc(o,a):(d._visibility|=2,Hc(o,a,s,c,r)),r&&2048&l&&Bc(a.alternate,a);break;case 24:Hc(o,a,s,c,r),r&&2048&l&&Vc(a.alternate,a);break;default:Hc(o,a,s,c,r)}t=t.sibling}}function Wc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:Wc(n,i),2048&r&&Bc(i.alternate,i);break;case 24:Wc(n,i),2048&r&&Vc(i.alternate,i);break;default:Wc(n,i)}t=t.sibling}}var Kc=8192;function Gc(e){if(e.subtreeFlags&Kc)for(e=e.child;null!==e;)Qc(e),e=e.sibling}function Qc(e){switch(e.tag){case 26:Gc(e),e.flags&Kc&&null!==e.memoizedState&&function(e,t,n){if(null===qu)throw Error(a(475));var i=qu;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=Ou(n.href),o=e.querySelector(xu(r));if(o)return null!==(e=o._p)&&"object"===typeof e&&"function"===typeof e.then&&(i.count++,i=Hu.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=o,void We(o);o=e.ownerDocument||e,n=_u(n),(r=Su.get(r))&&Lu(n,r),We(o=o.createElement("link"));var s=o;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),eu(o,"link",n),t.instance=o}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(i.count++,t=Hu.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(Mc,e.memoizedState,e.memoizedProps);break;case 5:default:Gc(e);break;case 3:case 4:var t=Mc;Mc=wu(e.stateNode.containerInfo),Gc(e),Mc=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Kc,Kc=16777216,Gc(e),Kc=t):Gc(e))}}function Jc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Yc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];Cc=i,Zc(i,e)}Jc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)$c(e),e=e.sibling}function $c(e){switch(e.tag){case 0:case 11:case 15:Yc(e),2048&e.flags&&sc(9,e,e.return);break;case 3:case 12:default:Yc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Xc(e)):Yc(e)}}function Xc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];Cc=i,Zc(i,e)}Jc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:sc(8,t,t.return),Xc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Xc(t));break;default:Xc(t)}e=e.sibling}}function Zc(e,t){for(;null!==Cc;){var n=Cc;switch(n.tag){case 0:case 11:case 15:sc(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Nr(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,Cc=i;else e:for(n=e;null!==Cc;){var r=(i=Cc).sibling,o=i.return;if(Ec(i),i===n){Cc=null;break e}if(null!==r){r.return=o,Cc=r;break e}Cc=o}}}var el={getCacheForType:function(e){var t=Pr(Dr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tl="function"===typeof WeakMap?WeakMap:Map,nl=0,il=null,rl=null,ol=0,al=0,sl=null,cl=!1,ll=!1,dl=!1,ul=0,hl=0,pl=0,ml=0,fl=0,gl=0,vl=0,bl=null,yl=null,kl=!1,Tl=0,Sl=1/0,Cl=null,wl=null,El=0,Pl=null,Rl=null,Il=0,Ol=0,xl=null,_l=null,Dl=0,Ml=null;function Nl(){if(0!==(2&nl)&&0!==ol)return ol&-ol;if(null!==N.T){return 0!==Ur?Ur:Od()}return xe()}function Al(){0===gl&&(gl=0===(536870912&ol)||or?Se():536870912);var e=rs.current;return null!==e&&(e.flags|=32),gl}function Ll(e,t,n){(e!==il||2!==al&&9!==al)&&null===e.cancelPendingCommit||(zl(e,0),Bl(e,ol,gl,!1)),Ee(e,n),0!==(2&nl)&&e===il||(e===il&&(0===(2&nl)&&(ml|=n),4===hl&&Bl(e,ol,gl,!1)),Sd(e))}function Ul(e,t,n){if(0!==(6&nl))throw Error(a(327));for(var i=!n&&0===(124&t)&&0===(t&e.expiredLanes)||ke(e,t),r=i?function(e,t){var n=nl;nl|=2;var i=Wl(),r=Kl();il!==e||ol!==t?(Cl=null,Sl=te()+500,zl(e,t)):ll=ke(e,t);e:for(;;)try{if(0!==al&&null!==rl){t=rl;var o=sl;t:switch(al){case 1:al=0,sl=null,Zl(e,t,o,1);break;case 2:case 9:if(Jr(o)){al=0,sl=null,Xl(t);break}t=function(){2!==al&&9!==al||il!==e||(al=7),Sd(e)},o.then(t,t);break e;case 3:al=7;break e;case 4:al=5;break e;case 7:Jr(o)?(al=0,sl=null,Xl(t)):(al=0,sl=null,Zl(e,t,o,7));break;case 5:var s=null;switch(rl.tag){case 26:s=rl.memoizedState;case 5:case 27:var c=rl;if(!s||Vu(s)){al=0,sl=null;var l=c.sibling;if(null!==l)rl=l;else{var d=c.return;null!==d?(rl=d,ed(d)):rl=null}break t}}al=0,sl=null,Zl(e,t,o,5);break;case 6:al=0,sl=null,Zl(e,t,o,6);break;case 8:ql(),hl=6;break e;default:throw Error(a(462))}}Yl();break}catch(u){Hl(e,u)}return br=vr=null,N.H=i,N.A=r,nl=n,null!==rl?0:(il=null,ol=0,Ii(),hl)}(e,t):Ql(e,t,!0),o=i;;){if(0===r){ll&&!i&&Bl(e,t,0,!1);break}if(n=e.current.alternate,!o||Fl(n)){if(2===r){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var c=e;r=bl;var l=c.current.memoizedState.isDehydrated;if(l&&(zl(c,s).flags|=256),2!==(s=Ql(c,s,!1))){if(dl&&!l){c.errorRecoveryDisabledLanes|=o,ml|=o,r=4;break e}o=yl,yl=r,null!==o&&(null===yl?yl=o:yl.push.apply(yl,o))}r=s}if(o=!1,2!==r)continue}}if(1===r){zl(e,0),Bl(e,t,0,!0);break}e:{switch(i=e,o=r){case 0:case 1:throw Error(a(345));case 4:if((4194048&t)!==t)break;case 6:Bl(i,t,gl,!cl);break e;case 2:yl=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&t)===t&&10<(r=Tl+300-te())){if(Bl(i,t,gl,!cl),0!==ye(i,0,!0))break e;i.timeoutHandle=cu(jl.bind(null,i,n,yl,Cl,kl,t,gl,ml,vl,cl,o,2,-0,0),r)}else jl(i,n,yl,Cl,kl,t,gl,ml,vl,cl,o,0,-0,0)}break}r=Ql(e,t,!1),o=!1}Sd(e)}function jl(e,t,n,i,r,o,s,c,l,d,u,h,p,m){if(e.timeoutHandle=-1,(8192&(h=t.subtreeFlags)||16785408===(16785408&h))&&(qu={stylesheets:null,count:0,unsuspend:zu},Qc(t),null!==(h=function(){if(null===qu)throw Error(a(475));var e=qu;return e.stylesheets&&0===e.count&&Ku(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Ku(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=h(nd.bind(null,e,t,o,n,i,r,s,c,l,u,1,p,m)),void Bl(e,o,s,!d);nd(e,t,o,n,i,r,s,c,l)}function Fl(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!Jn(o(),r))return!1}catch(a){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bl(e,t,n,i){t&=~fl,t&=~ml,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var r=t;0<r;){var o=31-pe(r),a=1<<o;i[o]=-1,r&=~a}0!==n&&Pe(e,n,t)}function Vl(){return 0!==(6&nl)||(Cd(0,!1),!1)}function ql(){if(null!==rl){if(0===al)var e=rl.return;else br=vr=null,jo(e=rl),Ja=null,Ya=0,e=rl;for(;null!==e;)oc(e.alternate,e),e=e.return;rl=null}}function zl(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,lu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),ql(),il=e,rl=n=ji(e.current,null),ol=t,al=0,sl=null,cl=!1,ll=ke(e,t),dl=!1,vl=gl=fl=ml=pl=hl=0,yl=bl=null,kl=!1,0!==(8&t)&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-pe(i),o=1<<r;t|=e[r],i&=~o}return ul=t,Ii(),n}function Hl(e,t){ko=null,N.H=Wa,t===Wr||t===Gr?(t=Zr(),al=3):t===Kr?(t=Zr(),al=4):al=t===Ps?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,sl=t,null===rl&&(hl=1,Ts(e,wi(t,e.current)))}function Wl(){var e=N.H;return N.H=Wa,null===e?Wa:e}function Kl(){var e=N.A;return N.A=el,e}function Gl(){hl=4,cl||(4194048&ol)!==ol&&null!==rs.current||(ll=!0),0===(134217727&pl)&&0===(134217727&ml)||null===il||Bl(il,ol,gl,!1)}function Ql(e,t,n){var i=nl;nl|=2;var r=Wl(),o=Kl();il===e&&ol===t||(Cl=null,zl(e,t)),t=!1;var a=hl;e:for(;;)try{if(0!==al&&null!==rl){var s=rl,c=sl;switch(al){case 8:ql(),a=6;break e;case 3:case 2:case 9:case 6:null===rs.current&&(t=!0);var l=al;if(al=0,sl=null,Zl(e,s,c,l),n&&ll){a=0;break e}break;default:l=al,al=0,sl=null,Zl(e,s,c,l)}}Jl(),a=hl;break}catch(d){Hl(e,d)}return t&&e.shellSuspendCounter++,br=vr=null,nl=i,N.H=r,N.A=o,null===rl&&(il=null,ol=0,Ii()),a}function Jl(){for(;null!==rl;)$l(rl)}function Yl(){for(;null!==rl&&!Z();)$l(rl)}function $l(e){var t=$s(e.alternate,e,ul);e.memoizedProps=e.pendingProps,null===t?ed(e):rl=t}function Xl(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ls(n,t,t.pendingProps,t.type,void 0,ol);break;case 11:t=Ls(n,t,t.pendingProps,t.type.render,t.ref,ol);break;case 5:jo(t);default:oc(n,t),t=$s(n,t=rl=Fi(t,ul),ul)}e.memoizedProps=e.pendingProps,null===t?ed(e):rl=t}function Zl(e,t,n,i){br=vr=null,jo(t),Ja=null,Ya=0;var r=t.return;try{if(function(e,t,n,i,r){if(n.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){if(null!==(t=n.alternate)&&Cr(t,n,r,!0),null!==(n=rs.current)){switch(n.tag){case 13:return null===os?Gl():null===n.alternate&&0===hl&&(hl=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===Qr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),ud(e,i,r)),!1;case 22:return n.flags|=65536,i===Qr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),ud(e,i,r)),!1}throw Error(a(435,n.tag))}return ud(e,i,r),Gl(),!1}if(or)return null!==(t=rs.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,i!==cr&&fr(wi(e=Error(a(422),{cause:i}),n))):(i!==cr&&fr(wi(t=Error(a(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,i=wi(i,n),so(e,r=Cs(e.stateNode,i,r)),4!==hl&&(hl=2)),!1;var o=Error(a(520),{cause:i});if(o=wi(o,n),null===bl?bl=[o]:bl.push(o),4!==hl&&(hl=2),null===t)return!0;i=wi(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,so(n,e=Cs(n.stateNode,i,e)),!1;case 1:if(t=n.type,o=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===wl||!wl.has(o))))return n.flags|=65536,r&=-r,n.lanes|=r,Es(r=ws(r),e,n,i),so(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,ol))return hl=1,Ts(e,wi(n,e.current)),void(rl=null)}catch(o){if(null!==r)throw rl=r,o;return hl=1,Ts(e,wi(n,e.current)),void(rl=null)}32768&t.flags?(or||1===i?e=!0:ll||0!==(536870912&ol)?e=!1:(cl=e=!0,(2===i||9===i||3===i||6===i)&&(null!==(i=rs.current)&&13===i.tag&&(i.flags|=16384))),td(t,e)):ed(t)}function ed(e){var t=e;do{if(0!==(32768&t.flags))return void td(t,cl);e=t.return;var n=ic(t.alternate,t,ul);if(null!==n)return void(rl=n);if(null!==(t=t.sibling))return void(rl=t);rl=t=e}while(null!==t);0===hl&&(hl=5)}function td(e,t){do{var n=rc(e.alternate,e);if(null!==n)return n.flags&=32767,void(rl=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(rl=e);rl=e=n}while(null!==e);hl=6,rl=null}function nd(e,t,n,i,r,o,s,c,l){e.cancelPendingCommit=null;do{sd()}while(0!==El);if(0!==(6&nl))throw Error(a(327));if(null!==t){if(t===e.current)throw Error(a(177));if(o=t.lanes|t.childLanes,function(e,t,n,i,r,o){var a=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,c=e.expirationTimes,l=e.hiddenUpdates;for(n=a&~n;0<n;){var d=31-pe(n),u=1<<d;s[d]=0,c[d]=-1;var h=l[d];if(null!==h)for(l[d]=null,d=0;d<h.length;d++){var p=h[d];null!==p&&(p.lane&=-536870913)}n&=~u}0!==i&&Pe(e,i,0),0!==o&&0===r&&0!==e.tag&&(e.suspendedLanes|=o&~(a&~t))}(e,n,o|=Ri,s,c,l),e===il&&(rl=il=null,ol=0),Rl=t,Pl=e,Il=n,Ol=o,xl=r,_l=i,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,$(oe,function(){return cd(),null})):(e.callbackNode=null,e.callbackPriority=0),i=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||i){i=N.T,N.T=null,r=A.p,A.p=2,s=nl,nl|=4;try{!function(e,t){if(e=e.containerInfo,tu=nh,ti(e=ei(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(g){n=null;break e}var s=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==r&&3!==h.nodeType||(c=s+r),h!==o||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===r&&(c=s),p===o&&++u===i&&(l=s),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(nu={focusedElem:e,selectionRange:n},nh=!1,Cc=t;null!==Cc;)if(e=(t=Cc).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Cc=e;else for(;null!==Cc;){switch(o=(t=Cc).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,n=t,r=o.memoizedProps,o=o.memoizedState,i=n.stateNode;try{var f=gs(n.type,r,(n.elementType,n.type));e=i.getSnapshotBeforeUpdate(f,o),i.__reactInternalSnapshotBeforeUpdate=e}catch(v){dd(n,n.return,v)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))fu(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":fu(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,Cc=e;break}Cc=t.return}}(e,t)}finally{nl=s,A.p=r,N.T=i}}El=1,id(),rd(),od()}}function id(){if(1===El){El=0;var e=Pl,t=Rl,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=N.T,N.T=null;var i=A.p;A.p=2;var r=nl;nl|=4;try{Nc(t,e);var o=nu,a=ei(e.containerInfo),s=o.focusedElem,c=o.selectionRange;if(a!==s&&s&&s.ownerDocument&&Zn(s.ownerDocument.documentElement,s)){if(null!==c&&ti(s)){var l=c.start,d=c.end;if(void 0===d&&(d=l),"selectionStart"in s)s.selectionStart=l,s.selectionEnd=Math.min(d,s.value.length);else{var u=s.ownerDocument||document,h=u&&u.defaultView||window;if(h.getSelection){var p=h.getSelection(),m=s.textContent.length,f=Math.min(c.start,m),g=void 0===c.end?f:Math.min(c.end,m);!p.extend&&f>g&&(a=g,g=f,f=a);var v=Xn(s,f),b=Xn(s,g);if(v&&b&&(1!==p.rangeCount||p.anchorNode!==v.node||p.anchorOffset!==v.offset||p.focusNode!==b.node||p.focusOffset!==b.offset)){var y=u.createRange();y.setStart(v.node,v.offset),p.removeAllRanges(),f>g?(p.addRange(y),p.extend(b.node,b.offset)):(y.setEnd(b.node,b.offset),p.addRange(y))}}}}for(u=[],p=s;p=p.parentNode;)1===p.nodeType&&u.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<u.length;s++){var k=u[s];k.element.scrollLeft=k.left,k.element.scrollTop=k.top}}nh=!!tu,nu=tu=null}finally{nl=r,A.p=i,N.T=n}}e.current=t,El=2}}function rd(){if(2===El){El=0;var e=Pl,t=Rl,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=N.T,N.T=null;var i=A.p;A.p=2;var r=nl;nl|=4;try{wc(e,t.alternate,t)}finally{nl=r,A.p=i,N.T=n}}El=3}}function od(){if(4===El||3===El){El=0,ee();var e=Pl,t=Rl,n=Il,i=_l;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?El=5:(El=0,Rl=Pl=null,ad(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(wl=null),Oe(n),t=t.stateNode,ue&&"function"===typeof ue.onCommitFiberRoot)try{ue.onCommitFiberRoot(de,t,void 0,128===(128&t.current.flags))}catch(c){}if(null!==i){t=N.T,r=A.p,A.p=2,N.T=null;try{for(var o=e.onRecoverableError,a=0;a<i.length;a++){var s=i[a];o(s.value,{componentStack:s.stack})}}finally{N.T=t,A.p=r}}0!==(3&Il)&&sd(),Sd(e),r=e.pendingLanes,0!==(4194090&n)&&0!==(42&r)?e===Ml?Dl++:(Dl=0,Ml=e):Dl=0,Cd(0,!1)}}function ad(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Nr(t)))}function sd(e){return id(),rd(),od(),cd()}function cd(){if(5!==El)return!1;var e=Pl,t=Ol;Ol=0;var n=Oe(Il),i=N.T,r=A.p;try{A.p=32>n?32:n,N.T=null,n=xl,xl=null;var o=Pl,s=Il;if(El=0,Rl=Pl=null,Il=0,0!==(6&nl))throw Error(a(331));var c=nl;if(nl|=4,$c(o.current),zc(o,o.current,s,n),nl=c,Cd(0,!1),ue&&"function"===typeof ue.onPostCommitFiberRoot)try{ue.onPostCommitFiberRoot(de,o)}catch(l){}return!0}finally{A.p=r,N.T=i,ad(e,t)}}function ld(e,t,n){t=wi(n,t),null!==(e=oo(e,t=Cs(e.stateNode,t,2),2))&&(Ee(e,2),Sd(e))}function dd(e,t,n){if(3===e.tag)ld(e,e,n);else for(;null!==t;){if(3===t.tag){ld(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===wl||!wl.has(i))){e=wi(n,e),null!==(i=oo(t,n=ws(2),2))&&(Es(n,i,t,e),Ee(i,2),Sd(i));break}}t=t.return}}function ud(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new tl;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(dl=!0,r.add(n),e=hd.bind(null,e,t,n),t.then(e,e))}function hd(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,il===e&&(ol&n)===n&&(4===hl||3===hl&&(62914560&ol)===ol&&300>te()-Tl?0===(2&nl)&&zl(e,0):fl|=n,vl===ol&&(vl=0)),Sd(e)}function pd(e,t){0===t&&(t=Ce()),null!==(e=_i(e,t))&&(Ee(e,t),Sd(e))}function md(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),pd(e,n)}function fd(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==i&&i.delete(t),pd(e,n)}var gd=null,vd=null,bd=!1,yd=!1,kd=!1,Td=0;function Sd(e){e!==vd&&null===e.next&&(null===vd?gd=vd=e:vd=vd.next=e),yd=!0,bd||(bd=!0,uu(function(){0!==(6&nl)?$(ie,wd):Ed()}))}function Cd(e,t){if(!kd&&yd){kd=!0;do{for(var n=!1,i=gd;null!==i;){if(!t)if(0!==e){var r=i.pendingLanes;if(0===r)var o=0;else{var a=i.suspendedLanes,s=i.pingedLanes;o=(1<<31-pe(42|e)+1)-1,o=201326741&(o&=r&~(a&~s))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,Id(i,o))}else o=ol,0===(3&(o=ye(i,i===il?o:0,null!==i.cancelPendingCommit||-1!==i.timeoutHandle)))||ke(i,o)||(n=!0,Id(i,o));i=i.next}}while(n);kd=!1}}function wd(){Ed()}function Ed(){yd=bd=!1;var e=0;0!==Td&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==su&&(su=e,!0);return su=null,!1}()&&(e=Td),Td=0);for(var t=te(),n=null,i=gd;null!==i;){var r=i.next,o=Pd(i,t);0===o?(i.next=null,null===n?gd=r:n.next=r,null===r&&(vd=n)):(n=i,(0!==e||0!==(3&o))&&(yd=!0)),i=r}Cd(e,!1)}function Pd(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var a=31-pe(o),s=1<<a,c=r[a];-1===c?0!==(s&n)&&0===(s&i)||(r[a]=Te(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}if(n=ol,n=ye(e,e===(t=il)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),i=e.callbackNode,0===n||e===t&&(2===al||9===al)||null!==e.cancelPendingCommit)return null!==i&&null!==i&&X(i),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||ke(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&X(i),Oe(n)){case 2:case 8:n=re;break;case 32:default:n=oe;break;case 268435456:n=se}return i=Rd.bind(null,e),n=$(n,i),e.callbackPriority=t,e.callbackNode=n,t}return null!==i&&null!==i&&X(i),e.callbackPriority=2,e.callbackNode=null,2}function Rd(e,t){if(0!==El&&5!==El)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(sd()&&e.callbackNode!==n)return null;var i=ol;return 0===(i=ye(e,e===il?i:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Ul(e,i,t),Pd(e,te()),null!=e.callbackNode&&e.callbackNode===n?Rd.bind(null,e):null)}function Id(e,t){if(sd())return null;Ul(e,t,!0)}function Od(){return 0===Td&&(Td=Se()),Td}function xd(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Ot(""+e)}function _d(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Dd=0;Dd<Ti.length;Dd++){var Md=Ti[Dd];Si(Md.toLowerCase(),"on"+(Md[0].toUpperCase()+Md.slice(1)))}Si(pi,"onAnimationEnd"),Si(mi,"onAnimationIteration"),Si(fi,"onAnimationStart"),Si("dblclick","onDoubleClick"),Si("focusin","onFocus"),Si("focusout","onBlur"),Si(gi,"onTransitionRun"),Si(vi,"onTransitionStart"),Si(bi,"onTransitionCancel"),Si(yi,"onTransitionEnd"),Je("onMouseEnter",["mouseout","mouseover"]),Je("onMouseLeave",["mouseout","mouseover"]),Je("onPointerEnter",["pointerout","pointerover"]),Je("onPointerLeave",["pointerout","pointerover"]),Qe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ad=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Nd));function Ld(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&r.isPropagationStopped())break e;o=s,r.currentTarget=l;try{o(r)}catch(d){vs(d)}r.currentTarget=null,o=c}else for(a=0;a<i.length;a++){if(c=(s=i[a]).instance,l=s.currentTarget,s=s.listener,c!==o&&r.isPropagationStopped())break e;o=s,r.currentTarget=l;try{o(r)}catch(d){vs(d)}r.currentTarget=null,o=c}}}}function Ud(e,t){var n=t[Ae];void 0===n&&(n=t[Ae]=new Set);var i=e+"__bubble";n.has(i)||(Vd(t,e,2,!1),n.add(i))}function jd(e,t,n){var i=0;t&&(i|=4),Vd(n,e,i,t)}var Fd="_reactListening"+Math.random().toString(36).slice(2);function Bd(e){if(!e[Fd]){e[Fd]=!0,Ke.forEach(function(t){"selectionchange"!==t&&(Ad.has(t)||jd(t,!1,e),jd(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Fd]||(t[Fd]=!0,jd("selectionchange",!1,t))}}function Vd(e,t,n,i){switch(lh(t)){case 2:var r=ih;break;case 8:r=rh;break;default:r=oh}n=r.bind(null,t,n,e),r=void 0,!Ft||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qd(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&a.stateNode.containerInfo===r)return;a=a.return}for(;null!==s;){if(null===(a=Ve(s)))return;if(5===(l=a.tag)||6===l||26===l||27===l){i=o=a;continue e}s=s.parentNode}}i=i.return}Lt(function(){var i=o,r=_t(n),a=[];e:{var s=ki.get(e);if(void 0!==s){var l=Zt,d=e;switch(e){case"keypress":if(0===Wt(n))break e;case"keydown":case"keyup":l=fn;break;case"focusin":d="focus",l=an;break;case"focusout":d="blur",l=an;break;case"beforeblur":case"afterblur":l=an;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=vn;break;case pi:case mi:case fi:l=sn;break;case yi:l=bn;break;case"scroll":case"scrollend":l=tn;break;case"wheel":l=yn;break;case"copy":case"cut":case"paste":l=cn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=gn;break;case"toggle":case"beforetoggle":l=kn}var u=0!==(4&t),h=!u&&("scroll"===e||"scrollend"===e),p=u?null!==s?s+"Capture":null:s;u=[];for(var m,f=i;null!==f;){var g=f;if(m=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===m||null===p||null!=(g=Ut(f,p))&&u.push(zd(f,g,m)),h)break;f=f.return}0<u.length&&(s=new l(s,d,null,n,r),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xt||!(d=n.relatedTarget||n.fromElement)||!Ve(d)&&!d[Ne])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(d=(d=n.relatedTarget||n.toElement)?Ve(d):null)&&(h=c(d),u=d.tag,d!==h||5!==u&&27!==u&&6!==u)&&(d=null)):(l=null,d=i),l!==d)){if(u=rn,g="onMouseLeave",p="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=gn,g="onPointerLeave",p="onPointerEnter",f="pointer"),h=null==l?s:ze(l),m=null==d?s:ze(d),(s=new u(g,f+"leave",l,n,r)).target=h,s.relatedTarget=m,g=null,Ve(r)===i&&((u=new u(p,f+"enter",d,n,r)).target=m,u.relatedTarget=h,g=u),h=g,l&&d)e:{for(p=d,f=0,m=u=l;m;m=Wd(m))f++;for(m=0,g=p;g;g=Wd(g))m++;for(;0<f-m;)u=Wd(u),f--;for(;0<m-f;)p=Wd(p),m--;for(;f--;){if(u===p||null!==p&&u===p.alternate)break e;u=Wd(u),p=Wd(p)}u=null}else u=null;null!==l&&Kd(a,s,l,u,!1),null!==d&&null!==h&&Kd(a,h,d,u,!0)}if("select"===(l=(s=i?ze(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var v=jn;else if(Dn(s))if(Fn)v=Qn;else{v=Kn;var b=Wn}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?i&&Pt(i.elementType)&&(v=jn):v=Gn;switch(v&&(v=v(e,i))?Mn(a,v,n,r):(b&&b(e,s,i),"focusout"===e&&i&&"number"===s.type&&null!=i.memoizedProps.value&&bt(s,"number",s.value)),b=i?ze(i):window,e){case"focusin":(Dn(b)||"true"===b.contentEditable)&&(ii=b,ri=i,oi=null);break;case"focusout":oi=ri=ii=null;break;case"mousedown":ai=!0;break;case"contextmenu":case"mouseup":case"dragend":ai=!1,si(a,n,r);break;case"selectionchange":if(ni)break;case"keydown":case"keyup":si(a,n,r)}var y;if(Sn)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else xn?In(e,n)&&(k="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(k="onCompositionStart");k&&(En&&"ko"!==n.locale&&(xn||"onCompositionStart"!==k?"onCompositionEnd"===k&&xn&&(y=Ht()):(qt="value"in(Vt=r)?Vt.value:Vt.textContent,xn=!0)),0<(b=Hd(i,k)).length&&(k=new ln(k,e,null,n,r),a.push({event:k,listeners:b}),y?k.data=y:null!==(y=On(n))&&(k.data=y))),(y=wn?function(e,t){switch(e){case"compositionend":return On(t);case"keypress":return 32!==t.which?null:(Rn=!0,Pn);case"textInput":return(e=t.data)===Pn&&Rn?null:e;default:return null}}(e,n):function(e,t){if(xn)return"compositionend"===e||!Sn&&In(e,t)?(e=Ht(),zt=qt=Vt=null,xn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return En&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(k=Hd(i,"onBeforeInput")).length&&(b=new ln("onBeforeInput","beforeinput",null,n,r),a.push({event:b,listeners:k}),b.data=y)),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var o=xd((r[Me]||null).action),a=i.submitter;a&&null!==(t=(t=a[Me]||null)?xd(t.formAction):a.getAttribute("formAction"))&&(o=t,a=null);var s=new Zt("action","action",null,i,r);e.push({event:s,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==Td){var e=a?_d(r,a):new FormData(r);_a(n,{pending:!0,data:e,method:r.method,action:o},null,e)}}else"function"===typeof o&&(s.preventDefault(),e=a?_d(r,a):new FormData(r),_a(n,{pending:!0,data:e,method:r.method,action:o},o,e))},currentTarget:r}]})}}(a,e,i,n,r)}Ld(a,t)})}function zd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hd(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===o||(null!=(r=Ut(e,n))&&i.unshift(zd(e,r,o)),null!=(r=Ut(e,t))&&i.push(zd(e,r,o))),3===e.tag)return i;e=e.return}return[]}function Wd(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Kd(e,t,n,i,r){for(var o=t._reactName,a=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(s=s.tag,null!==c&&c===i)break;5!==s&&26!==s&&27!==s||null===l||(c=l,r?null!=(l=Ut(n,o))&&a.unshift(zd(n,l,c)):r||null!=(l=Ut(n,o))&&a.push(zd(n,l,c))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Gd=/\r\n?/g,Qd=/\u0000|\uFFFD/g;function Jd(e){return("string"===typeof e?e:""+e).replace(Gd,"\n").replace(Qd,"")}function Yd(e,t){return t=Jd(t),Jd(e)===t}function $d(){}function Xd(e,t,n,i,r,o){switch(n){case"children":"string"===typeof i?"body"===t||"textarea"===t&&""===i||St(e,i):("number"===typeof i||"bigint"===typeof i)&&"body"!==t&&St(e,""+i);break;case"className":nt(e,"class",i);break;case"tabIndex":nt(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,i);break;case"style":Et(e,i,o);break;case"data":if("object"!==t){nt(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"===typeof i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=Ot(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"===typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===n?("input"!==t&&Xd(e,t,"name",r.name,r,null),Xd(e,t,"formEncType",r.formEncType,r,null),Xd(e,t,"formMethod",r.formMethod,r,null),Xd(e,t,"formTarget",r.formTarget,r,null)):(Xd(e,t,"encType",r.encType,r,null),Xd(e,t,"method",r.method,r,null),Xd(e,t,"target",r.target,r,null))),null==i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=Ot(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=$d);break;case"onScroll":null!=i&&Ud("scroll",e);break;case"onScrollEnd":null!=i&&Ud("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(a(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"muted":e.muted=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"===typeof i||"boolean"===typeof i||"symbol"===typeof i){e.removeAttribute("xlink:href");break}n=Ot(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"===typeof i||"symbol"===typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":Ud("beforetoggle",e),Ud("toggle",e),tt(e,"popover",i);break;case"xlinkActuate":it(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":it(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":it(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":it(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":it(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":it(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":it(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":it(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":it(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":tt(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Rt.get(n)||n,i)}}function Zd(e,t,n,i,r,o){switch(n){case"style":Et(e,i,o);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(a(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"===typeof i?St(e,i):("number"===typeof i||"bigint"===typeof i)&&St(e,""+i);break;case"onScroll":null!=i&&Ud("scroll",e);break;case"onScrollEnd":null!=i&&Ud("scrollend",e);break;case"onClick":null!=i&&(e.onclick=$d);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ge.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"===typeof(o=null!=(o=e[Me]||null)?o[n]:null)&&e.removeEventListener(t,o,r),"function"!==typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):tt(e,n,i):("function"!==typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,r)))}}function eu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ud("error",e),Ud("load",e);var i,r=!1,o=!1;for(i in n)if(n.hasOwnProperty(i)){var s=n[i];if(null!=s)switch(i){case"src":r=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Xd(e,t,i,s,n,null)}}return o&&Xd(e,t,"srcSet",n.srcSet,n,null),void(r&&Xd(e,t,"src",n.src,n,null));case"input":Ud("invalid",e);var c=i=s=o=null,l=null,d=null;for(r in n)if(n.hasOwnProperty(r)){var u=n[r];if(null!=u)switch(r){case"name":o=u;break;case"type":s=u;break;case"checked":l=u;break;case"defaultChecked":d=u;break;case"value":i=u;break;case"defaultValue":c=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:Xd(e,t,r,u,n,null)}}return vt(e,i,c,l,d,s,o,!1),void ut(e);case"select":for(o in Ud("invalid",e),r=s=i=null,n)if(n.hasOwnProperty(o)&&null!=(c=n[o]))switch(o){case"value":i=c;break;case"defaultValue":s=c;break;case"multiple":r=c;default:Xd(e,t,o,c,n,null)}return t=i,n=s,e.multiple=!!r,void(null!=t?yt(e,!!r,t,!1):null!=n&&yt(e,!!r,n,!0));case"textarea":for(s in Ud("invalid",e),i=o=r=null,n)if(n.hasOwnProperty(s)&&null!=(c=n[s]))switch(s){case"value":r=c;break;case"defaultValue":o=c;break;case"children":i=c;break;case"dangerouslySetInnerHTML":if(null!=c)throw Error(a(91));break;default:Xd(e,t,s,c,n,null)}return Tt(e,r,o,i),void ut(e);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(r=n[l]))if("selected"===l)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else Xd(e,t,l,r,n,null);return;case"dialog":Ud("beforetoggle",e),Ud("toggle",e),Ud("cancel",e),Ud("close",e);break;case"iframe":case"object":Ud("load",e);break;case"video":case"audio":for(r=0;r<Nd.length;r++)Ud(Nd[r],e);break;case"image":Ud("error",e),Ud("load",e);break;case"details":Ud("toggle",e);break;case"embed":case"source":case"link":Ud("error",e),Ud("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(r=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Xd(e,t,d,r,n,null)}return;default:if(Pt(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(r=n[u])&&Zd(e,t,u,r,n,void 0));return}}for(c in n)n.hasOwnProperty(c)&&(null!=(r=n[c])&&Xd(e,t,c,r,n,null))}var tu=null,nu=null;function iu(e){return 9===e.nodeType?e:e.ownerDocument}function ru(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ou(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function au(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var su=null;var cu="function"===typeof setTimeout?setTimeout:void 0,lu="function"===typeof clearTimeout?clearTimeout:void 0,du="function"===typeof Promise?Promise:void 0,uu="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof du?function(e){return du.resolve(null).then(e).catch(hu)}:cu;function hu(e){setTimeout(function(){throw e})}function pu(e){return"head"===e}function mu(e,t){var n=t,i=0,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0<i&&8>i){n=i;var a=e.ownerDocument;if(1&n&&Tu(a.documentElement),2&n&&Tu(a.body),4&n)for(Tu(n=a.head),a=n.firstChild;a;){var s=a.nextSibling,c=a.nodeName;a[Fe]||"SCRIPT"===c||"STYLE"===c||"LINK"===c&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=s}}if(0===r)return e.removeChild(o),void Rh(t);r--}else"$"===n||"$?"===n||"$!"===n?r++:i=n.charCodeAt(0)-48;else i=0;n=o}while(n);Rh(t)}function fu(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":fu(n),Be(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gu(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function vu(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var bu=null;function yu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function ku(e,t,n){switch(t=iu(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}function Tu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Be(e)}var Su=new Map,Cu=new Set;function wu(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Eu=A.d;A.d={f:function(){var e=Eu.f(),t=Vl();return e||t},r:function(e){var t=qe(e);null!==t&&5===t.tag&&"form"===t.type?Ma(t):Eu.r(e)},D:function(e){Eu.D(e),Ru("dns-prefetch",e,null)},C:function(e,t){Eu.C(e,t),Ru("preconnect",e,t)},L:function(e,t,n){Eu.L(e,t,n);var i=Pu;if(i&&e&&t){var r='link[rel="preload"][as="'+ft(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+ft(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(r+='[imagesizes="'+ft(n.imageSizes)+'"]')):r+='[href="'+ft(e)+'"]';var o=r;switch(t){case"style":o=Ou(e);break;case"script":o=Du(e)}Su.has(o)||(e=h({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Su.set(o,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(xu(o))||"script"===t&&i.querySelector(Mu(o))||(eu(t=i.createElement("link"),"link",e),We(t),i.head.appendChild(t)))}},m:function(e,t){Eu.m(e,t);var n=Pu;if(n&&e){var i=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+ft(i)+'"][href="'+ft(e)+'"]',o=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Du(e)}if(!Su.has(o)&&(e=h({rel:"modulepreload",href:e},t),Su.set(o,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Mu(o)))return}eu(i=n.createElement("link"),"link",e),We(i),n.head.appendChild(i)}}},X:function(e,t){Eu.X(e,t);var n=Pu;if(n&&e){var i=He(n).hoistableScripts,r=Du(e),o=i.get(r);o||((o=n.querySelector(Mu(r)))||(e=h({src:e,async:!0},t),(t=Su.get(r))&&Uu(e,t),We(o=n.createElement("script")),eu(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},i.set(r,o))}},S:function(e,t,n){Eu.S(e,t,n);var i=Pu;if(i&&e){var r=He(i).hoistableStyles,o=Ou(e);t=t||"default";var a=r.get(o);if(!a){var s={loading:0,preload:null};if(a=i.querySelector(xu(o)))s.loading=5;else{e=h({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Su.get(o))&&Lu(e,n);var c=a=i.createElement("link");We(c),eu(c,"link",e),c._p=new Promise(function(e,t){c.onload=e,c.onerror=t}),c.addEventListener("load",function(){s.loading|=1}),c.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Au(a,t,i)}a={type:"stylesheet",instance:a,count:1,state:s},r.set(o,a)}}},M:function(e,t){Eu.M(e,t);var n=Pu;if(n&&e){var i=He(n).hoistableScripts,r=Du(e),o=i.get(r);o||((o=n.querySelector(Mu(r)))||(e=h({src:e,async:!0,type:"module"},t),(t=Su.get(r))&&Uu(e,t),We(o=n.createElement("script")),eu(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},i.set(r,o))}}};var Pu="undefined"===typeof document?null:document;function Ru(e,t,n){var i=Pu;if(i&&"string"===typeof t&&t){var r=ft(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof n&&(r+='[crossorigin="'+n+'"]'),Cu.has(r)||(Cu.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(eu(t=i.createElement("link"),"link",e),We(t),i.head.appendChild(t)))}}function Iu(e,t,n,i){var r,o,s,c,l=(l=H.current)?wu(l):null;if(!l)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Ou(n.href),(i=(n=He(l).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Ou(n.href);var d=He(l).hoistableStyles,u=d.get(e);if(u||(l=l.ownerDocument||l,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=l.querySelector(xu(e)))&&!d._p&&(u.instance=d,u.state.loading=5),Su.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Su.set(e,n),d||(r=l,o=e,s=n,c=u.state,r.querySelector('link[rel="preload"][as="style"]['+o+"]")?c.loading=1:(o=r.createElement("link"),c.preload=o,o.addEventListener("load",function(){return c.loading|=1}),o.addEventListener("error",function(){return c.loading|=2}),eu(o,"link",s),We(o),r.head.appendChild(o))))),t&&null===i)throw Error(a(528,""));return u}if(t&&null!==i)throw Error(a(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Du(n),(i=(n=He(l).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Ou(e){return'href="'+ft(e)+'"'}function xu(e){return'link[rel="stylesheet"]['+e+"]"}function _u(e){return h({},e,{"data-precedence":e.precedence,precedence:null})}function Du(e){return'[src="'+ft(e)+'"]'}function Mu(e){return"script[async]"+e}function Nu(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+ft(n.href)+'"]');if(i)return t.instance=i,We(i),i;var r=h({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return We(i=(e.ownerDocument||e).createElement("style")),eu(i,"style",r),Au(i,n.precedence,e),t.instance=i;case"stylesheet":r=Ou(n.href);var o=e.querySelector(xu(r));if(o)return t.state.loading|=4,t.instance=o,We(o),o;i=_u(n),(r=Su.get(r))&&Lu(i,r),We(o=(e.ownerDocument||e).createElement("link"));var s=o;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),eu(o,"link",i),t.state.loading|=4,Au(o,n.precedence,e),t.instance=o;case"script":return o=Du(n.src),(r=e.querySelector(Mu(o)))?(t.instance=r,We(r),r):(i=n,(r=Su.get(o))&&Uu(i=h({},n),r),We(r=(e=e.ownerDocument||e).createElement("script")),eu(r,"link",i),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,Au(i,n.precedence,e));return t.instance}function Au(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,o=r,a=0;a<i.length;a++){var s=i[a];if(s.dataset.precedence===t)o=s;else if(o!==r)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Lu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Uu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var ju=null;function Fu(e,t,n){if(null===ju){var i=new Map,r=ju=new Map;r.set(n,i)}else(i=(r=ju).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var o=n[r];if(!(o[Fe]||o[De]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var a=o.getAttribute(t)||"";a=e+a;var s=i.get(a);s?s.push(o):i.set(a,[o])}}return i}function Bu(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Vu(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var qu=null;function zu(){}function Hu(){if(this.count--,0===this.count)if(this.stylesheets)Ku(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Wu=null;function Ku(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Wu=new Map,t.forEach(Gu,e),Wu=null,Hu.call(e))}function Gu(e,t){if(!(4&t.state.loading)){var n=Wu.get(e);if(n)var i=n.get(null);else{n=new Map,Wu.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<r.length;o++){var a=r[o];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),i=a)}i&&n.set(null,i)}a=(r=t.instance).getAttribute("data-precedence"),(o=n.get(a)||i)===i&&n.set(null,r),n.set(a,r),this.count++,i=Hu.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),o?o.parentNode.insertBefore(r,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Qu={$$typeof:T,Provider:null,Consumer:null,_currentValue:L,_currentValue2:L,_threadCount:0};function Ju(e,t,n,i,r,o,a,s){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=we(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=we(0),this.hiddenUpdates=we(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=o,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Yu(e,t,n,i,r,o,a,s,c,l,d,u){return e=new Ju(e,t,n,a,s,c,l,u),t=1,!0===o&&(t|=24),o=Li(3,null,null,t),e.current=o,o.stateNode=e,(t=Mr()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:i,isDehydrated:n,cache:t},no(o),e}function $u(e){return e?e=Ni:Ni}function Xu(e,t,n,i,r,o){r=$u(r),null===i.context?i.context=r:i.pendingContext=r,(i=ro(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(i.callback=o),null!==(n=oo(e,i,t))&&(Ll(n,0,t),ao(n,e,t))}function Zu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function eh(e,t){Zu(e,t),(e=e.alternate)&&Zu(e,t)}function th(e){if(13===e.tag){var t=_i(e,67108864);null!==t&&Ll(t,0,67108864),eh(e,67108864)}}var nh=!0;function ih(e,t,n,i){var r=N.T;N.T=null;var o=A.p;try{A.p=2,oh(e,t,n,i)}finally{A.p=o,N.T=r}}function rh(e,t,n,i){var r=N.T;N.T=null;var o=A.p;try{A.p=8,oh(e,t,n,i)}finally{A.p=o,N.T=r}}function oh(e,t,n,i){if(nh){var r=ah(i);if(null===r)qd(e,t,i,sh,n),bh(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return uh=yh(uh,e,t,n,i,r),!0;case"dragenter":return hh=yh(hh,e,t,n,i,r),!0;case"mouseover":return ph=yh(ph,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return mh.set(o,yh(mh.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,fh.set(o,yh(fh.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(bh(e,i),4&t&&-1<vh.indexOf(e)){for(;null!==r;){var o=qe(r);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var a=be(o.pendingLanes);if(0!==a){var s=o;for(s.pendingLanes|=2,s.entangledLanes|=2;a;){var c=1<<31-pe(a);s.entanglements[1]|=c,a&=~c}Sd(o),0===(6&nl)&&(Sl=te()+500,Cd(0,!1))}}break;case 13:null!==(s=_i(o,2))&&Ll(s,0,2),Vl(),eh(o,2)}if(null===(o=ah(i))&&qd(e,t,i,sh,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else qd(e,t,i,null,n)}}function ah(e){return ch(e=_t(e))}var sh=null;function ch(e){if(sh=null,null!==(e=Ve(e))){var t=c(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=l(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return sh=e,null}function lh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case ie:return 2;case re:return 8;case oe:case ae:return 32;case se:return 268435456;default:return 32}default:return 32}}var dh=!1,uh=null,hh=null,ph=null,mh=new Map,fh=new Map,gh=[],vh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bh(e,t){switch(e){case"focusin":case"focusout":uh=null;break;case"dragenter":case"dragleave":hh=null;break;case"mouseover":case"mouseout":ph=null;break;case"pointerover":case"pointerout":mh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":fh.delete(t.pointerId)}}function yh(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=qe(t))&&th(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function kh(e){var t=Ve(e.target);if(null!==t){var n=c(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void function(e,t){var n=A.p;try{return A.p=e,t()}finally{A.p=n}}(e.priority,function(){if(13===n.tag){var e=Nl();e=Ie(e);var t=_i(n,e);null!==t&&Ll(t,0,e),eh(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Th(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=ah(e.nativeEvent);if(null!==n)return null!==(t=qe(n))&&th(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xt=i,n.target.dispatchEvent(i),xt=null,t.shift()}return!0}function Sh(e,t,n){Th(e)&&n.delete(t)}function Ch(){dh=!1,null!==uh&&Th(uh)&&(uh=null),null!==hh&&Th(hh)&&(hh=null),null!==ph&&Th(ph)&&(ph=null),mh.forEach(Sh),fh.forEach(Sh)}function wh(e,t){e.blockedOn===t&&(e.blockedOn=null,dh||(dh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ch)))}var Eh=null;function Ph(e){Eh!==e&&(Eh=e,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Eh===e&&(Eh=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],r=e[t+2];if("function"!==typeof i){if(null===ch(i||n))continue;break}var o=qe(n);null!==o&&(e.splice(t,3),t-=3,_a(o,{pending:!0,data:r,method:n.method,action:i},i,r))}}))}function Rh(e){function t(t){return wh(t,e)}null!==uh&&wh(uh,e),null!==hh&&wh(hh,e),null!==ph&&wh(ph,e),mh.forEach(t),fh.forEach(t);for(var n=0;n<gh.length;n++){var i=gh[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<gh.length&&null===(n=gh[0]).blockedOn;)kh(n),null===n.blockedOn&&gh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],o=n[i+1],a=r[Me]||null;if("function"===typeof o)a||Ph(n);else if(a){var s=null;if(o&&o.hasAttribute("formAction")){if(r=o,a=o[Me]||null)s=a.formAction;else if(null!==ch(r))continue}else s=a.action;"function"===typeof s?n[i+1]=s:(n.splice(i,3),i-=3),Ph(n)}}}function Ih(e){this._internalRoot=e}function Oh(e){this._internalRoot=e}Oh.prototype.render=Ih.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Xu(t.current,Nl(),e,t,null,null)},Oh.prototype.unmount=Ih.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Xu(e.current,2,null,e,null,null),Vl(),t[Ne]=null}},Oh.prototype.unstable_scheduleHydration=function(e){if(e){var t=xe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gh.length&&0!==t&&t<gh[n].priority;n++);gh.splice(n,0,e),0===n&&kh(e)}};var xh=r.version;if("19.1.0"!==xh)throw Error(a(527,xh,"19.1.0"));A.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=c(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return d(r),e;if(o===i)return d(r),t;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?u(e):null)?null:e.stateNode};var _h={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Dh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dh.isDisabled&&Dh.supportsFiber)try{de=Dh.inject(_h),ue=Dh}catch(Nh){}}t.createRoot=function(e,t){if(!s(e))throw Error(a(299));var n=!1,i="",r=bs,o=ys,c=ks;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(c=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Yu(e,1,!1,null,0,n,i,r,o,c,0,null),e[Ne]=t.current,Bd(e),new Ih(t)}},43:(e,t,n)=>{"use strict";e.exports=n(288)},278:(e,t,n)=>{"use strict";const i=n(357),r={getLiveKitURL(){const e=l("url");if(!e)throw new Error("url is not found in query string");return e},getAccessToken(){const e=l("token");if(!e)throw new Error("token is not found in query string");return e},getLayout(){if(s.layout)return s.layout;const e=l("layout");return null!==e&&void 0!==e?e:""},setRoom(e){o&&o.off(i.RoomEvent.Disconnected,r.endRecording),o=e,o.localParticipant.on(i.ParticipantEvent.ParticipantMetadataChanged,c),o.on(i.RoomEvent.Disconnected,r.endRecording),c()},startRecording(){console.log("START_RECORDING")},endRecording(){o=void 0,console.log("END_RECORDING")},onLayoutChanged(e){a=e}};let o,a,s={layout:""};function c(){const e=null===o||void 0===o?void 0:o.localParticipant.metadata;if(e){const t=JSON.parse(e);t&&t.layout!==s.layout&&(s=t,a(s.layout))}}function l(e){return new URLSearchParams(window.location.search).get(e)}t.A=r},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var k=y.prototype=new b;k.constructor=y,f(k,v.prototype),k.isPureReactComponent=!0;var T=Array.isArray,S={H:null,A:null,T:null,S:null,V:null},C=Object.prototype.hasOwnProperty;function w(e,t,i,r,o,a){return i=a.ref,{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:a}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var P=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(){}function O(e,t,r,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c,l,d=!1;if(null===e)d=!0;else switch(s){case"bigint":case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case n:case i:d=!0;break;case h:return O((d=e._init)(e._payload),t,r,o,a)}}if(d)return a=a(e),d=""===o?"."+R(e,0):o,T(a)?(r="",null!=d&&(r=d.replace(P,"$&/")+"/"),O(a,t,r,"",function(e){return e})):null!=a&&(E(a)&&(c=a,l=r+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(P,"$&/")+"/")+d,a=w(c.type,l,void 0,0,0,c.props)),t.push(a)),1;d=0;var u,m=""===o?".":o+":";if(T(e))for(var f=0;f<e.length;f++)d+=O(o=e[f],t,r,s=m+R(o,f),a);else if("function"===typeof(f=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(e=f.call(e),f=0;!(o=e.next()).done;)d+=O(o=o.value,t,r,s=m+R(o,f++),a);else if("object"===s){if("function"===typeof e.then)return O(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(I,I):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,o,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return d}function x(e,t,n){if(null==e)return e;var i=[],r=0;return O(e,i,"","",function(e){return t.call(n,e,r++)}),i}function _(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function M(){}t.Children={map:x,forEach:function(e,t,n){x(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return x(e,function(){t++}),t},toArray:function(e){return x(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=y,t.StrictMode=o,t.Suspense=d,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var i=f({},e.props),r=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!C.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(i[o]=t[o]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var a=Array(o),s=0;s<o;s++)a[s]=arguments[s+2];i.children=a}return w(e.type,r,void 0,0,0,i)},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var i,r={},o=null;if(null!=t)for(i in void 0!==t.key&&(o=""+t.key),t)C.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var s=Array(a),c=0;c<a;c++)s[c]=arguments[c+2];r.children=s}if(e&&e.defaultProps)for(i in a=e.defaultProps)void 0===r[i]&&(r[i]=a[i]);return w(e,o,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:_}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var i=e(),r=S.S;null!==r&&r(n,i),"object"===typeof i&&null!==i&&"function"===typeof i.then&&i.then(M,D)}catch(o){D(o)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var i=S.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.1.0"},357:function(e,t,n){!function(e){"use strict";function t(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var i=Object.defineProperty,r=(e,t,n)=>((e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class o{constructor(){r(this,"_locking"),r(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise(t=>e=()=>{this._locks-=1,t()}),n=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),n}}function a(e,t){if(!e)throw new Error(t)}const s=34028234663852886e22,c=-34028234663852886e22,l=4294967295,d=2147483647,u=-2147483648;function h(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>d||e<u)throw new Error("invalid int 32: "+e)}function p(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>l||e<0)throw new Error("invalid uint 32: "+e)}function m(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>s||e<c))throw new Error("invalid float 32: "+e)}const f=Symbol("@bufbuild/protobuf/enum-type");function g(e){const t=e[f];return a(t,"missing enum type on enum object"),t}function v(e,t,n,i){e[f]=b(t,n.map(t=>({no:t.no,name:t.name,localName:e[t.no]})))}function b(e,t,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of t){const e=k(a);o.push(e),i[a.name]=e,r[a.no]=e}return{typeName:e,values:o,findName:e=>i[e],findNumber:e=>r[e]}}function y(e,t,n){const i={};for(const r of t){const e=k(r);i[e.localName]=e.no,i[e.no]=e.localName}return v(i,e,t),i}function k(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class T{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function S(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function C(e,t,n){for(let o=0;o<28;o+=7){const i=e>>>o,r=!(i>>>7==0&&0==t),a=255&(r?128|i:i);if(n.push(a),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),o=255&(r?128|i:i);if(n.push(o),!r)return}n.push(t>>>31&1)}}const w=4294967296;function E(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function o(t,o){const a=Number(e.slice(t,o));r*=n,i=i*n+a,i>=w&&(r+=i/w|0,i%=w)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?I(i,r):R(i,r)}function P(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(w*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,o=n+8147497*i,a=2*i;const s=1e7;return r>=s&&(o+=Math.floor(r/s),r%=s),o>=s&&(a+=Math.floor(o/s),o%=s),a.toString()+O(o)+O(r)}function R(e,t){return{lo:0|e,hi:0|t}}function I(e,t){return t=~t,e?e=1+~e:t+=1,R(e,t)}const O=e=>{const t=String(e);return"0000000".slice(t.length)+t};function x(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function _(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!=(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const D=function(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>a(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>a(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),E(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),E(e)),dec:(e,t)=>function(e,t){let n=R(e,t);const i=2147483648&n.hi;i&&(n=I(n.lo,n.hi));const r=P(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>P(e,t)}}();var M,N,A;function L(e,t,n){if(t===n)return!0;if(e==M.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return t==n}return!1}function U(e,t){switch(e){case M.BOOL:return!1;case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return 0==t?D.zero:"0";case M.DOUBLE:case M.FLOAT:return 0;case M.BYTES:return new Uint8Array(0);case M.STRING:return"";default:return 0}}function j(e,t){switch(e){case M.BOOL:return!1===t;case M.STRING:return""===t;case M.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(M||(M={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(N||(N={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(A||(A={}));class F{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(p(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return h(e),x(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){m(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){p(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){h(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return h(e),x(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=D.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=D.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=D.enc(e);return C(t.lo,t.hi,this.buf),this}sint64(e){let t=D.enc(e),n=t.hi>>31;return C(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=D.uEnc(e);return C(t.lo,t.hi,this.buf),this}}class B{constructor(e,t){this.varint64=S,this.uint32=_,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case A.Varint:for(;128&this.buf[this.pos++];);break;case A.Bit64:this.pos+=4;case A.Bit32:this.pos+=4;break;case A.LengthDelimited:let n=this.uint32();this.pos+=n;break;case A.StartGroup:for(;;){const[e,n]=this.tag();if(n===A.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return D.dec(...this.varint64())}uint64(){return D.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,D.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return D.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return D.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function V(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return U(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),z=[];for(let n=0;n<q.length;n++)z[q[n].charCodeAt(0)]=n;z["-".charCodeAt(0)]=q.indexOf("+"),z["_".charCodeAt(0)]=q.indexOf("/");const H={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,o=0,a=0;for(let s=0;s<e.length;s++){if(n=z[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:a=n,o=1;break;case 1:i[r++]=a<<2|(48&n)>>4,a=n,o=2;break;case 2:i[r++]=(15&a)<<4|(60&n)>>2,a=n,o=3;break;case 3:i[r++]=(3&a)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let o=0;o<e.length;o++)switch(t=e[o],i){case 0:n+=q[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=q[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=q[r|t>>6],n+=q[63&t],i=0}return i&&(n+=q[r],n+="=",1==i&&(n+="=")),n}};function W(e,t,n){Q(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(e=>e.no===t.no)}(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,a]=V(t);for(const s of r)t.runtime.bin.readField(o,i.readerFactory(s.data),t.field,s.wireType,i);return a()}function K(e,t,n,i){Q(t,e);const r=t.runtime.bin.makeReadOptions(i),o=t.runtime.bin.makeWriteOptions(i);if(G(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=o.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function G(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function Q(e,t){a(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function J(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!j(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function Y(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?U(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function $(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(T.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function X(e,t){return $(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}M.DOUBLE,M.FLOAT,M.INT64,M.UINT64,M.INT32,M.UINT32,M.BOOL,M.STRING,M.BYTES;const Z={ignoreUnknownFields:!1},ee={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function te(e){return e?Object.assign(Object.assign({},Z),e):Z}function ne(e){return e?Object.assign(Object.assign({},ee),e):ee}const ie=Symbol(),re=Symbol();function oe(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function ae(e,t,n,i,r){let o=n.localName;if(n.repeated){if(a("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t)));const s=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,i));break;case"enum":const o=le(n.T,e,i.ignoreUnknownFields,!0);o!==re&&s.push(o);break;case"scalar":try{s.push(ce(n.T,e,n.L,!0))}catch(t){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(e));throw t instanceof Error&&t.message.length>0&&(i+=": ".concat(t.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t)));const a=e[o];for(const[o,s]of Object.entries(t)){if(null===s)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=se(n.K,o)}catch(e){let i="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}switch(n.V.kind){case"message":a[c]=n.V.T.fromJson(s,i);break;case"enum":const o=le(n.V.T,s,i.ignoreUnknownFields,!0);o!==re&&(a[c]=o);break;case"scalar":try{a[c]=ce(n.V.T,s,N.BIGINT,!0)}catch(e){let i="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(null===t&&"google.protobuf.Value"!=a.typeName)return;let s=e[o];$(s)?s.fromJson(t,i):(e[o]=s=a.fromJson(t,i),a.fieldWrapper&&!n.oneof&&(e[o]=a.fieldWrapper.unwrapField(s)));break;case"enum":const c=le(n.T,t,i.ignoreUnknownFields,!1);switch(c){case ie:Y(n,e);break;case re:break;default:e[o]=c}break;case"scalar":try{const i=ce(n.T,t,n.L,!1);i===ie?Y(n,e):e[o]=i}catch(e){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(oe(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}function se(e,t){if(e===M.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return ce(e,t,N.BIGINT,!0).toString()}function ce(e,t,n,i){if(null===t)return i?U(e,n):ie;switch(e){case M.DOUBLE:case M.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==M.FLOAT&&m(i),i;case M.INT32:case M.FIXED32:case M.SFIXED32:case M.SINT32:case M.UINT32:let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==M.UINT32||e==M.FIXED32?p(r):h(r),r;case M.INT64:case M.SFIXED64:case M.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=D.parse(t);return n?o.toString():o;case M.FIXED64:case M.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=D.uParse(t);return n?a.toString():a;case M.BOOL:if("boolean"!=typeof t)break;return t;case M.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case M.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return H.dec(t)}throw new Error}function le(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:ie;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return re}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(oe(t)))}function de(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&"message"!=e.kind&&!e.opt&&!e.req}function ue(e,t,n){if("map"==e.kind){a("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,o]of r)i[n.toString()]=pe(e.V.T,o);break;case"message":for(const[e,o]of r)i[e.toString()]=o.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of r)i[e.toString()]=he(t,o,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){a(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(pe(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(he(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return pe(e.T,t);case"enum":return he(e.T,t,n.enumAsInteger);case"message":return X(e.T,t).toJson(n)}}function he(e,t,n){var i;if(a("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null==r?void 0:r.name)&&void 0!==i?i:t}function pe(e,t){switch(e){case M.INT32:case M.SFIXED32:case M.SINT32:case M.FIXED32:case M.UINT32:return a("number"==typeof t),t;case M.FLOAT:case M.DOUBLE:return a("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case M.STRING:return a("string"==typeof t),t;case M.BOOL:return a("boolean"==typeof t),t;case M.UINT64:case M.FIXED64:case M.INT64:case M.SFIXED64:case M.SINT64:return a("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case M.BYTES:return a(t instanceof Uint8Array),H.enc(t)}}const me=Symbol("@bufbuild/protobuf/unknown-fields"),fe={readUnknownFields:!0,readerFactory:e=>new B(e)},ge={writeUnknownFields:!0,writerFactory:()=>new F};function ve(e){return e?Object.assign(Object.assign({},fe),e):fe}function be(e){return e?Object.assign(Object.assign({},ge),e):ge}function ye(e,t,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?M.INT32:n.T;let c=Se;if("scalar"==n.kind&&n.L>0&&(c=Te),o){let n=e[a];if(i==A.LengthDelimited&&s!=M.STRING&&s!=M.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;o?e[a].push(ke(t,new l,r,n)):$(e[a])?ke(t,e[a],r,n):(e[a]=ke(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[d,u]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let o,a;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:o=Se(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=Se(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=ke(t,new e.V.T,n,void 0)}}}if(void 0===o&&(o=U(e.K,N.BIGINT)),"string"!=typeof o&&"number"!=typeof o&&(o=o.toString()),void 0===a)switch(e.V.kind){case"scalar":a=U(e.V.T,N.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[o,a]}(n,t,r);e[a][d]=u}}function ke(e,t,n,i){const r=t.getType().runtime.bin,o=null==i?void 0:i.delimited;return r.readMessage(t,e,o?i.no:e.uint32(),n,o),t}function Te(e,t){const n=Se(e,t);return"bigint"==typeof n?n.toString():n}function Se(e,t){switch(t){case M.STRING:return e.string();case M.BOOL:return e.bool();case M.DOUBLE:return e.double();case M.FLOAT:return e.float();case M.INT32:return e.int32();case M.INT64:return e.int64();case M.UINT64:return e.uint64();case M.FIXED64:return e.fixed64();case M.BYTES:return e.bytes();case M.FIXED32:return e.fixed32();case M.SFIXED32:return e.sfixed32();case M.SFIXED64:return e.sfixed64();case M.SINT64:return e.sint64();case M.UINT32:return e.uint32();case M.SINT32:return e.sint32()}}function Ce(e,t,n,i){a(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?M.INT32:e.T;if(r)if(a(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,A.LengthDelimited).fork();let[,r]=Re(t);for(let o=0;o<i.length;o++)e[r](i[o]);e.join()}(n,o,e.no,t);else for(const i of t)Pe(n,o,e.no,i);else Pe(n,o,e.no,t);break;case"message":if(r){a(Array.isArray(t));for(const r of t)Ee(n,i,e,r)}else Ee(n,i,e,t);break;case"map":a("object"==typeof t&&null!=t);for(const[r,a]of Object.entries(t))we(n,i,e,r,a)}}function we(e,t,n,i,r){e.tag(n.no,A.LengthDelimited),e.fork();let o=i;switch(n.K){case M.INT32:case M.FIXED32:case M.UINT32:case M.SFIXED32:case M.SINT32:o=Number.parseInt(i);break;case M.BOOL:a("true"==i||"false"==i),o="true"==i}switch(Pe(e,n.K,1,o),n.V.kind){case"scalar":Pe(e,n.V.T,2,r);break;case"enum":Pe(e,M.INT32,2,r);break;case"message":a(void 0!==r),e.tag(2,A.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Ee(e,t,n,i){const r=X(n.T,i);n.delimited?e.tag(n.no,A.StartGroup).raw(r.toBinary(t)).tag(n.no,A.EndGroup):e.tag(n.no,A.LengthDelimited).bytes(r.toBinary(t))}function Pe(e,t,n,i){a(void 0!==i);let[r,o]=Re(t);e.tag(n,r)[o](i)}function Re(e){let t=A.Varint;switch(e){case M.BYTES:case M.STRING:t=A.LengthDelimited;break;case M.DOUBLE:case M.FIXED64:case M.SFIXED64:t=A.Bit64;break;case M.FIXED32:case M.SFIXED32:case M.FLOAT:t=A.Bit32}return[t,M[e].toLowerCase()]}function Ie(e){if(void 0===e)return e;if($(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Oe(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class xe{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function _e(e,t){const n=Me(e);return t?n:je(Ue(n))}const De=Me;function Me(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Ne=new Set(["constructor","toString","toJSON","valueOf"]),Ae=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Le=e=>"".concat(e,"$"),Ue=e=>Ae.has(e)?Le(e):e,je=e=>Ne.has(e)?Le(e):e;class Fe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=_e(e,!1)}addField(e){a(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const Be=(Ve=e=>new xe(e,e=>function(e){var t,n,i,r,o,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=_e(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:De(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:N.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(o=l.req)&&void 0!==o&&o,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=M.BYTES&&l.T!=M.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new Fe(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e)),qe=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=U(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:te,makeWriteOptions:ne,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(oe(t)));i=null!=i?i:new e;const r=new Map,o=n.typeRegistry;for(const[a,s]of Object.entries(t)){const t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(a,'"'));r.set(t.oneof,a)}ae(i,s,t,n,e)}else{let t=!1;if((null==o?void 0:o.findExtension)&&a.startsWith("[")&&a.endsWith("]")){const r=o.findExtension(a.substring(1,a.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,o]=V(r);ae(e,s,r.field,n,r),K(i,r,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!J(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!de(r))continue}const n=ue(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const o=t.typeRegistry;if(null==o?void 0:o.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const a=o.findExtensionFor(n.typeName,r.no);if(a&&G(e,a)){const n=W(e,a,t),r=ue(a.field,n,t);void 0!==r&&(i[a.field.jsonName]=r)}}}catch(e){const t=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=e instanceof Error?e.message:String(e);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>ce(e,t,null!=n?n:N.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||j(e,t)?pe(e,t):void 0},debug:oe},bin:{makeReadOptions:ve,makeWriteOptions:be,listUnknownFields(e){var t;return null!==(t=e[me])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[me]},writeUnknownFields(e,t){const n=e[me];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[me])||(r[me]=[]),r[me].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const o=e.getType(),a=r?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==r||c!=A.EndGroup);){const n=o.fields.find(s);if(n)ye(e,t,n,c,i);else{const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n)}}if(r&&(c!=A.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:ye,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(J(r,e))Ce(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Ce(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:v,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,o=e;if(null!=o[n])switch(i.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=i.findField(e);let a=o[n].value;t&&"message"==t.kind&&!$(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===M.BYTES&&(a=Oe(a)),r[n]={case:e,value:a};break;case"scalar":case"enum":let s=o[n];i.T===M.BYTES&&(s=i.repeated?s.map(Oe):Oe(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===M.BYTES)for(const[t,i]of Object.entries(o[n]))r[n][t]=Oe(i);else Object.assign(r[n],o[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(o[n])){let i=o[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=o[n].map(e=>$(e,c)?e:new c(e));else{const e=o[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Oe(e):r[n]=e:r[n]=$(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every(e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every((t,n)=>e.T.equals(t,r[n]));case"scalar":return i.every((t,n)=>L(e.T,t,r[n]));case"enum":return i.every((e,t)=>L(M.INT32,e,r[t]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=i,n=r;return e.T.fieldWrapper&&(void 0===t||$(t)||(t=e.T.fieldWrapper.wrapField(t)),void 0===n||$(n)||(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return L(M.INT32,i,r);case"scalar":return L(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const o=e.findField(i.case);if(void 0===o)return!0;switch(o.kind){case"message":return o.T.equals(i.value,r.value);case"enum":return L(M.INT32,i.value,r.value);case"scalar":return L(o.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return a.every(e=>t.equals(i[e],r[e]));case"enum":return a.every(e=>L(M.INT32,i[e],r[e]));case"scalar":const n=e.V.T;return a.every(e=>L(n,i[e],r[e]))}}}),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(Ie);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=Ie(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:Ie(t.value)}:{case:void 0}:Ie(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:Ve,initFields:qe}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const o=null!==(r=null==i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),a={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(a.prototype,new T),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:y,makeEnumType:b,getEnumType:g,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var Ve,qe;class ze extends T{constructor(e){super(),this.seconds=D.zero,this.nanos=0,Be.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(Be.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=D.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return ze.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new ze({seconds:D.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new ze).fromBinary(e,t)}static fromJson(e,t){return(new ze).fromJson(e,t)}static fromJsonString(e,t){return(new ze).fromJsonString(e,t)}static equals(e,t){return Be.util.equals(ze,e,t)}}ze.runtime=Be,ze.typeName="google.protobuf.Timestamp",ze.fields=Be.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const He=Be.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ze},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:We,repeated:!0},{no:5,name:"events",kind:"message",T:Ge,repeated:!0}]),We=Be.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Ke,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Ke=Be.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ze},{no:3,name:"value",kind:"scalar",T:2}]),Ge=Be.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ze},{no:7,name:"normalized_end_timestamp",kind:"message",T:ze,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Qe=Be.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Je=Be.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ye=Be.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),$e=Be.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Xe=Be.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Ze=Be.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),et=Be.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),tt=Be.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),nt=Be.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),it=Be.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),rt=Be.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ot,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Lt}]),ot=Be.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),at=Be.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:Be.getEnumType(Ye),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),st=Be.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Be.getEnumType(ct)},{no:4,name:"tracks",kind:"message",T:pt,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:at},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:Be.getEnumType(lt)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:Be.getEnumType(et)},{no:18,name:"kind_details",kind:"enum",T:Be.getEnumType(dt),repeated:!0}]),ct=Be.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),lt=Be.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),dt=Be.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ut=Be.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),ht=Be.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:mt,repeated:!0}]),pt=Be.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:Be.getEnumType(Je)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:Be.getEnumType(Ye)},{no:10,name:"layers",kind:"message",T:mt,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:ht,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:Be.getEnumType(ut)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Lt},{no:19,name:"audio_features",kind:"enum",T:Be.getEnumType(it),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:Be.getEnumType(Qe)}]),mt=Be.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:Be.getEnumType($e)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),ft=Be.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:Be.getEnumType(gt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:yt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:vt,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:kt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Tt,oneof:"value"},{no:8,name:"metrics",kind:"message",T:He,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Ct,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:wt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Et,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Pt,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Bt,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Vt,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:qt,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),gt=Be.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),vt=Be.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:bt,repeated:!0}]),bt=Be.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),yt=Be.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),kt=Be.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Tt=Be.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:St,repeated:!0}]),St=Be.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Ct=Be.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),wt=Be.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Et=Be.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Pt=Be.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Rt,oneof:"value"}]),Rt=Be.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),It=Be.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Ot=Be.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:Be.getEnumType(xt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),xt=Be.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),_t=Be.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:Be.getEnumType(Dt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Dt=Be.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Mt=Be.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Nt},{no:2,name:"screen",kind:"message",T:Nt},{no:3,name:"resume_connection",kind:"enum",T:Be.getEnumType(Ze)},{no:4,name:"disabled_codecs",kind:"message",T:At},{no:5,name:"force_relay",kind:"enum",T:Be.getEnumType(Ze)}]),Nt=Be.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:Be.getEnumType(Ze)}]),At=Be.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ot,repeated:!0},{no:2,name:"publish",kind:"message",T:ot,repeated:!0}]),Lt=Be.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Ut=Be.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),jt=Be.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:Be.getEnumType(Ut)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Ft=Be.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Bt=Be.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:Be.getEnumType(ut)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:jt,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Ft,oneof:"content_header"}],{localName:"DataStream_Header"}),Vt=Be.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),qt=Be.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),zt=Be.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Ht=Be.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Wt=Be.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Kt=Be.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:nn,oneof:"message"},{no:2,name:"answer",kind:"message",T:nn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Yt,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Jt,oneof:"message"},{no:5,name:"mute",kind:"message",T:$t,oneof:"message"},{no:6,name:"subscription",kind:"message",T:on,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:an,oneof:"message"},{no:8,name:"leave",kind:"message",T:ln,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:un,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:wn,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Rn,oneof:"message"},{no:13,name:"simulate",kind:"message",T:xn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:hn,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:_n,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:sn,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:cn,oneof:"message"}]),Gt=Be.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Xt,oneof:"message"},{no:2,name:"answer",kind:"message",T:nn,oneof:"message"},{no:3,name:"offer",kind:"message",T:nn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Yt,oneof:"message"},{no:5,name:"update",kind:"message",T:rn,oneof:"message"},{no:6,name:"track_published",kind:"message",T:en,oneof:"message"},{no:8,name:"leave",kind:"message",T:ln,oneof:"message"},{no:9,name:"mute",kind:"message",T:$t,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:mn,oneof:"message"},{no:11,name:"room_update",kind:"message",T:fn,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:vn,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:yn,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Sn,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:En,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:tn,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Zt,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Dn,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:An,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Ln,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:jn,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Pn,oneof:"message"}]),Qt=Be.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),Jt=Be.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:Be.getEnumType(Je)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:Be.getEnumType(Ye)},{no:9,name:"layers",kind:"message",T:mt,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Qt,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:Be.getEnumType(ut)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:Be.getEnumType(Qe)},{no:17,name:"audio_features",kind:"enum",T:Be.getEnumType(it),repeated:!0}]),Yt=Be.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:Be.getEnumType(zt)},{no:3,name:"final",kind:"scalar",T:8}]),$t=Be.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Xt=Be.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:rt},{no:2,name:"participant",kind:"message",T:st},{no:3,name:"other_participants",kind:"message",T:st,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:pn,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Mt},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Ot},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ot,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Zt=Be.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:pn,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Mt},{no:3,name:"server_info",kind:"message",T:Ot},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),en=Be.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:pt}]),tn=Be.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),nn=Be.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),rn=Be.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:st,repeated:!0}]),on=Be.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:It,repeated:!0}]),an=Be.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:Be.getEnumType($e)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),sn=Be.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:Be.getEnumType(it),repeated:!0}]),cn=Be.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ln=Be.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:Be.getEnumType(et)},{no:3,name:"action",kind:"enum",T:Be.getEnumType(dn)},{no:4,name:"regions",kind:"message",T:Mn}]),dn=Be.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),un=Be.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:mt,repeated:!0}]),hn=Be.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),pn=Be.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),mn=Be.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:bt,repeated:!0}]),fn=Be.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:rt}]),gn=Be.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:Be.getEnumType(Xe)},{no:3,name:"score",kind:"scalar",T:2}]),vn=Be.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:gn,repeated:!0}]),bn=Be.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Be.getEnumType(Ht)}]),yn=Be.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:bn,repeated:!0}]),kn=Be.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:Be.getEnumType($e)},{no:2,name:"enabled",kind:"scalar",T:8}]),Tn=Be.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:kn,repeated:!0}]),Sn=Be.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:kn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Tn,repeated:!0}]),Cn=Be.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),wn=Be.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Cn,repeated:!0}]),En=Be.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Pn=Be.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:rt},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:st},{no:4,name:"other_participants",kind:"message",T:st,repeated:!0}]),Rn=Be.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:nn},{no:2,name:"subscription",kind:"message",T:on},{no:3,name:"publish_tracks",kind:"message",T:en,repeated:!0},{no:4,name:"data_channels",kind:"message",T:On,repeated:!0},{no:5,name:"offer",kind:"message",T:nn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:In,repeated:!0}]),In=Be.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),On=Be.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:Be.getEnumType(zt)}]),xn=Be.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:Be.getEnumType(Wt),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),_n=Be.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Dn=Be.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Mn=Be.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Nn,repeated:!0}]),Nn=Be.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),An=Be.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:Be.getEnumType(nt)}]),Ln=Be.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:Be.getEnumType(Un)},{no:3,name:"message",kind:"scalar",T:9}]),Un=Be.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),jn=Be.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Fn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Bn,Vn,qn,zn={exports:{}},Hn=zn.exports,Wn=(Bn||(Bn=1,function(e){var t,n;t=Hn,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=s?s:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o},e.exports?e.exports=n():t.log=n()}(zn)),zn.exports);e.LogLevel=void 0,(Vn=e.LogLevel||(e.LogLevel={}))[Vn.trace=0]="trace",Vn[Vn.debug=1]="debug",Vn[Vn.info=2]="info",Vn[Vn.warn=3]="warn",Vn[Vn.error=4]="error",Vn[Vn.silent=5]="silent",e.LoggerNames=void 0,(qn=e.LoggerNames||(e.LoggerNames={})).Default="livekit",qn.Room="livekit-room",qn.Participant="livekit-participant",qn.Track="livekit-track",qn.Publication="livekit-track-publication",qn.Engine="livekit-engine",qn.Signal="livekit-signal",qn.PCManager="livekit-pc-manager",qn.PCTransport="livekit-pc-transport",qn.E2EE="lk-e2ee";let Kn=Wn.getLogger("livekit");const Gn=Object.values(e.LoggerNames).map(e=>Wn.getLogger(e));function Qn(e){const t=Wn.getLogger(e);return t.setDefaultLevel(Kn.getLevel()),t}Kn.setDefaultLevel(e.LogLevel.info);const Jn=Wn.getLogger("lk-e2ee"),Yn=7e3,$n=[0,300,1200,2700,4800,Yn,Yn,Yn,Yn,Yn];class Xn{constructor(e){this._retryDelays=void 0!==e?[...e]:$n}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}function Zn(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((i=i.apply(e,t||[])).next())})}function ei(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ti(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=ei(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){!function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)}(i,r,(t=e[n](t)).done,t.value)})}}}"function"==typeof SuppressedError&&SuppressedError;var ni,ii={exports:{}},ri=function(){if(ni)return ii.exports;ni=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}ii.exports=r,ii.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,r,{once:!0})})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,c,l;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),void 0===c)c=o[t]=n,++e._eventsCount;else if("function"==typeof c?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,l=d,console&&console.warn&&console.warn(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function r(o){i.once&&e.removeEventListener(t,r),n(o)})}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},ii.exports}();let oi=!0,ai=!0;function si(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function ci(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function li(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(oi=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function di(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ai=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ui(){if("object"==typeof window){if(oi)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function hi(e,t){ai&&console.warn(e+" is deprecated, please use "+t+" instead.")}function pi(e){return"[object Object]"===Object.prototype.toString.call(e)}function mi(e){return pi(e)?Object.keys(e).reduce(function(t,n){const i=pi(e[n]),r=i?mi(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})},{}):e}function fi(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?fi(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(t=>{fi(e,e.get(t),n)})}))}function gi(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&fi(e,n,r)})}),r}const vi=ui;function bi(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let a=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),vi("chrome: "+JSON.stringify(e)),r(e)})}e.video=i(e.video)}return vi("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(o(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(o(e))))}}}function yi(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function ki(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ci(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Ti(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Si(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>gi(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),ci(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>gi(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach(n=>{n.track===e&&(t?i=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?i=!0:n=t),t.track===e)),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ci(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function wi(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ci(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}};e.RTCPeerConnection.prototype[t]=i[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ei(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function Pi(e,t){ci(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Ri=Object.freeze({__proto__:null,fixNegotiationNeeded:Pi,shimAddTrackRemoveTrack:wi,shimAddTrackRemoveTrackWithNative:Ci,shimGetSendersWithDtmf:Ti,shimGetUserMedia:bi,shimMediaStream:yi,shimOnTrack:ki,shimPeerConnection:Ei,shimSenderReceiverGetStats:Si});function Ii(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){hi("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Oi(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xi(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(r,o)}}function _i(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Di(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),ci(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Mi(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){hi("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Ni(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ai(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function Li(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Ui(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ji(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Fi=Object.freeze({__proto__:null,shimAddTransceiver:Ai,shimCreateAnswer:ji,shimCreateOffer:Ui,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Li,shimGetUserMedia:Ii,shimOnTrack:Oi,shimPeerConnection:xi,shimRTCDataChannel:Ni,shimReceiverGetStats:Di,shimRemoveStream:Mi,shimSenderGetStats:_i});function Bi(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function Vi(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function qi(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function zi(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Hi(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Hi(e){return e&&void 0!==e.video?Object.assign({},e,{video:mi(e.video)}):e}function Wi(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(hi("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Ki(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Gi(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Qi(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ji,Yi=Object.freeze({__proto__:null,shimAudioContext:Qi,shimCallbacksAPI:qi,shimConstraints:Hi,shimCreateOfferLegacy:Gi,shimGetUserMedia:zi,shimLocalStreamsAPI:Bi,shimRTCIceServerUrls:Wi,shimRemoteStreamsAPI:Vi,shimTrackEventTransceiver:Ki}),$i={exports:{}},Xi=(Ji||(Ji=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let o=3;o<i.length;o++){const r=i[o],a=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){const i=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=o.length?t.parseFmtp(o[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let r=0;return n.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}($i)),$i.exports),Zi=Fn(Xi),er=t({__proto__:null,default:Zi},[Xi]);function tr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Zi.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,ci(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function nr(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ci(e,"icecandidate",e=>{if(e.candidate){const t=Zi.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function ir(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Zi.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Zi.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=Zi.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function rr(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},ci(e,"datachannel",e=>(t(e.channel,e.target),e))}function or(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function ar(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function sr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function cr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var lr=Object.freeze({__proto__:null,removeExtmapAllowMixed:ar,shimAddIceCandidateNullOrEmpty:sr,shimConnectionState:or,shimMaxMessageSize:ir,shimParameterlessSetLocalDescription:cr,shimRTCIceCandidate:tr,shimRTCIceCandidateRelayProtocol:nr,shimSendThrowTypeError:rr});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=ui,i=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(si(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(si(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(si(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=si(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),r={browserDetails:i,commonShim:lr,extractVersion:si,disableLog:li,disableWarnings:di,sdp:er};switch(i.browser){case"chrome":if(!Ri||!Ei||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Ri,sr(e,i),cr(e),bi(e,i),yi(e),Ei(e,i),ki(e),wi(e,i),Ti(e),Si(e),Pi(e,i),tr(e),nr(e),or(e),ir(e,i),rr(e),ar(e,i);break;case"firefox":if(!Fi||!xi||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Fi,sr(e,i),cr(e),Ii(e,i),xi(e,i),Oi(e),Mi(e),_i(e),Di(e),Ni(e),Ai(e),Li(e),Ui(e),ji(e),tr(e),or(e),ir(e,i),rr(e);break;case"safari":if(!Yi||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Yi,sr(e,i),cr(e),Wi(e),Gi(e),qi(e),Bi(e),Vi(e),Ki(e),zi(e),Qi(e),tr(e),nr(e),ir(e,i),rr(e),ar(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});const dr="AES-GCM",ur="lk_e2ee",hr={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:10,keyringSize:16};var pr,mr,fr,gr,vr,br,yr,kr,Tr;function Sr(){return wr()||Cr()}function Cr(){return void 0!==window.RTCRtpScriptTransform}function wr(){return void 0!==window.RTCRtpSender&&void 0!==window.RTCRtpSender.prototype.createEncodedStreams}function Er(e){return Zn(this,void 0,void 0,function*(){let t=new TextEncoder;return yield crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function Pr(e){return Zn(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"])})}function Rr(e,t){const n=(new TextEncoder).encode(t);switch(e){case"HKDF":return{name:"HKDF",salt:n,hash:"SHA-256",info:new ArrayBuffer(128)};case"PBKDF2":return{name:"PBKDF2",salt:n,hash:"SHA-256",iterations:1e5};default:throw new Error("algorithm ".concat(e," is currently unsupported"))}}e.KeyProviderEvent=void 0,(pr=e.KeyProviderEvent||(e.KeyProviderEvent={})).SetKey="setKey",pr.RatchetRequest="ratchetRequest",pr.KeyRatcheted="keyRatcheted",e.KeyHandlerEvent=void 0,(e.KeyHandlerEvent||(e.KeyHandlerEvent={})).KeyRatcheted="keyRatcheted",e.EncryptionEvent=void 0,(mr=e.EncryptionEvent||(e.EncryptionEvent={})).ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",mr.EncryptionError="encryptionError",e.CryptorEvent=void 0,(e.CryptorEvent||(e.CryptorEvent={})).Error="cryptorError";class Ir extends ri.EventEmitter{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.onKeyRatcheted=(e,t,n)=>{Kn.debug("key ratcheted event received",{ratchetResult:e,participantId:t,keyIndex:n})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},hr),t),this.on(e.KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,n,i){const r={key:t,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(null!=n?n:"shared","-").concat(null!=i?i:0),r),this.emit(e.KeyProviderEvent.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,n){this.emit(e.KeyProviderEvent.RatchetRequest,t,n)}}class Or extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}e.ConnectionErrorReason=void 0,(fr=e.ConnectionErrorReason||(e.ConnectionErrorReason={}))[fr.NotAllowed=0]="NotAllowed",fr[fr.ServerUnreachable=1]="ServerUnreachable",fr[fr.InternalError=2]="InternalError",fr[fr.Cancelled=3]="Cancelled",fr[fr.LeaveRequest=4]="LeaveRequest",fr[fr.Timeout=5]="Timeout";class xr extends Or{constructor(t,n,i,r){super(1,t),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=e.ConnectionErrorReason[n]}}class _r extends Or{constructor(e){super(21,null!=e?e:"device is unsupported"),this.name="DeviceUnsupportedError"}}class Dr extends Or{constructor(e){super(20,null!=e?e:"track is invalid"),this.name="TrackInvalidError"}}class Mr extends Or{constructor(e){super(10,null!=e?e:"unsupported server"),this.name="UnsupportedServer"}}class Nr extends Or{constructor(e){super(12,null!=e?e:"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Ar extends Or{constructor(e){super(13,null!=e?e:"unable to negotiate"),this.name="NegotiationError"}}class Lr extends Or{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class Ur extends Or{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"==typeof t?t:Un[t]}}e.MediaDeviceFailure=void 0,(gr=e.MediaDeviceFailure||(e.MediaDeviceFailure={})).PermissionDenied="PermissionDenied",gr.NotFound="NotFound",gr.DeviceInUse="DeviceInUse",gr.Other="Other",function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(e.MediaDeviceFailure||(e.MediaDeviceFailure={})),e.CryptorErrorReason=void 0,(vr=e.CryptorErrorReason||(e.CryptorErrorReason={}))[vr.InvalidKey=0]="InvalidKey",vr[vr.MissingKey=1]="MissingKey",vr[vr.InternalError=2]="InternalError",e.RoomEvent=void 0,(br=e.RoomEvent||(e.RoomEvent={})).Connected="connected",br.Reconnecting="reconnecting",br.SignalReconnecting="signalReconnecting",br.Reconnected="reconnected",br.Disconnected="disconnected",br.ConnectionStateChanged="connectionStateChanged",br.Moved="moved",br.MediaDevicesChanged="mediaDevicesChanged",br.ParticipantConnected="participantConnected",br.ParticipantDisconnected="participantDisconnected",br.TrackPublished="trackPublished",br.TrackSubscribed="trackSubscribed",br.TrackSubscriptionFailed="trackSubscriptionFailed",br.TrackUnpublished="trackUnpublished",br.TrackUnsubscribed="trackUnsubscribed",br.TrackMuted="trackMuted",br.TrackUnmuted="trackUnmuted",br.LocalTrackPublished="localTrackPublished",br.LocalTrackUnpublished="localTrackUnpublished",br.LocalAudioSilenceDetected="localAudioSilenceDetected",br.ActiveSpeakersChanged="activeSpeakersChanged",br.ParticipantMetadataChanged="participantMetadataChanged",br.ParticipantNameChanged="participantNameChanged",br.ParticipantAttributesChanged="participantAttributesChanged",br.ParticipantActive="participantActive",br.RoomMetadataChanged="roomMetadataChanged",br.DataReceived="dataReceived",br.SipDTMFReceived="sipDTMFReceived",br.TranscriptionReceived="transcriptionReceived",br.ConnectionQualityChanged="connectionQualityChanged",br.TrackStreamStateChanged="trackStreamStateChanged",br.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",br.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",br.AudioPlaybackStatusChanged="audioPlaybackChanged",br.VideoPlaybackStatusChanged="videoPlaybackChanged",br.MediaDevicesError="mediaDevicesError",br.ParticipantPermissionsChanged="participantPermissionsChanged",br.SignalConnected="signalConnected",br.RecordingStatusChanged="recordingStatusChanged",br.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",br.EncryptionError="encryptionError",br.DCBufferStatusChanged="dcBufferStatusChanged",br.ActiveDeviceChanged="activeDeviceChanged",br.ChatMessage="chatMessage",br.LocalTrackSubscribed="localTrackSubscribed",br.MetricsReceived="metricsReceived",e.ParticipantEvent=void 0,(yr=e.ParticipantEvent||(e.ParticipantEvent={})).TrackPublished="trackPublished",yr.TrackSubscribed="trackSubscribed",yr.TrackSubscriptionFailed="trackSubscriptionFailed",yr.TrackUnpublished="trackUnpublished",yr.TrackUnsubscribed="trackUnsubscribed",yr.TrackMuted="trackMuted",yr.TrackUnmuted="trackUnmuted",yr.LocalTrackPublished="localTrackPublished",yr.LocalTrackUnpublished="localTrackUnpublished",yr.LocalTrackCpuConstrained="localTrackCpuConstrained",yr.LocalSenderCreated="localSenderCreated",yr.ParticipantMetadataChanged="participantMetadataChanged",yr.ParticipantNameChanged="participantNameChanged",yr.DataReceived="dataReceived",yr.SipDTMFReceived="sipDTMFReceived",yr.TranscriptionReceived="transcriptionReceived",yr.IsSpeakingChanged="isSpeakingChanged",yr.ConnectionQualityChanged="connectionQualityChanged",yr.TrackStreamStateChanged="trackStreamStateChanged",yr.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",yr.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",yr.TrackCpuConstrained="trackCpuConstrained",yr.MediaDevicesError="mediaDevicesError",yr.AudioStreamAcquired="audioStreamAcquired",yr.ParticipantPermissionsChanged="participantPermissionsChanged",yr.PCTrackAdded="pcTrackAdded",yr.AttributesChanged="attributesChanged",yr.LocalTrackSubscribed="localTrackSubscribed",yr.ChatMessage="chatMessage",yr.Active="active",e.EngineEvent=void 0,(kr=e.EngineEvent||(e.EngineEvent={})).TransportsCreated="transportsCreated",kr.Connected="connected",kr.Disconnected="disconnected",kr.Resuming="resuming",kr.Resumed="resumed",kr.Restarting="restarting",kr.Restarted="restarted",kr.SignalResumed="signalResumed",kr.SignalRestarted="signalRestarted",kr.Closing="closing",kr.MediaTrackAdded="mediaTrackAdded",kr.ActiveSpeakersUpdate="activeSpeakersUpdate",kr.DataPacketReceived="dataPacketReceived",kr.RTPVideoMapUpdate="rtpVideoMapUpdate",kr.DCBufferStatusChanged="dcBufferStatusChanged",kr.ParticipantUpdate="participantUpdate",kr.RoomUpdate="roomUpdate",kr.SpeakersChanged="speakersChanged",kr.StreamStateChanged="streamStateChanged",kr.ConnectionQualityUpdate="connectionQualityUpdate",kr.SubscriptionError="subscriptionError",kr.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",kr.RemoteMute="remoteMute",kr.SubscribedQualityUpdate="subscribedQualityUpdate",kr.LocalTrackUnpublished="localTrackUnpublished",kr.LocalTrackSubscribed="localTrackSubscribed",kr.Offline="offline",kr.SignalRequestResponse="signalRequestResponse",kr.SignalConnected="signalConnected",kr.RoomMoved="roomMoved",e.TrackEvent=void 0,(Tr=e.TrackEvent||(e.TrackEvent={})).Message="message",Tr.Muted="muted",Tr.Unmuted="unmuted",Tr.Restarted="restarted",Tr.Ended="ended",Tr.Subscribed="subscribed",Tr.Unsubscribed="unsubscribed",Tr.CpuConstrained="cpuConstrained",Tr.UpdateSettings="updateSettings",Tr.UpdateSubscription="updateSubscription",Tr.AudioPlaybackStarted="audioPlaybackStarted",Tr.AudioPlaybackFailed="audioPlaybackFailed",Tr.AudioSilenceDetected="audioSilenceDetected",Tr.VisibilityChanged="visibilityChanged",Tr.VideoDimensionsChanged="videoDimensionsChanged",Tr.VideoPlaybackStarted="videoPlaybackStarted",Tr.VideoPlaybackFailed="videoPlaybackFailed",Tr.ElementAttached="elementAttached",Tr.ElementDetached="elementDetached",Tr.UpstreamPaused="upstreamPaused",Tr.UpstreamResumed="upstreamResumed",Tr.SubscriptionPermissionChanged="subscriptionPermissionChanged",Tr.SubscriptionStatusChanged="subscriptionStatusChanged",Tr.SubscriptionFailed="subscriptionFailed",Tr.TrackProcessorUpdate="trackProcessorUpdate",Tr.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",Tr.TranscriptionReceived="transcriptionReceived",Tr.TimeSyncUpdate="timeSyncUpdate",Tr.PreConnectBufferFlushed="preConnectBufferFlushed";const jr=/version\/(\d+(\.?_?\d+)+)/i;let Fr;function Br(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e&&"undefined"==typeof navigator)return;const n=(null!=e?e:navigator.userAgent).toLowerCase();if(void 0===Fr||t){const e=Vr.find(e=>{let{test:t}=e;return t.test(n)});Fr=null==e?void 0:e.describe(n)}return Fr}const Vr=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:qr(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:zr(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:qr(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:zr(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:qr(jr,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:zr(e)})}];function qr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function zr(e){return e.includes("mac os")?qr(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}const Hr="2.15.1";class Wr{}Wr.setTimeout=function(){return setTimeout(...arguments)},Wr.setInterval=function(){return setInterval(...arguments)},Wr.clearTimeout=function(){return clearTimeout(...arguments)},Wr.clearInterval=function(){return clearInterval(...arguments)};const Kr=[];e.VideoQuality=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(e.VideoQuality||(e.VideoQuality={}));class Gr extends ri.EventEmitter{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Gr.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Kn,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),5e3):this.handleAppVisibilityChanged()},this.log=Qn(null!==(r=i.loggerName)&&void 0!==r?r:e.LoggerNames.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Gr.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),sa(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===Gr.Kind.Video&&(n="video"),0===this.attachedElements.length&&this.kind===Gr.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===n&&(Kr.forEach(e=>{null!==e.parentElement||t||(t=e)}),t&&Kr.splice(Kr.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),Qr(this.mediaStreamTrack,t);const i=t.srcObject.getTracks(),r=i.some(e=>"audio"===e.kind);return t.play().then(()=>{this.emit(r?e.TrackEvent.AudioPlaybackStarted:e.TrackEvent.VideoPlaybackStarted)}).catch(n=>{"NotAllowedError"===n.name?this.emit(r?e.TrackEvent.AudioPlaybackFailed:e.TrackEvent.VideoPlaybackFailed,n):"AbortError"===n.name?Kn.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Kn.warn("could not playback ".concat(r?"audio":"video"),n),r&&t&&i.some(e=>"video"===e.kind)&&"NotAllowedError"===n.name&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(e.TrackEvent.ElementAttached,t),t}detach(t){try{if(t){Jr(this.mediaStreamTrack,t);const n=this.attachedElements.indexOf(t);return n>=0&&(this.attachedElements.splice(n,1),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach(t=>{Jr(this.mediaStreamTrack,t),n.push(t),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)}),this.attachedElements=[],n}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Qn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Kr.forEach(e=>{e.parentElement||(t=!1)}),t&&Kr.push(e)}}handleAppVisibilityChanged(){return Zn(this,void 0,void 0,function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==Gr.Kind.Video||setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){yo()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){yo()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Qr(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach(e=>{n.removeTrack(e)}),n.addTrack(e)),fo()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(fo()||mo())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function Jr(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return Je.AUDIO;case t.Video:return Je.VIDEO;default:return Je.DATA}},e.kindFromProto=function(e){switch(e){case Je.AUDIO:return t.Audio;case Je.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return Ye.CAMERA;case n.Microphone:return Ye.MICROPHONE;case n.ScreenShare:return Ye.SCREEN_SHARE;case n.ScreenShareAudio:return Ye.SCREEN_SHARE_AUDIO;default:return Ye.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Ye.CAMERA:return n.Camera;case Ye.MICROPHONE:return n.Microphone;case Ye.SCREEN_SHARE:return n.ScreenShare;case Ye.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Ht.ACTIVE:return i.Active;case Ht.PAUSED:return i.Paused;default:return i.Unknown}}}(Gr||(Gr={}));class Yr{constructor(e,t,n,i,r){if("object"==typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const $r=["vp8","h264"],Xr=["vp8","h264","vp9","av1","h265"];function Zr(e){return!!$r.find(t=>t===e)}var eo;e.BackupCodecPolicy=void 0,function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(e.BackupCodecPolicy||(e.BackupCodecPolicy={})),e.AudioPresets=void 0,(eo=e.AudioPresets||(e.AudioPresets={})).telephone={maxBitrate:12e3},eo.speech={maxBitrate:24e3},eo.music={maxBitrate:48e3},eo.musicStereo={maxBitrate:64e3},eo.musicHighQuality={maxBitrate:96e3},eo.musicHighQualityStereo={maxBitrate:128e3};const to={h90:new Yr(160,90,9e4,20),h180:new Yr(320,180,16e4,20),h216:new Yr(384,216,18e4,20),h360:new Yr(640,360,45e4,20),h540:new Yr(960,540,8e5,25),h720:new Yr(1280,720,17e5,30),h1080:new Yr(1920,1080,3e6,30),h1440:new Yr(2560,1440,5e6,30),h2160:new Yr(3840,2160,8e6,30)},no={h120:new Yr(160,120,7e4,20),h180:new Yr(240,180,125e3,20),h240:new Yr(320,240,14e4,20),h360:new Yr(480,360,33e4,20),h480:new Yr(640,480,5e5,20),h540:new Yr(720,540,6e5,25),h720:new Yr(960,720,13e5,30),h1080:new Yr(1440,1080,23e5,30),h1440:new Yr(1920,1440,38e5,30)},io={h360fps3:new Yr(640,360,2e5,3,"medium"),h360fps15:new Yr(640,360,4e5,15,"medium"),h720fps5:new Yr(1280,720,8e5,5,"medium"),h720fps15:new Yr(1280,720,15e5,15,"medium"),h720fps30:new Yr(1280,720,2e6,30,"medium"),h1080fps15:new Yr(1920,1080,25e5,15,"medium"),h1080fps30:new Yr(1920,1080,5e6,30,"medium"),original:new Yr(0,0,7e6,30,"medium")},ro="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function oo(e){return Zn(this,void 0,void 0,function*(){return new Promise(t=>Wr.setTimeout(t,e))})}function ao(){return"addTransceiver"in RTCPeerConnection.prototype}function so(){return"addTrack"in RTCPeerConnection.prototype}function co(){if(!("getCapabilities"in RTCRtpSender))return!1;if(fo())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}function lo(){if(!("getCapabilities"in RTCRtpSender))return!1;if(mo())return!1;if(fo()){const e=Br();if((null==e?void 0:e.version)&&Eo(e.version,"16")<0)return!1;if("iOS"===(null==e?void 0:e.os)&&(null==e?void 0:e.osVersion)&&Eo(e.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}function uo(e){return"av1"===e||"vp9"===e}function ho(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function po(){return"undefined"!=typeof RTCPeerConnection&&(ao()||so())}function mo(){var e;return"Firefox"===(null===(e=Br())||void 0===e?void 0:e.name)}function fo(){var e;return"Safari"===(null===(e=Br())||void 0===e?void 0:e.name)}function go(){const e=Br();return"Safari"===(null==e?void 0:e.name)||"iOS"===(null==e?void 0:e.os)}function vo(){const e=Br();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")||"iOS"===(null==e?void 0:e.os)&&!!(null==e?void 0:e.osVersion)&&Eo(e.osVersion,"17")>=0}function bo(){var e,t;return!!yo()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function yo(){return"undefined"!=typeof document}function ko(){return"ReactNative"==navigator.product}function To(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function So(){if(n.g&&n.g.LiveKitReactNativeGlobal)return n.g.LiveKitReactNativeGlobal}function Co(){if(!ko())return;let e=So();return e?e.platform:void 0}function wo(){if(yo())return window.devicePixelRatio;if(ko()){let e=So();if(e)return e.devicePixelRatio}return 1}function Eo(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const e=parseInt(n[o],10),t=parseInt(i[o],10);if(e>t)return 1;if(e<t)return-1;if(o===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function Po(e){for(const t of e)t.target.handleResize(t)}function Ro(e){for(const t of e)t.target.handleVisibilityChanged(t)}let Io=null;const Oo=()=>(Io||(Io=new ResizeObserver(Po)),Io);let xo=null;const _o=()=>(xo||(xo=new IntersectionObserver(Ro,{root:null,rootMargin:"0px"})),xo);let Do,Mo;function No(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const o=r.getContext("2d");null==o||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function Ao(){if(!Mo){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Mo]=i.stream.getAudioTracks(),!Mo)throw Error("Could not get empty media stream audio track");Mo.enabled=!1}return Mo.clone()}class Lo{constructor(e,t){this.onFinally=t,this.promise=new Promise((t,n)=>Zn(this,void 0,void 0,function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})).finally(()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)})}}function Uo(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function jo(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function Fo(t){switch(t.reason){case e.ConnectionErrorReason.LeaveRequest:return t.context;case e.ConnectionErrorReason.Cancelled:return et.CLIENT_INITIATED;case e.ConnectionErrorReason.NotAllowed:return et.USER_REJECTED;case e.ConnectionErrorReason.ServerUnreachable:return et.JOIN_FAILURE;default:return et.UNKNOWN_REASON}}function Bo(e){return void 0!==e?Number(e):void 0}function Vo(e){return void 0!==e?BigInt(e):void 0}function qo(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function zo(e){return!!e&&e.kind==Gr.Kind.Audio}function Ho(e){return!!e&&e.kind==Gr.Kind.Video}function Wo(e){return qo(e)&&Ho(e)}function Ko(e){return qo(e)&&zo(e)}function Go(e){return!!e&&!e.isLocal}function Qo(e){return!!e&&!e.isLocal}function Jo(e){return Go(e)&&Ho(e)}function Yo(e){return e.isLocal}function $o(e,t,n){var i,r,o,a;const{optionsWithoutProcessor:s,audioProcessor:c,videoProcessor:l}=ca(null!=e?e:{}),d=null==t?void 0:t.processor,u=null==n?void 0:n.processor,h=null!=s?s:{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(Xo(h.audio,t),null!==(i=(o=h.audio).deviceId)&&void 0!==i||(o.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=null!=c?c:d)),h.video&&(Xo(h.video,n),null!==(r=(a=h.video).deviceId)&&void 0!==r||(a.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=null!=l?l:u)),h}function Xo(e,t){return Object.keys(t).forEach(n=>{void 0===e[n]&&(e[n]=t[n])}),e}function Zo(e){var t,n,i,r;const o={};if(e.video)if("object"==typeof e.video){const n={},r=n,a=e.video;Object.keys(a).forEach(e=>{"resolution"===e?Xo(r,a.resolution):r[e]=a[e]}),o.video=n,null!==(t=(i=o.video).deviceId)&&void 0!==t||(i.deviceId={ideal:"default"})}else o.video=!!e.video&&{deviceId:{ideal:"default"}};else o.video=!1;return e.audio?"object"==typeof e.audio?(o.audio=e.audio,null!==(n=(r=o.audio).deviceId)&&void 0!==n||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function ea(e){return Zn(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=ta();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,o=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield oo(t),i.getByteTimeDomainData(o);const a=o.some(e=>128!==e&&0!==e);return n.close(),!a}return!1}()})}function ta(){var e;const t="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&"undefined"!=typeof window&&(null===(e=window.document)||void 0===e?void 0:e.body)){const e=()=>Zn(this,void 0,void 0,function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(e){console.warn("Error trying to auto-resume audio context",e)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)});window.document.body.addEventListener("click",e)}return n}}function na(e){return"audioinput"===e?Gr.Source.Microphone:"videoinput"===e?Gr.Source.Camera:Gr.Source.Unknown}function ia(e){return e===Gr.Source.Microphone?"audioinput":e===Gr.Source.Camera?"videoinput":void 0}function ra(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"==typeof i?{}:i,i=fo()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function oa(e){return e.split("/")[1].toLowerCase()}function aa(e){const t=[];return e.forEach(e=>{void 0!==e.track&&t.push(new en({cid:e.track.mediaStreamID,track:e.trackInfo}))}),t}function sa(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?sa(e.track):{})}}function ca(e){const t=Object.assign({},e);let n,i;return"object"==typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"==typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:(r=t,void 0===r?r:"function"==typeof structuredClone?"object"==typeof r&&null!==r?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r)))};var r}function la(e,t){return e.width*e.height<t.width*t.height}class da extends ri.EventEmitter{constructor(t){super(),this.onWorkerMessage=t=>{var n,i;const{kind:r,data:o}=t.data;switch(r){case"error":Kn.error(o.error.message),this.emit(e.EncryptionEvent.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===(null===(n=this.room)||void 0===n?void 0:n.localParticipant.identity))this.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const t=null===(i=this.room)||void 0===i?void 0:i.getParticipantByIdentity(o.participantIdentity);if(!t)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,o.enabled,t)}break;case"ratchetKey":this.keyProvider.emit(e.KeyProviderEvent.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex)}},this.onWorkerError=t=>{Kn.error("e2ee worker encountered an error:",{error:t.error}),this.emit(e.EncryptionEvent.EncryptionError,t.error)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1}setup(e){if(!Sr())throw new _r("tried to setup end-to-end encryption on an unsupported browser");if(Kn.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Jn.getLevel()}};this.worker&&(Kn.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Kn.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):Kn.warn("ignoring server sent trailer as it's empty")}setupEngine(t){t.on(e.EngineEvent.RTPVideoMapUpdate,e=>{this.postRTPMap(e)})}setupEventListeners(t,n){t.on(e.RoomEvent.TrackPublished,(e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==ut.NONE,t.identity)),t.on(e.RoomEvent.ConnectionStateChanged,n=>{n===e.ConnectionState.Connected&&t.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==ut.NONE,e.identity)})})}).on(e.RoomEvent.TrackUnsubscribed,(e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)}).on(e.RoomEvent.TrackSubscribed,(e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(e.RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(e=>{this.postKey(e)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(e.ParticipantEvent.LocalSenderCreated,(e,t)=>Zn(this,void 0,void 0,function*(){this.setupE2EESender(t,e)})),n.on(e.KeyProviderEvent.SetKey,e=>this.postKey(e)).on(e.KeyProviderEvent.RatchetRequest,(e,t)=>this.postRatchetRequest(e,t))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null==n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?oa(n.mimeType):void 0)}}setupE2EESender(e,t){qo(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||Kn.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return Zn(this,void 0,void 0,function*(){if(this.worker){if(Cr()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(ur in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,o=e.readableStream;if(!r||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,o=t.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:t,codec:i,participantIdentity:n,isReuse:ur in e}};this.worker.postMessage(a,[o,r])}e[ur]=!0}})}handleSender(e,t,n){var i;if(!(ur in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Cr()){Kn.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{Kn.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(r,[i.readable,i.writable])}e[ur]=!0}}}const ua="default";class ha{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new ha),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return Zn(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=ha.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){Kn.debug("awaiting getUserMedia promise");try{e?yield ha.userMediaPromiseMap.get(e):yield Promise.all(ha.userMediaPromiseMap.values())}catch(e){Kn.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!fo()||!t.hasDeviceInUse(e))&&(0===r.filter(t=>t.kind===e).length||r.some(t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i}))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(e=>{e.stop()})}return t._previousDevices=r,e&&(r=r.filter(t=>t.kind===e)),r}()})}normalizeDeviceId(e,t,n){return Zn(this,void 0,void 0,function*(){if(t!==ua)return t;const i=yield this.getDevices(e),r=i.find(e=>e.deviceId===ua);if(!r)return void Kn.warn("could not reliably determine default device");const o=i.find(e=>e.deviceId!==ua&&e.groupId===(null!=n?n:r.groupId));if(o)return null==o?void 0:o.deviceId;Kn.warn("could not reliably determine default device")})}hasDeviceInUse(e){return e?ha.userMediaPromiseMap.has(e):ha.userMediaPromiseMap.size>0}}var pa;ha.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],ha.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(pa||(pa={}));class ma{constructor(){this.pendingTasks=new Map,this.taskMutex=new o,this.nextTaskIndex=0}run(e){return Zn(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:pa.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=pa.RUNNING,yield e()}finally{t.status=pa.COMPLETED,this.pendingTasks.delete(t.id),n()}})}flush(){return Zn(this,void 0,void 0,function*(){return this.run(()=>Zn(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function fa(e,t){return e.pathname="".concat(function(e){return e.endsWith("/")?e:"".concat(e,"/")}(e.pathname)).concat(t),e.toString()}const ga=["syncState","trickle","offer","answer","simulate","leave"];var va;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(va||(va={}));class ba{get currentState(){return this.state}get isDisconnected(){return this.state===va.DISCONNECTING||this.state===va.DISCONNECTED}get isEstablishingConnection(){return this.state===va.CONNECTING||this.state===va.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;this.rtt=0,this.state=va.DISCONNECTED,this.log=Kn,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Qn(null!==(i=n.loggerName)&&void 0!==i?i:e.LoggerNames.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=t,this.requestQueue=new ma,this.queuedRequests=[],this.closingLock=new o,this.connectionLock=new o,this.state=va.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return Zn(this,void 0,void 0,function*(){return this.state=va.CONNECTING,this.options=n,yield this.connect(e,t,n,i)})}reconnect(e,t,n,i){return Zn(this,void 0,void 0,function*(){if(this.options)return this.state=va.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}));this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext)})}connect(t,n,i,r){this.connectOptions=i;const o=function(e,t,n){var i;const r=new URLSearchParams;return r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",ko()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel),t.os&&r.set("os",t.os),t.osVersion&&r.set("os_version",t.osVersion),t.browser&&r.set("browser",t.browser),t.browserVersion&&r.set("browser_version",t.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type),r}(n,function(){var e;const t=new _t({sdk:Dt.JS,protocol:16,version:Hr});return ko()&&(t.os=null!==(e=Co())&&void 0!==e?e:""),t}(),i),a=function(e,t){const n=new URL(function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e));return t.forEach((e,t)=>{n.searchParams.set(t,e)}),fa(n,"rtc")}(t,o),s=fa(new URL(jo(a)),"validate");return new Promise((t,n)=>Zn(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();try{const o=()=>Zn(this,void 0,void 0,function*(){this.close(),clearTimeout(c),n(new xr("room connection has been cancelled (signal)",e.ConnectionErrorReason.Cancelled))}),c=setTimeout(()=>{this.close(),n(new xr("room connection has timed out (signal)",e.ConnectionErrorReason.ServerUnreachable))},i.websocketTimeout);(null==r?void 0:r.aborted)&&o(),null==r||r.addEventListener("abort",o);const l=new URL(a);l.searchParams.has("access_token")&&l.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(l),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(c)},this.ws.onerror=t=>Zn(this,void 0,void 0,function*(){if(this.state===va.CONNECTED)this.handleWSError(t);else{this.state=va.DISCONNECTED,clearTimeout(c);try{const i=yield fetch(s);if(i.status.toFixed(0).startsWith("4")){const t=yield i.text();n(new xr(t,e.ConnectionErrorReason.NotAllowed,i.status))}else n(new xr("Encountered unknown websocket error during connection: ".concat(t.toString()),e.ConnectionErrorReason.InternalError,i.status))}catch(t){n(new xr(t instanceof Error?t.message:"server was not reachable",e.ConnectionErrorReason.ServerUnreachable))}}}),this.ws.onmessage=a=>Zn(this,void 0,void 0,function*(){var s,c,l;let d;if("string"==typeof a.data){const e=JSON.parse(a.data);d=Gt.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(a.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof a.data),this.logContext);d=Gt.fromBinary(new Uint8Array(a.data))}if(this.state!==va.CONNECTED){let a=!1;if("join"===(null===(s=d.message)||void 0===s?void 0:s.case)?(this.state=va.CONNECTED,null==r||r.removeEventListener("abort",o),this.pingTimeoutDuration=d.message.value.pingTimeout,this.pingIntervalDuration=d.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),t(d.message.value)):this.state===va.RECONNECTING&&"leave"!==d.message.case?(this.state=va.CONNECTED,null==r||r.removeEventListener("abort",o),this.startPingInterval(),"reconnect"===(null===(c=d.message)||void 0===c?void 0:c.case)?t(d.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),t(void 0),a=!0)):this.isEstablishingConnection&&"leave"===d.message.case?n(new xr("Received leave request while trying to (re)connect",e.ConnectionErrorReason.LeaveRequest,void 0,d.message.value.reason)):i.reconnect||n(new xr("did not receive join response, got ".concat(null===(l=d.message)||void 0===l?void 0:l.case," instead"),e.ConnectionErrorReason.InternalError)),!a)return}this.signalLatency&&(yield oo(this.signalLatency)),this.handleSignalResponse(d)}),this.ws.onclose=t=>{this.isEstablishingConnection&&n(new xr("Websocket got closed during a (re)connection attempt",e.ConnectionErrorReason.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:t.reason,code:t.code,wasClean:t.wasClean,state:this.state})),this.handleOnClose(t.reason)}}finally{o()}}))}close(){return Zn(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=va.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise(t=>{e.ws?e.ws.onclose=()=>{t()}:t()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,oo(250)])),e.ws=void 0}}finally{t&&(e.state=va.DISCONNECTED),n()}}()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ka(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ka(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Yt({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new $t({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return Zn(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new hn({requestId:r,metadata:e,name:t,attributes:i})}),r}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new un({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new wn({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:D.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new _n({timestamp:D.parse(Date.now()),rtt:D.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new sn({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new ln({reason:et.CLIENT_INITIATED,action:dn.DISCONNECT})})}sendRequest(e){return Zn(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=ga.indexOf(e.case)>=0;return Kn.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===va.RECONNECTING)return void t.queuedRequests.push(()=>Zn(t,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield oo(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext);const r=new Kt({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}}()})}handleSignalResponse(e){var t,n;const i=e.message;if(null==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=ya(i.value);this.onAnswer&&this.onAnswer(e,i.value.id)}else if("offer"===i.case){const e=ya(i.value);this.onOffer&&this.onOffer(e,i.value.id)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):"roomMoved"===i.case?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Zn(this,void 0,void 0,function*(){if(this.state===va.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Wr.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Wr.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Wr.setInterval(()=>{this.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Wr.clearInterval(this.pingInterval)}}function ya(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function ka(e,t){return new nn({sdp:e.sdp,type:e.type,id:t})}class Ta{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class Sa{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const i=n+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t){if(!(t.expiresAt<Date.now()))return t.value;this._map.delete(e)}}has(e){const t=this._map.get(e);return!!t&&(!(t.expiresAt<Date.now())||(this._map.delete(e),!1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[i,r]of n.entries())t.push(e(r,i,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var Ca,wa,Ea,Pa,Ra,Ia={},Oa={},xa={exports:{}};function _a(){if(Ca)return xa.exports;Ca=1;var e=xa.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),xa.exports}function Da(){return wa||(wa=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=_a(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}}),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}})})}}(Oa)),Oa}function Ma(){if(Pa)return Ea;Pa=1;var e=_a(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return Ea=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var a=n.outerOrder||r,s=n.innerOrder||o,c=[];return a.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})}),t.media.forEach(function(t){c.push(i("m",e.m[0],t)),s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})})}),c.join("\r\n")+"\r\n"},Ea}var Na=function(){if(Ra)return Ia;Ra=1;var e=Da(),t=Ma(),n=_a();return Ia.grammar=n,Ia.write=t,Ia.parse=e.parse,Ia.parseParams=e.parseParams,Ia.parseFmtpConfig=e.parseFmtpConfig,Ia.parsePayloads=e.parsePayloads,Ia.parseRemoteCandidates=e.parseRemoteCandidates,Ia.parseImageAttributes=e.parseImageAttributes,Ia.parseSimulcastStreamList=e.parseSimulcastStreamList,Ia}();function Aa(e,t,n){var i,r,o;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise(function(i,r){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,l=Date.now(),!a){var i=e.apply(n,t);s&&s(i),d.forEach(function(e){return(0,e.resolve)(i)}),d=[]}},u()),c){var h=e.apply(n,t);return s&&s(h),i(h)}d.push({resolve:i,reject:r})})};return h.cancel=function(e){void 0!==o&&clearTimeout(o),d.forEach(function(t){return(0,t.reject)(e)}),d=[]},h}const La="negotiationStarted",Ua="negotiationComplete",ja="rtpVideoPayloadTypes";class Fa extends ri.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;super(),this.log=Kn,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Aa(e=>Zn(this,void 0,void 0,function*(){this.emit(La);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Qn(null!==(i=n.loggerName)&&void 0!==i?i:e.LoggerNames.PCTransport),this.loggerOptions=n,this.config=t,this._pc=this.createPC(),this.offerLock=new o}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return Zn(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return Zn(this,void 0,void 0,function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=Na.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return r.media.forEach(e=>{var t;"audio"===e.type&&(e.rtp.some(e=>"opus"===e.codec&&(o=e.payload,!0)),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some(e=>e.payload===o&&"nack"===e.type))&&i.push(e.mid),e.fmtp.some(t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)))}),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=Na.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach(e=>{"audio"===e.type&&this.trackBitrates.some(t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter(e=>!e.includes("maxaveragebitrate")).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0})}),i=Na.write(t)}return yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(e=>{this.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):"answer"===e.type&&(this.emit(Ua),e.sdp)&&Na.parse(e.sdp).media.forEach(e=>{"video"===e.type&&this.emit(ja,e.rtp)}),!0})}createAndSendOffer(e){return Zn(this,void 0,void 0,function*(){var t;const n=yield this.offerLock.lock();try{if(void 0===this.onOffer)return;if((null==e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null==e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=this.latestOfferId+1;this.latestOfferId=n;const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const r=Na.parse(null!==(t=i.sdp)&&void 0!==t?t:"");if(r.media.forEach(e=>{Va(e),"audio"===e.type?Ba(e,[],[]):"video"===e.type&&this.trackBitrates.some(t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;if(uo(t.codec)&&this.ensureVideoDDExtensionForSVC(e,r),"av1"!==t.codec)return!0;const i=Math.round(.7*t.maxbr);for(const r of e.fmtp)if(r.payload===n){r.config.includes("x-google-start-bitrate")||(r.config+=";x-google-start-bitrate=".concat(i));break}return!0})}),this.latestOfferId>n)return void this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n}));yield this.setMungedSDP(i,Na.write(r)),this.onOffer(i,this.latestOfferId)}finally{n()}})}createAndSetAnswer(){return Zn(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),n=Na.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach(e=>{Va(e),"audio"===e.type&&Ba(e,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Na.write(n)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Nr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Nr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return Zn(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach(e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}}),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0})}setMungedSDP(e,t,n){return Zn(this,void 0,void 0,function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let r="unknown error";t instanceof Error?r=t.message:"string"==typeof t&&(r=t);const o={error:r,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Ar(r)}})}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(e=>e.uri===ro))){if(0===this.ddExtID){let e=0;t.media.forEach(t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach(t=>{t.value>e&&(e=t.value)}))}),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:ro})}}}function Ba(e,t,n){let i=0;e.rtp.some(e=>"opus"===e.codec&&(i=e.payload,!0)),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(e=>e.payload===i&&"nack"===e.type)&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)))}function Va(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const qa="vp8",za={audioPreset:e.AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:io.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:qa,backupCodec:!0,preConnectBuffer:!1},Ha={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Wa={deviceId:{ideal:"default"},resolution:to.h720.resolution},Ka={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Xn,disconnectOnPageLeave:!0,webAudioMix:!1},Ga={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Qa;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Qa||(Qa={}));class Ja{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,n,i){var r;this.peerConnectionTimeout=Ga.peerConnectionTimeout,this.log=Kn,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map(e=>e.getConnectionState());n.every(e=>"connected"===e)?this.state=Qa.CONNECTED:n.some(e=>"failed"===e)?this.state=Qa.FAILED:n.some(e=>"connecting"===e)?this.state=Qa.CONNECTING:n.every(e=>"closed"===e)?this.state=Qa.CLOSED:n.some(e=>"closed"===e)?this.state=Qa.CLOSING:n.every(e=>"new"===e)&&(this.state=Qa.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Qa[t]," to ").concat(Qa[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Qn(null!==(r=i.loggerName)&&void 0!==r?r:e.LoggerNames.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new Fa(t,i),this.subscriber=new Fa(t,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,zt.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,zt.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=Qa.NEW,this.connectionLock=new o,this.remoteOfferLock=new o}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Zn(this,void 0,void 0,function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const t=this.publisher;for(const n of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(n)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return Zn(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return Zn(this,void 0,void 0,function*(){t===zt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return Zn(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{if(!(yield this.subscriber.setRemoteDescription(e,t)))return;return yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return Zn(this,void 0,void 0,function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map(n=>this.ensureTransportConnected(n,e,t)))}finally{i()}})}negotiate(e){return Zn(this,void 0,void 0,function*(){return new Promise((t,n)=>Zn(this,void 0,void 0,function*(){const i=setTimeout(()=>{n("negotiation timed out")},this.peerConnectionTimeout);e.signal.addEventListener("abort",()=>{clearTimeout(i),n("negotiation aborted")}),this.publisher.once(La,()=>{e.signal.aborted||this.publisher.once(Ua,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(e=>{clearTimeout(i),n(e)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===zt.PUBLISHER||e===zt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(t,n){return Zn(this,arguments,void 0,function(t,n){var i=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==t.getConnectionState())return new Promise((t,o)=>Zn(i,void 0,void 0,function*(){const i=()=>{this.log.warn("abort transport connection",this.logContext),Wr.clearTimeout(a),o(new xr("room connection has been cancelled",e.ConnectionErrorReason.Cancelled))};(null==n?void 0:n.signal.aborted)&&i(),null==n||n.signal.addEventListener("abort",i);const a=Wr.setTimeout(()=>{null==n||n.signal.removeEventListener("abort",i),o(new xr("could not establish pc connection",e.ConnectionErrorReason.InternalError))},r);for(;this.state!==Qa.CONNECTED;)if(yield oo(50),null==n?void 0:n.signal.aborted)return void o(new xr("room connection has been cancelled",e.ConnectionErrorReason.Cancelled));Wr.clearTimeout(a),null==n||n.signal.removeEventListener("abort",i),t()}))}()})}}class Ya extends Error{constructor(e,t,n){super(t),this.code=e,this.message=Xa(t,Ya.MAX_MESSAGE_BYTES),this.data=n?Xa(n,Ya.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ya(e.code,e.message,e.data)}toProto(){return new Rt({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Ya(Ya.ErrorCode[e],Ya.ErrorMessage[e],t)}}function $a(e){return(new TextEncoder).encode(e).length}function Xa(e,t){if($a(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(e.slice(0,o)).length<=t?n=o:i=o-1}return e.slice(0,n)}Ya.MAX_MESSAGE_BYTES=256,Ya.MAX_DATA_BYTES=15360,Ya.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Ya.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Za=2e3;function es(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}const ts="undefined"!=typeof MediaRecorder,ns=ts?MediaRecorder:class{constructor(){throw new Error("MediaRecorder is not available in this environment")}};class is extends ns{constructor(e,t){if(!ts)throw new Error("MediaRecorder is not available in this environment");let n,i;super(new MediaStream([e.mediaStreamTrack]),t);const r=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",o),null==i||i.close(),i=void 0},o=e=>{null==i||i.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",o),i=void 0};this.byteStream=new ReadableStream({start:e=>{i=e,n=t=>Zn(this,void 0,void 0,function*(){const n=yield t.data.arrayBuffer();void 0!==i&&e.enqueue(new Uint8Array(n))}),this.addEventListener("dataavailable",n)},cancel:()=>{r()}}),this.addEventListener("stop",r),this.addEventListener("error",o)}}class rs extends Gr{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(t,n,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Aa(()=>Zn(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>Zn(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(e.TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new o,this.pauseUpstreamLock=new o,this.processorLock=new o,this.restartLock=new o,this.setMediaStreamTrack(t,!0),this._constraints=t.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Gr.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return Zn(this,void 0,void 0,function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let i;if(this._mediaStreamTrack&&(this.attachedElements.forEach(e=>{Jr(this._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Qr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}finally{t()}}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(null!=i?i:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(t=>{Qr(null!=i?i:e,t)}))})}waitForDimensions(){return Zn(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===Gr.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Br())||void 0===n?void 0:n.os)&&(yield oo(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield oo(50)}throw new Dr("unable to get track dimensions after timeout")}()})}setDeviceId(e){return Zn(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Uo(e)||(this._constraints.deviceId=e,!!this.isMuted||(yield this.restartTrack(),Uo(e)===this._mediaStreamTrack.getSettings().deviceId))})}getDeviceId(){return Zn(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===Gr.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===Gr.Kind.Audio?"audioinput":"videoinput";return t?ha.getInstance().normalizeDeviceId(r,n,i):n}()})}mute(){return Zn(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return Zn(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return Zn(this,void 0,void 0,function*(){if(!this.sender)throw new Dr("unable to replace an unpublished track");let n,i;return"boolean"==typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null==n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(t){return Zn(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{t||(t=this._constraints);const{deviceId:n,facingMode:i}=t,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const o={audio:!1,video:!1};this.kind===Gr.Kind.Video?o.video=!n&&!i||{deviceId:n,facingMode:i}:o.audio=!n||{deviceId:n},this.attachedElements.forEach(e=>{Jr(this.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const a=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield a.applyConstraints(r),a.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(a),this._constraints=t,this.emit(e.TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),this.isMuted===t&&this._mediaStreamTrack.enabled!==t||(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Zn(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),bo()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return Zn(this,void 0,void 0,function*(){var t;const n=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(e.TrackEvent.UpstreamPaused,this);const n=Br();if("Safari"===(null==n?void 0:n.name)&&Eo(n.version,"12.0")<0)throw new _r("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(t=this.sender.transport)||void 0===t?void 0:t.state)&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return Zn(this,void 0,void 0,function*(){var t;const n=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(e.TrackEvent.UpstreamResumed,this),"closed"!==(null===(t=this.sender.transport)||void 0===t?void 0:t.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return Zn(this,void 0,void 0,function*(){var e;if(null===(e=this.sender)||void 0===e?void 0:e.getStats)return yield this.sender.getStats()})}setProcessor(t){return Zn(this,arguments,void 0,function(t){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r;const o=yield n.processorLock.lock();try{n.log.debug("setting up processor",n.logContext);const o=document.createElement(n.kind),a={kind:n.kind,track:n._mediaStreamTrack,element:o,audioContext:n.audioContext};if(yield t.init(a),n.log.debug("processor initialized",n.logContext),n.processor&&(yield n.stopProcessor()),"unknown"===n.kind)throw TypeError("cannot set processor on track of unknown kind");if(Qr(n._mediaStreamTrack,o),o.muted=!0,o.play().catch(e=>n.log.error("failed to play processor element",Object.assign(Object.assign({},n.logContext),{error:e}))),n.processor=t,n.processorElement=o,n.processor.processedTrack){for(const e of n.attachedElements)e!==n.processorElement&&i&&(Jr(n._mediaStreamTrack,e),Qr(n.processor.processedTrack,e));yield null===(r=n.sender)||void 0===r?void 0:r.replaceTrack(n.processor.processedTrack)}n.emit(e.TrackEvent.TrackProcessorUpdate,n.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return Zn(this,arguments,void 0,function(){var t=this;let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var i,r;t.processor&&(t.log.debug("stopping processor",t.logContext),null===(i=t.processor.processedTrack)||void 0===i||i.stop(),yield t.processor.destroy(),t.processor=void 0,n||(null===(r=t.processorElement)||void 0===r||r.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(e.TrackEvent.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;ts?this.localTrackRecorder?this.log.warn("preconnect buffer already started"):(this.localTrackRecorder=new is(this,{mimeType:"audio/webm;codecs=opus"}),this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},1e4)):this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}}class os extends rs{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(t,Gr.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>Zn(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=es(e,this.prevStats)),this.prevStats=e}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(e.TrackEvent.AudioTrackFeatureUpdate,this,it.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(e.TrackEvent.AudioTrackFeatureUpdate,this,it.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Zn(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Gr.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Zn(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Uo(this._constraints.deviceId);return this.source!==Gr.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return Zn(this,void 0,void 0,function*(){let t;if(e){const n=Zo({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Zn(this,void 0,void 0,function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n})}startMonitor(){yo()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Za)))}setProcessor(t){return Zn(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!ko()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(i),this.processor=t,this.processor.processedTrack&&(yield null===(n=this.sender)||void 0===n?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(e.TrackEvent.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return Zn(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach(e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),t})}checkForSilence(){return Zn(this,void 0,void 0,function*(){const t=yield ea(this);return t&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(e.TrackEvent.AudioSilenceDetected)),t})}}const as=Object.values(to),ss=Object.values(no),cs=Object.values(io),ls=[to.h180,to.h360],ds=[no.h180,no.h360],us=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map(t=>{var n,i;return new Yr(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(i=t.fps)&&void 0!==i?i:30))))),t.fps,e.encoding.priority)}),hs=["q","h","f"];function ps(e,t,n,i){var r,o;let a=null==i?void 0:i.videoEncoding;e&&(a=null==i?void 0:i.screenShareEncoding);const s=null==i?void 0:i.simulcast,c=null==i?void 0:i.scalabilityMode,l=null==i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const r=function(e,t,n){if(e)return cs;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?as:ss}(e,t,n);let{encoding:o}=r[0];const a=Math.max(t,n);for(let s=0;s<r.length;s+=1){const e=r[s];if(o=e.encoding,e.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}(e,t,n,l),Kn.debug("using video encoding",a));const d=a.maxFramerate,u=new Yr(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&uo(l)){const e=new vs(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Br();if(go()||ko()||"Chrome"===(null==n?void 0:n.name)&&Eo(null==n?void 0:n.version,"113")<0){const i="h"==e.suffix?2:3,r=function(e){return e||(e=Br()),"Safari"===(null==e?void 0:e.name)&&Eo(e.version,"18.3")>0||"iOS"===(null==e?void 0:e.os)&&!!(null==e?void 0:e.osVersion)&&Eo(e.osVersion,"18.3")>0}(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:hs[2-n],maxBitrate:a.maxBitrate/Math.pow(i,n),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:r?Math.pow(2,n):void 0});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(t[0].priority=u.encoding.priority,t[0].networkPriority=u.encoding.priority),Kn.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let h,p=[];if(p=e?null!==(r=gs(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:ms(e,u):null!==(o=gs(null==i?void 0:i.videoSimulcastLayers))&&void 0!==o?o:ms(e,u),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return fs(t,n,[e,h,u],d);if(i>=480)return fs(t,n,[e,u],d)}return fs(t,n,[u])}function ms(e,t){if(e)return us(t);const{width:n,height:i}=t,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?ls:ds}function fs(e,t,n,i){const r=[];if(n.forEach((n,o)=>{if(o>=hs.length)return;const a=Math.min(e,t),s={rid:hs[o],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);const l=mo()||0===o;n.encoding.priority&&l&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),r.push(s)}),ko()&&"ios"===Co()){let e;r.forEach(t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate});let t=!0;r.forEach(n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,Kn.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Kn.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)})}return r}function gs(e){if(e)return e.sort((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0})}class vs{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class bs extends rs{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;super(t,Gr.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>Zn(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let t;try{t=yield this.getSenderStats()}catch(e){return void this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const n=new Map(t.map(e=>[e.rid,e])),i=t.some(e=>"cpu"===e.qualityLimitationReason);if(i!==this.isCpuConstrained&&(this.isCpuConstrained=i,this.isCpuConstrained&&this.emit(e.TrackEvent.CpuConstrained)),this.prevStats){let e=0;n.forEach((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=es(t,r)}),this._currentBitrate=e}this.prevStats=n}),this.senderLock=new o}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!yo())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Za))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return Zn(this,void 0,void 0,function*(){var t,n,i,r,o;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=ti(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(null)}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return Zn(this,void 0,void 0,function*(){var t,n,i,r,o;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=ti(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Zn(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==Gr.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Zn(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==Gr.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return Zn(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach(e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),t.push(r)}}),t.sort((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)}),t})}setPublishingQuality(t){const n=[];for(let i=e.VideoQuality.LOW;i<=e.VideoQuality.HIGH;i+=1)n.push(new kn({quality:i,enabled:i<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(uo(this.codec),n)}restartTrack(e){return Zn(this,void 0,void 0,function*(){var t,n,i,r,o;let a;if(e){const t=Zo({video:e});"boolean"!=typeof t.video&&(a=t.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var s,c=!0,l=ti(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);c=!0){r=s.value,c=!1;const e=r;e.sender&&"closed"!==(null===(o=e.sender.transport)||void 0===o?void 0:o.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{c||t||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return Zn(this,arguments,void 0,function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,o,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var d,u=!0,h=ti(n.simulcastCodecs.values());!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(e){o={error:e}}finally{try{u||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}}()})}setDegradationPreference(e){return Zn(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},5e3))}setPublishingCodecs(e){return Zn(this,void 0,void 0,function*(){var t,n,i,r,o,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(uo(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=ti(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield ys(t.sender,t.encodings,e.qualities,this.senderLock,uo(e.codec),this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(uo(e.codec),e.qualities)}}catch(e){o={error:e}}finally{try{t||r||!(a=n.return)||(yield a.call(n))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e,t){return Zn(this,void 0,void 0,function*(){this.optimizeForPerformance?this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t})):(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield ys(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext)))})}prioritizePerformance(){return Zn(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const e=this.sender.getParameters();e.encodings=e.encodings.map((e,t)=>{var n;return Object.assign(Object.assign({},e),{active:0===t,scaleResolutionDownBy:Math.max(1,Math.ceil((null!==(n=this.mediaStreamTrack.getSettings().height)&&void 0!==n?n:360)/360)),scalabilityMode:0===t&&uo(this.codec)?"L1T3":void 0,maxFramerate:0===t?15:0,maxBitrate:0===t?e.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:e.encodings})),this.encodings=e.encodings,yield this.sender.setParameters(e)}catch(e){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:e})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Zn(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),bo()&&this.isInBackground&&this.source===Gr.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function ys(e,t,n,i,r,o,a){return Zn(this,void 0,void 0,function*(){const s=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:s}=i;if(!s)return;if(s.length!==t.length)return void o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:s,senderEncodings:t}));let c=!1;r&&n.some(e=>e.enabled)&&n.forEach(e=>e.enabled=!0),s.forEach((e,i)=>{var r;let s=null!==(r=e.rid)&&void 0!==r?r:"";""===s&&(s="q");const l=ks(s),d=n.find(e=>e.quality===l);d&&e.active!==d.enabled&&(c=!0,e.active=d.enabled,o.debug("setting layer ".concat(d.quality," to ").concat(e.active?"enabled":"disabled"),a),mo()&&(d.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))}),c&&(i.encodings=s,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:i.encodings})),yield e.setParameters(i))}finally{s()}})}function ks(t){switch(t){case"f":default:return e.VideoQuality.HIGH;case"h":return e.VideoQuality.MEDIUM;case"q":return e.VideoQuality.LOW}}function Ts(t,n,i,r){if(!i)return[new mt({quality:e.VideoQuality.HIGH,width:t,height:n,bitrate:0,ssrc:0})];if(r){const r=i[0].scalabilityMode,o=new vs(r),a=[],s="h"==o.suffix?1.5:2,c="h"==o.suffix?2:3;for(let l=0;l<o.spatial;l+=1)a.push(new mt({quality:Math.min(e.VideoQuality.HIGH,o.spatial-1)-l,width:Math.ceil(t/Math.pow(s,l)),height:Math.ceil(n/Math.pow(s,l)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return a}return i.map(e=>{var i,r,o;const a=null!==(i=e.scaleResolutionDownBy)&&void 0!==i?i:1;let s=ks(null!==(r=e.rid)&&void 0!==r?r:"");return new mt({quality:s,width:Math.ceil(t/a),height:Math.ceil(n/a),bitrate:null!==(o=e.maxBitrate)&&void 0!==o?o:0,ssrc:0})})}const Ss="_lossy",Cs="_reliable",ws="leave-reconnect";var Es,Ps;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Es||(Es={}));class Rs extends ri.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var n;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=Ga.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Es.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Kn,this.reliableDataSequence=1,this.reliableMessageBuffer=new Ta,this.reliableReceivedState=new Sa(3e4),this.handleDataChannel=e=>Zn(this,[e],void 0,function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===Cs)t.reliableDCSub=n;else{if(n.label!==Ss)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()}),this.handleDataMessage=t=>Zn(this,void 0,void 0,function*(){var n,i;const r=yield this.dataProcessLock.lock();try{let r;if(t.data instanceof ArrayBuffer)r=t.data;else{if(!(t.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:t.data}));r=yield t.data.arrayBuffer()}const o=ft.fromBinary(new Uint8Array(r));if(o.sequence>0&&""!==o.participantSid){const e=this.reliableReceivedState.get(o.participantSid);if(e&&o.sequence<=e)return;this.reliableReceivedState.set(o.participantSid,o.sequence)}"speaker"===(null===(n=o.value)||void 0===n?void 0:n.case)?this.emit(e.EngineEvent.ActiveSpeakersUpdate,o.value.value.speakers):("user"===(null===(i=o.value)||void 0===i?void 0:i.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(o,o.value.value),this.emit(e.EngineEvent.DataPacketReceived,o))}finally{r()}}),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?gt.LOSSY:gt.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(t,n)=>{if(this._isClosed)return;this.log.warn("".concat(t," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const i=t=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(t,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),this.close()},r=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:r,retryCount:this.reconnectAttempts});null!==o?(t===ws&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Wr.setTimeout(()=>this.attemptReconnect(n).finally(()=>this.reconnectTimeout=void 0),o)):i(r)},this.waitForRestarted=()=>new Promise((t,n)=>{this.pcState===Es.Connected&&t();const i=()=>{this.off(e.EngineEvent.Disconnected,r),t()},r=()=>{this.off(e.EngineEvent.Restarted,i),n()};this.once(e.EngineEvent.Restarted,i),this.once(e.EngineEvent.Disconnected,r)}),this.updateAndEmitDCBufferStatus=t=>{const n=this.isBufferStatusLow(t);void 0!==n&&n!==this.dcBufferStatus.get(t)&&(this.dcBufferStatus.set(t,n),this.emit(e.EngineEvent.DCBufferStatusChanged,n,t))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===gt.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===va.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(tt.RR_SIGNAL_DISCONNECTED))},this.log=Qn(null!==(n=t.loggerName)&&void 0!==n?n:e.LoggerNames.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new ba(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new o,this.dataProcessLock=new o,this.dcBufferStatus=new Map([[gt.LOSSY,!0],[gt.RELIABLE,!0]]),this.client.onParticipantUpdate=t=>this.emit(e.EngineEvent.ParticipantUpdate,t),this.client.onConnectionQuality=t=>this.emit(e.EngineEvent.ConnectionQualityUpdate,t),this.client.onRoomUpdate=t=>this.emit(e.EngineEvent.RoomUpdate,t),this.client.onSubscriptionError=t=>this.emit(e.EngineEvent.SubscriptionError,t),this.client.onSubscriptionPermissionUpdate=t=>this.emit(e.EngineEvent.SubscriptionPermissionUpdate,t),this.client.onSpeakersChanged=t=>this.emit(e.EngineEvent.SpeakersChanged,t),this.client.onStreamStateUpdate=t=>this.emit(e.EngineEvent.StreamStateChanged,t),this.client.onRequestResponse=t=>this.emit(e.EngineEvent.SignalRequestResponse,t)}get logContext(){var e,t,n,i,r,o;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(o=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===o?void 0:o.identity,pID:this.participantSid}}join(t,n,i,r){return Zn(this,void 0,void 0,function*(){this.url=t,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(t,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),this.subscriberPrimary&&!o.fastPublish||this.negotiate(),this.clientConfiguration=o.clientConfiguration,this.emit(e.EngineEvent.SignalConnected,o),o}catch(a){if(a instanceof xr&&a.reason===e.ConnectionErrorReason.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,n,i,r);throw a}})}close(){return Zn(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed)t();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(e.EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return Zn(this,void 0,void 0,function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Ta,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return Zn(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new Dr("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],i(new xr("publication of local track timed out, no response from server",e.ConnectionErrorReason.Timeout))},1e4);this.pendingTrackResolvers[t.cid]={resolve:e=>{clearTimeout(r),n(e)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return Zn(this,void 0,void 0,function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(t){return Zn(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Qa.NEW)return;this.participantSid=null===(n=t.participant)||void 0===n?void 0:n.sid;const r=this.makeRTCConfiguration(t);var o;this.pcManager=new Ja(r,t.subscriberPrimary,this.loggerOptions),this.emit(e.EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(n,i,r)=>Zn(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(n),this.logContext),["closed","disconnected","failed"].includes(i)&&(this.publisherConnectionPromise=void 0),n===Qa.CONNECTED){const n=this.pcState===Es.New;this.pcState=Es.Connected,n&&this.emit(e.EngineEvent.Connected,t)}else n===Qa.FAILED&&this.pcState===Es.Connected&&(this.pcState=Es.Disconnected,this.handleDisconnect("peerconnection failed","failed"===r?tt.RR_SUBSCRIBER_FAILED:tt.RR_PUBLISHER_FAILED));const o=this.client.isDisconnected||this.client.currentState===va.RECONNECTING,a=[Qa.FAILED,Qa.CLOSING,Qa.CLOSED].includes(n);o&&a&&!this._isClosed&&this.emit(e.EngineEvent.Offline)}),this.pcManager.onTrack=t=>{this.emit(e.EngineEvent.MediaTrackAdded,t.track,t.streams[0],t.receiver)},void 0!==(o=null===(i=t.serverInfo)||void 0===i?void 0:i.protocol)&&o>13||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>Zn(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>Zn(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);n&&this.client.sendAnswer(n,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(e.EngineEvent.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(e.EngineEvent.LocalTrackSubscribed,t)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(t,n)=>{this.emit(e.EngineEvent.RemoteMute,t,n)},this.client.onSubscribedQualityUpdate=t=>{this.emit(e.EngineEvent.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var n;this.participantSid=null===(n=t.participant)||void 0===n?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit(e.EngineEvent.RoomMoved,t)},this.client.onClose=()=>{this.handleDisconnect("signal",tt.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==t?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(t.regions)),t.action){case dn.DISCONNECT:this.emit(e.EngineEvent.Disconnected,null==t?void 0:t.reason),this.close();break;case dn.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ws);break;case dn.RESUME:this.handleDisconnect(ws)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach(e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)}),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ze.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Ss,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Cs,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return Zn(this,void 0,void 0,function*(){if(ao())return yield this.createTransceiverRTCRtpSender(e,t,n);if(so())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Nr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,n,i){return Zn(this,void 0,void 0,function*(){if(ao())return this.createSimulcastTransceiverSender(e,t,n,i);if(so())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Nr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,n){return Zn(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Ho(e)&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};return n&&(r.sendEncodings=n),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(e,t,n,i){return Zn(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nr("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return Zn(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(t){return Zn(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed)if(this.attemptingReconnect)Kn.warn("already attempting reconnect, returning early",this.logContext);else{(null===(n=this.clientConfiguration)||void 0===n?void 0:n.resumeConnection)!==Ze.DISABLED&&(null!==(r=null===(i=this.pcManager)||void 0===i?void 0:i.currentState)&&void 0!==r?r:Qa.NEW)!==Qa.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(t){this.reconnectAttempts+=1;let i=!0;t instanceof Nr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:t})),i=!1):t instanceof Is||(this.fullReconnectOnNext=!0),i?this.handleDisconnect("reconnect",tt.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(t){return Zn(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Nr("could not reconnect, url or token not saved");let i;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Is;i=yield this.join(null!=t?t:this.url,this.token,this.signalOpts)}catch(t){if(t instanceof xr&&t.reason===e.ConnectionErrorReason.NotAllowed)throw new Nr("could not reconnect, token might be expired");throw new Is}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(e.EngineEvent.SignalRestarted,i),yield this.waitForPCReconnected(),this.client.currentState!==va.CONNECTED)throw new Is("Signal connection got severed during reconnect");null===(n=this.regionUrlProvider)||void 0===n||n.resetAttempts(),this.emit(e.EngineEvent.Restarted)}catch(e){const n=yield null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getNextBestRegionUrl();if(n)return void(yield this.restartConnection(n));throw null===(r=this.regionUrlProvider)||void 0===r||r.resetAttempts(),e}})}resumeConnection(t){return Zn(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Nr("could not reconnect, url or token not saved");if(!this.pcManager)throw new Nr("publisher and subscriber connections unset");let i;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Resuming);try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(t){let i="";if(t instanceof Error&&(i=t.message,this.log.error(t.message,Object.assign(Object.assign({},this.logContext),{error:t}))),t instanceof xr&&t.reason===e.ConnectionErrorReason.NotAllowed)throw new Nr("could not reconnect, token might be expired");if(t instanceof xr&&t.reason===e.ConnectionErrorReason.LeaveRequest)throw t;throw new Is(i)}if(this.emit(e.EngineEvent.SignalResumed),i){const e=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==va.CONNECTED)throw new Is("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(n=this.reliableDC)||void 0===n?void 0:n.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),(null==i?void 0:i.lastMessageSeq)&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(e.EngineEvent.Resumed)})}waitForPCInitialConnection(e,t){return Zn(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return Zn(this,void 0,void 0,function*(){this.pcState=Es.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield oo(2e3),!this.pcManager)throw new Nr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Es.Connected}catch(t){throw this.pcState=Es.Disconnected,new xr("could not establish PC connection, ".concat(t.message),e.ConnectionErrorReason.InternalError)}})}publishRpcResponse(e,t,n,i){return Zn(this,void 0,void 0,function*(){const r=new ft({destinationIdentities:[e],kind:gt.RELIABLE,value:{case:"rpcResponse",value:new Pt({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!=n?n:""}})}});yield this.sendDataPacket(r,gt.RELIABLE)})}publishRpcAck(e,t){return Zn(this,void 0,void 0,function*(){const n=new ft({destinationIdentities:[e],kind:gt.RELIABLE,value:{case:"rpcAck",value:new Et({requestId:t})}});yield this.sendDataPacket(n,gt.RELIABLE)})}sendDataPacket(e,t){return Zn(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(t),t===gt.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===gt.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;i.send(n)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return Zn(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(gt.RELIABLE);const t=this.dataChannelForKind(gt.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(e=>{t.send(e.data)})),this.updateAndEmitDCBufferStatus(gt.RELIABLE)})}waitForBufferStatusLow(t){return new Promise((n,i)=>Zn(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))n();else{const r=()=>i("Engine closed");for(this.once(e.EngineEvent.Closing,r);!this.dcBufferStatus.get(t);)yield oo(10);this.off(e.EngineEvent.Closing,r),n()}}))}ensureDataTransportConnected(t){return Zn(this,arguments,void 0,function(t){var n=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var r;if(!n.pcManager)throw new Nr("PC manager is closed");const o=i?n.pcManager.subscriber:n.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new xr("".concat(a," connection not set"),e.ConnectionErrorReason.InternalError);let s=!1;i||n.dataChannelForKind(t,i)||(n.createDataChannels(),s=!0),s||i||n.pcManager.publisher.isICEConnected||"checking"===n.pcManager.publisher.getICEConnectionState()||(s=!0),s&&n.negotiate();const c=n.dataChannelForKind(t,i);if("open"===(null==c?void 0:c.readyState))return;const l=(new Date).getTime()+n.peerConnectionTimeout;for(;(new Date).getTime()<l;){if(o.isICEConnected&&"open"===(null===(r=n.dataChannelForKind(t,i))||void 0===r?void 0:r.readyState))return;yield oo(50)}throw new xr("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),e.ConnectionErrorReason.InternalError)}()})}ensurePublisherConnected(e){return Zn(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!!this.pcManager&&this.pcManager.currentState===Qa.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return Zn(this,void 0,void 0,function*(){return new Promise((t,n)=>Zn(this,void 0,void 0,function*(){if(!this.pcManager)return void n(new Ar("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(e.EngineEvent.Closing,r),this.pcManager.publisher.once(ja,t=>{const n=new Map;t.forEach(e=>{const t=e.codec.toLowerCase();var i;i=t,Xr.includes(i)&&n.set(e.payload,t)}),this.emit(e.EngineEvent.RTPVideoMapUpdate,n)});try{yield this.pcManager.negotiate(i),t()}catch(e){e instanceof Ar&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",tt.RR_UNKNOWN),n(e)}finally{this.off(e.EngineEvent.Closing,r)}}))})}dataChannelForKind(e,t){if(t){if(e===gt.LOSSY)return this.lossyDCSub;if(e===gt.RELIABLE)return this.reliableDCSub}else{if(e===gt.LOSSY)return this.lossyDC;if(e===gt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach(e=>{e.isDesired!==a&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)}),this.client.sendSyncState(new Rn({answer:r?ka({sdp:r.sdp,type:r.type}):void 0,offer:o?ka({sdp:o.sdp,type:o.type}):void 0,subscription:new on({trackSids:s,subscribe:!a,participantTracks:[]}),publishTracks:aa(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c,datachannelReceiveStates:this.reliableReceivedState.map((e,t)=>new In({publisherSid:t,lastSeq:e}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null==t?void 0:t.id)&&null!==t.id&&e.push(new On({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(gt.LOSSY),zt.PUBLISHER),t(this.dataChannelForKind(gt.RELIABLE),zt.PUBLISHER),t(this.dataChannelForKind(gt.LOSSY,!0),zt.SUBSCRIBER),t(this.dataChannelForKind(gt.RELIABLE,!0),zt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Wr.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){yo()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){yo()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Is extends Error{}class Os{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return To(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Zn(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(t=>t.url===e.url));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),Kn.debug("next region: ".concat(e.region)),e.url}return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(t){return Zn(this,void 0,void 0,function*(){const n=yield fetch("".concat((i=this.serverUrl,"".concat(i.protocol.replace("ws","http"),"//").concat(i.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:t});var i;if(n.ok){const e=yield n.json();return this.lastUpdateAt=Date.now(),e}throw new xr("Could not fetch region settings: ".concat(n.statusText),401===n.status?e.ConnectionErrorReason.NotAllowed:e.ConnectionErrorReason.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class xs{get info(){return this._info}constructor(e,t,n){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0}}class _s extends xs{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength;const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>Zn(this,void 0,void 0,function*(){try{const{done:t,value:n}=yield e.read();return t?{done:!0,value:void 0}:(this.handleChunkReceived(n),{done:!1,value:n.content})}catch(e){return{done:!0,value:void 0}}}),return(){return Zn(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return Zn(this,void 0,void 0,function*(){var e,t,n,i;let r=new Set;try{for(var o,a=!0,s=ti(this);!(e=(o=yield s.next()).done);a=!0){i=o.value,a=!1;const e=i;r.add(e)}}catch(e){t={error:e}}finally{try{a||e||!(n=s.return)||(yield n.call(s))}finally{if(t)throw t.error}}return Array.from(r)})}}class Ds extends xs{constructor(e,t,n){super(e,t,n),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=Bo(e.chunkIndex),i=this.receivedChunks.get(n);if(i&&i.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder;return{next:()=>Zn(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:t.decode(i.content)})}catch(e){return{done:!0,value:void 0}}}),return(){return Zn(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return Zn(this,void 0,void 0,function*(){var e,t,n,i;let r="";try{for(var o,a=!0,s=ti(this);!(e=(o=yield s.next()).done);a=!0)i=o.value,a=!1,r+=i}catch(e){t={error:e}}finally{try{a||e||!(n=s.return)||(yield n.call(s))}finally{if(t)throw t.error}}return r})}}class Ms{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return Zn(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)})}}class Ns extends Ms{}class As extends Ms{}class Ls extends Gr{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const n=i=>{i.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(e.TrackEvent.Ended,this))};t.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return Zn(this,void 0,void 0,function*(){var e;if(null===(e=this.receiver)||void 0===e?void 0:e.getStats)return yield this.receiver.getStats()})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Za)),"undefined"!=typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>t());const i=null===(n=this.receiver)||void 0===n?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:t,rtpTimestamp:n}=i;n&&this.rtpTimestamp!==n&&(this.emit(e.TrackEvent.TimeSyncUpdate,{timestamp:t,rtpTimestamp:n}),this.rtpTimestamp=n)}};t()}}class Us extends Ls{constructor(e,t,n,i,r,o){super(e,t,Gr.Kind.Audio,n,o),this.monitorReceiver=()=>Zn(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=es(e,this.prevStats)),this.prevStats=e}),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;ko()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ko())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return Zn(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(ho(t))return t.setSinkId(e)}))})}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&ho(e)&&e.setSinkId(this.sinkId).catch(e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(e=>{i.connect(e),i=e}),this.gainNode=t.createGain(),i.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==t.state&&t.resume().then(()=>{"running"!==t.state&&this.emit(e.TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(t=>{this.emit(e.TrackEvent.AudioPlaybackFailed,t)})}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Zn(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach(t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})}),e})}}class js extends Ls{constructor(e,t,n,i,r){super(e,t,Gr.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>Zn(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=es(e,this.prevStats)),this.prevStats=e}),this.debouncedHandleResize=Aa(()=>{this.updateDimensions()},100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Jr(this._mediaStreamTrack,t):Qr(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t.element===e)){const t=new Fs(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t===e)?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter(t=>t===e);for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter(t=>t!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return Zn(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach(e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)}),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(t=>t.element===e);for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Zn(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var t,n;const i=this.elementInfos.reduce((e,t)=>Math.max(e,t.visibilityChangedAt||0),0),r=!(null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pauseVideoInBackground)&&void 0!==n&&!n)&&this.isInBackground,o=this.elementInfos.some(e=>e.pictureInPicture),a=this.elementInfos.some(e=>e.visible)&&!r||o;this.lastVisible!==a&&(!a&&Date.now()-i<100?Wr.setTimeout(()=>{this.updateVisibility()},100):(this.lastVisible=a,this.emit(e.TrackEvent.VisibilityChanged,a,this)))}updateDimensions(){var t,n;let i=0,r=0;const o=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*o,n=e.height()*o;t+n>i+r&&(i=t,r=n)}(null===(t=this.lastDimensions)||void 0===t?void 0:t.width)===i&&(null===(n=this.lastDimensions)||void 0===n?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(e.TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?wo():t||(wo()>2?2:1)}}class Fs{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=Bs(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Bs(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=Bs(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!=t?t:Vs(e),this.isPiP=yo()&&Bs(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=Vs(this.element),this.isPiP=Bs(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,_o().observe(this.element),Oo().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=_o())||void 0===e||e.unobserve(this.element),null===(t=Oo())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function Bs(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&Vs(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function Vs(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const o=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!s&&"none"!==c}class qs extends ri.EventEmitter{constructor(t,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=ut.NONE,this.log=Kn,this.handleMuted=()=>{this.emit(e.TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(e.TrackEvent.Unmuted)},this.log=Qn(null!==(o=null==r?void 0:r.loggerName)&&void 0!==o?o:e.LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=i,this.source=Gr.Source.Unknown}setTrack(t){this.track&&(this.track.off(e.TrackEvent.Muted,this.handleMuted),this.track.off(e.TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(e.TrackEvent.Muted,this.handleMuted),t.on(e.TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),sa(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==ut.NONE}get audioTrack(){if(zo(this.track))return this.track}get videoTrack(){if(Ho(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Gr.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Gr.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(qs||(qs={}));class zs extends qs{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(t,n,i,r){super(t,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(e.TrackEvent.Ended)},this.handleCpuConstrained=()=>{this.track&&Ho(this.track)&&this.emit(e.TrackEvent.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(t){this.track&&(this.track.off(e.TrackEvent.Ended,this.handleTrackEnded),this.track.off(e.TrackEvent.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(e.TrackEvent.Ended,this.handleTrackEnded),t.on(e.TrackEvent.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return Zn(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()})}unmute(){return Zn(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()})}pauseUpstream(){return Zn(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()})}resumeUpstream(){return Zn(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(zo(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(it.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(it.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(it.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(it.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(it.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(it.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function Hs(e,t){return Zn(this,void 0,void 0,function*(){null!=e||(e={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=ca(e);let a=o.audio,s=o.video;if(i&&"object"==typeof o.audio&&(o.audio.processor=i),r&&"object"==typeof o.video&&(o.video.processor=r),e.audio&&"object"==typeof o.audio&&"string"==typeof o.audio.deviceId){const e=o.audio.deviceId;o.audio.deviceId={exact:e},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:e}})}if(o.video&&"object"==typeof o.video&&"string"==typeof o.video.deviceId){const e=o.video.deviceId;o.video.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},o.video),{deviceId:{ideal:e}})}(!0===o.audio||"object"==typeof o.audio&&!o.audio.deviceId)&&(o.audio={deviceId:"default"}),!0===o.video?o.video={deviceId:"default"}:"object"!=typeof o.video||o.video.deviceId||(o.video.deviceId="default");const c=$o(o,Ha,Wa),l=Zo(c),d=navigator.mediaDevices.getUserMedia(l);o.audio&&(ha.userMediaPromiseMap.set("audioinput",d),d.catch(()=>ha.userMediaPromiseMap.delete("audioinput"))),o.video&&(ha.userMediaPromiseMap.set("videoinput",d),d.catch(()=>ha.userMediaPromiseMap.delete("videoinput")));try{const e=yield d;return yield Promise.all(e.getTracks().map(n=>Zn(this,void 0,void 0,function*(){const o="audio"===n.kind;let a,s=o?c.audio:c.video;"boolean"!=typeof s&&s||(s={});const d=o?l.audio:l.video;"boolean"!=typeof d&&(a=d);const u=n.getSettings().deviceId;(null==a?void 0:a.deviceId)&&Uo(a.deviceId)!==u?a.deviceId=u:a||(a={deviceId:u});const h=function(e,t,n){switch(e.kind){case"audio":return new os(e,t,!1,void 0,n);case"video":return new bs(e,t,!1,n);default:throw new Dr("unsupported track type: ".concat(e.kind))}}(n,a,t);return h.kind===Gr.Kind.Video?h.source=Gr.Source.Camera:h.kind===Gr.Kind.Audio&&(h.source=Gr.Source.Microphone),h.mediaStream=e,zo(h)&&i?yield h.setProcessor(i):Ho(h)&&r&&(yield h.setProcessor(r)),h})))}catch(i){if(!n)throw i;return Hs(Object.assign(Object.assign({},e),{audio:a,video:s}),t)}})}function Ws(e){return Zn(this,void 0,void 0,function*(){return(yield Hs({audio:!1,video:null==e||e}))[0]})}function Ks(e){return Zn(this,void 0,void 0,function*(){return(yield Hs({audio:null==e||e,video:!1}))[0]})}e.ConnectionQuality=void 0,function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(e.ConnectionQuality||(e.ConnectionQuality={}));class Gs extends ri.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===lt.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===ct.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,n,i,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:lt.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=e.ConnectionQuality.Unknown,this.log=Kn,this.log=Qn(null!==(c=null==a?void 0:a.loggerName)&&void 0!==c?c:e.LoggerNames.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=s,this._attributes=null!=o?o:{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new Lo,this.once(e.ParticipantEvent.Active,()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0})),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(Gr.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(Gr.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(Gr.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(t){var n;return!(this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version)&&(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===ct.ACTIVE&&(null===(n=this.participantInfo)||void 0===n?void 0:n.state)!==ct.ACTIVE&&this.emit(e.ParticipantEvent.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(e.ParticipantEvent.ParticipantMetadataChanged,i)}_setName(t){const n=this.name!==t;this.name=t,n&&this.emit(e.ParticipantEvent.ParticipantNameChanged,t)}_setAttributes(t){const n=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const o of i)e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"");return r}(this.attributes,t);this._attributes=t,Object.keys(n).length>0&&this.emit(e.ParticipantEvent.AttributesChanged,n)}setPermissions(t){var n,i,r,o,a,s;const c=this.permissions,l=t.canPublish!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublish)||t.canSubscribe!==(null===(i=this.permissions)||void 0===i?void 0:i.canSubscribe)||t.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||t.hidden!==(null===(o=this.permissions)||void 0===o?void 0:o.hidden)||t.recorder!==(null===(a=this.permissions)||void 0===a?void 0:a.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])})||t.canSubscribeMetrics!==(null===(s=this.permissions)||void 0===s?void 0:s.canSubscribeMetrics);return this.permissions=t,l&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,c),l}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(e.ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=function(t){switch(t){case Xe.EXCELLENT:return e.ConnectionQuality.Excellent;case Xe.GOOD:return e.ConnectionQuality.Good;case Xe.POOR:return e.ConnectionQuality.Poor;case Xe.LOST:return e.ConnectionQuality.Lost;default:return e.ConnectionQuality.Unknown}}(t),n!==this._connectionQuality&&this.emit(e.ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>zo(t.track)&&t.track.setAudioContext(e))}addTrackPublication(t){t.on(e.TrackEvent.Muted,()=>{this.emit(e.ParticipantEvent.TrackMuted,t)}),t.on(e.TrackEvent.Unmuted,()=>{this.emit(e.ParticipantEvent.TrackUnmuted,t)});const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case Gr.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case Gr.Kind.Video:this.videoTrackPublications.set(t.trackSid,t)}}}class Qs extends Gs{constructor(t,n,i,r,o){super(t,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ut.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Lo)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t,n,i,r,o;this.reconnectFuture&&(this.reconnectFuture.promise.catch(e=>this.log.warn(e.message,this.logContext)),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(i=(n=this.signalConnectedFuture).reject)||void 0===i||i.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(o=null===(r=this.activeAgentFuture)||void 0===r?void 0:r.reject)||void 0===o||o.call(r,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Lo),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==Un.OK&&r.reject(new Ur(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,i=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(i=Ya.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,i);break;case"rpcAck":let r=e.value.value;this.handleIncomingRpcAck(r.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Cn({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e)))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),sa(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),sa(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),sa(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.onTrackCpuConstrained=(t,n)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),sa(n))),this.emit(e.ParticipantEvent.LocalTrackCpuConstrained,t,n)},this.handleSubscribedQualityUpdate=e=>Zn(this,void 0,void 0,function*(){var t,n,i,r,o;if(!(null===(o=this.roomOptions)||void 0===o?void 0:o.dynacast))return;const a=this.videoTrackPublications.get(e.trackSid);if(!a)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!a.videoTrack)return;const s=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,d=ti(s);!(t=(c=yield d.next()).done);l=!0){r=c.value,l=!1;const e=r;Zr(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),sa(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(e){n={error:e}}finally{try{l||t||!(i=d.return)||(yield i.call(d))}finally{if(n)throw n.error}}}),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>Zn(this,void 0,void 0,function*(){if(e.source===Gr.Source.ScreenShare||e.source===Gr.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),sa(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(Ko(e)||Wo(e))try{if(yo())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===Gr.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),sa(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(e){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),sa(e))),Ko(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),sa(e))),yield e.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ut.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(t){this.engine=t,this.engine.on(e.EngineEvent.RemoteMute,(e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())}),this.engine.on(e.EngineEvent.Connected,this.handleReconnected).on(e.EngineEvent.SignalConnected,this.handleSignalConnected).on(e.EngineEvent.SignalRestarted,this.handleReconnected).on(e.EngineEvent.SignalResumed,this.handleReconnected).on(e.EngineEvent.Restarting,this.handleReconnecting).on(e.EngineEvent.Resuming,this.handleReconnecting).on(e.EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(e.EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(e.EngineEvent.Disconnected,this.handleDisconnected).on(e.EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket),this.signalConnectedFuture=void 0}setMetadata(e){return Zn(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return Zn(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return Zn(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return Zn(this,arguments,void 0,function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise((e,o)=>Zn(t,void 0,void 0,function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!=n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!=i?i:this.name)&&void 0!==a?a:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{o(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every(e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]})))return this.pendingSignalRequests.delete(c),void e();yield oo(50)}o(new Ur("Request to update local metadata timed out","TimeoutError"))}catch(e){e instanceof Error&&o(e)}}))}()})}setCameraEnabled(e,t,n){return this.setTrackEnabled(Gr.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(Gr.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(Gr.Source.ScreenShare,e,t,n)}setPermissions(t){const n=this.permissions,i=super.setPermissions(t);return i&&n&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return Zn(this,void 0,void 0,function*(){this.encryptionType=e?ut.GCM:ut.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,n,i,r){return Zn(this,void 0,void 0,function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:n})),this.republishPromise&&(yield this.republishPromise);let s=this.getTrackPublication(t);if(n)if(s)yield s.unmute();else{let n;if(this.pendingPublishing.has(t)){const e=yield this.waitForPendingPublicationOfSource(t);return e||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield null==e?void 0:e.unmute(),e}this.pendingPublishing.add(t);try{switch(t){case Gr.Source.Camera:n=yield this.createTracks({video:null===(o=i)||void 0===o||o});break;case Gr.Source.Microphone:n=yield this.createTracks({audio:null===(a=i)||void 0===a||a});break;case Gr.Source.ScreenShare:n=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Dr(t)}}catch(i){throw null==n||n.forEach(e=>{e.stop()}),i instanceof Error&&this.emit(e.ParticipantEvent.MediaDevicesError,i,ia(t)),this.pendingPublishing.delete(t),i}for(const e of n)t===Gr.Source.Microphone&&zo(e)&&(null==r?void 0:r.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),e.startPreConnectBuffer());try{const e=[];for(const i of n)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),sa(i))),e.push(this.publishTrack(i,r));const t=yield Promise.all(e);[s]=t}catch(e){throw null==n||n.forEach(e=>{e.stop()}),e}finally{this.pendingPublishing.delete(t)}}else if(!(null==s?void 0:s.track)&&this.pendingPublishing.has(t)&&(s=yield this.waitForPendingPublicationOfSource(t),s||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),s&&s.track)if(t===Gr.Source.ScreenShare){s=yield this.unpublishTrack(s.track);const e=this.getTrackPublication(Gr.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield s.mute();return s})}enableCameraAndMicrophone(){return Zn(this,void 0,void 0,function*(){if(!this.pendingPublishing.has(Gr.Source.Camera)&&!this.pendingPublishing.has(Gr.Source.Microphone)){this.pendingPublishing.add(Gr.Source.Camera),this.pendingPublishing.add(Gr.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(e=>this.publishTrack(e)))}finally{this.pendingPublishing.delete(Gr.Source.Camera),this.pendingPublishing.delete(Gr.Source.Microphone)}}})}createTracks(t){return Zn(this,void 0,void 0,function*(){var n,i;null!=t||(t={});const r=$o(t,null===(n=this.roomOptions)||void 0===n?void 0:n.audioCaptureDefaults,null===(i=this.roomOptions)||void 0===i?void 0:i.videoCaptureDefaults);try{return(yield Hs(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(t=>(zo(t)&&(this.microphoneError=void 0,t.setAudioContext(this.audioContext),t.source=Gr.Source.Microphone,this.emit(e.ParticipantEvent.AudioStreamAcquired)),Ho(t)&&(this.cameraError=void 0,t.source=Gr.Source.Camera),t))}catch(e){throw e instanceof Error&&(t.audio&&(this.microphoneError=e),t.video&&(this.cameraError=e)),e}})}createScreenTracks(t){return Zn(this,void 0,void 0,function*(){if(void 0===t&&(t={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new _r("getDisplayMedia not supported");void 0!==t.resolution||vo()||(t.resolution=io.h1080fps30.resolution);const n=ra(t),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(0===r.length)throw new Dr("no video track found");const o=new bs(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=Gr.Source.ScreenShare,t.contentHint&&(o.mediaStreamTrack.contentHint=t.contentHint);const a=[o];if(i.getAudioTracks().length>0){this.emit(e.ParticipantEvent.AudioStreamAcquired);const t=new os(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});t.source=Gr.Source.ScreenShareAudio,a.push(t)}return a})}publishTrack(e,t){return Zn(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return Zn(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s;let c,l;if(Ko(e)&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),qo(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case Gr.Source.Microphone:t="audioinput";break;case Gr.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new os(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new bs(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Dr("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach(t=>{t.track&&t.track===e&&(l=t)}),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),sa(l))),l;const d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,u=null!==(o=null==t?void 0:t.forceStereo)&&void 0!==o?o:d;u&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),sa(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=t.dtx)&&void 0!==a||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=Br(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&Eo(t,e.osVersion)>=0)||"Safari"===e.name&&Eo(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise((t,i)=>Zn(n,void 0,void 0,function*(){try{if(this.engine.client.currentState!==va.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:sa(e)}));const n=setTimeout(()=>{i(new Lr("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const r=yield this.publish(e,h,u);t(r)}else try{const n=yield this.publish(e,h,u);t(n)}catch(e){i(e)}}catch(e){i(e)}}));n.pendingPublishPromises.set(e,p);try{return yield p}catch(e){throw e}finally{n.pendingPublishPromises.delete(e)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Lo),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),sa(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map(e=>function(e){switch(e){case Ye.CAMERA:return Gr.Source.Camera;case Ye.MICROPHONE:return Gr.Source.Microphone;case Ye.SCREEN_SHARE:return Gr.Source.ScreenShare;case Ye.SCREEN_SHARE_AUDIO:return Gr.Source.ScreenShareAudio;default:return Gr.Source.Unknown}}(e)).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),sa(e))),!1)}publish(t,n,i){return Zn(this,void 0,void 0,function*(){var r,o,a,s,c,l,d,u,h,p;if(!this.hasPermissionsToPublish(t))throw new Lr("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(e=>qo(t)&&e.source===t.source)&&t.source!==Gr.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),sa(t))),n.stopMicTrackOnMute&&zo(t)&&(t.stopOnMute=!0),t.source===Gr.Source.ScreenShare&&mo()&&(n.simulcast=!1),"av1"!==n.videoCodec||co()||(n.videoCodec=void 0),"vp9"!==n.videoCodec||lo()||(n.videoCodec=void 0),void 0===n.videoCodec&&(n.videoCodec=qa),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(e=>n.videoCodec===oa(e.mime))||(n.videoCodec=oa(this.enabledPublishVideoCodecs[0].mime)));const m=n.videoCodec;t.on(e.TrackEvent.Muted,this.onTrackMuted),t.on(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.on(e.TrackEvent.Ended,this.handleTrackEnded),t.on(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.on(e.TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=[],g=!(null===(r=n.dtx)||void 0===r||r),v=t.getSourceTrackSettings();v.autoGainControl&&f.push(it.TF_AUTO_GAIN_CONTROL),v.echoCancellation&&f.push(it.TF_ECHO_CANCELLATION),v.noiseSuppression&&f.push(it.TF_NOISE_SUPPRESSION),v.channelCount&&v.channelCount>1&&f.push(it.TF_STEREO),g&&f.push(it.TF_NO_DTX),Ko(t)&&t.hasPreConnectBuffer&&f.push(it.TF_PRECONNECT_BUFFER);const b=new Jt({cid:t.mediaStreamTrack.id,name:n.name,type:Gr.kindToProto(t.kind),muted:t.isMuted,source:Gr.sourceToProto(t.source),disableDtx:g,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(null===(o=n.red)||void 0===o||o),stream:null==n?void 0:n.stream,backupCodecPolicy:null==n?void 0:n.backupCodecPolicy,audioFeatures:f});let y;if(t.kind===Gr.Kind.Video){let e={width:0,height:0};try{e=yield t.waitForDimensions()}catch(n){const r=null!==(s=null===(a=this.roomOptions.videoCaptureDefaults)||void 0===a?void 0:a.resolution)&&void 0!==s?s:to.h720.resolution;e={width:r.width,height:r.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),sa(t)),{dims:e}))}b.width=e.width,b.height=e.height,Wo(t)&&(uo(m)&&(t.source===Gr.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),sa(t))))),n.scalabilityMode=null!==(c=n.scalabilityMode)&&void 0!==c?c:"L3T3_KEY"),b.simulcastCodecs=[new Qt({codec:m,cid:t.mediaStreamTrack.id})],!0===n.backupCodec&&(n.backupCodec={codec:qa}),n.backupCodec&&m!==n.backupCodec.codec&&b.encryption===ut.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),b.simulcastCodecs.push(new Qt({codec:n.backupCodec.codec,cid:""})))),y=ps(t.source===Gr.Source.ScreenShare,b.width,b.height,n),b.layers=Ts(b.width,b.height,y,uo(n.videoCodec))}else t.kind===Gr.Kind.Audio&&(y=[{maxBitrate:null===(l=n.audioPreset)||void 0===l?void 0:l.maxBitrate,priority:null!==(u=null===(d=n.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==u?u:"high",networkPriority:null!==(p=null===(h=n.audioPreset)||void 0===h?void 0:h.priority)&&void 0!==p?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new Nr("cannot publish track when not connected");const k=()=>Zn(this,void 0,void 0,function*(){var i,r,o;if(!this.engine.pcManager)throw new Nr("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,n,y),this.emit(e.ParticipantEvent.LocalSenderCreated,t.sender,t),Wo(t)&&(null!==(i=n.degradationPreference)&&void 0!==i||(n.degradationPreference=function(e){return e.source===Gr.Source.ScreenShare||e.constraints.height&&Uo(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(t)),t.setDegradationPreference(n.degradationPreference)),y)if(mo()&&t.kind===Gr.Kind.Audio){let e;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===t.sender){e=n;break}e&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:e,codec:"opus",maxbr:(null===(r=y[0])||void 0===r?void 0:r.maxBitrate)?y[0].maxBitrate/1e3:0})}else t.codec&&uo(t.codec)&&(null===(o=y[0])||void 0===o?void 0:o.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:b.cid,codec:t.codec,maxbr:y[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const S=new Promise((e,n)=>Zn(this,void 0,void 0,function*(){var i;try{T=yield this.engine.addTrack(b),e(T)}catch(e){t.sender&&(null===(i=this.engine.pcManager)||void 0===i?void 0:i.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch(e=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),sa(t)),{error:e}))})),n(e)}}));if(this.enabledPublishVideoCodecs.length>0){const e=yield Promise.all([S,k()]);T=e[0]}else{let e;if(T=yield S,T.codecs.forEach(t=>{void 0===e&&(e=t.mimeType)}),e&&t.kind===Gr.Kind.Video){const i=oa(e);i!==m&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),sa(t)),{codec:i})),n.videoCodec=i,y=ps(t.source===Gr.Source.ScreenShare,b.width,b.height,n))}yield k()}const C=new zs(t.kind,T,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(C.on(e.TrackEvent.CpuConstrained,e=>this.onTrackCpuConstrained(e,C)),C.options=n,t.sid=T.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:T})),Wo(t)?t.startMonitor(this.engine.client):Ko(t)&&t.startMonitor(),this.addTrackPublication(C),this.emit(e.ParticipantEvent.LocalTrackPublished,C),Ko(t)&&T.audioFeatures.includes(it.TF_PRECONNECT_BUFFER)){const n=t.getPreConnectBuffer();if(this.on(e.ParticipantEvent.LocalTrackSubscribed,e=>{if(e.trackSid===T.sid){if(!t.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),sa(t))),t.stopPreConnectBuffer()}}),n){const e=new Promise((e,i)=>Zn(this,void 0,void 0,function*(){var r,o,a,s,c,l;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),sa(t)));const p=setTimeout(()=>{i(new Error("agent not active within 10 seconds"))},1e4),m=yield this.waitUntilActiveAgentPresent();clearTimeout(p),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),sa(t)));const f=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[m.identity],attributes:{trackId:C.trackSid,sampleRate:String(null!==(c=v.sampleRate)&&void 0!==c?c:"48000"),channels:String(null!==(l=v.channelCount)&&void 0!==l?l:"1")}});try{for(var d,u=!0,h=ti(n);!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield f.write(e)}}catch(e){o={error:e}}finally{try{u||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}yield f.close(),e()}catch(e){i(e)}}));e.then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),sa(t)))}).catch(e=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),sa(t)),{error:e}))})}}return C})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return Zn(this,void 0,void 0,function*(){var i;if(this.encryptionType!==ut.NONE)return;let r;if(this.trackPublications.forEach(t=>{t.track&&t.track===e&&(r=t)}),!r)throw new Dr("track is not published");if(!Wo(e))throw new Dr("track is not a video track");const o=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,r,o,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&Kn.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(o=s.height)&&void 0!==o?o:null===(a=e.dimensions)||void 0===a?void 0:a.height;return e.source===Gr.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),ps(e.source===Gr.Source.ScreenShare,c,l,n)}(e,t,o);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),sa(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new Jt({cid:s.mediaStreamTrack.id,type:Gr.kindToProto(e.kind),muted:e.isMuted,source:Gr.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=Ts(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new Nr("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>Zn(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,s,o,a),yield this.engine.negotiate()}))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))})}unpublishTrack(t,n){return Zn(this,void 0,void 0,function*(){var i,r;if(qo(t)){const e=this.pendingPublishPromises.get(t);e&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),sa(t))),yield e)}const o=this.getPublicationForTrack(t),a=o?sa(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));(t=o.track).off(e.TrackEvent.Muted,this.onTrackMuted),t.off(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.off(e.TrackEvent.Ended,this.handleTrackEnded),t.off(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.off(e.TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===n&&(n=null===(r=null===(i=this.roomOptions)||void 0===i?void 0:i.stopLocalTrackOnUnpublish)||void 0===r||r),n?t.stop():t.stopMonitor();let s=!1;const c=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Qa.FAILED&&c)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===c&&(e.direction="inactive",s=!0);if(this.engine.removeTrack(c)&&(s=!0),Wo(t)){for(const[,e]of t.simulcastCodecs)e.sender&&(this.engine.removeTrack(e.sender)&&(s=!0),e.sender=void 0);t.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:e}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case Gr.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case Gr.Kind.Video:this.videoTrackPublications.delete(o.trackSid)}return this.emit(e.ParticipantEvent.LocalTrackUnpublished,o),o.setTrack(void 0),s&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return Zn(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>this.unpublishTrack(e)))).filter(e=>!!e)})}republishAllTracks(e){return Zn(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise((i,r)=>Zn(t,void 0,void 0,function*(){try{const t=[];this.trackPublications.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))}),yield Promise.all(t.map(e=>Zn(this,void 0,void 0,function*(){const t=e.track;yield this.unpublishTrack(t,!1),!n||t.isMuted||t.source===Gr.Source.ScreenShare||t.source===Gr.Source.ScreenShareAudio||!Ko(t)&&!Wo(t)||t.isUserProvided||(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))),i()}catch(e){r(e)}finally{this.republishPromise=void 0}})),yield t.republishPromise}()})}publishData(e){return Zn(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?gt.RELIABLE:gt.LOSSY,r=n.destinationIdentities,o=n.topic,a=new ft({kind:i,value:{case:"user",value:new yt({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:o})}});yield t.engine.sendDataPacket(a,i)}()})}publishDtmf(e,t){return Zn(this,void 0,void 0,function*(){const n=new ft({kind:gt.RELIABLE,value:{case:"sipDtmf",value:new kt({code:e,digit:t})}});yield this.engine.sendDataPacket(n,gt.RELIABLE)})}sendChatMessage(t,n){return Zn(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:null==n?void 0:n.attachments},r=new ft({value:{case:"chatMessage",value:new Ct(Object.assign(Object.assign({},i),{timestamp:D.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,gt.RELIABLE),this.emit(e.ParticipantEvent.ChatMessage,i),i})}editChatMessage(t,n){return Zn(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:t,editTimestamp:Date.now()}),r=new ft({value:{case:"chatMessage",value:new Ct(Object.assign(Object.assign({},i),{timestamp:D.parse(i.timestamp),editTimestamp:D.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,gt.RELIABLE),this.emit(e.ParticipantEvent.ChatMessage,i),i})}sendText(e,t){return Zn(this,void 0,void 0,function*(){var n;const i=crypto.randomUUID(),r=(new TextEncoder).encode(e).byteLength,o=null===(n=null==t?void 0:t.attachments)||void 0===n?void 0:n.map(()=>crypto.randomUUID()),a=new Array(o?o.length+1:1).fill(0),s=(e,n)=>{var i;a[n]=e;const r=a.reduce((e,t)=>e+t,0);null===(i=null==t?void 0:t.onProgress)||void 0===i||i.call(t,r)},c=yield this.streamText({streamId:i,totalSize:r,destinationIdentities:null==t?void 0:t.destinationIdentities,topic:null==t?void 0:t.topic,attachedStreamIds:o,attributes:null==t?void 0:t.attributes});return yield c.write(e),s(1,0),yield c.close(),(null==t?void 0:t.attachments)&&o&&(yield Promise.all(t.attachments.map((e,n)=>Zn(this,void 0,void 0,function*(){return this._sendFile(o[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{s(e,n+1)}})})))),c.info})}streamText(t){return Zn(this,void 0,void 0,function*(){var n,i;const r=null!==(n=null==t?void 0:t.streamId)&&void 0!==n?n:crypto.randomUUID(),o={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(i=null==t?void 0:t.topic)&&void 0!==i?i:"",size:null==t?void 0:t.totalSize,attributes:null==t?void 0:t.attributes},a=new Bt({streamId:r,mimeType:o.mimeType,topic:o.topic,timestamp:Vo(o.timestamp),totalLength:Vo(null==t?void 0:t.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new jt({version:null==t?void 0:t.version,attachedStreamIds:null==t?void 0:t.attachedStreamIds,replyToStreamId:null==t?void 0:t.replyToStreamId,operationType:"update"===(null==t?void 0:t.type)?Ut.UPDATE:Ut.CREATE})}}),s=null==t?void 0:t.destinationIdentities,c=new ft({destinationIdentities:s,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(c,gt.RELIABLE);let l=0;const d=this,u=new WritableStream({write(e){return Zn(this,void 0,void 0,function*(){for(const t of function(e,t){const n=[];let i=(new TextEncoder).encode(e);for(;i.length>t;){let e=t;for(;e>0;){const t=i[e];if(void 0!==t&&128!=(192&t))break;e--}n.push(i.slice(0,e)),i=i.slice(e)}return i.length>0&&n.push(i),n}(e,15e3)){yield d.engine.waitForBufferStatusLow(gt.RELIABLE);const e=new Vt({content:t,streamId:r,chunkIndex:Vo(l)}),n=new ft({destinationIdentities:s,value:{case:"streamChunk",value:e}});yield d.engine.sendDataPacket(n,gt.RELIABLE),l+=1}})},close(){return Zn(this,void 0,void 0,function*(){const e=new qt({streamId:r}),t=new ft({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield d.engine.sendDataPacket(t,gt.RELIABLE)})},abort(e){console.log("Sink error:",e)}});let h=()=>Zn(this,void 0,void 0,function*(){yield p.close()});d.engine.once(e.EngineEvent.Closing,h);const p=new Ns(u,o,()=>this.engine.off(e.EngineEvent.Closing,h));return p})}sendFile(e,t){return Zn(this,void 0,void 0,function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}})}_sendFile(e,t,n){return Zn(this,void 0,void 0,function*(){var i;const r=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(i=null==n?void 0:n.mimeType)&&void 0!==i?i:t.type,topic:null==n?void 0:n.topic,destinationIdentities:null==n?void 0:n.destinationIdentities}),o=t.stream().getReader();for(;;){const{done:e,value:t}=yield o.read();if(e)break;yield r.write(t)}return yield r.close(),r.info})}streamBytes(e){return Zn(this,void 0,void 0,function*(){var t,n,i,r,a;const s=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),c=null==e?void 0:e.destinationIdentities,l={id:s,mimeType:null!==(n=null==e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(i=null==e?void 0:e.topic)&&void 0!==i?i:"",timestamp:Date.now(),attributes:null==e?void 0:e.attributes,size:null==e?void 0:e.totalSize,name:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"unknown"},d=new Bt({totalLength:Vo(null!==(a=l.size)&&void 0!==a?a:0),mimeType:l.mimeType,streamId:s,topic:l.topic,timestamp:Vo(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new Ft({name:l.name})}}),u=new ft({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(u,gt.RELIABLE);let h=0;const p=new o,m=this.engine,f=this.log,g=new WritableStream({write(e){return Zn(this,void 0,void 0,function*(){const t=yield p.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+15e3);yield m.waitForBufferStatusLow(gt.RELIABLE);const i=new ft({destinationIdentities:c,value:{case:"streamChunk",value:new Vt({content:t,streamId:s,chunkIndex:Vo(h)})}});yield m.sendDataPacket(i,gt.RELIABLE),h+=1,n+=t.byteLength}}finally{t()}})},close(){return Zn(this,void 0,void 0,function*(){const e=new qt({streamId:s}),t=new ft({destinationIdentities:c,value:{case:"streamTrailer",value:e}});yield m.sendDataPacket(t,gt.RELIABLE)})},abort(e){f.error("Sink error:",e)}});return new As(g,l)})}performRpc(e){return Zn(this,arguments,void 0,function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:o=1e4}=e;return function*(){return new Promise((e,a)=>Zn(t,void 0,void 0,function*(){var t,s,c,l;if($a(r)>15360)return void a(Ya.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&Eo(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void a(Ya.builtIn("UNSUPPORTED_SERVER"));const d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,r,o-2e3);const u=setTimeout(()=>{this.pendingAcks.delete(d),a(Ya.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(h)},2e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(u)},participantIdentity:n});const h=setTimeout(()=>{this.pendingResponses.delete(d),a(Ya.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(u)),n?a(n):e(null!=t?t:"")},participantIdentity:n})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,i,r){return Zn(this,void 0,void 0,function*(){const o=new ft({destinationIdentities:[e],kind:gt.RELIABLE,value:{case:"rpcRequest",value:new wt({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(o,gt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,Ya.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(e=>"video"===e.mime.split("/")[0].toLowerCase())}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach(e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),sa(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}}),!0)}setActiveAgent(e){var t,n,i,r;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(r=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Lo),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(Ko(i)||Wo(i))&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))}),t}waitForPendingPublicationOfSource(e){return Zn(this,void 0,void 0,function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find(t=>{let[n]=t;return n.source===e});if(t)return t[1];yield oo(20)}})}}class Js extends qs{constructor(t,n,i,r){super(t,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=t=>{this.setTrack(void 0),this.emit(e.TrackEvent.Ended,t)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.visible=e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensionsAdaptiveStream=e,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const r=new on({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new It({participantSid:"",trackSids:[this.trackSid]})]});this.emit(e.TrackEvent.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return!1===this.subscribed?qs.SubscriptionStatus.Unsubscribed:super.isSubscribed?qs.SubscriptionStatus.Subscribed:qs.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?qs.PermissionStatus.Allowed:qs.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return void 0!==this.requestedDisabled?!this.requestedDisabled:!this.isAdaptiveStream||this.visible}get isLocal(){return!1}setEnabled(e){this.isManualOperationAllowed()&&this.requestedDisabled!==!e&&(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.requestedMaxQuality!==e&&(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.requestedVideoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.requestedVideoDimensions)||void 0===n?void 0:n.height)===e.height||(Jo(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Jo(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var t;return null!==(t=this.requestedMaxQuality)&&void 0!==t?t:e.VideoQuality.HIGH}setTrack(t){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==t&&(r&&(r.off(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),r.off(e.TrackEvent.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(e.TrackEvent.Unsubscribed,r)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(e.TrackEvent.Ended,this.handleEnded),this.emit(e.TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(t){this.emit(e.TrackEvent.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?e.TrackEvent.Muted:e.TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(e.TrackEvent.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(e.TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Jo(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new an({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===Gr.Kind.Video){let o=this.requestedVideoDimensions;if(void 0!==this.videoDimensionsAdaptiveStream)if(o)la(this.videoDimensionsAdaptiveStream,o)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),o=this.videoDimensionsAdaptiveStream);else if(void 0!==this.requestedMaxQuality&&this.trackInfo){const e=(n=this.trackInfo,i=this.requestedMaxQuality,null===(r=n.layers)||void 0===r?void 0:r.find(e=>e.quality===i));e&&la(this.videoDimensionsAdaptiveStream,e)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),o=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),o=this.videoDimensionsAdaptiveStream;o?(t.width=Math.ceil(o.width),t.height=Math.ceil(o.height)):void 0!==this.requestedMaxQuality?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:e.VideoQuality.HIGH})),t.quality=e.VideoQuality.HIGH)}var n,i,r;this.emit(e.TrackEvent.UpdateSettings,t)}}class Ys extends Gs{static fromParticipantInfo(e,t,n){return new Ys(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,o,a){super(t,n||"",i,r,o,a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:lt.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(e.TrackEvent.UpdateSettings,e=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),sa(t)),{settings:e})),this.signalClient.sendUpdateTrackSettings(e)}),t.on(e.TrackEvent.UpdateSubscription,e=>{e.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(e)}),t.on(e.TrackEvent.SubscriptionPermissionChanged,n=>{this.emit(e.ParticipantEvent.TrackSubscriptionPermissionChanged,t,n)}),t.on(e.TrackEvent.SubscriptionStatusChanged,n=>{this.emit(e.ParticipantEvent.TrackSubscriptionStatusChanged,t,n)}),t.on(e.TrackEvent.Subscribed,n=>{this.emit(e.ParticipantEvent.TrackSubscribed,n,t)}),t.on(e.TrackEvent.Unsubscribed,n=>{this.emit(e.ParticipantEvent.TrackUnsubscribed,n,t)}),t.on(e.TrackEvent.SubscriptionFailed,n=>{this.emit(e.ParticipantEvent.TrackSubscriptionFailed,t.trackSid,n)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gr.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gr.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(t,n,i,r,o,a){let s,c=this.getTrackPublicationBySid(n);return c||n.startsWith("TR")||this.trackPublications.forEach(e=>{c||t.kind!==e.kind.toString()||(c=e)}),c?"ended"===t.readyState?(this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),sa(c))),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(s="video"===t.kind?new js(t,n,r,o):new Us(t,n,r,this.audioContext,this.audioOutput),s.source=c.source,s.isMuted=c.isMuted,s.setMediaStream(i),s.start(),c.setTrack(s),this.volumeMap.has(c.source)&&Go(s)&&zo(s)&&s.setVolume(this.volumeMap.get(c.source)),c):0===a?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(void 0===a&&(a=20),void setTimeout(()=>{this.addSubscribedMediaTrack(t,n,i,r,o,a-1)},150))}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(t){if(!super.updateInfo(t))return!1;const n=new Map,i=new Map;return t.tracks.forEach(e=>{var t,r;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const n=Gr.kindFromProto(e.type);if(!n)return;o=new Js(n,e,null===(t=this.signalClient.connectOptions)||void 0===t?void 0:t.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),o.updateInfo(e),i.set(e.sid,o);const a=Array.from(this.trackPublications.values()).find(e=>e.source===(null==o?void 0:o.source));a&&o.source!==Gr.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:sa(a),newTrack:sa(o)})),this.addTrackPublication(o)}n.set(e.sid,o)}),this.trackPublications.forEach(e=>{n.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),sa(e))),this.unpublishTrack(e.trackSid,!0))}),i.forEach(t=>{this.emit(e.ParticipantEvent.TrackPublished,t)}),!0}unpublishTrack(t,n){const i=this.trackPublications.get(t);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(t),i.kind){case Gr.Kind.Audio:this.audioTrackPublications.delete(t);break;case Gr.Kind.Video:this.videoTrackPublications.delete(t)}n&&this.emit(e.ParticipantEvent.TrackUnpublished,i)}setAudioOutput(e){return Zn(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(n=>{var i;zo(n.track)&&Go(n.track)&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}e.ConnectionState=void 0,(Ps=e.ConnectionState||(e.ConnectionState={})).Disconnected="disconnected",Ps.Connecting="connecting",Ps.Connected="connected",Ps.Reconnecting="reconnecting",Ps.SignalReconnecting="signalReconnecting";class $s extends ri.EventEmitter{constructor(t){var n,i,r,a;if(super(),n=this,this.state=e.ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Kn,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(t,n,i)=>Zn(this,void 0,void 0,function*(){var r;if(!po())throw ko()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const o=yield this.disconnectLock.lock();if(this.state===e.ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),o(),Promise.resolve();if(this.connectFuture)return o(),this.connectFuture.promise;this.setAndEmitConnectionState(e.ConnectionState.Connecting),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.getServerUrl().toString())!==t&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),To(new URL(t))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new Os(t,n):this.regionUrlProvider.updateToken(n),this.regionUrlProvider.fetchRegionSettings().then(e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))}));const a=(r,s,c)=>Zn(this,void 0,void 0,function*(){var l,d;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null==o||o();try{yield this.attemptConnection(null!=c?c:t,n,i,u),this.abortController=void 0,r()}catch(t){if(this.regionUrlProvider&&t instanceof xr&&t.reason!==e.ConnectionErrorReason.Cancelled&&t.reason!==e.ConnectionErrorReason.NotAllowed){let i=null;try{i=yield this.regionUrlProvider.getNextBestRegionUrl(null===(l=this.abortController)||void 0===l?void 0:l.signal)}catch(t){if(t instanceof xr&&(401===t.status||t.reason===e.ConnectionErrorReason.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void s(t)}i&&!(null===(d=this.abortController)||void 0===d?void 0:d.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(t.message,". Retrying with another region: ").concat(i),this.logContext),this.recreateEngine(),yield a(r,s,i)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Fo(t)),s(t))}else{let e=et.UNKNOWN_REASON;t instanceof xr&&(e=Fo(t)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e),s(t)}}}),s=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Lo((e,t)=>{a(e,t,s)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(e,t,n,i,r,o)=>Zn(this,void 0,void 0,function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"==typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=d,this.log.debug("connected to Livekit Server ".concat(Object.entries(d).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!d.version)throw new Mr("unknown server version");return"0.15.1"===d.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l}),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){this.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:e}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(t,n,i,r)=>Zn(this,void 0,void 0,function*(){var o,a;this.state===e.ConnectionState.Reconnecting||this.isResuming||(null===(o=this.engine)||void 0===o?void 0:o.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(a=this.regionUrlProvider)||void 0===a?void 0:a.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Ga),i),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const i=yield this.connectSignal(t,n,this.engine,this.connOptions,this.options,r);this.applyJoinResponse(i),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected)}catch(t){yield this.engine.close(),this.recreateEngine();const i=new xr("could not establish signal connection",e.ConnectionErrorReason.ServerUnreachable);throw t instanceof Error&&(i.message="".concat(i.message,": ").concat(t.message)),t instanceof xr&&(i.reason=t.reason,i.status=t.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:t})),i}if(r.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new xr("Connection attempt aborted",e.ConnectionErrorReason.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,r)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}yo()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),yo()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Zn(n,[...i],void 0,function(){var t=this;let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var i,r,o,a;const s=yield t.disconnectLock.lock();try{if(t.state===e.ConnectionState.Disconnected)return void t.log.debug("already disconnected",t.logContext);t.log.info("disconnect from room",Object.assign({},t.logContext)),(t.state===e.ConnectionState.Connecting||t.state===e.ConnectionState.Reconnecting||t.isResuming)&&(t.log.warn("abort connection attempt",t.logContext),null===(i=t.abortController)||void 0===i||i.abort(),null===(o=null===(r=t.connectFuture)||void 0===r?void 0:r.reject)||void 0===o||o.call(r,new xr("Client initiated disconnect",e.ConnectionErrorReason.Cancelled)),t.connectFuture=void 0),(null===(a=t.engine)||void 0===a?void 0:a.client.isDisconnected)||(yield t.engine.client.sendLeave()),t.engine&&(yield t.engine.close()),t.handleDisconnect(n,et.CLIENT_INITIATED),t.engine=void 0}finally{s()}}()})},this.onPageLeave=()=>Zn(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>Zn(this,void 0,void 0,function*(){const t=[],n=Br();if(n&&"iOS"===n.os){const n="livekit-dummy-audio-el";let i=document.getElementById(n);if(!i){i=document.createElement("audio"),i.id=n,i.autoplay=!0,i.hidden=!0;const t=Ao();t.enabled=!0;const r=new MediaStream([t]);i.srcObject=r,document.addEventListener("visibilitychange",()=>{i&&(i.srcObject=document.hidden?null:r,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(i),this.once(e.RoomEvent.Disconnected,()=>{null==i||i.remove(),i=null})}t.push(i)}this.remoteParticipants.forEach(e=>{e.audioTrackPublications.forEach(e=>{e.track&&e.track.attachedElements.forEach(e=>{t.push(e)})})});try{yield Promise.all([this.acquireAudioContext(),...t.map(e=>(e.muted=!1,e.play()))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}}),this.startVideo=()=>Zn(this,void 0,void 0,function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach(t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach(t=>{e.includes(t)||e.push(t)})});yield Promise.all(e.map(e=>e.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&this.emit(e.RoomEvent.Reconnecting)},this.handleSignalRestarted=t=>Zn(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(t.serverRegion),Object.assign(Object.assign({},this.logContext),{region:t.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(t);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:t.serverRegion}))}catch(e){return}this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=e=>{e.forEach(e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===ct.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)})},this.handleActiveSpeakersUpdate=t=>{const n=[],i={};t.forEach(e=>{if(i[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),n.push(this.localParticipant);else{const t=this.getRemoteParticipantBySid(e.sid);t&&(t.audioLevel=e.level,t.setIsSpeaking(!0),n.push(t))}}),i[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(e=>{i[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),this.activeSpeakers=n,this.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,n)},this.handleSpeakersChanged=t=>{const n=new Map;this.activeSpeakers.forEach(e=>{const t=this.remoteParticipants.get(e.identity);t&&t.sid!==e.sid||n.set(e.sid,e)}),t.forEach(e=>{let t=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(t=this.localParticipant),t&&(t.audioLevel=e.level,t.setIsSpeaking(e.active),e.active?n.set(e.sid,t):n.delete(e.sid))});const i=Array.from(n.values());i.sort((e,t)=>t.audioLevel-e.audioLevel),this.activeSpeakers=i,this.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,i)},this.handleStreamStateUpdate=t=>{t.streamStates.forEach(t=>{const n=this.getRemoteParticipantBySid(t.participantSid);if(!n)return;const i=n.getTrackPublicationBySid(t.trackSid);if(!i||!i.track)return;const r=Gr.streamStateFromProto(t.state);r!==i.track.streamState&&(i.track.streamState=r,n.emit(e.ParticipantEvent.TrackStreamStateChanged,i,i.track.streamState),this.emitWhenConnected(e.RoomEvent.TrackStreamStateChanged,i,i.track.streamState,n))})},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find(t=>t.trackPublications.has(e.trackSid));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case)this.handleStreamHeader(e.value.value,e.participantIdentity);else if("streamChunk"===e.value.case)this.handleStreamChunk(e.value.value);else if("streamTrailer"===e.value.case)this.handleStreamTrailer(e.value.value);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(t,n,i)=>{this.emit(e.RoomEvent.DataReceived,n.payload,t,i,n.topic),null==t||t.emit(e.ParticipantEvent.DataReceived,n.payload,i)},this.handleSipDtmf=(t,n)=>{this.emit(e.RoomEvent.SipDTMFReceived,n,t),null==t||t.emit(e.ParticipantEvent.SipDTMFReceived,n)},this.bufferedSegments=new Map,this.handleTranscription=(t,n)=>{const i=n.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(n.transcribedParticipantIdentity),r=null==i?void 0:i.trackPublications.get(n.trackId),o=function(e,t){return e.segments.map(e=>{let{id:n,text:i,language:r,startTime:o,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),d=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:d}})}(n,this.transcriptionReceivedTimes);null==r||r.emit(e.TrackEvent.TranscriptionReceived,o),null==i||i.emit(e.ParticipantEvent.TranscriptionReceived,o,r),this.emit(e.RoomEvent.TranscriptionReceived,o,i,r)},this.handleChatMessage=(t,n)=>{const i=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(n);this.emit(e.RoomEvent.ChatMessage,i,t)},this.handleMetrics=(t,n)=>{this.emit(e.RoomEvent.MetricsReceived,t,n)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=t=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:t})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(e.RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(e.RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Zn(this,void 0,void 0,function*(){var t;"iOS"!==(null===(t=Br())||void 0===t?void 0:t.os)&&(yield this.selectDefaultDevices()),this.emit(e.RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=t=>{const n=this.roomInfo;this.roomInfo=t,n&&n.metadata!==t.metadata&&this.emitWhenConnected(e.RoomEvent.RoomMetadataChanged,t.metadata),(null==n?void 0:n.activeRecording)!==t.activeRecording&&this.emitWhenConnected(e.RoomEvent.RecordingStatusChanged,t.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach(e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)})},this.onLocalParticipantMetadataChanged=t=>{this.emit(e.RoomEvent.ParticipantMetadataChanged,t,this.localParticipant)},this.onLocalParticipantNameChanged=t=>{this.emit(e.RoomEvent.ParticipantNameChanged,t,this.localParticipant)},this.onLocalAttributesChanged=t=>{this.emit(e.RoomEvent.ParticipantAttributesChanged,t,this.localParticipant)},this.onLocalTrackMuted=t=>{this.emit(e.RoomEvent.TrackMuted,t,this.localParticipant)},this.onLocalTrackUnmuted=t=>{this.emit(e.RoomEvent.TrackUnmuted,t,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=t=>Zn(this,void 0,void 0,function*(){var n,i,r,o,a,s;null===(n=t.track)||void 0===n||n.on(e.TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(i=t.track)||void 0===i||i.on(e.TrackEvent.Restarted,this.onLocalTrackRestarted),null===(a=null===(o=null===(r=t.track)||void 0===r?void 0:r.getProcessor())||void 0===o?void 0:o.onPublish)||void 0===a||a.call(o,this),this.emit(e.RoomEvent.LocalTrackPublished,t,this.localParticipant),Ko(t.track)&&(yield t.track.checkForSilence())&&this.emit(e.RoomEvent.LocalAudioSilenceDetected,t);const c=yield null===(s=t.track)||void 0===s?void 0:s.getDeviceId(!1),l=ia(t.source);l&&c&&c!==this.localParticipant.activeDeviceMap.get(l)&&(this.localParticipant.activeDeviceMap.set(l,c),this.emit(e.RoomEvent.ActiveDeviceChanged,l,c))}),this.onLocalTrackUnpublished=t=>{var n,i;null===(n=t.track)||void 0===n||n.off(e.TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(i=t.track)||void 0===i||i.off(e.TrackEvent.Restarted,this.onLocalTrackRestarted),this.emit(e.RoomEvent.LocalTrackUnpublished,t,this.localParticipant)},this.onLocalTrackRestarted=t=>Zn(this,void 0,void 0,function*(){const n=yield t.getDeviceId(!1),i=ia(t.source);i&&n&&n!==this.localParticipant.activeDeviceMap.get(i)&&(this.log.debug("local track restarted, setting ".concat(i," ").concat(n," active"),this.logContext),this.localParticipant.activeDeviceMap.set(i,n),this.emit(e.RoomEvent.ActiveDeviceChanged,i,n))}),this.onLocalConnectionQualityChanged=t=>{this.emit(e.RoomEvent.ConnectionQualityChanged,t,this.localParticipant)},this.onMediaDevicesError=(t,n)=>{this.emit(e.RoomEvent.MediaDevicesError,t,n)},this.onLocalParticipantPermissionsChanged=t=>{this.emit(e.RoomEvent.ParticipantPermissionsChanged,t,this.localParticipant)},this.onLocalChatMessageSent=t=>{this.emit(e.RoomEvent.ChatMessage,t,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},Ka),t),this.log=Qn(null!==(i=this.options.loggerName)&&void 0!==i?i:e.LoggerNames.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Ha),null==t?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Wa),null==t?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},za),null==t?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new o,this.localParticipant=new Qs("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Uo(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Uo(this.options.audioCaptureDefaults.deviceId)),(null===(r=this.options.audioOutput)||void 0===r?void 0:r.deviceId)&&this.switchActiveDevice("audiooutput",Uo(this.options.audioOutput.deviceId)).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),yo()){const e=new AbortController;null===(a=navigator.mediaDevices)||void 0===a||a.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),$s.cleanupRegistry&&$s.cleanupRegistry.register(this,()=>{e.abort()})}}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,t,n,i,r,o){return Zn(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),1!==o)return void(yield this.engine.publishRpcResponse(e,t,null,Ya.builtIn("UNSUPPORTED_VERSION")));const a=this.rpcHandlers.get(n);if(!a)return void(yield this.engine.publishRpcResponse(e,t,null,Ya.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const o=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});$a(o)>15360?(s=Ya.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=o}catch(e){e instanceof Ya?s=e:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),e),s=Ya.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,s)})}setE2EEEnabled(e){return Zn(this,void 0,void 0,function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)})}setupE2EE(){var t;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new da(this.options.e2ee),this.e2eeManager.on(e.EncryptionEvent.ParticipantEncryptionStatusChanged,(t,n)=>{Yo(n)&&(this.isE2EEEnabled=t),this.emit(e.RoomEvent.ParticipantEncryptionStatusChanged,t,n)}),this.e2eeManager.on(e.EncryptionEvent.EncryptionError,t=>this.emit(e.RoomEvent.EncryptionError,t)),null===(t=this.e2eeManager)||void 0===t||t.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return Zn(this,void 0,void 0,function*(){return this.state===e.ConnectionState.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise((t,n)=>{const i=n=>{""!==n.sid&&(this.engine.off(e.EngineEvent.RoomUpdate,i),t(n.sid))};this.engine.on(e.EngineEvent.RoomUpdate,i),this.once(e.RoomEvent.Disconnected,()=>{this.engine.off(e.EngineEvent.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Rs(this.options),this.engine.on(e.EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(e.EngineEvent.RoomUpdate,this.handleRoomUpdate).on(e.EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(e.EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(e.EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(e.EngineEvent.SubscriptionError,this.handleSubscriptionError).on(e.EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(e.EngineEvent.MediaTrackAdded,(e,t,n)=>{this.onTrackAdded(e,t,n)}).on(e.EngineEvent.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(e.EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket).on(e.EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(e.ConnectionState.SignalReconnecting)&&this.emit(e.RoomEvent.SignalReconnecting)}).on(e.EngineEvent.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(e.ConnectionState.Connected)&&this.emit(e.RoomEvent.Reconnected)}).on(e.EngineEvent.SignalResumed,()=>{this.bufferedEvents=[],(this.state===e.ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(e.EngineEvent.Restarting,this.handleRestarting).on(e.EngineEvent.SignalRestarted,this.handleSignalRestarted).on(e.EngineEvent.Offline,()=>{this.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&this.emit(e.RoomEvent.Reconnecting)}).on(e.EngineEvent.DCBufferStatusChanged,(t,n)=>{this.emit(e.RoomEvent.DCBufferStatusChanged,t,n)}).on(e.EngineEvent.LocalTrackSubscribed,t=>{const n=this.localParticipant.getTrackPublications().find(e=>{let{trackSid:n}=e;return n===t});n?(this.localParticipant.emit(e.ParticipantEvent.LocalTrackSubscribed,n),this.emitWhenConnected(e.RoomEvent.LocalTrackSubscribed,n,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)}).on(e.EngineEvent.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((e,t)=>{this.handleParticipantDisconnected(t,e)}),this.emit(e.RoomEvent.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ha.getInstance().getDevices(e,t)}prepareConnection(t,n){return Zn(this,void 0,void 0,function*(){if(this.state===e.ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(To(new URL(t))&&n){this.regionUrlProvider=new Os(t,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===e.ConnectionState.Disconnected&&(this.regionUrl=i,yield fetch(jo(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(jo(t),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Zn(this,void 0,void 0,function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new xn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new xn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new xn({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new xn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>Zn(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new xn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>Zn(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new xn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new xn({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>Zn(this,void 0,void 0,function*(){const e=this.engine.client.onLeave;e&&e(new ln({reason:et.CLIENT_INITIATED,action:dn.RECONNECT}))});break;case"subscriber-bandwidth":if(void 0===t||"number"!=typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new xn({scenario:{case:"subscriberBandwidth",value:Vo(t)}});break;case"leave-full-reconnect":n=new xn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(t,n){return Zn(this,arguments,void 0,function(t,n){var i=this;let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var o,a,s,c,l,d,u;let h=!0,p=!1;const m=r?{exact:n}:n;if("audioinput"===t){p=0===i.localParticipant.audioTrackPublications.size;const e=null!==(o=i.getActiveDevice(t))&&void 0!==o?o:i.options.audioCaptureDefaults.deviceId;i.options.audioCaptureDefaults.deviceId=m;const n=Array.from(i.localParticipant.audioTrackPublications.values()).filter(e=>e.source===Gr.Source.Microphone);try{h=(yield Promise.all(n.map(e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(m)}))).every(e=>!0===e)}catch(t){throw i.options.audioCaptureDefaults.deviceId=e,t}const r=n.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});h&&r&&(p=!0)}else if("videoinput"===t){p=0===i.localParticipant.videoTrackPublications.size;const e=null!==(a=i.getActiveDevice(t))&&void 0!==a?a:i.options.videoCaptureDefaults.deviceId;i.options.videoCaptureDefaults.deviceId=m;const n=Array.from(i.localParticipant.videoTrackPublications.values()).filter(e=>e.source===Gr.Source.Camera);try{h=(yield Promise.all(n.map(e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(m)}))).every(e=>!0===e)}catch(t){throw i.options.videoCaptureDefaults.deviceId=e,t}const r=n.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});h&&r&&(p=!0)}else if("audiooutput"===t){if(p=!0,!ho()&&!i.options.webAudioMix||i.options.webAudioMix&&i.audioContext&&!("setSinkId"in i.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");i.options.webAudioMix&&(n=null!==(s=yield ha.getInstance().normalizeDeviceId("audiooutput",n))&&void 0!==s?s:""),null!==(c=(u=i.options).audioOutput)&&void 0!==c||(u.audioOutput={});const e=null!==(l=i.getActiveDevice(t))&&void 0!==l?l:i.options.audioOutput.deviceId;i.options.audioOutput.deviceId=n;try{i.options.webAudioMix&&(null===(d=i.audioContext)||void 0===d||d.setSinkId(n)),yield Promise.all(Array.from(i.remoteParticipants.values()).map(e=>e.setAudioOutput({deviceId:n})))}catch(t){throw i.options.audioOutput.deviceId=e,t}}return p&&(i.localParticipant.activeDeviceMap.set(t,n),i.emit(e.RoomEvent.ActiveDeviceChanged,t,n)),h}()})}setupLocalParticipantEvents(){this.localParticipant.on(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(e.ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).on(e.ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).on(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,n,i){if(this.state===e.ConnectionState.Connecting||this.state===e.ConnectionState.Reconnecting){const r=()=>{this.onTrackAdded(t,n,i),o()},o=()=>{this.off(e.RoomEvent.Reconnected,r),this.off(e.RoomEvent.Connected,r),this.off(e.RoomEvent.Disconnected,o)};return this.once(e.RoomEvent.Reconnected,r),this.once(e.RoomEvent.Connected,r),void this.once(e.RoomEvent.Disconnected,o)}if(this.state===e.ConnectionState.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===t.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const r=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(n.id),o=r[0];let a=r[1],s=t.id;if(a&&a.startsWith("TR")&&(s=a),o===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const c=Array.from(this.remoteParticipants.values()).find(e=>e.sid===o);if(!c)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);let l;this.options.adaptiveStream&&(l="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),c.addSubscribedMediaTrack(t,s,n,i,l)}handleDisconnect(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==e.ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(e=>{var n,i,r;e.track&&this.localParticipant.unpublishTrack(e.track,t),t?(null===(n=e.track)||void 0===n||n.detach(),null===(i=e.track)||void 0===i||i.stop()):null===(r=e.track)||void 0===r||r.stopMonitor()}),this.localParticipant.off(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(e.ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).off(e.ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).off(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),yo()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(i=navigator.mediaDevices)||void 0===i||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(e.ConnectionState.Disconnected),this.emit(e.RoomEvent.Disconnected,n)}}}handleParticipantDisconnected(t,n){var i;this.remoteParticipants.delete(t),n&&(n.trackPublications.forEach(e=>{n.unpublishTrack(e.trackSid,!0)}),this.emit(e.RoomEvent.ParticipantDisconnected,n),n.setDisconnected(),null===(i=this.localParticipant)||void 0===i||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,t){return Zn(this,void 0,void 0,function*(){var n;if("byteHeader"===e.contentHeader.case){const i=this.byteStreamHandlers.get(e.topic);if(!i)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let r;const o={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Bo(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:t=>{r=t,this.byteStreamControllers.set(e.streamId,{info:o,controller:r,startTime:Date.now()})}});i(new _s(o,a,Bo(e.totalLength)),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let i;const r={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:t=>{i=t,this.textStreamControllers.set(e.streamId,{info:r,controller:i,startTime:Date.now()})}});n(new Ds(r,o,Bo(e.totalLength)),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return Zn(this,void 0,void 0,function*(){var t,n,i;const r=ha.getInstance().previousDevices,o=yield ha.getInstance().getDevices(void 0,!1),a=Br();if("Chrome"===(null==a?void 0:a.name)&&"iOS"!==a.os)for(let c of o){const t=r.find(e=>e.deviceId===c.deviceId);t&&""!==t.label&&t.kind===c.kind&&t.label!==c.label&&"default"===this.getActiveDevice(c.kind)&&this.emit(e.RoomEvent.ActiveDeviceChanged,c.kind,c.deviceId)}const s=["audiooutput","audioinput","videoinput"];for(let e of s){const a=na(e),s=this.localParticipant.getTrackPublication(a);if(s&&(null===(t=s.track)||void 0===t?void 0:t.isUserProvided))continue;const c=o.filter(t=>t.kind===e),l=this.getActiveDevice(e);l===(null===(n=r.filter(t=>t.kind===e)[0])||void 0===n?void 0:n.deviceId)&&c.length>0&&(null===(i=c[0])||void 0===i?void 0:i.deviceId)!==l?yield this.switchActiveDevice(e,c[0].deviceId):"audioinput"===e&&!go()||"videoinput"===e||!(c.length>0)||c.find(t=>t.deviceId===this.getActiveDevice(e))||"audiooutput"===e&&go()||(yield this.switchActiveDevice(e,c[0].deviceId))}})}acquireAudioContext(){return Zn(this,void 0,void 0,function*(){var t,n;if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(t=ta())&&void 0!==t?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(e=>e.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),oo(200)])}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}const i="running"===(null===(n=this.audioContext)||void 0===n?void 0:n.state);i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,i))})}createParticipant(e,t){var n;let i;return i=t?Ys.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new Ys(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),i}getOrCreateParticipant(t,n){if(this.remoteParticipants.has(t)){const e=this.remoteParticipants.get(t);return n&&e.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),e}const i=this.createParticipant(t,n);return this.remoteParticipants.set(t,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(e.RoomEvent.ParticipantConnected,i),i.on(e.ParticipantEvent.TrackPublished,t=>{this.emitWhenConnected(e.RoomEvent.TrackPublished,t,i)}).on(e.ParticipantEvent.TrackSubscribed,(t,n)=>{t.kind===Gr.Kind.Audio?(t.on(e.TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),t.on(e.TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):t.kind===Gr.Kind.Video&&(t.on(e.TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),t.on(e.TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(e.RoomEvent.TrackSubscribed,t,n,i)}).on(e.ParticipantEvent.TrackUnpublished,t=>{this.emit(e.RoomEvent.TrackUnpublished,t,i)}).on(e.ParticipantEvent.TrackUnsubscribed,(t,n)=>{this.emit(e.RoomEvent.TrackUnsubscribed,t,n,i)}).on(e.ParticipantEvent.TrackMuted,t=>{this.emitWhenConnected(e.RoomEvent.TrackMuted,t,i)}).on(e.ParticipantEvent.TrackUnmuted,t=>{this.emitWhenConnected(e.RoomEvent.TrackUnmuted,t,i)}).on(e.ParticipantEvent.ParticipantMetadataChanged,t=>{this.emitWhenConnected(e.RoomEvent.ParticipantMetadataChanged,t,i)}).on(e.ParticipantEvent.ParticipantNameChanged,t=>{this.emitWhenConnected(e.RoomEvent.ParticipantNameChanged,t,i)}).on(e.ParticipantEvent.AttributesChanged,t=>{this.emitWhenConnected(e.RoomEvent.ParticipantAttributesChanged,t,i)}).on(e.ParticipantEvent.ConnectionQualityChanged,t=>{this.emitWhenConnected(e.RoomEvent.ConnectionQualityChanged,t,i)}).on(e.ParticipantEvent.ParticipantPermissionsChanged,t=>{this.emitWhenConnected(e.RoomEvent.ParticipantPermissionsChanged,t,i)}).on(e.ParticipantEvent.TrackSubscriptionStatusChanged,(t,n)=>{this.emitWhenConnected(e.RoomEvent.TrackSubscriptionStatusChanged,t,n,i)}).on(e.ParticipantEvent.TrackSubscriptionFailed,(t,n)=>{this.emit(e.RoomEvent.TrackSubscriptionFailed,t,i,n)}).on(e.ParticipantEvent.TrackSubscriptionPermissionChanged,(t,n)=>{this.emitWhenConnected(e.RoomEvent.TrackSubscriptionPermissionChanged,t,n,i)}).on(e.ParticipantEvent.Active,()=>{this.emitWhenConnected(e.RoomEvent.ParticipantActive,i),i.kind===lt.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((e,t)=>(e.push(...t.getTrackPublications()),e),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&Qo(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Wr.setInterval(()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,et.STATE_MISMATCH)))},4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Wr.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t!==this.state&&(this.state=t,this.emit(e.RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,n]=e;this.emit(t,...n)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===e.ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,i]);else if(this.state===e.ConnectionState.Connected)return this.emit(t,...i);return!1}simulateParticipants(t){return Zn(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new rt({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:D.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new st({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),this.emit(e.RoomEvent.Connected),this.setAndEmitConnectionState(e.ConnectionState.Connected),r.video){const t=new zs(Gr.Kind.Video,new pt({source:Ye.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Je.AUDIO,name:"video-dummy"}),new bs(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:No(160*(null!==(n=o.aspectRatios[0])&&void 0!==n?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(t),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,t)}if(r.audio){const t=new zs(Gr.Kind.Audio,new pt({source:Ye.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Je.AUDIO}),new os(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Ao(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(t),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,t)}for(let e=0;e<o.count-1;e+=1){let t=new st({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:ct.ACTIVE,tracks:[],joinedAt:D.parse(Date.now())});const n=this.getOrCreateParticipant(t.identity,t);if(o.video){const r=No(160*(null!==(i=o.aspectRatios[e%o.aspectRatios.length])&&void 0!==i?i:1),160,!1,!0),a=new pt({source:Ye.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Je.AUDIO});n.addSubscribedMediaTrack(r,a.sid,new MediaStream([r]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(o.audio){const e=Ao(),i=new pt({source:Ye.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Je.AUDIO});n.addSubscribedMediaTrack(e,i.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,i]}n.updateInfo(t)}})}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(t!==e.RoomEvent.ActiveSpeakersChanged&&t!==e.RoomEvent.TranscriptionReceived){const e=Xs(i).filter(e=>void 0!==e);this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:e}))}return super.emit(t,...i)}}function Xs(e){return e.map(e=>{if(e)return Array.isArray(e)?Xs(e):"object"==typeof e?"logContext"in e?e.logContext:void 0:e})}$s.cleanupRegistry="undefined"!=typeof FinalizationRegistry&&new FinalizationRegistry(e=>{e()});var Zs,ec=Object.freeze({__proto__:null,Convert:class{static toAgentAttributes(e){return JSON.parse(e)}static agentAttributesToJson(e){return JSON.stringify(e)}static toTranscriptionAttributes(e){return JSON.parse(e)}static transcriptionAttributesToJson(e){return JSON.stringify(e)}}});e.CheckStatus=void 0,(Zs=e.CheckStatus||(e.CheckStatus={}))[Zs.IDLE=0]="IDLE",Zs[Zs.RUNNING=1]="RUNNING",Zs[Zs.SKIPPED=2]="SKIPPED",Zs[Zs.SUCCESS=3]="SUCCESS",Zs[Zs.FAILED=4]="FAILED";class tc extends ri.EventEmitter{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.status=e.CheckStatus.IDLE,this.logs=[],this.options={},this.url=t,this.token=n,this.name=this.constructor.name,this.room=new $s(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(t){return Zn(this,void 0,void 0,function*(){if(this.status!==e.CheckStatus.IDLE)throw Error("check is running already");this.setStatus(e.CheckStatus.RUNNING);try{yield this.perform()}catch(e){e instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(e.message):this.appendError(e.message))}return yield this.disconnect(),yield new Promise(e=>setTimeout(e,500)),this.status!==e.CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?e.CheckStatus.SUCCESS:e.CheckStatus.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>"error"===e.level)}connect(t){return Zn(this,void 0,void 0,function*(){return this.room.state===e.ConnectionState.Connected||(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions)),this.room})}disconnect(){return Zn(this,void 0,void 0,function*(){this.room&&this.room.state!==e.ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(e.CheckStatus.SKIPPED)}switchProtocol(t){return Zn(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(e.RoomEvent.Reconnecting,()=>{n=!0}),this.room.once(e.RoomEvent.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(e=>setTimeout(e,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield oo(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class nc extends tc{get description(){return"Cloud regions"}perform(){return Zn(this,void 0,void 0,function*(){const e=new Os(this.url,this.token);if(!e.isCloud())return void this.skip();const t=[],n=new Set;for(let r=0;r<3;r++){const i=yield e.getNextBestRegionUrl();if(!i)break;if(n.has(i))continue;n.add(i);const r=yield this.checkCloudRegion(i);this.appendMessage("".concat(r.region," RTT: ").concat(r.rtt,"ms, duration: ").concat(r.duration,"ms")),t.push(r)}t.sort((e,t)=>.5*(e.duration-t.duration)+.5*(e.rtt-t.rtt));const i=t[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return Zn(this,void 0,void 0,function*(){var t,n;yield this.connect(e),"tcp"===this.options.protocol&&(yield this.switchProtocol("tcp"));const i=null===(t=this.room.serverInfo)||void 0===t?void 0:t.region;if(!i)throw new Error("Region not found");const r=yield this.room.localParticipant.streamText({topic:"test"}),o="A".repeat(1e3),a=Date.now();for(let e=0;e<1e3;e++)yield r.write(o);yield r.close();const s=Date.now(),c=yield null===(n=this.room.engine.pcManager)||void 0===n?void 0:n.publisher.getStats(),l={region:i,rtt:1e4,duration:s-a};return null==c||c.forEach(e=>{"candidate-pair"===e.type&&e.nominated&&(l.rtt=1e3*e.currentRoundTripTime)}),yield this.disconnect(),l})}}const ic=1e4;class rc extends tc{get description(){return"Connection via UDP vs TCP"}perform(){return Zn(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const n=this.bestStats;this.appendMessage("upstream bitrate: ".concat((n.bitrateTotal/n.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((n.rttTotal/n.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((n.jitterTotal/n.count*1e3).toFixed(2)," ms")),n.packetsLost>0&&this.appendWarning("packets lost: ".concat((n.packetsLost/n.packetsSent*100).toFixed(2),"%")),n.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((n.qualityLimitationDurations.bandwidth/10*100).toFixed(2),"%")),n.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((n.qualityLimitationDurations.cpu/10*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return Zn(this,void 0,void 0,function*(){yield this.connect(),"tcp"===e?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const n=t.getContext("2d");if(!n)throw new Error("Could not get canvas context");let i=0;const r=()=>{i=(i+1)%360,n.fillStyle="hsl(".concat(i,", 100%, 50%)"),n.fillRect(0,0,t.width,t.height),requestAnimationFrame(r)};r();const o=t.captureStream(30).getVideoTracks()[0],a=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,s={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},c=setInterval(()=>Zn(this,void 0,void 0,function*(){const e=yield a.getRTCStatsReport();null==e||e.forEach(e=>{"outbound-rtp"===e.type?(s.packetsSent=e.packetsSent,s.qualityLimitationDurations=e.qualityLimitationDurations,s.bitrateTotal+=e.targetBitrate,s.count++):"remote-inbound-rtp"===e.type&&(s.packetsLost=e.packetsLost,s.rttTotal+=e.roundTripTime,s.jitterTotal+=e.jitter)})}),1e3);return yield new Promise(e=>setTimeout(e,ic)),clearInterval(c),o.stop(),t.remove(),yield this.disconnect(),s})}}class oc extends tc{get description(){return"Can publish audio"}perform(){return Zn(this,void 0,void 0,function*(){var e;const t=yield this.connect(),n=yield Ks();if(yield ea(n,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(n),yield new Promise(e=>setTimeout(e,3e3));const i=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let r=0;if(i.forEach(e=>{"outbound-rtp"!==e.type||"audio"!==e.kind&&(e.kind||"audio"!==e.mediaType)||(r=e.packetsSent)}),0===r)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," audio packets"))})}}class ac extends tc{get description(){return"Can publish video"}perform(){return Zn(this,void 0,void 0,function*(){var e;const t=yield this.connect(),n=yield Ws();yield this.checkForVideo(n.mediaStreamTrack),t.localParticipant.publishTrack(n),yield new Promise(e=>setTimeout(e,5e3));const i=yield null===(e=n.sender)||void 0===e?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let r=0;if(i.forEach(e=>{"outbound-rtp"!==e.type||"video"!==e.kind&&(e.kind||"video"!==e.mediaType)||(r+=e.packetsSent)}),0===r)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))})}checkForVideo(e){return Zn(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const n=document.createElement("video");n.srcObject=t,n.muted=!0,yield new Promise(t=>{n.onplay=()=>{setTimeout(()=>{var i,r,o,a;const s=document.createElement("canvas"),c=e.getSettings(),l=null!==(r=null!==(i=c.width)&&void 0!==i?i:n.videoWidth)&&void 0!==r?r:1280,d=null!==(a=null!==(o=c.height)&&void 0!==o?o:n.videoHeight)&&void 0!==a?a:720;s.width=l,s.height=d;const u=s.getContext("2d");u.drawImage(n,0,0);const h=u.getImageData(0,0,s.width,s.height).data;let p=!0;for(let e=0;e<h.length;e+=4)if(0!==h[e]||0!==h[e+1]||0!==h[e+2]){p=!1;break}p?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),t()},1e3)},n.play()}),t.getTracks().forEach(e=>e.stop()),n.remove()})}}class sc extends tc{get description(){return"Resuming connection after interruption"}perform(){return Zn(this,void 0,void 0,function*(){var t;const n=yield this.connect();let i,r=!1,o=!1;const a=new Promise(e=>{setTimeout(e,5e3),i=e}),s=()=>{r=!0};n.on(e.RoomEvent.SignalReconnecting,s).on(e.RoomEvent.Reconnecting,s).on(e.RoomEvent.Reconnected,()=>{o=!0,i(!0)}),null===(t=n.engine.client.ws)||void 0===t||t.close();const c=n.engine.client.onClose;if(c&&c(""),yield a,!r)throw new Error("Did not attempt to reconnect");if(!o||n.state!==e.ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")})}}class cc extends tc{get description(){return"Can connect via TURN"}perform(){return Zn(this,void 0,void 0,function*(){var e,t;const n=new ba,i=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let r=!1,o=!1,a=!1;for(let s of i.iceServers)for(let e of s.urls)e.startsWith("turn:")?(o=!0,a=!0):e.startsWith("turns:")&&(o=!0,a=!0,r=!0),e.startsWith("stun:")&&(a=!0);a?o&&!r&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield n.close(),(null===(t=null===(e=this.connectOptions)||void 0===e?void 0:e.rtcConfig)||void 0===t?void 0:t.iceServers)||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(e=>setTimeout(e,0)))})}}class lc extends tc{get description(){return"Establishing WebRTC connection"}perform(){return Zn(this,void 0,void 0,function*(){let t=!1,n=!1;this.room.on(e.RoomEvent.SignalConnected,()=>{const e=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,r)=>{if(i.candidate){const e=new RTCIceCandidate(i);let r="".concat(e.protocol," ").concat(e.address,":").concat(e.port," ").concat(e.type);e.address&&(function(e){const t=e.split(".");if(4===t.length){if("10"===t[0])return!0;if("192"===t[0]&&"168"===t[1])return!0;if("172"===t[0]){const e=parseInt(t[1],10);if(e>=16&&e<=31)return!0}}return!1}(e.address)?r+=" (private)":"tcp"===e.protocol&&"passive"===e.tcpType?(t=!0,r+=" (passive)"):"udp"===e.protocol&&(n=!0)),this.appendMessage(r)}e&&e(i,r)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=e=>{e instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(e.errorCode," ").concat(e.errorText," ").concat(e.url))})});try{yield this.connect(),Kn.info("now the room is connected")}catch(e){throw this.appendWarning("ports need to be open on firewall in order to connect."),e}t||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}class dc extends tc{get description(){return"Connecting to signal connection via WebSocket"}perform(){return Zn(this,void 0,void 0,function*(){var e,t,n;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new ba;const r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),(null===(e=r.serverInfo)||void 0===e?void 0:e.edition)===xt.Cloud&&(null===(t=r.serverInfo)||void 0===t?void 0:t.region)&&this.appendMessage("LiveKit Cloud: ".concat(null===(n=r.serverInfo)||void 0===n?void 0:n.region)),yield i.close()})}}class uc extends ri.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=n}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:e.CheckStatus.IDLE,name:"",description:""}),t}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==e.CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return Zn(this,void 0,void 0,function*(){const t=this.getNextCheckId(),n=new e(this.url,this.token,this.options),i=e=>{this.updateCheck(t,e)};n.on("update",i);const r=yield n.run();return n.off("update",i),r})}checkWebsocket(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(dc)})}checkWebRTC(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(lc)})}checkTURN(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(cc)})}checkReconnect(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(sc)})}checkPublishAudio(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(oc)})}checkPublishVideo(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(ac)})}checkConnectionProtocol(){return Zn(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(rc);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return Zn(this,void 0,void 0,function*(){return this.createAndRunCheck(nc)})}}const hc=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),pc=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function mc(e){var t;const n=e.trim().toLowerCase();if(""!==n)return hc.has(n)?hc.get(n):null===(t=Array.from(pc.entries()).find(e=>{let[t]=e;return n.includes(t)}))||void 0===t?void 0:t[1]}e.BaseKeyProvider=Ir,e.Checker=tc,e.ConnectionCheck=uc,e.ConnectionError=xr,e.CriticalTimers=Wr,e.CryptorError=class extends Or{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.CryptorErrorReason.InternalError,i=arguments.length>2?arguments[2]:void 0;super(40,t),this.reason=n,this.participantIdentity=i}},e.DataPacket_Kind=gt,e.DefaultReconnectPolicy=Xn,e.DeviceUnsupportedError=_r,e.DisconnectReason=et,e.ExternalE2EEKeyProvider=class extends Ir{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1}))}setKey(e){return Zn(this,void 0,void 0,function*(){const t="string"==typeof e?yield Er(e):yield Pr(e);this.onSetEncryptionKey(t)})}},e.LivekitError=Or,e.LocalAudioTrack=os,e.LocalParticipant=Qs,e.LocalTrack=rs,e.LocalTrackPublication=zs,e.LocalTrackRecorder=is,e.LocalVideoTrack=bs,e.Mutex=o,e.NegotiationError=Ar,e.Participant=Gs,e.ParticipantKind=lt,e.PublishDataError=class extends Or{constructor(e){super(14,null!=e?e:"unable to publish data"),this.name="PublishDataError"}},e.PublishTrackError=Lr,e.RemoteAudioTrack=Us,e.RemoteParticipant=Ys,e.RemoteTrack=Ls,e.RemoteTrackPublication=Js,e.RemoteVideoTrack=js,e.Room=$s,e.RpcError=Ya,e.ScreenSharePresets=io,e.SignalRequestError=Ur,e.SubscriptionError=nt,e.Track=Gr,e.TrackInvalidError=Dr,e.TrackPublication=qs,e.TrackType=Je,e.UnexpectedConnectionState=Nr,e.UnsupportedServer=Mr,e.VideoPreset=Yr,e.VideoPresets=to,e.VideoPresets43=no,e.attachToElement=Qr,e.attributes=ec,e.compareVersions=Eo,e.createAudioAnalyser=function(e,t){const n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),i=ta();if(!i)throw new Error("Audio Context not supported on this browser");const r=n.cloneTrack?e.mediaStreamTrack.clone():e.mediaStreamTrack,o=i.createMediaStreamSource(new MediaStream([r])),a=i.createAnalyser();a.minDecibels=n.minDecibels,a.maxDecibels=n.maxDecibels,a.fftSize=n.fftSize,a.smoothingTimeConstant=n.smoothingTimeConstant,o.connect(a);const s=new Uint8Array(a.frequencyBinCount);return{calculateVolume:()=>{a.getByteFrequencyData(s);let e=0;for(const t of s)e+=Math.pow(t/255,2);return Math.sqrt(e/s.length)},analyser:a,cleanup:()=>Zn(this,void 0,void 0,function*(){yield i.close(),n.cloneTrack&&r.stop()})}},e.createE2EEKey=function(){return window.crypto.getRandomValues(new Uint8Array(32))},e.createKeyMaterialFromBuffer=Pr,e.createKeyMaterialFromString=Er,e.createLocalAudioTrack=Ks,e.createLocalScreenTracks=function(e){return Zn(this,void 0,void 0,function*(){if(void 0===e&&(e={}),void 0!==e.resolution||vo()||(e.resolution=io.h1080fps30.resolution),void 0===navigator.mediaDevices.getDisplayMedia)throw new _r("getDisplayMedia not supported");const t=ra(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Dr("no video track found");const r=new bs(i[0],void 0,!1);r.source=Gr.Source.ScreenShare;const o=[r];if(n.getAudioTracks().length>0){const e=new os(n.getAudioTracks()[0],void 0,!1);e.source=Gr.Source.ScreenShareAudio,o.push(e)}return o})},e.createLocalTracks=Hs,e.createLocalVideoTrack=Ws,e.deriveKeys=function(e,t){return Zn(this,void 0,void 0,function*(){const n=Rr(e.algorithm.name,t),i=yield crypto.subtle.deriveKey(n,e,{name:dr,length:128},!1,["encrypt","decrypt"]);return{material:e,encryptionKey:i}})},e.detachTrack=Jr,e.facingModeFromDeviceLabel=mc,e.facingModeFromLocalTrack=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const i=qo(e)?e.mediaStreamTrack:e,r=i.getSettings();let o={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in r){const e=r.facingMode;Kn.trace("rawFacingMode",{rawFacingMode:e}),e&&"string"==typeof e&&function(e){return void 0===e||["user","environment","left","right"].includes(e)}(e)&&(o={facingMode:e,confidence:"high"})}if(["low","medium"].includes(o.confidence)){Kn.trace("Try to get facing mode from device label: (".concat(i.label,")"));const e=mc(i.label);void 0!==e&&(o=e)}return o},e.getBrowser=Br,e.getEmptyAudioStreamTrack=Ao,e.getEmptyVideoStreamTrack=function(){return Do||(Do=No()),Do.clone()},e.getLogger=Qn,e.importKey=function(e){return Zn(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:dr},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"encrypt";return function*(){return crypto.subtle.importKey("raw",e,t,!1,"derive"===n?["deriveBits","deriveKey"]:["encrypt","decrypt"])}()})},e.isAudioTrack=zo,e.isBackupCodec=Zr,e.isBrowserSupported=po,e.isE2EESupported=Sr,e.isInsertableStreamSupported=wr,e.isLocalParticipant=Yo,e.isLocalTrack=qo,e.isRemoteParticipant=function(e){return!e.isLocal},e.isRemoteTrack=Go,e.isScriptTransformSupported=Cr,e.isVideoFrame=function(e){return"type"in e},e.isVideoTrack=Ho,e.needsRbspUnescaping=function(e){for(var t=0;t<e.length-3;t++)if(0==e[t]&&0==e[t+1]&&3==e[t+2])return!0;return!1},e.parseRbsp=function(e){const t=[];for(var n=e.length,i=0;i<e.length;)n-i>=3&&!e[i]&&!e[i+1]&&3==e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);return new Uint8Array(t)},e.protocolVersion=16,e.ratchet=function(e,t){return Zn(this,void 0,void 0,function*(){const n=Rr(e.algorithm.name,t);return crypto.subtle.deriveBits(n,e,256)})},e.setLogExtension=function(t,n){(n?[n]:Gn).forEach(n=>{const i=n.methodFactory;n.methodFactory=(n,r,o)=>{const a=i(n,r,o),s=e.LogLevel[n],c=s>=r&&s<e.LogLevel.silent;return(e,n)=>{n?a(e,n):a(e),c&&t(s,e,n)}},n.setLevel(n.getLevel())})},e.setLogLevel=function(e,t){if(t)Wn.getLogger(t).setLevel(e);else for(const n of Gn)n.setLevel(e)},e.supportsAV1=co,e.supportsAdaptiveStream=function(){return void 0!==typeof ResizeObserver&&void 0!==typeof IntersectionObserver},e.supportsDynacast=function(){return ao()},e.supportsVP9=lo,e.version=Hr,e.videoCodecs=Xr,e.writeRbsp=function(e){const t=[];for(var n=0,i=0;i<e.length;++i){var r=e[i];r<=3&&n>=2&&(t.push(3),n=0),t.push(r),0==r?++n:n=0}return new Uint8Array(t)}}(t)},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},672:(e,t,n)=>{"use strict";var i=n(43);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var a={d:{f:o,r:function(){throw Error(r(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},s=Symbol.for("react.portal");var c=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=c.T,n=a.p;try{if(c.T=null,a.p=2,e)return e()}finally{c.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,i=l(n,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:o}):"script"===n&&a.d.X(e,{crossOrigin:i,integrity:r,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,i=l(n,t.crossOrigin);a.d.L(e,n,{crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=l(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return c.H.useFormState(e,t,n)},t.useFormStatus=function(){return c.H.useHostTransitionStatus()},t.version="19.1.0"},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(e,t,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==t.key&&(r=""+t.key),"key"in t)for(var o in i={},t)"key"!==o&&(i[o]=t[o]);else i=t;return t=i.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:i}}t.Fragment=i,t.jsx=r,t.jsxs=r},853:(e,t,n)=>{"use strict";e.exports=n(896)},896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var s=2*(i+1)-1,c=e[s],l=s+1,d=e[l];if(0>o(c,n))l<r&&0>o(d,c)?(e[i]=d,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<r&&0>o(d,n)))break e;e[i]=d,e[l]=n,i=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,v=!1,b="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,k="undefined"!==typeof setImmediate?setImmediate:null;function T(e){for(var t=i(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(l,t)}t=i(d)}}function S(e){if(g=!1,T(e),!f)if(null!==i(l))f=!0,w||(w=!0,C());else{var t=i(d);null!==t&&D(S,t.startTime-e)}}var C,w=!1,E=-1,P=5,R=-1;function I(){return!!v||!(t.unstable_now()-R<P)}function O(){if(v=!1,w){var e=t.unstable_now();R=e;var n=!0;try{e:{f=!1,g&&(g=!1,y(E),E=-1),m=!0;var o=p;try{t:{for(T(e),h=i(l);null!==h&&!(h.expirationTime>e&&I());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var s=a(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){h.callback=s,T(e),n=!0;break t}h===i(l)&&r(l),T(e)}else r(l);h=i(l)}if(null!==h)n=!0;else{var c=i(d);null!==c&&D(S,c.startTime-e),n=!1}}break e}finally{h=null,p=o,m=!1}n=void 0}}finally{n?C():w=!1}}}if("function"===typeof k)C=function(){k(O)};else if("undefined"!==typeof MessageChannel){var x=new MessageChannel,_=x.port2;x.port1.onmessage=O,C=function(){_.postMessage(null)}}else C=function(){b(O,0)};function D(e,n){E=b(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(d,e),null===i(l)&&e===i(d)&&(g?(y(E),E=-1):g=!0,D(S,o-a))):(e.sortIndex=s,n(l,e),f||m||(f=!0,w||(w=!0,C()))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},960:(e,t,n)=>{"use strict";e.exports=n(799)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),(()=>{"use strict";var e=n(43),t=n(391),i=n(278);function r(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function s(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function d(e,t){return t.forEach(function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var u=Object.defineProperty,h=(e,t,n)=>((e,t,n)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class p{constructor(){h(this,"_locking"),h(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise(t=>e=()=>{this._locks-=1,t()}),n=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),n}}function m(e,t){if(!e)throw new Error(t)}function f(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function g(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function v(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const b=Symbol("@bufbuild/protobuf/enum-type");function y(e){const t=e[b];return m(t,"missing enum type on enum object"),t}function k(e,t,n,i){e[b]=T(t,n.map(t=>({no:t.no,name:t.name,localName:e[t.no]})))}function T(e,t,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of t){const e=C(a);o.push(e),i[a.name]=e,r[a.no]=e}return{typeName:e,values:o,findName:e=>i[e],findNumber:e=>r[e]}}function S(e,t,n){const i={};for(const r of t){const e=C(r);i[e.localName]=e.no,i[e.no]=e.localName}return k(i,e,t),i}function C(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class w{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function E(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function P(e,t,n){for(let o=0;o<28;o+=7){const i=e>>>o,r=!(i>>>7==0&&0==t),a=255&(r?128|i:i);if(n.push(a),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),o=255&(r?128|i:i);if(n.push(o),!r)return}n.push(t>>>31&1)}}const R=4294967296;function I(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function o(t,o){const a=Number(e.slice(t,o));r*=n,i=i*n+a,i>=R&&(r+=i/R|0,i%=R)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?_(i,r):x(i,r)}function O(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(R*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,o=n+8147497*i,a=2*i;const s=1e7;return r>=s&&(o+=Math.floor(r/s),r%=s),o>=s&&(a+=Math.floor(o/s),o%=s),a.toString()+D(o)+D(r)}function x(e,t){return{lo:0|e,hi:0|t}}function _(e,t){return t=~t,e?e=1+~e:t+=1,x(e,t)}const D=e=>{const t=String(e);return"0000000".slice(t.length)+t};function M(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function N(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const A=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>m(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>m(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),I(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),I(e)),dec:(e,t)=>function(e,t){let n=x(e,t);const i=2147483648&n.hi;i&&(n=_(n.lo,n.hi));const r=O(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>O(e,t)}}();var L,U,j;function F(e,t,n){if(t===n)return!0;if(e==L.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return t==n}return!1}function B(e,t){switch(e){case L.BOOL:return!1;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return 0==t?A.zero:"0";case L.DOUBLE:case L.FLOAT:return 0;case L.BYTES:return new Uint8Array(0);case L.STRING:return"";default:return 0}}function V(e,t){switch(e){case L.BOOL:return!1===t;case L.STRING:return""===t;case L.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(L||(L={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(U||(U={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(j||(j={}));class q{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(g(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return f(e),M(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){v(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){g(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){f(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return f(e),M(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=A.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=A.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=A.enc(e);return P(t.lo,t.hi,this.buf),this}sint64(e){let t=A.enc(e),n=t.hi>>31;return P(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=A.uEnc(e);return P(t.lo,t.hi,this.buf),this}}class z{constructor(e,t){this.varint64=E,this.uint32=N,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case j.Varint:for(;128&this.buf[this.pos++];);break;case j.Bit64:this.pos+=4;case j.Bit32:this.pos+=4;break;case j.LengthDelimited:let n=this.uint32();this.pos+=n;break;case j.StartGroup:for(;;){const[e,n]=this.tag();if(n===j.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return A.dec(...this.varint64())}uint64(){return A.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,A.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return A.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return A.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function H(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return B(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let W="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),K=[];for(let n=0;n<W.length;n++)K[W[n].charCodeAt(0)]=n;K["-".charCodeAt(0)]=W.indexOf("+"),K["_".charCodeAt(0)]=W.indexOf("/");const G={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,o=0,a=0;for(let s=0;s<e.length;s++){if(n=K[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:a=n,o=1;break;case 1:i[r++]=a<<2|(48&n)>>4,a=n,o=2;break;case 2:i[r++]=(15&a)<<4|(60&n)>>2,a=n,o=3;break;case 3:i[r++]=(3&a)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let o=0;o<e.length;o++)switch(t=e[o],i){case 0:n+=W[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=W[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=W[r|t>>6],n+=W[63&t],i=0}return i&&(n+=W[r],n+="=",1==i&&(n+="=")),n}};function Q(e,t,n){$(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(e=>e.no===t.no)}(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,a]=H(t);for(const s of r)t.runtime.bin.readField(o,i.readerFactory(s.data),t.field,s.wireType,i);return a()}function J(e,t,n,i){$(t,e);const r=t.runtime.bin.makeReadOptions(i),o=t.runtime.bin.makeWriteOptions(i);if(Y(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=o.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function Y(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function $(e,t){m(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function X(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!V(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function Z(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?B(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function ee(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(w.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function te(e,t){return ee(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}L.DOUBLE,L.FLOAT,L.INT64,L.UINT64,L.INT32,L.UINT32,L.BOOL,L.STRING,L.BYTES;const ne={ignoreUnknownFields:!1},ie={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function re(e){return e?Object.assign(Object.assign({},ne),e):ne}function oe(e){return e?Object.assign(Object.assign({},ie),e):ie}const ae=Symbol(),se=Symbol();function ce(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function le(e,t,n,i,r){let o=n.localName;if(n.repeated){if(m("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t)));const s=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(e)));switch(n.kind){case"message":s.push(n.T.fromJson(e,i));break;case"enum":const t=he(n.T,e,i.ignoreUnknownFields,!0);t!==se&&s.push(t);break;case"scalar":try{s.push(ue(n.T,e,n.L,!0))}catch(a){let t="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(e));throw a instanceof Error&&a.message.length>0&&(t+=": ".concat(a.message)),new Error(t)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t)));const s=e[o];for(const[e,o]of Object.entries(t)){if(null===o)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=de(n.K,e)}catch(a){let e="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t));throw a instanceof Error&&a.message.length>0&&(e+=": ".concat(a.message)),new Error(e)}switch(n.V.kind){case"message":s[c]=n.V.T.fromJson(o,i);break;case"enum":const e=he(n.V.T,o,i.ignoreUnknownFields,!0);e!==se&&(s[c]=e);break;case"scalar":try{s[c]=ue(n.V.T,o,U.BIGINT,!0)}catch(a){let e="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t));throw a instanceof Error&&a.message.length>0&&(e+=": ".concat(a.message)),new Error(e)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const s=n.T;if(null===t&&"google.protobuf.Value"!=s.typeName)return;let c=e[o];ee(c)?c.fromJson(t,i):(e[o]=c=s.fromJson(t,i),s.fieldWrapper&&!n.oneof&&(e[o]=s.fieldWrapper.unwrapField(c)));break;case"enum":const l=he(n.T,t,i.ignoreUnknownFields,!1);switch(l){case ae:Z(n,e);break;case se:break;default:e[o]=l}break;case"scalar":try{const i=ue(n.T,t,n.L,!1);if(i===ae)Z(n,e);else e[o]=i}catch(a){let e="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(ce(t));throw a instanceof Error&&a.message.length>0&&(e+=": ".concat(a.message)),new Error(e)}}}function de(e,t){if(e===L.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return ue(e,t,U.BIGINT,!0).toString()}function ue(e,t,n,i){if(null===t)return i?B(e,n):ae;switch(e){case L.DOUBLE:case L.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==L.FLOAT&&v(i),i;case L.INT32:case L.FIXED32:case L.SFIXED32:case L.SINT32:case L.UINT32:let o;if("number"==typeof t?o=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(o=Number(t)),void 0===o)break;return e==L.UINT32||e==L.FIXED32?g(o):f(o),o;case L.INT64:case L.SFIXED64:case L.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=A.parse(t);return n?a.toString():a;case L.FIXED64:case L.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const s=A.uParse(t);return n?s.toString():s;case L.BOOL:if("boolean"!==typeof t)break;return t;case L.STRING:if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(r){throw new Error("invalid UTF8")}return t;case L.BYTES:if(""===t)return new Uint8Array(0);if("string"!==typeof t)break;return G.dec(t)}throw new Error}function he(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:ae;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return se}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(ce(t)))}function pe(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function me(e,t,n){if("map"==e.kind){m("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,o]of r)i[n.toString()]=ge(e.V.T,o);break;case"message":for(const[e,o]of r)i[e.toString()]=o.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of r)i[e.toString()]=fe(t,o,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){m(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(ge(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(fe(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return ge(e.T,t);case"enum":return fe(e.T,t,n.enumAsInteger);case"message":return te(e.T,t).toJson(n)}}function fe(e,t,n){var i;if(m("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null===r||void 0===r?void 0:r.name)&&void 0!==i?i:t}function ge(e,t){switch(e){case L.INT32:case L.SFIXED32:case L.SINT32:case L.FIXED32:case L.UINT32:return m("number"==typeof t),t;case L.FLOAT:case L.DOUBLE:return m("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case L.STRING:return m("string"==typeof t),t;case L.BOOL:return m("boolean"==typeof t),t;case L.UINT64:case L.FIXED64:case L.INT64:case L.SFIXED64:case L.SINT64:return m("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case L.BYTES:return m(t instanceof Uint8Array),G.enc(t)}}const ve=Symbol("@bufbuild/protobuf/unknown-fields"),be={readUnknownFields:!0,readerFactory:e=>new z(e)},ye={writeUnknownFields:!0,writerFactory:()=>new q};function ke(e){return e?Object.assign(Object.assign({},be),e):be}function Te(e){return e?Object.assign(Object.assign({},ye),e):ye}function Se(e,t,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?L.INT32:n.T;let c=Ee;if("scalar"==n.kind&&n.L>0&&(c=we),o){let n=e[a];if(i==j.LengthDelimited&&s!=L.STRING&&s!=L.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;o?e[a].push(Ce(t,new l,r,n)):ee(e[a])?Ce(t,e[a],r,n):(e[a]=Ce(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[d,u]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let o,a;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:o=Ee(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=Ee(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=Ce(t,new e.V.T,n,void 0)}}}void 0===o&&(o=B(e.K,U.BIGINT));"string"!=typeof o&&"number"!=typeof o&&(o=o.toString());if(void 0===a)switch(e.V.kind){case"scalar":a=B(e.V.T,U.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[o,a]}(n,t,r);e[a][d]=u}}function Ce(e,t,n,i){const r=t.getType().runtime.bin,o=null===i||void 0===i?void 0:i.delimited;return r.readMessage(t,e,o?i.no:e.uint32(),n,o),t}function we(e,t){const n=Ee(e,t);return"bigint"==typeof n?n.toString():n}function Ee(e,t){switch(t){case L.STRING:return e.string();case L.BOOL:return e.bool();case L.DOUBLE:return e.double();case L.FLOAT:return e.float();case L.INT32:return e.int32();case L.INT64:return e.int64();case L.UINT64:return e.uint64();case L.FIXED64:return e.fixed64();case L.BYTES:return e.bytes();case L.FIXED32:return e.fixed32();case L.SFIXED32:return e.sfixed32();case L.SFIXED64:return e.sfixed64();case L.SINT64:return e.sint64();case L.UINT32:return e.uint32();case L.SINT32:return e.sint32()}}function Pe(e,t,n,i){m(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?L.INT32:e.T;if(r)if(m(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,j.LengthDelimited).fork();let[,r]=xe(t);for(let o=0;o<i.length;o++)e[r](i[o]);e.join()}(n,o,e.no,t);else for(const i of t)Oe(n,o,e.no,i);else Oe(n,o,e.no,t);break;case"message":if(r){m(Array.isArray(t));for(const r of t)Ie(n,i,e,r)}else Ie(n,i,e,t);break;case"map":m("object"==typeof t&&null!=t);for(const[r,a]of Object.entries(t))Re(n,i,e,r,a)}}function Re(e,t,n,i,r){e.tag(n.no,j.LengthDelimited),e.fork();let o=i;switch(n.K){case L.INT32:case L.FIXED32:case L.UINT32:case L.SFIXED32:case L.SINT32:o=Number.parseInt(i);break;case L.BOOL:m("true"==i||"false"==i),o="true"==i}switch(Oe(e,n.K,1,o),n.V.kind){case"scalar":Oe(e,n.V.T,2,r);break;case"enum":Oe(e,L.INT32,2,r);break;case"message":m(void 0!==r),e.tag(2,j.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Ie(e,t,n,i){const r=te(n.T,i);n.delimited?e.tag(n.no,j.StartGroup).raw(r.toBinary(t)).tag(n.no,j.EndGroup):e.tag(n.no,j.LengthDelimited).bytes(r.toBinary(t))}function Oe(e,t,n,i){m(void 0!==i);let[r,o]=xe(t);e.tag(n,r)[o](i)}function xe(e){let t=j.Varint;switch(e){case L.BYTES:case L.STRING:t=j.LengthDelimited;break;case L.DOUBLE:case L.FIXED64:case L.SFIXED64:t=j.Bit64;break;case L.FIXED32:case L.SFIXED32:case L.FLOAT:t=j.Bit32}return[t,L[e].toLowerCase()]}function _e(e){if(void 0===e)return e;if(ee(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function De(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class Me{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function Ne(e,t){const n=Le(e);return t?n:Ve(Be(n))}const Ae=Le;function Le(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Ue=new Set(["constructor","toString","toJSON","valueOf"]),je=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Fe=e=>"".concat(e,"$"),Be=e=>je.has(e)?Fe(e):e,Ve=e=>Ue.has(e)?Fe(e):e;class qe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Ne(e,!1)}addField(e){m(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const ze=(He=e=>new Me(e,e=>function(e){var t,n,i,r,o,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=Ne(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:Ae(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:U.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(o=l.req)&&void 0!==o&&o,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=L.BYTES&&l.T!=L.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new qe(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e)),We=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=B(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:re,makeWriteOptions:oe,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(ce(t)));i=null!==i&&void 0!==i?i:new e;const r=new Map,o=n.typeRegistry;for(const[a,s]of Object.entries(t)){const t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(a,'"'));r.set(t.oneof,a)}le(i,s,t,n,e)}else{let t=!1;if((null===o||void 0===o?void 0:o.findExtension)&&a.startsWith("[")&&a.endsWith("]")){const r=o.findExtension(a.substring(1,a.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,o]=H(r);le(e,s,r.field,n,r),J(i,r,o(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!X(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!pe(r))continue}const n=me(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const o=t.typeRegistry;if(null===o||void 0===o?void 0:o.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const a=o.findExtensionFor(n.typeName,r.no);if(a&&Y(e,a)){const n=Q(e,a,t),r=me(a.field,n,t);void 0!==r&&(i[a.field.jsonName]=r)}}}catch(o){const e=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),t=o instanceof Error?o.message:String(o);throw new Error(e+(t.length>0?": ".concat(t):""))}return i},readScalar:(e,t,n)=>ue(e,t,null!==n&&void 0!==n?n:U.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||V(e,t)?ge(e,t):void 0},debug:ce},bin:{makeReadOptions:ke,makeWriteOptions:Te,listUnknownFields(e){var t;return null!==(t=e[ve])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[ve]},writeUnknownFields(e,t){const n=e[ve];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[ve])||(r[ve]=[]),r[ve].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const o=e.getType(),a=r?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==r||c!=j.EndGroup);){const n=o.fields.find(s);if(!n){const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n);continue}Se(e,t,n,c,i)}if(r&&(c!=j.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:Se,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(X(r,e))Pe(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Pe(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:k,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,o=e;if(null!=o[n])switch(i.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=i.findField(e);let a=o[n].value;t&&"message"==t.kind&&!ee(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===L.BYTES&&(a=De(a)),r[n]={case:e,value:a};break;case"scalar":case"enum":let s=o[n];i.T===L.BYTES&&(s=i.repeated?s.map(De):De(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===L.BYTES)for(const[t,i]of Object.entries(o[n]))r[n][t]=De(i);else Object.assign(r[n],o[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(o[n])){let i=o[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=o[n].map(e=>ee(e,c)?e:new c(e));else{const e=o[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=De(e):r[n]=e:r[n]=ee(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every(e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every((t,n)=>e.T.equals(t,r[n]));case"scalar":return i.every((t,n)=>F(e.T,t,r[n]));case"enum":return i.every((e,t)=>F(L.INT32,e,r[t]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=i,n=r;return e.T.fieldWrapper&&(void 0===t||ee(t)||(t=e.T.fieldWrapper.wrapField(t)),void 0===n||ee(n)||(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return F(L.INT32,i,r);case"scalar":return F(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const o=e.findField(i.case);if(void 0===o)return!0;switch(o.kind){case"message":return o.T.equals(i.value,r.value);case"enum":return F(L.INT32,i.value,r.value);case"scalar":return F(o.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return a.every(e=>t.equals(i[e],r[e]));case"enum":return a.every(e=>F(L.INT32,i[e],r[e]));case"scalar":const n=e.V.T;return a.every(e=>F(n,i[e],r[e]))}}}),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(_e);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=_e(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:_e(t.value)}:{case:void 0}:_e(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:He,initFields:We}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const o=null!==(r=null===i||void 0===i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),a={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(a.prototype,new w),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:S,makeEnumType:T,getEnumType:y,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var He,We;class Ke extends w{constructor(e){super(),this.seconds=A.zero,this.nanos=0,ze.util.initPartial(e,this)}fromJson(e,t){if("string"!==typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(ze.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=A.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return Ke.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Ke({seconds:A.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new Ke).fromBinary(e,t)}static fromJson(e,t){return(new Ke).fromJson(e,t)}static fromJsonString(e,t){return(new Ke).fromJsonString(e,t)}static equals(e,t){return ze.util.equals(Ke,e,t)}}Ke.runtime=ze,Ke.typeName="google.protobuf.Timestamp",Ke.fields=ze.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Ge=ze.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ke},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Qe,repeated:!0},{no:5,name:"events",kind:"message",T:Ye,repeated:!0}]),Qe=ze.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Je,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Je=ze.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ke},{no:3,name:"value",kind:"scalar",T:2}]),Ye=ze.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Ke},{no:7,name:"normalized_end_timestamp",kind:"message",T:Ke,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),$e=ze.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Xe=ze.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ze=ze.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),et=ze.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),tt=ze.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),nt=ze.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),it=ze.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),rt=ze.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),ot=ze.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),at=ze.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),st=ze.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ct,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Ft}]),ct=ze.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),lt=ze.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:ze.getEnumType(Ze),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),dt=ze.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ze.getEnumType(ut)},{no:4,name:"tracks",kind:"message",T:gt,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:lt},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:ze.getEnumType(ht)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:ze.getEnumType(it)},{no:18,name:"kind_details",kind:"enum",T:ze.getEnumType(pt),repeated:!0}]),ut=ze.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ht=ze.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),pt=ze.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),mt=ze.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),ft=ze.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:vt,repeated:!0}]),gt=ze.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:ze.getEnumType(Xe)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:ze.getEnumType(Ze)},{no:10,name:"layers",kind:"message",T:vt,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:ft,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:ze.getEnumType(mt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Ft},{no:19,name:"audio_features",kind:"enum",T:ze.getEnumType(at),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:ze.getEnumType($e)}]),vt=ze.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:ze.getEnumType(et)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),bt=ze.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:ze.getEnumType(yt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:St,oneof:"value"},{no:3,name:"speaker",kind:"message",T:kt,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Ct,oneof:"value"},{no:7,name:"transcription",kind:"message",T:wt,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Ge,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Pt,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Rt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:It,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Ot,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:zt,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ht,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Wt,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),yt=ze.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),kt=ze.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Tt,repeated:!0}]),Tt=ze.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),St=ze.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Ct=ze.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),wt=ze.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Et,repeated:!0}]),Et=ze.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Pt=ze.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Rt=ze.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),It=ze.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Ot=ze.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:xt,oneof:"value"}]),xt=ze.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),_t=ze.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Dt=ze.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:ze.getEnumType(Mt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Mt=ze.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Nt=ze.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:ze.getEnumType(At)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),At=ze.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Lt=ze.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Ut},{no:2,name:"screen",kind:"message",T:Ut},{no:3,name:"resume_connection",kind:"enum",T:ze.getEnumType(nt)},{no:4,name:"disabled_codecs",kind:"message",T:jt},{no:5,name:"force_relay",kind:"enum",T:ze.getEnumType(nt)}]),Ut=ze.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:ze.getEnumType(nt)}]),jt=ze.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ct,repeated:!0},{no:2,name:"publish",kind:"message",T:ct,repeated:!0}]),Ft=ze.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Bt=ze.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Vt=ze.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:ze.getEnumType(Bt)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),qt=ze.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),zt=ze.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:ze.getEnumType(mt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Vt,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:qt,oneof:"content_header"}],{localName:"DataStream_Header"}),Ht=ze.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Wt=ze.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Kt=ze.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Gt=ze.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Qt=ze.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Jt=ze.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:an,oneof:"message"},{no:2,name:"answer",kind:"message",T:an,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Zt,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Xt,oneof:"message"},{no:5,name:"mute",kind:"message",T:en,oneof:"message"},{no:6,name:"subscription",kind:"message",T:cn,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:ln,oneof:"message"},{no:8,name:"leave",kind:"message",T:hn,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:mn,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Rn,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:xn,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Mn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:fn,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Nn,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:dn,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:un,oneof:"message"}]),Yt=ze.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:tn,oneof:"message"},{no:2,name:"answer",kind:"message",T:an,oneof:"message"},{no:3,name:"offer",kind:"message",T:an,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Zt,oneof:"message"},{no:5,name:"update",kind:"message",T:sn,oneof:"message"},{no:6,name:"track_published",kind:"message",T:rn,oneof:"message"},{no:8,name:"leave",kind:"message",T:hn,oneof:"message"},{no:9,name:"mute",kind:"message",T:en,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:vn,oneof:"message"},{no:11,name:"room_update",kind:"message",T:bn,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:kn,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Sn,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:En,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:In,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:on,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:nn,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:An,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:jn,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Fn,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Vn,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:On,oneof:"message"}]),$t=ze.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),Xt=ze.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:ze.getEnumType(Xe)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:ze.getEnumType(Ze)},{no:9,name:"layers",kind:"message",T:vt,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:$t,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:ze.getEnumType(mt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:ze.getEnumType($e)},{no:17,name:"audio_features",kind:"enum",T:ze.getEnumType(at),repeated:!0}]),Zt=ze.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:ze.getEnumType(Kt)},{no:3,name:"final",kind:"scalar",T:8}]),en=ze.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),tn=ze.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:st},{no:2,name:"participant",kind:"message",T:dt},{no:3,name:"other_participants",kind:"message",T:dt,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:gn,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Lt},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Dt},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ct,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),nn=ze.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:gn,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Lt},{no:3,name:"server_info",kind:"message",T:Dt},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),rn=ze.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:gt}]),on=ze.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),an=ze.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),sn=ze.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:dt,repeated:!0}]),cn=ze.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:_t,repeated:!0}]),ln=ze.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:ze.getEnumType(et)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),dn=ze.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:ze.getEnumType(at),repeated:!0}]),un=ze.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),hn=ze.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:ze.getEnumType(it)},{no:3,name:"action",kind:"enum",T:ze.getEnumType(pn)},{no:4,name:"regions",kind:"message",T:Ln}]),pn=ze.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),mn=ze.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:vt,repeated:!0}]),fn=ze.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),gn=ze.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),vn=ze.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Tt,repeated:!0}]),bn=ze.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:st}]),yn=ze.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:ze.getEnumType(tt)},{no:3,name:"score",kind:"scalar",T:2}]),kn=ze.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:yn,repeated:!0}]),Tn=ze.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ze.getEnumType(Gt)}]),Sn=ze.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Tn,repeated:!0}]),Cn=ze.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:ze.getEnumType(et)},{no:2,name:"enabled",kind:"scalar",T:8}]),wn=ze.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Cn,repeated:!0}]),En=ze.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Cn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:wn,repeated:!0}]),Pn=ze.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Rn=ze.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Pn,repeated:!0}]),In=ze.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),On=ze.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:st},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:dt},{no:4,name:"other_participants",kind:"message",T:dt,repeated:!0}]),xn=ze.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:an},{no:2,name:"subscription",kind:"message",T:cn},{no:3,name:"publish_tracks",kind:"message",T:rn,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Dn,repeated:!0},{no:5,name:"offer",kind:"message",T:an},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:_n,repeated:!0}]),_n=ze.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Dn=ze.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:ze.getEnumType(Kt)}]),Mn=ze.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:ze.getEnumType(Qt),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Nn=ze.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),An=ze.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Ln=ze.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Un,repeated:!0}]),Un=ze.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),jn=ze.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:ze.getEnumType(ot)}]),Fn=ze.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:ze.getEnumType(Bn)},{no:3,name:"message",kind:"scalar",T:9}]),Bn=ze.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Vn=ze.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function qn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var zn,Hn={exports:{}},Wn=Hn.exports;var Kn,Gn,Qn=function(){return zn||(zn=1,e=Hn,function(t,n){e.exports?e.exports=n():t.log=n()}(Wn,function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(o){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(o){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"===typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"===typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"===typeof e?h+=":"+e:"symbol"===typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=l?l:null!=s?s:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(r){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o})),Hn.exports;var e}();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(Kn||(Kn={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(Gn||(Gn={}));let Jn=Qn.getLogger("livekit");Object.values(Gn).map(e=>Qn.getLogger(e));function Yn(e){const t=Qn.getLogger(e);return t.setDefaultLevel(Jn.getLevel()),t}Jn.setDefaultLevel(Kn.info);const $n=Qn.getLogger("lk-e2ee"),Xn=7e3,Zn=[0,300,1200,2700,4800,Xn,Xn,Xn,Xn,Xn];function ei(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((i=i.apply(e,t||[])).next())})}function ti(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ni(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=ti(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}"function"===typeof SuppressedError&&SuppressedError;var ii,ri={exports:{}};var oi=function(){if(ii)return ri.exports;ii=1;var e,t="object"===typeof Reflect?Reflect:null,n=t&&"function"===typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"===typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function r(){r.init.call(this)}ri.exports=r,ri.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&m(e,"error",t,n)}(e,r,{once:!0})})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,c,l;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),void 0===c)c=o[t]=n,++e._eventsCount;else if("function"===typeof c?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,l=d,console&&console.warn&&console.warn(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function r(o){i.once&&e.removeEventListener(t,r),n(o)})}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"===typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},ri.exports}();let ai=!0,si=!0;function ci(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function li(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function di(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(ai=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ui(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(si=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function hi(){if("object"===typeof window){if(ai)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function pi(e,t){si&&console.warn(e+" is deprecated, please use "+t+" instead.")}function mi(e){return"[object Object]"===Object.prototype.toString.call(e)}function fi(e){return mi(e)?Object.keys(e).reduce(function(t,n){const i=mi(e[n]),r=i?fi(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})},{}):e}function gi(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?gi(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(t=>{gi(e,e.get(t),n)})}))}function vi(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&gi(e,n,r)})}),r}const bi=hi;function yi(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"===typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===typeof e.video){let o=e.video.facingMode;o=o&&("object"===typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let a=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),bi("chrome: "+JSON.stringify(e)),r(e)})}e.video=i(e.video)}return bi("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(o(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(o(e))))}}}function ki(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ti(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else li(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Si(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ci(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>vi(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),li(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>vi(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach(n=>{n.track===e&&(t?i=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?i=!0:n=t),t.track===e)),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function wi(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function Ei(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return wi(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}};e.RTCPeerConnection.prototype[t]=i[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Pi(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function Ri(e,t){li(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var Ii=Object.freeze({__proto__:null,fixNegotiationNeeded:Ri,shimAddTrackRemoveTrack:Ei,shimAddTrackRemoveTrackWithNative:wi,shimGetSendersWithDtmf:Si,shimGetUserMedia:yi,shimMediaStream:ki,shimOnTrack:Ti,shimPeerConnection:Pi,shimSenderReceiverGetStats:Ci});function Oi(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){pi("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"===typeof n&&"object"===typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function xi(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _i(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(i){if("TypeError"!==i.name)throw i;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(r,o)}}function Di(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Mi(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),li(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ni(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){pi("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Ai(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Li(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function Ui(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ji(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Fi(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Bi=Object.freeze({__proto__:null,shimAddTransceiver:Li,shimCreateAnswer:Fi,shimCreateOffer:ji,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Ui,shimGetUserMedia:Oi,shimOnTrack:xi,shimPeerConnection:_i,shimRTCDataChannel:Ai,shimReceiverGetStats:Mi,shimRemoveStream:Ni,shimSenderGetStats:Di});function Vi(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function qi(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function zi(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function Hi(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Wi(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Wi(e){return e&&void 0!==e.video?Object.assign({},e,{video:fi(e.video)}):e}function Ki(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(pi("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Gi(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qi(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ji(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Yi,$i=Object.freeze({__proto__:null,shimAudioContext:Ji,shimCallbacksAPI:zi,shimConstraints:Wi,shimCreateOfferLegacy:Qi,shimGetUserMedia:Hi,shimLocalStreamsAPI:Vi,shimRTCIceServerUrls:Ki,shimRemoteStreamsAPI:qi,shimTrackEventTransceiver:Gi}),Xi={exports:{}};var Zi=(Yi||(Yi=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let o=3;o<i.length;o++){const r=i[o],a=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){const i=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=o.length?t.parseFmtp(o[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let r=0;return n.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Xi)),Xi.exports),er=qn(Zi),tr=d({__proto__:null,default:er},[Zi]);function nr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=er.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,li(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function ir(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||li(e,"icecandidate",e=>{if(e.candidate){const t=er.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function rr(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=er.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=er.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!==n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=er.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function or(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},li(e,"datachannel",e=>(t(e.channel,e.target),e))}function ar(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function sr(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function cr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function lr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var dr=Object.freeze({__proto__:null,removeExtmapAllowMixed:sr,shimAddIceCandidateNullOrEmpty:cr,shimConnectionState:ar,shimMaxMessageSize:rr,shimParameterlessSetLocalDescription:lr,shimRTCIceCandidate:nr,shimRTCIceCandidateRelayProtocol:ir,shimSendThrowTypeError:or});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=hi,i=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(ci(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(ci(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(ci(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=ci(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),r={browserDetails:i,commonShim:dr,extractVersion:ci,disableLog:di,disableWarnings:ui,sdp:tr};switch(i.browser){case"chrome":if(!Ii||!Pi||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Ii,cr(e,i),lr(e),yi(e,i),ki(e),Pi(e,i),Ti(e),Ei(e,i),Si(e),Ci(e),Ri(e,i),nr(e),ir(e),ar(e),rr(e,i),or(e),sr(e,i);break;case"firefox":if(!Bi||!_i||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Bi,cr(e,i),lr(e),Oi(e,i),_i(e,i),xi(e),Ni(e),Di(e),Mi(e),Ai(e),Li(e),Ui(e),ji(e),Fi(e),nr(e),ar(e),rr(e,i),or(e);break;case"safari":if(!$i||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=$i,cr(e,i),lr(e),Ki(e),Qi(e),zi(e),Vi(e),qi(e),Gi(e),Hi(e),Ji(e),nr(e),ir(e),rr(e,i),or(e),sr(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"===typeof window?void 0:window});const ur="lk_e2ee";var hr,pr,mr,fr;function gr(){return"undefined"!==typeof window.RTCRtpSender&&"undefined"!==typeof window.RTCRtpSender.prototype.createEncodedStreams||vr()}function vr(){return"undefined"!==typeof window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(hr||(hr={})),function(e){e.KeyRatcheted="keyRatcheted"}(pr||(pr={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(mr||(mr={})),function(e){e.Error="cryptorError"}(fr||(fr={}));oi.EventEmitter;class br extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var yr,kr,Tr,Sr,Cr,wr,Er;!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"}(yr||(yr={}));class Pr extends br{constructor(e,t,n,i){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=i,this.reasonName=yr[t]}}class Rr extends br{constructor(e){super(21,null!==e&&void 0!==e?e:"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ir extends br{constructor(e){super(20,null!==e&&void 0!==e?e:"track is invalid"),this.name="TrackInvalidError"}}class Or extends br{constructor(e){super(10,null!==e&&void 0!==e?e:"unsupported server"),this.name="UnsupportedServer"}}class xr extends br{constructor(e){super(12,null!==e&&void 0!==e?e:"unexpected connection state"),this.name="UnexpectedConnectionState"}}class _r extends br{constructor(e){super(13,null!==e&&void 0!==e?e:"unable to negotiate"),this.name="NegotiationError"}}class Dr extends br{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class Mr extends br{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"===typeof t?t:Bn[t]}}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(kr||(kr={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(kr||(kr={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(Tr||(Tr={}));!function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(Sr||(Sr={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"}(Cr||(Cr={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"}(wr||(wr={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"}(Er||(Er={}));const Nr=/version\/(\d+(\.?_?\d+)+)/i;let Ar;function Lr(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof e&&"undefined"===typeof navigator)return;const n=(null!==e&&void 0!==e?e:navigator.userAgent).toLowerCase();if(void 0===Ar||t){const e=Ur.find(e=>{let{test:t}=e;return t.test(n)});Ar=null===e||void 0===e?void 0:e.describe(n)}return Ar}const Ur=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:jr(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Fr(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:jr(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Fr(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:jr(Nr,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Fr(e)})}];function jr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function Fr(e){return e.includes("mac os")?jr(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class Br{}Br.setTimeout=function(){return setTimeout(...arguments)},Br.setInterval=function(){return setInterval(...arguments)},Br.clearTimeout=function(){return clearTimeout(...arguments)},Br.clearInterval=function(){return clearInterval(...arguments)};const Vr=[];var qr;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(qr||(qr={}));class zr extends oi.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=zr.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Jn,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),5e3):this.handleAppVisibilityChanged()},this.log=Yn(null!==(i=n.loggerName)&&void 0!==i?i:Gn.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=zr.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Zo(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===zr.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===zr.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(Vr.forEach(t=>{null!==t.parentElement||e||(e=t)}),e&&Vr.splice(Vr.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Hr(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some(e=>"audio"===e.kind);return e.play().then(()=>{this.emit(i?Er.AudioPlaybackStarted:Er.VideoPlaybackStarted)}).catch(t=>{"NotAllowedError"===t.name?this.emit(i?Er.AudioPlaybackFailed:Er.VideoPlaybackFailed,t):"AbortError"===t.name?Jn.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Jn.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some(e=>"video"===e.kind)&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Er.ElementAttached,e),e}detach(e){try{if(e){Wr(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Er.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(e=>{Wr(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Er.ElementDetached,e)}),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Yn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Vr.forEach(e=>{e.parentElement||(t=!1)}),t&&Vr.push(e)}}handleAppVisibilityChanged(){return ei(this,void 0,void 0,function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==zr.Kind.Video||setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){po()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){po()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Hr(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach(e=>{n.removeTrack(e)}),n.addTrack(e)),co()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(co()||so())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function Wr(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return Xe.AUDIO;case t.Video:return Xe.VIDEO;default:return Xe.DATA}},e.kindFromProto=function(e){switch(e){case Xe.AUDIO:return t.Audio;case Xe.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return Ze.CAMERA;case n.Microphone:return Ze.MICROPHONE;case n.ScreenShare:return Ze.SCREEN_SHARE;case n.ScreenShareAudio:return Ze.SCREEN_SHARE_AUDIO;default:return Ze.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Ze.CAMERA:return n.Camera;case Ze.MICROPHONE:return n.Microphone;case Ze.SCREEN_SHARE:return n.ScreenShare;case Ze.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Gt.ACTIVE:return i.Active;case Gt.PAUSED:return i.Paused;default:return i.Unknown}}}(zr||(zr={}));class Kr{constructor(e,t,n,i,r){if("object"===typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Gr=["vp8","h264"],Qr=["vp8","h264","vp9","av1","h265"];function Jr(e){return!!Gr.find(t=>t===e)}var Yr,$r;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(Yr||(Yr={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}($r||($r={}));const Xr={h90:new Kr(160,90,9e4,20),h180:new Kr(320,180,16e4,20),h216:new Kr(384,216,18e4,20),h360:new Kr(640,360,45e4,20),h540:new Kr(960,540,8e5,25),h720:new Kr(1280,720,17e5,30),h1080:new Kr(1920,1080,3e6,30),h1440:new Kr(2560,1440,5e6,30),h2160:new Kr(3840,2160,8e6,30)},Zr={h120:new Kr(160,120,7e4,20),h180:new Kr(240,180,125e3,20),h240:new Kr(320,240,14e4,20),h360:new Kr(480,360,33e4,20),h480:new Kr(640,480,5e5,20),h540:new Kr(720,540,6e5,25),h720:new Kr(960,720,13e5,30),h1080:new Kr(1440,1080,23e5,30),h1440:new Kr(1920,1440,38e5,30)},eo={h360fps3:new Kr(640,360,2e5,3,"medium"),h360fps15:new Kr(640,360,4e5,15,"medium"),h720fps5:new Kr(1280,720,8e5,5,"medium"),h720fps15:new Kr(1280,720,15e5,15,"medium"),h720fps30:new Kr(1280,720,2e6,30,"medium"),h1080fps15:new Kr(1920,1080,25e5,15,"medium"),h1080fps30:new Kr(1920,1080,5e6,30,"medium"),original:new Kr(0,0,7e6,30,"medium")},to="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function no(e){return ei(this,void 0,void 0,function*(){return new Promise(t=>Br.setTimeout(t,e))})}function io(){return"addTransceiver"in RTCPeerConnection.prototype}function ro(){return"addTrack"in RTCPeerConnection.prototype}function oo(e){return"av1"===e||"vp9"===e}function ao(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function so(){var e;return"Firefox"===(null===(e=Lr())||void 0===e?void 0:e.name)}function co(){var e;return"Safari"===(null===(e=Lr())||void 0===e?void 0:e.name)}function lo(){const e=Lr();return"Safari"===(null===e||void 0===e?void 0:e.name)||"iOS"===(null===e||void 0===e?void 0:e.os)}function uo(){const e=Lr();return"Safari"===(null===e||void 0===e?void 0:e.name)&&e.version.startsWith("17.")||"iOS"===(null===e||void 0===e?void 0:e.os)&&!!(null===e||void 0===e?void 0:e.osVersion)&&yo(e.osVersion,"17")>=0}function ho(){var e,t;return!!po()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function po(){return"undefined"!==typeof document}function mo(){return"ReactNative"==navigator.product}function fo(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function go(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function vo(){if(!mo())return;let e=go();return e?e.platform:void 0}function bo(){if(po())return window.devicePixelRatio;if(mo()){let e=go();if(e)return e.devicePixelRatio}return 1}function yo(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const e=parseInt(n[o],10),t=parseInt(i[o],10);if(e>t)return 1;if(e<t)return-1;if(o===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function ko(e){for(const t of e)t.target.handleResize(t)}function To(e){for(const t of e)t.target.handleVisibilityChanged(t)}let So=null;const Co=()=>(So||(So=new ResizeObserver(ko)),So);let wo=null;const Eo=()=>(wo||(wo=new IntersectionObserver(To,{root:null,rootMargin:"0px"})),wo);let Po;function Ro(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const o=r.getContext("2d");null===o||void 0===o||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function Io(){if(!Po){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Po]=i.stream.getAudioTracks(),!Po)throw Error("Could not get empty media stream audio track");Po.enabled=!1}return Po.clone()}class Oo{constructor(e,t){this.onFinally=t,this.promise=new Promise((t,n)=>ei(this,void 0,void 0,function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})).finally(()=>{var e;return null===(e=this.onFinally)||void 0===e?void 0:e.call(this)})}}function xo(e){if("string"===typeof e||"number"===typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function _o(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function Do(e){switch(e.reason){case yr.LeaveRequest:return e.context;case yr.Cancelled:return it.CLIENT_INITIATED;case yr.NotAllowed:return it.USER_REJECTED;case yr.ServerUnreachable:return it.JOIN_FAILURE;default:return it.UNKNOWN_REASON}}function Mo(e){return void 0!==e?Number(e):void 0}function No(e){return void 0!==e?BigInt(e):void 0}function Ao(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function Lo(e){return!!e&&e.kind==zr.Kind.Audio}function Uo(e){return!!e&&e.kind==zr.Kind.Video}function jo(e){return Ao(e)&&Uo(e)}function Fo(e){return Ao(e)&&Lo(e)}function Bo(e){return!!e&&!e.isLocal}function Vo(e){return!!e&&!e.isLocal}function qo(e){return Bo(e)&&Uo(e)}function zo(e,t,n){var i,r,o,a;const{optionsWithoutProcessor:s,audioProcessor:c,videoProcessor:l}=ea(null!==e&&void 0!==e?e:{}),d=null===t||void 0===t?void 0:t.processor,u=null===n||void 0===n?void 0:n.processor,h=null!==s&&void 0!==s?s:{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(Ho(h.audio,t),null!==(i=(o=h.audio).deviceId)&&void 0!==i||(o.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=null!==c&&void 0!==c?c:d)),h.video&&(Ho(h.video,n),null!==(r=(a=h.video).deviceId)&&void 0!==r||(a.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=null!==l&&void 0!==l?l:u)),h}function Ho(e,t){return Object.keys(t).forEach(n=>{void 0===e[n]&&(e[n]=t[n])}),e}function Wo(e){var t,n,i,r;const o={};if(e.video)if("object"===typeof e.video){const n={},r=n,a=e.video;Object.keys(a).forEach(e=>{if("resolution"===e)Ho(r,a.resolution);else r[e]=a[e]}),o.video=n,null!==(t=(i=o.video).deviceId)&&void 0!==t||(i.deviceId={ideal:"default"})}else o.video=!!e.video&&{deviceId:{ideal:"default"}};else o.video=!1;return e.audio?"object"===typeof e.audio?(o.audio=e.audio,null!==(n=(r=o.audio).deviceId)&&void 0!==n||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Ko(e){return ei(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=Go();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,o=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield no(t),i.getByteTimeDomainData(o);const a=o.some(e=>128!==e&&0!==e);return n.close(),!a}return!1}()})}function Go(){var e;const t="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&"undefined"!==typeof window&&(null===(e=window.document)||void 0===e?void 0:e.body)){const e=()=>ei(this,void 0,void 0,function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(i){console.warn("Error trying to auto-resume audio context",i)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)});window.document.body.addEventListener("click",e)}return n}}function Qo(e){return"audioinput"===e?zr.Source.Microphone:"videoinput"===e?zr.Source.Camera:zr.Source.Unknown}function Jo(e){return e===zr.Source.Microphone?"audioinput":e===zr.Source.Camera?"videoinput":void 0}function Yo(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"===typeof i?{}:i,i=co()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function $o(e){return e.split("/")[1].toLowerCase()}function Xo(e){const t=[];return e.forEach(e=>{void 0!==e.track&&t.push(new rn({cid:e.track.mediaStreamID,track:e.trackInfo}))}),t}function Zo(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?Zo(e.track):{})}}function ea(e){const t=Object.assign({},e);let n,i;return"object"===typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"===typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:(r=t,"undefined"===typeof r?r:"function"===typeof structuredClone?"object"===typeof r&&null!==r?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r)))};var r}function ta(e,t){return e.width*e.height<t.width*t.height}class na extends oi.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":Jn.error(r.error.message),this.emit(mr.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)});break;case"enable":if(r.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)}),this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(mr.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(mr.ParticipantEncryptionStatusChanged,r.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(hr.KeyRatcheted,r.ratchetResult,r.participantIdentity,r.keyIndex)}},this.onWorkerError=e=>{Jn.error("e2ee worker encountered an error:",{error:e.error}),this.emit(mr.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!gr())throw new Rr("tried to setup end-to-end encryption on an unsupported browser");if(Jn.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:$n.getLevel()}};this.worker&&(Jn.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Jn.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):Jn.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(wr.RTPVideoMapUpdate,e=>{this.postRTPMap(e)})}setupEventListeners(e,t){e.on(Sr.TrackPublished,(e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==mt.NONE,t.identity)),e.on(Sr.ConnectionStateChanged,t=>{t===Bs.Connected&&e.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==mt.NONE,e.identity)})})}).on(Sr.TrackUnsubscribed,(e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)}).on(Sr.TrackSubscribed,(e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(Sr.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(e=>{this.postKey(e)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Cr.LocalSenderCreated,(e,t)=>ei(this,void 0,void 0,function*(){this.setupE2EESender(t,e)})),t.on(hr.SetKey,e=>this.postKey(e)).on(hr.RatchetRequest,(e,t)=>this.postRatchetRequest(e,t))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null===n||void 0===n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?$o(n.mimeType):void 0)}}setupE2EESender(e,t){Ao(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||Jn.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return ei(this,void 0,void 0,function*(){if(this.worker){if(vr()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(ur in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,o=e.readableStream;if(!r||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,o=t.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:t,codec:i,participantIdentity:n,isReuse:ur in e}};this.worker.postMessage(a,[o,r])}e[ur]=!0}})}handleSender(e,t,n){var i;if(!(ur in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(vr()){Jn.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{Jn.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(r,[i.readable,i.writable])}e[ur]=!0}}}const ia="default";class ra{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new ra),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return ei(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=ra.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){Jn.debug("awaiting getUserMedia promise");try{e?yield ra.userMediaPromiseMap.get(e):yield Promise.all(ra.userMediaPromiseMap.values())}catch(o){Jn.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!co()||!t.hasDeviceInUse(e))){if(0===r.filter(t=>t.kind===e).length||r.some(t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i})){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(e=>{e.stop()})}}return t._previousDevices=r,e&&(r=r.filter(t=>t.kind===e)),r}()})}normalizeDeviceId(e,t,n){return ei(this,void 0,void 0,function*(){if(t!==ia)return t;const i=yield this.getDevices(e),r=i.find(e=>e.deviceId===ia);if(!r)return void Jn.warn("could not reliably determine default device");const o=i.find(e=>e.deviceId!==ia&&e.groupId===(null!==n&&void 0!==n?n:r.groupId));if(o)return null===o||void 0===o?void 0:o.deviceId;Jn.warn("could not reliably determine default device")})}hasDeviceInUse(e){return e?ra.userMediaPromiseMap.has(e):ra.userMediaPromiseMap.size>0}}var oa;ra.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],ra.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(oa||(oa={}));class aa{constructor(){this.pendingTasks=new Map,this.taskMutex=new p,this.nextTaskIndex=0}run(e){return ei(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:oa.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=oa.RUNNING,yield e()}finally{t.status=oa.COMPLETED,this.pendingTasks.delete(t.id),n()}})}flush(){return ei(this,void 0,void 0,function*(){return this.run(()=>ei(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function sa(e,t){return e.pathname="".concat(function(e){return e.endsWith("/")?e:"".concat(e,"/")}(e.pathname)).concat(t),e.toString()}const ca=["syncState","trickle","offer","answer","simulate","leave"];var la;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(la||(la={}));class da{get currentState(){return this.state}get isDisconnected(){return this.state===la.DISCONNECTING||this.state===la.DISCONNECTED}get isEstablishingConnection(){return this.state===la.CONNECTING||this.state===la.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=la.DISCONNECTED,this.log=Jn,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Yn(null!==(n=t.loggerName)&&void 0!==n?n:Gn.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new aa,this.queuedRequests=[],this.closingLock=new p,this.connectionLock=new p,this.state=la.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return ei(this,void 0,void 0,function*(){this.state=la.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)})}reconnect(e,t,n,i){return ei(this,void 0,void 0,function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=la.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))})}connect(e,t,n,i){this.connectOptions=n;const r=function(e,t,n){var i;const r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",mo()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return r}(t,function(){var e;const t=new Nt({sdk:At.JS,protocol:16,version:"2.15.1"});return mo()&&(t.os=null!==(e=vo())&&void 0!==e?e:""),t}(),n),o=function(e,t){const n=new URL(function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e));return t.forEach((e,t)=>{n.searchParams.set(t,e)}),sa(n,"rtc")}(e,r),a=sa(new URL(_o(o)),"validate");return new Promise((e,t)=>ei(this,void 0,void 0,function*(){const r=yield this.connectionLock.lock();try{const r=()=>ei(this,void 0,void 0,function*(){this.close(),clearTimeout(s),t(new Pr("room connection has been cancelled (signal)",yr.Cancelled))}),s=setTimeout(()=>{this.close(),t(new Pr("room connection has timed out (signal)",yr.ServerUnreachable))},n.websocketTimeout);(null===i||void 0===i?void 0:i.aborted)&&r(),null===i||void 0===i||i.addEventListener("abort",r);const c=new URL(o);c.searchParams.has("access_token")&&c.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(c),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(o),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(s)},this.ws.onerror=e=>ei(this,void 0,void 0,function*(){if(this.state===la.CONNECTED)this.handleWSError(e);else{this.state=la.DISCONNECTED,clearTimeout(s);try{const n=yield fetch(a);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();t(new Pr(e,yr.NotAllowed,n.status))}else t(new Pr("Encountered unknown websocket error during connection: ".concat(e.toString()),yr.InternalError,n.status))}catch(n){t(new Pr(n instanceof Error?n.message:"server was not reachable",yr.ServerUnreachable))}}}),this.ws.onmessage=o=>ei(this,void 0,void 0,function*(){var a,s,c;let l;if("string"===typeof o.data){const e=JSON.parse(o.data);l=Yt.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(o.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof o.data),this.logContext);l=Yt.fromBinary(new Uint8Array(o.data))}if(this.state!==la.CONNECTED){let o=!1;if("join"===(null===(a=l.message)||void 0===a?void 0:a.case)?(this.state=la.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",r),this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),e(l.message.value)):this.state===la.RECONNECTING&&"leave"!==l.message.case?(this.state=la.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",r),this.startPingInterval(),"reconnect"===(null===(s=l.message)||void 0===s?void 0:s.case)?e(l.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),e(void 0),o=!0)):this.isEstablishingConnection&&"leave"===l.message.case?t(new Pr("Received leave request while trying to (re)connect",yr.LeaveRequest,void 0,l.message.value.reason)):n.reconnect||t(new Pr("did not receive join response, got ".concat(null===(c=l.message)||void 0===c?void 0:c.case," instead"),yr.InternalError)),!o)return}this.signalLatency&&(yield no(this.signalLatency)),this.handleSignalResponse(l)}),this.ws.onclose=e=>{this.isEstablishingConnection&&t(new Pr("Websocket got closed during a (re)connection attempt",yr.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{r()}}))}close(){return ei(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=la.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise(t=>{e.ws?e.ws.onclose=()=>{t()}:t()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,no(250)])),e.ws=void 0}}finally{t&&(e.state=la.DISCONNECTED),n()}}()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ha(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ha(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Zt({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new en({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return ei(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new fn({requestId:r,metadata:e,name:t,attributes:i})}),r}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new mn({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Rn({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:A.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Nn({timestamp:A.parse(Date.now()),rtt:A.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new dn({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new hn({reason:it.CLIENT_INITIATED,action:pn.DISCONNECT})})}sendRequest(e){return ei(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=ca.indexOf(e.case)>=0;return Jn.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===la.RECONNECTING)return void t.queuedRequests.push(()=>ei(t,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield no(t.signalLatency)),!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null===e||void 0===e?void 0:e.case),t.logContext);const r=new Jt({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(o){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:o}))}}()})}handleSignalResponse(e){var t,n;const i=e.message;if(void 0==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=ua(i.value);this.onAnswer&&this.onAnswer(e,i.value.id)}else if("offer"===i.case){const e=ua(i.value);this.onOffer&&this.onOffer(e,i.value.id)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):"roomMoved"===i.case?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return ei(this,void 0,void 0,function*(){if(this.state===la.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Br.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Br.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Br.setInterval(()=>{this.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Br.clearInterval(this.pingInterval)}}function ua(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function ha(e,t){return new an({sdp:e.sdp,type:e.type,id:t})}class pa{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0;){if(!(this.buffer[0].sequence<=e))break;this.pop()}}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class ma{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const i=n+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t){if(!(t.expiresAt<Date.now()))return t.value;this._map.delete(e)}}has(e){const t=this._map.get(e);return!!t&&(!(t.expiresAt<Date.now())||(this._map.delete(e),!1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[i,r]of n.entries())t.push(e(r,i,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var fa,ga,va,ba,ya,ka={},Ta={},Sa={exports:{}};function Ca(){if(fa)return Sa.exports;fa=1;var e=Sa.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),Sa.exports}function wa(){return ga||(ga=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))}(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=Ca(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}}),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}})})}}(Ta)),Ta}function Ea(){if(ba)return va;ba=1;var e=Ca(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return va=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var a=n.outerOrder||r,s=n.innerOrder||o,c=[];return a.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})}),t.media.forEach(function(t){c.push(i("m",e.m[0],t)),s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})})}),c.join("\r\n")+"\r\n"},va}var Pa=function(){if(ya)return ka;ya=1;var e=wa(),t=Ea(),n=Ca();return ka.grammar=n,ka.write=t,ka.parse=e.parse,ka.parseParams=e.parseParams,ka.parseFmtpConfig=e.parseFmtpConfig,ka.parsePayloads=e.parsePayloads,ka.parseRemoteCandidates=e.parseRemoteCandidates,ka.parseImageAttributes=e.parseImageAttributes,ka.parseSimulcastStreamList=e.parseSimulcastStreamList,ka}();function Ra(e,t,n){var i,r,o;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise(function(i,r){var c=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,l=Date.now(),!a){var i=e.apply(n,t);s&&s(i),d.forEach(function(e){return(0,e.resolve)(i)}),d=[]}},u()),c){var h=e.apply(n,t);return s&&s(h),i(h)}d.push({resolve:i,reject:r})})};return h.cancel=function(e){void 0!==o&&clearTimeout(o),d.forEach(function(t){return(0,t.reject)(e)}),d=[]},h}const Ia="negotiationStarted",Oa="negotiationComplete",xa="rtpVideoPayloadTypes";class _a extends oi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=Jn,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Ra(e=>ei(this,void 0,void 0,function*(){this.emit(Ia);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Yn(null!==(n=t.loggerName)&&void 0!==n?n:Gn.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new p}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return ei(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return ei(this,void 0,void 0,function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=Pa.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return r.media.forEach(e=>{var t;"audio"===e.type&&(e.rtp.some(e=>"opus"===e.codec&&(o=e.payload,!0)),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some(e=>e.payload===o&&"nack"===e.type))&&i.push(e.mid),e.fmtp.some(t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)))}),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=Pa.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach(e=>{"audio"===e.type&&this.trackBitrates.some(t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter(e=>!e.includes("maxaveragebitrate")).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0})}),i=Pa.write(t)}if(yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(e=>{this.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(Oa),e.sdp)){Pa.parse(e.sdp).media.forEach(e=>{"video"===e.type&&this.emit(xa,e.rtp)})}return!0})}createAndSendOffer(e){return ei(this,void 0,void 0,function*(){var t;const n=yield this.offerLock.lock();try{if(void 0===this.onOffer)return;if((null===e||void 0===e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null===e||void 0===e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=this.latestOfferId+1;this.latestOfferId=n;const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const r=Pa.parse(null!==(t=i.sdp)&&void 0!==t?t:"");if(r.media.forEach(e=>{Ma(e),"audio"===e.type?Da(e,[],[]):"video"===e.type&&this.trackBitrates.some(t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;if(oo(t.codec)&&this.ensureVideoDDExtensionForSVC(e,r),"av1"!==t.codec)return!0;const i=Math.round(.7*t.maxbr);for(const r of e.fmtp)if(r.payload===n){r.config.includes("x-google-start-bitrate")||(r.config+=";x-google-start-bitrate=".concat(i));break}return!0})}),this.latestOfferId>n)return void this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n}));yield this.setMungedSDP(i,Pa.write(r)),this.onOffer(i,this.latestOfferId)}finally{n()}})}createAndSetAnswer(){return ei(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),n=Pa.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach(e=>{Ma(e),"audio"===e.type&&Da(e,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Pa.write(n)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new xr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new xr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return ei(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach(e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}}),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0})}setMungedSDP(e,t,n){return ei(this,void 0,void 0,function*(){if(t){const r=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(i){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:i,sdp:t})),e.sdp=r}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let t="unknown error";i instanceof Error?t=i.message:"string"===typeof i&&(t=i);const r={error:t,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new _r(t)}})}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(e=>e.uri===to))){if(0===this.ddExtID){let e=0;t.media.forEach(t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach(t=>{t.value>e&&(e=t.value)}))}),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:to})}}}function Da(e,t,n){let i=0;e.rtp.some(e=>"opus"===e.codec&&(i=e.payload,!0)),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(e=>e.payload===i&&"nack"===e.type)&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)))}function Ma(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const Na="vp8",Aa={audioPreset:$r.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:eo.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Na,backupCodec:!0,preConnectBuffer:!1},La={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ua={deviceId:{ideal:"default"},resolution:Xr.h720.resolution},ja={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:Zn}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1},Fa={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ba;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Ba||(Ba={}));class Va{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=Fa.peerConnectionTimeout,this.log=Jn,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map(e=>e.getConnectionState());n.every(e=>"connected"===e)?this.state=Ba.CONNECTED:n.some(e=>"failed"===e)?this.state=Ba.FAILED:n.some(e=>"connecting"===e)?this.state=Ba.CONNECTING:n.every(e=>"closed"===e)?this.state=Ba.CLOSED:n.some(e=>"closed"===e)?this.state=Ba.CLOSING:n.every(e=>"new"===e)&&(this.state=Ba.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Ba[t]," to ").concat(Ba[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Yn(null!==(i=n.loggerName)&&void 0!==i?i:Gn.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new _a(e,n),this.subscriber=new _a(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Kt.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Kt.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=Ba.NEW,this.connectionLock=new p,this.remoteOfferLock=new p}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return ei(this,void 0,void 0,function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const t=this.publisher;for(const n of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(n)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return ei(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return ei(this,void 0,void 0,function*(){t===Kt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return ei(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{if(!(yield this.subscriber.setRemoteDescription(e,t)))return;return yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return ei(this,void 0,void 0,function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map(n=>this.ensureTransportConnected(n,e,t)))}finally{i()}})}negotiate(e){return ei(this,void 0,void 0,function*(){return new Promise((t,n)=>ei(this,void 0,void 0,function*(){const i=setTimeout(()=>{n("negotiation timed out")},this.peerConnectionTimeout);e.signal.addEventListener("abort",()=>{clearTimeout(i),n("negotiation aborted")}),this.publisher.once(Ia,()=>{e.signal.aborted||this.publisher.once(Oa,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(e=>{clearTimeout(i),n(e)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Kt.PUBLISHER||e===Kt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return ei(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise((e,r)=>ei(n,void 0,void 0,function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),Br.clearTimeout(o),r(new Pr("room connection has been cancelled",yr.Cancelled))};(null===t||void 0===t?void 0:t.signal.aborted)&&n(),null===t||void 0===t||t.signal.addEventListener("abort",n);const o=Br.setTimeout(()=>{null===t||void 0===t||t.signal.removeEventListener("abort",n),r(new Pr("could not establish pc connection",yr.InternalError))},i);for(;this.state!==Ba.CONNECTED;)if(yield no(50),null===t||void 0===t?void 0:t.signal.aborted)return void r(new Pr("room connection has been cancelled",yr.Cancelled));Br.clearTimeout(o),null===t||void 0===t||t.signal.removeEventListener("abort",n),e()}))}()})}}class qa extends Error{constructor(e,t,n){super(t),this.code=e,this.message=Ha(t,qa.MAX_MESSAGE_BYTES),this.data=n?Ha(n,qa.MAX_DATA_BYTES):void 0}static fromProto(e){return new qa(e.code,e.message,e.data)}toProto(){return new xt({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new qa(qa.ErrorCode[e],qa.ErrorMessage[e],t)}}qa.MAX_MESSAGE_BYTES=256,qa.MAX_DATA_BYTES=15360,qa.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},qa.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};function za(e){return(new TextEncoder).encode(e).length}function Ha(e,t){if(za(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(e.slice(0,o)).length<=t?n=o:i=o-1}return e.slice(0,n)}const Wa=2e3;function Ka(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}const Ga="undefined"!==typeof MediaRecorder;const Qa=Ga?MediaRecorder:class{constructor(){throw new Error("MediaRecorder is not available in this environment")}};class Ja extends Qa{constructor(e,t){if(!Ga)throw new Error("MediaRecorder is not available in this environment");let n,i;super(new MediaStream([e.mediaStreamTrack]),t);const r=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",o),null===i||void 0===i||i.close(),i=void 0},o=e=>{null===i||void 0===i||i.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",o),i=void 0};this.byteStream=new ReadableStream({start:e=>{i=e,n=t=>ei(this,void 0,void 0,function*(){const n=yield t.data.arrayBuffer();void 0!==i&&e.enqueue(new Uint8Array(n))}),this.addEventListener("dataavailable",n)},cancel:()=>{r()}}),this.addEventListener("stop",r),this.addEventListener("error",o)}}class Ya extends zr{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Ra(()=>ei(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>ei(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Er.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new p,this.pauseUpstreamLock=new p,this.processorLock=new p,this.restartLock=new p,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==zr.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return ei(this,void 0,void 0,function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let i;if(this._mediaStreamTrack&&(this.attachedElements.forEach(e=>{Wr(this._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){const t=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Hr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}finally{t()}}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(null!==i&&void 0!==i?i:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(t=>{Hr(null!==i&&void 0!==i?i:e,t)}))})}waitForDimensions(){return ei(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===zr.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Lr())||void 0===n?void 0:n.os)&&(yield no(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield no(50)}throw new Ir("unable to get track dimensions after timeout")}()})}setDeviceId(e){return ei(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===xo(e)||(this._constraints.deviceId=e,!!this.isMuted||(yield this.restartTrack(),xo(e)===this._mediaStreamTrack.getSettings().deviceId))})}getDeviceId(){return ei(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===zr.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===zr.Kind.Audio?"audioinput":"videoinput";return t?ra.getInstance().normalizeDeviceId(r,n,i):n}()})}mute(){return ei(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return ei(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return ei(this,void 0,void 0,function*(){if(!this.sender)throw new Ir("unable to replace an unpublished track");let n,i;return"boolean"===typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null===n||void 0===n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return ei(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const r={audio:!1,video:!1};this.kind===zr.Kind.Video?r.video=!t&&!n||{deviceId:t,facingMode:n}:r.audio=!t||{deviceId:t},this.attachedElements.forEach(e=>{Wr(this.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const o=(yield navigator.mediaDevices.getUserMedia(r)).getTracks()[0];return yield o.applyConstraints(i),o.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(o),this._constraints=e,this.emit(Er.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Er.Muted:Er.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ei(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),ho()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return ei(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(Er.UpstreamPaused,this);const t=Lr();if("Safari"===(null===t||void 0===t?void 0:t.name)&&yo(t.version,"12.0")<0)throw new Rr("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return ei(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(Er.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return ei(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()})}setProcessor(e){return ei(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const r=yield t.processorLock.lock();try{t.log.debug("setting up processor",t.logContext);const r=document.createElement(t.kind),o={kind:t.kind,track:t._mediaStreamTrack,element:r,audioContext:t.audioContext};if(yield e.init(o),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.stopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(Hr(t._mediaStreamTrack,r),r.muted=!0,r.play().catch(e=>t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e}))),t.processor=e,t.processorElement=r,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(Wr(t._mediaStreamTrack,e),Hr(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(Er.TrackProcessorUpdate,t.processor)}finally{r()}}()})}getProcessor(){return this.processor}stopProcessor(){return ei(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Er.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;Ga?this.localTrackRecorder?this.log.warn("preconnect buffer already started"):(this.localTrackRecorder=new Ja(this,{mimeType:"audio/webm;codecs=opus"}),this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},1e4)):this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}}class $a extends Ya{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,zr.Kind.Audio,t,n,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>ei(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(t){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:t}))}e&&this.prevStats&&(this._currentBitrate=Ka(e,this.prevStats)),this.prevStats=e}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Er.AudioTrackFeatureUpdate,this,at.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Er.AudioTrackFeatureUpdate,this,at.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return ei(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===zr.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return ei(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==xo(this._constraints.deviceId);return this.source!==zr.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return ei(this,void 0,void 0,function*(){let t;if(e){const n=Wo({audio:e});"boolean"!==typeof n.audio&&(t=n.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return ei(this,void 0,void 0,function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n})}startMonitor(){po()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Wa)))}setProcessor(e){return ei(this,void 0,void 0,function*(){var t;const n=yield this.processorLock.lock();try{if(!mo()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Er.TrackProcessorUpdate,this.processor)}finally{n()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return ei(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach(e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),t})}checkForSilence(){return ei(this,void 0,void 0,function*(){const e=yield Ko(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Er.AudioSilenceDetected)),e})}}const Xa=Object.values(Xr),Za=Object.values(Zr),es=Object.values(eo),ts=[Xr.h180,Xr.h360],ns=[Zr.h180,Zr.h360],is=["q","h","f"];function rs(e,t,n,i){var r,o;let a=null===i||void 0===i?void 0:i.videoEncoding;e&&(a=null===i||void 0===i?void 0:i.screenShareEncoding);const s=null===i||void 0===i?void 0:i.simulcast,c=null===i||void 0===i?void 0:i.scalabilityMode,l=null===i||void 0===i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const r=function(e,t,n){if(e)return es;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return Xa;return Za}(e,t,n);let{encoding:o}=r[0];const a=Math.max(t,n);for(let s=0;s<r.length;s+=1){const e=r[s];if(o=e.encoding,e.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}(e,t,n,l),Jn.debug("using video encoding",a));const d=a.maxFramerate,u=new Kr(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&oo(l)){const e=new cs(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Lr();if(lo()||mo()||"Chrome"===(null===n||void 0===n?void 0:n.name)&&yo(null===n||void 0===n?void 0:n.version,"113")<0){const i="h"==e.suffix?2:3,r=function(e){return e||(e=Lr()),"Safari"===(null===e||void 0===e?void 0:e.name)&&yo(e.version,"18.3")>0||"iOS"===(null===e||void 0===e?void 0:e.os)&&!!(null===e||void 0===e?void 0:e.osVersion)&&yo(e.osVersion,"18.3")>0}(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:is[2-n],maxBitrate:a.maxBitrate/Math.pow(i,n),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:r?Math.pow(2,n):void 0});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(t[0].priority=u.encoding.priority,t[0].networkPriority=u.encoding.priority),Jn.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let h,p=[];if(p=e?null!==(r=ss(null===i||void 0===i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:os(e,u):null!==(o=ss(null===i||void 0===i?void 0:i.videoSimulcastLayers))&&void 0!==o?o:os(e,u),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return as(t,n,[e,h,u],d);if(i>=480)return as(t,n,[e,u],d)}return as(t,n,[u])}function os(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map(e=>{var t,i;return new Kr(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)});var n;const{width:i,height:r}=t,o=i>r?i/r:r/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?ts:ns}function as(e,t,n,i){const r=[];if(n.forEach((n,o)=>{if(o>=is.length)return;const a=Math.min(e,t),s={rid:is[o],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);const l=so()||0===o;n.encoding.priority&&l&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),r.push(s)}),mo()&&"ios"===vo()){let e;r.forEach(t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate});let t=!0;r.forEach(n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,Jn.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Jn.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)})}return r}function ss(e){if(e)return e.sort((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0})}class cs{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class ls extends Ya{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,zr.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>ei(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(i){return void this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:i}))}const t=new Map(e.map(e=>[e.rid,e])),n=e.some(e=>"cpu"===e.qualityLimitationReason);if(n!==this.isCpuConstrained&&(this.isCpuConstrained=n,this.isCpuConstrained&&this.emit(Er.CpuConstrained)),this.prevStats){let e=0;t.forEach((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=Ka(t,r)}),this._currentBitrate=e}this.prevStats=t}),this.senderLock=new p}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!po())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Wa))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return ei(this,void 0,void 0,function*(){var t,n,i,r,o;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=ni(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(null)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return ei(this,void 0,void 0,function*(){var t,n,i,r,o;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=ni(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return ei(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==zr.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return ei(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==zr.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return ei(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach(e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),t.push(r)}}),t.sort((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)}),t})}setPublishingQuality(e){const t=[];for(let n=qr.LOW;n<=qr.HIGH;n+=1)t.push(new Cn({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(oo(this.codec),t)}restartTrack(e){return ei(this,void 0,void 0,function*(){var t,n,i,r,o;let a;if(e){const t=Wo({video:e});"boolean"!==typeof t.video&&(a=t.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var s,c=!0,l=ni(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);c=!0){r=s.value,c=!1;const e=r;e.sender&&"closed"!==(null===(o=e.sender.transport)||void 0===o?void 0:o.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(d){n={error:d}}finally{try{c||t||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return ei(this,arguments,void 0,function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,o,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var d,u=!0,h=ni(n.simulcastCodecs.values());!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(p){o={error:p}}finally{try{u||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}}()})}setDegradationPreference(e){return ei(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},5e3))}setPublishingCodecs(e){return ei(this,void 0,void 0,function*(){var t,n,i,r,o,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(oo(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=ni(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield ds(t.sender,t.encodings,e.qualities,this.senderLock,oo(e.codec),this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(oo(e.codec),e.qualities)}}catch(l){o={error:l}}finally{try{t||r||!(a=n.return)||(yield a.call(n))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e,t){return ei(this,void 0,void 0,function*(){this.optimizeForPerformance?this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t})):(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield ds(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext)))})}prioritizePerformance(){return ei(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const e=this.sender.getParameters();e.encodings=e.encodings.map((e,t)=>{var n;return Object.assign(Object.assign({},e),{active:0===t,scaleResolutionDownBy:Math.max(1,Math.ceil((null!==(n=this.mediaStreamTrack.getSettings().height)&&void 0!==n?n:360)/360)),scalabilityMode:0===t&&oo(this.codec)?"L1T3":void 0,maxFramerate:0===t?15:0,maxBitrate:0===t?e.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:e.encodings})),this.encodings=e.encodings,yield this.sender.setParameters(e)}catch(t){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:t})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ei(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),ho()&&this.isInBackground&&this.source===zr.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function ds(e,t,n,i,r,o,a){return ei(this,void 0,void 0,function*(){const s=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:s}=i;if(!s)return;if(s.length!==t.length)return void o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:s,senderEncodings:t}));let c=!1;if(!1&&s[0].scalabilityMode);else{if(r){const e=n.some(e=>e.enabled);e&&n.forEach(e=>e.enabled=!0)}s.forEach((e,i)=>{var r;let s=null!==(r=e.rid)&&void 0!==r?r:"";""===s&&(s="q");const l=us(s),d=n.find(e=>e.quality===l);d&&e.active!==d.enabled&&(c=!0,e.active=d.enabled,o.debug("setting layer ".concat(d.quality," to ").concat(e.active?"enabled":"disabled"),a),so()&&(d.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})}c&&(i.encodings=s,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:i.encodings})),yield e.setParameters(i))}finally{s()}})}function us(e){switch(e){case"f":default:return qr.HIGH;case"h":return qr.MEDIUM;case"q":return qr.LOW}}function hs(e,t,n,i){if(!n)return[new vt({quality:qr.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new cs(i),o=[],a="h"==r.suffix?1.5:2,s="h"==r.suffix?2:3;for(let c=0;c<r.spatial;c+=1)o.push(new vt({quality:Math.min(qr.HIGH,r.spatial-1)-c,width:Math.ceil(e/Math.pow(a,c)),height:Math.ceil(t/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,c)):0,ssrc:0}));return o}return n.map(n=>{var i,r,o;const a=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=us(null!==(r=n.rid)&&void 0!==r?r:"");return new vt({quality:s,width:Math.ceil(e/a),height:Math.ceil(t/a),bitrate:null!==(o=n.maxBitrate)&&void 0!==o?o:0,ssrc:0})})}const ps="_lossy",ms="_reliable",fs="leave-reconnect";var gs;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(gs||(gs={}));class vs extends oi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Fa.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=gs.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Jn,this.reliableDataSequence=1,this.reliableMessageBuffer=new pa,this.reliableReceivedState=new ma(3e4),this.handleDataChannel=e=>ei(this,[e],void 0,function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===ms)t.reliableDCSub=n;else{if(n.label!==ps)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()}),this.handleDataMessage=e=>ei(this,void 0,void 0,function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=bt.fromBinary(new Uint8Array(i));if(r.sequence>0&&""!==r.participantSid){const e=this.reliableReceivedState.get(r.participantSid);if(e&&r.sequence<=e)return;this.reliableReceivedState.set(r.participantSid,r.sequence)}"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(wr.ActiveSpeakersUpdate,r.value.value.speakers):("user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(r,r.value.value),this.emit(wr.DataPacketReceived,r))}finally{i()}}),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?yt.LOSSY:yt.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(wr.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let r=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==r?(e===fs&&(r=0),this.log.debug("reconnecting in ".concat(r,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Br.setTimeout(()=>this.attemptReconnect(t).finally(()=>this.reconnectTimeout=void 0),r)):n(i)},this.waitForRestarted=()=>new Promise((e,t)=>{this.pcState===gs.Connected&&e();const n=()=>{this.off(wr.Disconnected,i),e()},i=()=>{this.off(wr.Restarted,n),t()};this.once(wr.Restarted,n),this.once(wr.Disconnected,i)}),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);"undefined"!==typeof t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(wr.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===yt.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===la.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(rt.RR_SIGNAL_DISCONNECTED))},this.log=Yn(null!==(t=e.loggerName)&&void 0!==t?t:Gn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new da(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new p,this.dataProcessLock=new p,this.dcBufferStatus=new Map([[yt.LOSSY,!0],[yt.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(wr.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(wr.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(wr.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(wr.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(wr.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(wr.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(wr.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(wr.SignalRequestResponse,e)}get logContext(){var e,t,n,i,r,o;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(o=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===o?void 0:o.identity,pID:this.participantSid}}join(e,t,n,i){return ei(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary&&!r.fastPublish||this.negotiate(),this.clientConfiguration=r.clientConfiguration,this.emit(wr.SignalConnected,r),r}catch(r){if(r instanceof Pr&&r.reason===yr.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw r}})}close(){return ei(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(wr.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return ei(this,void 0,void 0,function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new pa,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return ei(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ir("a track with the same ID has already been published");return new Promise((t,n)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],n(new Pr("publication of local track timed out, no response from server",yr.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return ei(this,void 0,void 0,function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return ei(this,void 0,void 0,function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==Ba.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);var r;this.pcManager=new Va(i,e.subscriberPrimary,this.loggerOptions),this.emit(wr.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>ei(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===Ba.CONNECTED){const t=this.pcState===gs.New;this.pcState=gs.Connected,t&&this.emit(wr.Connected,e)}else t===Ba.FAILED&&this.pcState===gs.Connected&&(this.pcState=gs.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?rt.RR_SUBSCRIBER_FAILED:rt.RR_PUBLISHER_FAILED));const r=this.client.isDisconnected||this.client.currentState===la.RECONNECTING,o=[Ba.FAILED,Ba.CLOSING,Ba.CLOSED].includes(t);r&&o&&!this._isClosed&&this.emit(wr.Offline)}),this.pcManager.onTrack=e=>{this.emit(wr.MediaTrackAdded,e.track,e.streams[0],e.receiver)},void 0!==(r=null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)&&r>13||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>ei(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>ei(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);n&&this.client.sendAnswer(n,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(wr.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(wr.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(wr.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(wr.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(wr.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",rt.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null===e||void 0===e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case pn.DISCONNECT:this.emit(wr.Disconnected,null===e||void 0===e?void 0:e.reason),this.close();break;case pn.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(fs);break;case pn.RESUME:this.handleDisconnect(fs)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach(e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)}),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===nt.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(ps,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(ms,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return ei(this,void 0,void 0,function*(){if(io()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(ro()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new xr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,n,i){return ei(this,void 0,void 0,function*(){if(io())return this.createSimulcastTransceiverSender(e,t,n,i);if(ro())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new xr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,n){return ei(this,void 0,void 0,function*(){if(!this.pcManager)throw new xr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Uo(e)&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);return(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(e,t,n,i){return ei(this,void 0,void 0,function*(){if(!this.pcManager)throw new xr("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return ei(this,void 0,void 0,function*(){if(!this.pcManager)throw new xr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return ei(this,void 0,void 0,function*(){var t,n,i;if(!this._isClosed)if(this.attemptingReconnect)Jn.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==nt.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:Ba.NEW)!==Ba.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let e=!0;r instanceof xr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),e=!1):r instanceof bs||(this.fullReconnectOnNext=!0),e?this.handleDisconnect("reconnect",rt.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(wr.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return ei(this,void 0,void 0,function*(){var t,n,i;try{if(!this.url||!this.token)throw new xr("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(wr.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new bs;n=yield this.join(null!==e&&void 0!==e?e:this.url,this.token,this.signalOpts)}catch(r){if(r instanceof Pr&&r.reason===yr.NotAllowed)throw new xr("could not reconnect, token might be expired");throw new bs}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(wr.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==la.CONNECTED)throw new bs("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(wr.Restarted)}catch(o){const e=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(e)return void(yield this.restartConnection(e));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),o}})}resumeConnection(e){return ei(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new xr("could not reconnect, url or token not saved");if(!this.pcManager)throw new xr("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(wr.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let e="";if(i instanceof Error&&(e=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof Pr&&i.reason===yr.NotAllowed)throw new xr("could not reconnect, token might be expired");if(i instanceof Pr&&i.reason===yr.LeaveRequest)throw i;throw new bs(e)}if(this.emit(wr.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=n.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==la.CONNECTED)throw new bs("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),(null===n||void 0===n?void 0:n.lastMessageSeq)&&this.resendReliableMessagesForResume(n.lastMessageSeq),this.emit(wr.Resumed)})}waitForPCInitialConnection(e,t){return ei(this,void 0,void 0,function*(){if(!this.pcManager)throw new xr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return ei(this,void 0,void 0,function*(){this.pcState=gs.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield no(2e3),!this.pcManager)throw new xr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=gs.Connected}catch(e){throw this.pcState=gs.Disconnected,new Pr("could not establish PC connection, ".concat(e.message),yr.InternalError)}})}publishRpcResponse(e,t,n,i){return ei(this,void 0,void 0,function*(){const r=new bt({destinationIdentities:[e],kind:yt.RELIABLE,value:{case:"rpcResponse",value:new Ot({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!==n&&void 0!==n?n:""}})}});yield this.sendDataPacket(r,yt.RELIABLE)})}publishRpcAck(e,t){return ei(this,void 0,void 0,function*(){const n=new bt({destinationIdentities:[e],kind:yt.RELIABLE,value:{case:"rpcAck",value:new It({requestId:t})}});yield this.sendDataPacket(n,yt.RELIABLE)})}sendDataPacket(e,t){return ei(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(t),t===yt.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===yt.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;i.send(n)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return ei(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(yt.RELIABLE);const t=this.dataChannelForKind(yt.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(e=>{t.send(e.data)})),this.updateAndEmitDCBufferStatus(yt.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,n)=>ei(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>n("Engine closed");for(this.once(wr.Closing,i);!this.dcBufferStatus.get(e);)yield no(10);this.off(wr.Closing,i),t()}}))}ensureDataTransportConnected(e){return ei(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new xr("PC manager is closed");const r=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher";if(!r)throw new Pr("".concat(o," connection not set"),yr.InternalError);let a=!1;n||t.dataChannelForKind(e,n)||(t.createDataChannels(),a=!0),a||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(a=!0),a&&t.negotiate();const s=t.dataChannelForKind(e,n);if("open"===(null===s||void 0===s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(r.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield no(50)}throw new Pr("could not establish ".concat(o," connection, state: ").concat(r.getICEConnectionState()),yr.InternalError)}()})}ensurePublisherConnected(e){return ei(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===Ba.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return ei(this,void 0,void 0,function*(){return new Promise((e,t)=>ei(this,void 0,void 0,function*(){if(!this.pcManager)return void t(new _r("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(wr.Closing,i),this.pcManager.publisher.once(xa,e=>{const t=new Map;e.forEach(e=>{const n=e.codec.toLowerCase();var i;i=n,Qr.includes(i)&&t.set(e.payload,n)}),this.emit(wr.RTPVideoMapUpdate,t)});try{yield this.pcManager.negotiate(n),e()}catch(r){r instanceof _r&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",rt.RR_UNKNOWN),t(r)}finally{this.off(wr.Closing,i)}}))})}dataChannelForKind(e,t){if(t){if(e===yt.LOSSY)return this.lossyDCSub;if(e===yt.RELIABLE)return this.reliableDCSub}else{if(e===yt.LOSSY)return this.lossyDC;if(e===yt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach(e=>{e.isDesired!==a&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)}),this.client.sendSyncState(new xn({answer:r?ha({sdp:r.sdp,type:r.type}):void 0,offer:o?ha({sdp:o.sdp,type:o.type}):void 0,subscription:new cn({trackSids:s,subscribe:!a,participantTracks:[]}),publishTracks:Xo(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c,datachannelReceiveStates:this.reliableReceivedState.map((e,t)=>new _n({publisherSid:t,lastSeq:e}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null===t||void 0===t?void 0:t.id)&&null!==t.id&&e.push(new Dn({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(yt.LOSSY),Kt.PUBLISHER),t(this.dataChannelForKind(yt.RELIABLE),Kt.PUBLISHER),t(this.dataChannelForKind(yt.LOSSY,!0),Kt.SUBSCRIBER),t(this.dataChannelForKind(yt.RELIABLE,!0),Kt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Br.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){po()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){po()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class bs extends Error{}class ys{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return fo(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return ei(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(t=>t.url===e.url));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),Jn.debug("next region: ".concat(e.region)),e.url}return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return ei(this,void 0,void 0,function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new Pr("Could not fetch region settings: ".concat(t.statusText),401===t.status?yr.NotAllowed:yr.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class ks{get info(){return this._info}constructor(e,t,n){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0}}class Ts extends ks{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength;const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>ei(this,void 0,void 0,function*(){try{const{done:t,value:n}=yield e.read();return t?{done:!0,value:void 0}:(this.handleChunkReceived(n),{done:!1,value:n.content})}catch(t){return{done:!0,value:void 0}}}),return(){return ei(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return ei(this,void 0,void 0,function*(){var e,t,n,i;let r=new Set;try{for(var o,a=!0,s=ni(this);!(e=(o=yield s.next()).done);a=!0){i=o.value,a=!1;const e=i;r.add(e)}}catch(c){t={error:c}}finally{try{a||e||!(n=s.return)||(yield n.call(s))}finally{if(t)throw t.error}}return Array.from(r)})}}class Ss extends ks{constructor(e,t,n){super(e,t,n),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=Mo(e.chunkIndex),i=this.receivedChunks.get(n);if(i&&i.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder;return{next:()=>ei(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:t.decode(i.content)})}catch(n){return{done:!0,value:void 0}}}),return(){return ei(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return ei(this,void 0,void 0,function*(){var e,t,n,i;let r="";try{for(var o,a=!0,s=ni(this);!(e=(o=yield s.next()).done);a=!0){i=o.value,a=!1;r+=i}}catch(c){t={error:c}}finally{try{a||e||!(n=s.return)||(yield n.call(s))}finally{if(t)throw t.error}}return r})}}class Cs{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return ei(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)})}}class ws extends Cs{}class Es extends Cs{}class Ps extends zr{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Er.Muted:Er.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Er.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return ei(this,void 0,void 0,function*(){var e;if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Wa)),"undefined"!==typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(Er.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class Rs extends Ps{constructor(e,t,n,i,r,o){super(e,t,zr.Kind.Audio,n,o),this.monitorReceiver=()=>ei(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Ka(e,this.prevStats)),this.prevStats=e}),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;mo()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(mo())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return ei(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(ao(t))return t.setSinkId(e)}))})}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&ao(e)&&e.setSinkId(this.sinkId).catch(e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach(e=>{n.connect(e),n=e}),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then(()=>{"running"!==e.state&&this.emit(Er.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(e=>{this.emit(Er.AudioPlaybackFailed,e)})}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return ei(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach(t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})}),e})}}class Is extends Ps{constructor(e,t,n,i,r){super(e,t,zr.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>ei(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Ka(e,this.prevStats)),this.prevStats=e}),this.debouncedHandleResize=Ra(()=>{this.updateDimensions()},100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Wr(this._mediaStreamTrack,t):Hr(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t.element===e)){const t=new Os(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t===e)?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter(t=>t===e);for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter(t=>t!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return ei(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach(e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)}),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(t=>t.element===e);for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ei(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const n=this.elementInfos.reduce((e,t)=>Math.max(e,t.visibilityChangedAt||0),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some(e=>e.pictureInPicture),o=this.elementInfos.some(e=>e.visible)&&!i||r;this.lastVisible!==o&&(!o&&Date.now()-n<100?Br.setTimeout(()=>{this.updateVisibility()},100):(this.lastVisible=o,this.emit(Er.VisibilityChanged,o,this)))}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const o of this.elementInfos){const e=o.width()*r,t=o.height()*r;e+t>n+i&&(n=e,i=t)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(Er.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return bo();if(!t){return bo()>2?2:1}return t}}class Os{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=xs(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=xs(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=xs(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!==t&&void 0!==t?t:_s(e),this.isPiP=po()&&xs(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=_s(this.element),this.isPiP=xs(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Eo().observe(this.element),Co().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=Eo())||void 0===e||e.unobserve(this.element),null===(t=Co())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function xs(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&_s(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function _s(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const o=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!s&&"none"!==c}class Ds extends oi.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=mt.NONE,this.log=Jn,this.handleMuted=()=>{this.emit(Er.Muted)},this.handleUnmuted=()=>{this.emit(Er.Unmuted)},this.log=Yn(null!==(r=null===i||void 0===i?void 0:i.loggerName)&&void 0!==r?r:Gn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=zr.Source.Unknown}setTrack(e){this.track&&(this.track.off(Er.Muted,this.handleMuted),this.track.off(Er.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Er.Muted,this.handleMuted),e.on(Er.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Zo(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==mt.NONE}get audioTrack(){if(Lo(this.track))return this.track}get videoTrack(){if(Uo(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=zr.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===zr.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(Ds||(Ds={}));class Ms extends Ds{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Er.Ended)},this.handleCpuConstrained=()=>{this.track&&Uo(this.track)&&this.emit(Er.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&(this.track.off(Er.Ended,this.handleTrackEnded),this.track.off(Er.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Er.Ended,this.handleTrackEnded),e.on(Er.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return ei(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()})}unmute(){return ei(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()})}pauseUpstream(){return ei(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()})}resumeUpstream(){return ei(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Lo(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(at.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(at.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(at.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(at.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(at.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(at.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function Ns(e,t){return ei(this,void 0,void 0,function*(){null!==e&&void 0!==e||(e={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=ea(e);let a=o.audio,s=o.video;if(i&&"object"===typeof o.audio&&(o.audio.processor=i),r&&"object"===typeof o.video&&(o.video.processor=r),e.audio&&"object"===typeof o.audio&&"string"===typeof o.audio.deviceId){const e=o.audio.deviceId;o.audio.deviceId={exact:e},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:e}})}if(o.video&&"object"===typeof o.video&&"string"===typeof o.video.deviceId){const e=o.video.deviceId;o.video.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},o.video),{deviceId:{ideal:e}})}(!0===o.audio||"object"===typeof o.audio&&!o.audio.deviceId)&&(o.audio={deviceId:"default"}),!0===o.video?o.video={deviceId:"default"}:"object"!==typeof o.video||o.video.deviceId||(o.video.deviceId="default");const c=zo(o,La,Ua),l=Wo(c),d=navigator.mediaDevices.getUserMedia(l);o.audio&&(ra.userMediaPromiseMap.set("audioinput",d),d.catch(()=>ra.userMediaPromiseMap.delete("audioinput"))),o.video&&(ra.userMediaPromiseMap.set("videoinput",d),d.catch(()=>ra.userMediaPromiseMap.delete("videoinput")));try{const e=yield d;return yield Promise.all(e.getTracks().map(n=>ei(this,void 0,void 0,function*(){const o="audio"===n.kind;let a,s=o?c.audio:c.video;"boolean"!==typeof s&&s||(s={});const d=o?l.audio:l.video;"boolean"!==typeof d&&(a=d);const u=n.getSettings().deviceId;(null===a||void 0===a?void 0:a.deviceId)&&xo(a.deviceId)!==u?a.deviceId=u:a||(a={deviceId:u});const h=function(e,t,n){switch(e.kind){case"audio":return new $a(e,t,!1,void 0,n);case"video":return new ls(e,t,!1,n);default:throw new Ir("unsupported track type: ".concat(e.kind))}}(n,a,t);return h.kind===zr.Kind.Video?h.source=zr.Source.Camera:h.kind===zr.Kind.Audio&&(h.source=zr.Source.Microphone),h.mediaStream=e,Lo(h)&&i?yield h.setProcessor(i):Uo(h)&&r&&(yield h.setProcessor(r)),h})))}catch(u){if(!n)throw u;return Ns(Object.assign(Object.assign({},e),{audio:a,video:s}),t)}})}var As;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(As||(As={}));class Ls extends oi.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===ht.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===ut.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ht.STANDARD;var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=As.Unknown,this.log=Jn,this.log=Yn(null!==(s=null===o||void 0===o?void 0:o.loggerName)&&void 0!==s?s:Gn.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=null!==r&&void 0!==r?r:{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new Oo,this.once(Cr.Active,()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0})),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(zr.Source.Camera);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(zr.Source.Microphone);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(zr.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){var t;return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===ut.ACTIVE&&(null===(t=this.participantInfo)||void 0===t?void 0:t.state)!==ut.ACTIVE&&this.emit(Cr.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(Cr.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(Cr.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const o of i)e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"");return r}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(Cr.AttributesChanged,t)}setPermissions(e){var t,n,i,r,o,a;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])})||e.canSubscribeMetrics!==(null===(a=this.permissions)||void 0===a?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(Cr.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Cr.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case tt.EXCELLENT:return As.Excellent;case tt.GOOD:return As.Good;case tt.POOR:return As.Poor;case tt.LOST:return As.Lost;default:return As.Unknown}}(e),t!==this._connectionQuality&&this.emit(Cr.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>Lo(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Er.Muted,()=>{this.emit(Cr.TrackMuted,e)}),e.on(Er.Unmuted,()=>{this.emit(Cr.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case zr.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case zr.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class Us extends Ls{constructor(e,t,n,i,r){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=mt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Oo)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var e,t,n,i,r,o;this.reconnectFuture&&(this.reconnectFuture.promise.catch(e=>this.log.warn(e.message,this.logContext)),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(i=(n=this.signalConnectedFuture).reject)||void 0===i||i.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(o=null===(r=this.activeAgentFuture)||void 0===r?void 0:r.reject)||void 0===o||o.call(r,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Oo),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==Bn.OK&&r.reject(new Mr(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,i=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(i=qa.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,i);break;case"rpcAck":let r=e.value.value;this.handleIncomingRpcAck(r.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Pn({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e)))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Zo(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Zo(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Zo(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.onTrackCpuConstrained=(e,t)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Zo(t))),this.emit(Cr.LocalTrackCpuConstrained,e,t)},this.handleSubscribedQualityUpdate=e=>ei(this,void 0,void 0,function*(){var t,n,i,r,o;if(!(null===(o=this.roomOptions)||void 0===o?void 0:o.dynacast))return;const a=this.videoTrackPublications.get(e.trackSid);if(!a)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!a.videoTrack)return;const s=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,d=ni(s);!(t=(c=yield d.next()).done);l=!0){r=c.value,l=!1;const e=r;Jr(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Zo(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(u){n={error:u}}finally{try{l||t||!(i=d.return)||(yield i.call(d))}finally{if(n)throw n.error}}}),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>ei(this,void 0,void 0,function*(){if(e.source===zr.Source.ScreenShare||e.source===zr.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Zo(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(Fo(e)||jo(e))try{if(po())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===zr.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Zo(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(t){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Zo(e))),Fo(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Zo(e))),yield e.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==mt.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(wr.RemoteMute,(e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())}),this.engine.on(wr.Connected,this.handleReconnected).on(wr.SignalConnected,this.handleSignalConnected).on(wr.SignalRestarted,this.handleReconnected).on(wr.SignalResumed,this.handleReconnected).on(wr.Restarting,this.handleReconnecting).on(wr.Resuming,this.handleReconnecting).on(wr.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(wr.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(wr.Disconnected,this.handleDisconnected).on(wr.SignalRequestResponse,this.handleSignalRequestResponse).on(wr.DataPacketReceived,this.handleDataPacket),this.signalConnectedFuture=void 0}setMetadata(e){return ei(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return ei(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return ei(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return ei(this,arguments,void 0,function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise((e,o)=>ei(t,void 0,void 0,function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!==n&&void 0!==n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!==i&&void 0!==i?i:this.name)&&void 0!==a?a:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{o(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every(e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]})))return this.pendingSignalRequests.delete(c),void e();yield no(50)}o(new Mr("Request to update local metadata timed out","TimeoutError"))}catch(s){s instanceof Error&&o(s)}}))}()})}setCameraEnabled(e,t,n){return this.setTrackEnabled(zr.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(zr.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(zr.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(Cr.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return ei(this,void 0,void 0,function*(){this.encryptionType=e?mt.GCM:mt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,n,i){return ei(this,void 0,void 0,function*(){var r,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(t)if(a)yield a.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null===t||void 0===t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case zr.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case zr.Source.Microphone:t=yield this.createTracks({audio:null===(o=n)||void 0===o||o});break;case zr.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new Ir(e)}}catch(s){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),s instanceof Error&&this.emit(Cr.MediaDevicesError,s,Jo(e)),this.pendingPublishing.delete(e),s}for(const n of t)e===zr.Source.Microphone&&Lo(n)&&(null===i||void 0===i?void 0:i.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),n.startPreConnectBuffer());try{const e=[];for(const r of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Zo(r))),e.push(this.publishTrack(r,i));const n=yield Promise.all(e);[a]=n}catch(s){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),s}finally{this.pendingPublishing.delete(e)}}else if(!(null===a||void 0===a?void 0:a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===zr.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const e=this.getTrackPublication(zr.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return ei(this,void 0,void 0,function*(){if(!this.pendingPublishing.has(zr.Source.Camera)&&!this.pendingPublishing.has(zr.Source.Microphone)){this.pendingPublishing.add(zr.Source.Camera),this.pendingPublishing.add(zr.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(e=>this.publishTrack(e)))}finally{this.pendingPublishing.delete(zr.Source.Camera),this.pendingPublishing.delete(zr.Source.Microphone)}}})}createTracks(e){return ei(this,void 0,void 0,function*(){var t,n;null!==e&&void 0!==e||(e={});const i=zo(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults);try{const e=yield Ns(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return e.map(e=>(Lo(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=zr.Source.Microphone,this.emit(Cr.AudioStreamAcquired)),Uo(e)&&(this.cameraError=void 0,e.source=zr.Source.Camera),e))}catch(r){throw r instanceof Error&&(e.audio&&(this.microphoneError=r),e.video&&(this.cameraError=r)),r}})}createScreenTracks(e){return ei(this,void 0,void 0,function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new Rr("getDisplayMedia not supported");void 0!==e.resolution||uo()||(e.resolution=eo.h1080fps30.resolution);const t=Yo(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Ir("no video track found");const r=new ls(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=zr.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const o=[r];if(n.getAudioTracks().length>0){this.emit(Cr.AudioStreamAcquired);const e=new $a(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=zr.Source.ScreenShareAudio,o.push(e)}return o})}publishTrack(e,t){return ei(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return ei(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s;let c,l;if(Fo(e)&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),Ao(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case zr.Source.Microphone:t="audioinput";break;case zr.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new $a(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new ls(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Ir("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach(t=>{t.track&&t.track===e&&(l=t)}),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),Zo(l))),l;const d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,u=null!==(o=null===t||void 0===t?void 0:t.forceStereo)&&void 0!==o?o:d;u&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),Zo(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=t.dtx)&&void 0!==a||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=Lr(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&yo(t,e.osVersion)>=0)||"Safari"===e.name&&yo(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise((t,i)=>ei(n,void 0,void 0,function*(){try{if(this.engine.client.currentState!==la.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Zo(e)}));const n=setTimeout(()=>{i(new Dr("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const r=yield this.publish(e,h,u);t(r)}else try{const n=yield this.publish(e,h,u);t(n)}catch(n){i(n)}}catch(n){i(n)}}));n.pendingPublishPromises.set(e,p);try{return yield p}catch(m){throw m}finally{n.pendingPublishPromises.delete(e)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Oo),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Zo(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map(e=>function(e){switch(e){case Ze.CAMERA:return zr.Source.Camera;case Ze.MICROPHONE:return zr.Source.Microphone;case Ze.SCREEN_SHARE:return zr.Source.ScreenShare;case Ze.SCREEN_SHARE_AUDIO:return zr.Source.ScreenShareAudio;default:return zr.Source.Unknown}}(e)).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Zo(e))),!1)}publish(e,t,n){return ei(this,void 0,void 0,function*(){var i,r,o,a,s,c,l,d,u,h;if(!this.hasPermissionsToPublish(e))throw new Dr("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(t=>Ao(e)&&t.source===e.source)&&e.source!==zr.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Zo(e))),t.stopMicTrackOnMute&&Lo(e)&&(e.stopOnMute=!0),e.source===zr.Source.ScreenShare&&so()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(co())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(so())return!1;if(co()){const e=Lr();if((null===e||void 0===e?void 0:e.version)&&yo(e.version,"16")<0)return!1;if("iOS"===(null===e||void 0===e?void 0:e.os)&&(null===e||void 0===e?void 0:e.osVersion)&&yo(e.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=Na),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(e=>t.videoCodec===$o(e.mime))||(t.videoCodec=$o(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(Er.Muted,this.onTrackMuted),e.on(Er.Unmuted,this.onTrackUnmuted),e.on(Er.Ended,this.handleTrackEnded),e.on(Er.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Er.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Er.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const m=[],f=!(null===(i=t.dtx)||void 0===i||i),g=e.getSourceTrackSettings();g.autoGainControl&&m.push(at.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&m.push(at.TF_ECHO_CANCELLATION),g.noiseSuppression&&m.push(at.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&m.push(at.TF_STEREO),f&&m.push(at.TF_NO_DTX),Fo(e)&&e.hasPreConnectBuffer&&m.push(at.TF_PRECONNECT_BUFFER);const v=new Xt({cid:e.mediaStreamTrack.id,name:t.name,type:zr.kindToProto(e.kind),muted:e.isMuted,source:zr.sourceToProto(e.source),disableDtx:f,encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null===t||void 0===t?void 0:t.stream,backupCodecPolicy:null===t||void 0===t?void 0:t.backupCodecPolicy,audioFeatures:m});let b;if(e.kind===zr.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(C){const t=null!==(a=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==a?a:Xr.h720.resolution;n={width:t.width,height:t.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Zo(e)),{dims:n}))}v.width=n.width,v.height=n.height,jo(e)&&(oo(p)&&(e.source===zr.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Zo(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),v.simulcastCodecs=[new $t({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:Na}),t.backupCodec&&p!==t.backupCodec.codec&&v.encryption===mt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new $t({codec:t.backupCodec.codec,cid:""})))),b=rs(e.source===zr.Source.ScreenShare,v.width,v.height,t),v.layers=hs(v.width,v.height,b,oo(t.videoCodec))}else e.kind===zr.Kind.Audio&&(b=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(d=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==d?d:"high",networkPriority:null!==(h=null===(u=t.audioPreset)||void 0===u?void 0:u.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new xr("cannot publish track when not connected");const y=()=>ei(this,void 0,void 0,function*(){var n,i,r;if(!this.engine.pcManager)throw new xr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,b),this.emit(Cr.LocalSenderCreated,e.sender,e),jo(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===zr.Source.ScreenShare||e.constraints.height&&xo(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),b)if(so()&&e.kind===zr.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(i=b[0])||void 0===i?void 0:i.maxBitrate)?b[0].maxBitrate/1e3:0})}else e.codec&&oo(e.codec)&&(null===(r=b[0])||void 0===r?void 0:r.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;const T=new Promise((t,n)=>ei(this,void 0,void 0,function*(){var i;try{k=yield this.engine.addTrack(v),t(k)}catch(r){e.sender&&(null===(i=this.engine.pcManager)||void 0===i?void 0:i.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(t=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Zo(e)),{error:t}))})),n(r)}}));if(this.enabledPublishVideoCodecs.length>0){const e=yield Promise.all([T,y()]);k=e[0]}else{let n;if(k=yield T,k.codecs.forEach(e=>{void 0===n&&(n=e.mimeType)}),n&&e.kind===zr.Kind.Video){const i=$o(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Zo(e)),{codec:i})),t.videoCodec=i,b=rs(e.source===zr.Source.ScreenShare,v.width,v.height,t))}yield y()}const S=new Ms(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(S.on(Er.CpuConstrained,e=>this.onTrackCpuConstrained(e,S)),S.options=t,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),jo(e)?e.startMonitor(this.engine.client):Fo(e)&&e.startMonitor(),this.addTrackPublication(S),this.emit(Cr.LocalTrackPublished,S),Fo(e)&&k.audioFeatures.includes(at.TF_PRECONNECT_BUFFER)){const t=e.getPreConnectBuffer();if(this.on(Cr.LocalTrackSubscribed,t=>{if(t.trackSid===k.sid){if(!e.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Zo(e))),e.stopPreConnectBuffer()}}),t){const n=new Promise((n,i)=>ei(this,void 0,void 0,function*(){var r,o,a,s,c,l;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Zo(e)));const m=setTimeout(()=>{i(new Error("agent not active within 10 seconds"))},1e4),f=yield this.waitUntilActiveAgentPresent();clearTimeout(m),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Zo(e)));const v=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[f.identity],attributes:{trackId:S.trackSid,sampleRate:String(null!==(c=g.sampleRate)&&void 0!==c?c:"48000"),channels:String(null!==(l=g.channelCount)&&void 0!==l?l:"1")}});try{for(var d,u=!0,h=ni(t);!(r=(d=yield h.next()).done);u=!0){s=d.value,u=!1;const e=s;yield v.write(e)}}catch(p){o={error:p}}finally{try{u||r||!(a=h.return)||(yield a.call(h))}finally{if(o)throw o.error}}yield v.close(),n()}catch(C){i(C)}}));n.then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Zo(e)))}).catch(t=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Zo(e)),{error:t}))})}}return S})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return ei(this,void 0,void 0,function*(){var i;if(this.encryptionType!==mt.NONE)return;let r;if(this.trackPublications.forEach(t=>{t.track&&t.track===e&&(r=t)}),!r)throw new Ir("track is not published");if(!jo(e))throw new Ir("track is not a video track");const o=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,r,o,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&Jn.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(o=s.height)&&void 0!==o?o:null===(a=e.dimensions)||void 0===a?void 0:a.height;return e.source===zr.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),rs(e.source===zr.Source.ScreenShare,c,l,n)}(e,t,o);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Zo(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new Xt({cid:s.mediaStreamTrack.id,type:zr.kindToProto(e.kind),muted:e.isMuted,source:zr.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=hs(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new xr("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>ei(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,s,o,a),yield this.engine.negotiate()}))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))})}unpublishTrack(e,t){return ei(this,void 0,void 0,function*(){var n,i;if(Ao(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Zo(e))),yield t)}const r=this.getPublicationForTrack(e),o=r?Zo(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(e=r.track).off(Er.Muted,this.onTrackMuted),e.off(Er.Unmuted,this.onTrackUnmuted),e.off(Er.Ended,this.handleTrackEnded),e.off(Er.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Er.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Er.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t?e.stop():e.stopMonitor();let a=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ba.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",a=!0);if(this.engine.removeTrack(s)&&(a=!0),jo(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(a=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case zr.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case zr.Kind.Video:this.videoTrackPublications.delete(r.trackSid)}return this.emit(Cr.LocalTrackUnpublished,r),r.setTrack(void 0),a&&(yield this.engine.negotiate()),r})}unpublishTracks(e){return ei(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>this.unpublishTrack(e)))).filter(e=>!!e)})}republishAllTracks(e){return ei(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise((i,r)=>ei(t,void 0,void 0,function*(){try{const t=[];this.trackPublications.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))}),yield Promise.all(t.map(e=>ei(this,void 0,void 0,function*(){const t=e.track;yield this.unpublishTrack(t,!1),!n||t.isMuted||t.source===zr.Source.ScreenShare||t.source===zr.Source.ScreenShareAudio||!Fo(t)&&!jo(t)||t.isUserProvided||(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))),i()}catch(t){r(t)}finally{this.republishPromise=void 0}})),yield t.republishPromise}()})}publishData(e){return ei(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?yt.RELIABLE:yt.LOSSY,r=n.destinationIdentities,o=n.topic,a=new bt({kind:i,value:{case:"user",value:new St({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:o})}});yield t.engine.sendDataPacket(a,i)}()})}publishDtmf(e,t){return ei(this,void 0,void 0,function*(){const n=new bt({kind:yt.RELIABLE,value:{case:"sipDtmf",value:new Ct({code:e,digit:t})}});yield this.engine.sendDataPacket(n,yt.RELIABLE)})}sendChatMessage(e,t){return ei(this,void 0,void 0,function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null===t||void 0===t?void 0:t.attachments},i=new bt({value:{case:"chatMessage",value:new Pt(Object.assign(Object.assign({},n),{timestamp:A.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(i,yt.RELIABLE),this.emit(Cr.ChatMessage,n),n})}editChatMessage(e,t){return ei(this,void 0,void 0,function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new bt({value:{case:"chatMessage",value:new Pt(Object.assign(Object.assign({},n),{timestamp:A.parse(n.timestamp),editTimestamp:A.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,yt.RELIABLE),this.emit(Cr.ChatMessage,n),n})}sendText(e,t){return ei(this,void 0,void 0,function*(){var n;const i=crypto.randomUUID(),r=(new TextEncoder).encode(e).byteLength,o=null===(n=null===t||void 0===t?void 0:t.attachments)||void 0===n?void 0:n.map(()=>crypto.randomUUID()),a=new Array(o?o.length+1:1).fill(0),s=(e,n)=>{var i;a[n]=e;const r=a.reduce((e,t)=>e+t,0);null===(i=null===t||void 0===t?void 0:t.onProgress)||void 0===i||i.call(t,r)},c=yield this.streamText({streamId:i,totalSize:r,destinationIdentities:null===t||void 0===t?void 0:t.destinationIdentities,topic:null===t||void 0===t?void 0:t.topic,attachedStreamIds:o,attributes:null===t||void 0===t?void 0:t.attributes});return yield c.write(e),s(1,0),yield c.close(),(null===t||void 0===t?void 0:t.attachments)&&o&&(yield Promise.all(t.attachments.map((e,n)=>ei(this,void 0,void 0,function*(){return this._sendFile(o[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{s(e,n+1)}})})))),c.info})}streamText(e){return ei(this,void 0,void 0,function*(){var t,n;const i=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),r={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null===e||void 0===e?void 0:e.topic)&&void 0!==n?n:"",size:null===e||void 0===e?void 0:e.totalSize,attributes:null===e||void 0===e?void 0:e.attributes},o=new zt({streamId:i,mimeType:r.mimeType,topic:r.topic,timestamp:No(r.timestamp),totalLength:No(null===e||void 0===e?void 0:e.totalSize),attributes:r.attributes,contentHeader:{case:"textHeader",value:new Vt({version:null===e||void 0===e?void 0:e.version,attachedStreamIds:null===e||void 0===e?void 0:e.attachedStreamIds,replyToStreamId:null===e||void 0===e?void 0:e.replyToStreamId,operationType:"update"===(null===e||void 0===e?void 0:e.type)?Bt.UPDATE:Bt.CREATE})}}),a=null===e||void 0===e?void 0:e.destinationIdentities,s=new bt({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(s,yt.RELIABLE);let c=0;const l=this,d=new WritableStream({write(e){return ei(this,void 0,void 0,function*(){for(const t of function(e,t){const n=[];let i=(new TextEncoder).encode(e);for(;i.length>t;){let e=t;for(;e>0;){const t=i[e];if(void 0!==t&&128!==(192&t))break;e--}n.push(i.slice(0,e)),i=i.slice(e)}return i.length>0&&n.push(i),n}(e,15e3)){yield l.engine.waitForBufferStatusLow(yt.RELIABLE);const e=new Ht({content:t,streamId:i,chunkIndex:No(c)}),n=new bt({destinationIdentities:a,value:{case:"streamChunk",value:e}});yield l.engine.sendDataPacket(n,yt.RELIABLE),c+=1}})},close(){return ei(this,void 0,void 0,function*(){const e=new Wt({streamId:i}),t=new bt({destinationIdentities:a,value:{case:"streamTrailer",value:e}});yield l.engine.sendDataPacket(t,yt.RELIABLE)})},abort(e){console.log("Sink error:",e)}});let u=()=>ei(this,void 0,void 0,function*(){yield h.close()});l.engine.once(wr.Closing,u);const h=new ws(d,r,()=>this.engine.off(wr.Closing,u));return h})}sendFile(e,t){return ei(this,void 0,void 0,function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}})}_sendFile(e,t,n){return ei(this,void 0,void 0,function*(){var i;const r=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(i=null===n||void 0===n?void 0:n.mimeType)&&void 0!==i?i:t.type,topic:null===n||void 0===n?void 0:n.topic,destinationIdentities:null===n||void 0===n?void 0:n.destinationIdentities}),o=t.stream().getReader();for(;;){const{done:e,value:t}=yield o.read();if(e)break;yield r.write(t)}return yield r.close(),r.info})}streamBytes(e){return ei(this,void 0,void 0,function*(){var t,n,i,r,o;const a=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),s=null===e||void 0===e?void 0:e.destinationIdentities,c={id:a,mimeType:null!==(n=null===e||void 0===e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(i=null===e||void 0===e?void 0:e.topic)&&void 0!==i?i:"",timestamp:Date.now(),attributes:null===e||void 0===e?void 0:e.attributes,size:null===e||void 0===e?void 0:e.totalSize,name:null!==(r=null===e||void 0===e?void 0:e.name)&&void 0!==r?r:"unknown"},l=new zt({totalLength:No(null!==(o=c.size)&&void 0!==o?o:0),mimeType:c.mimeType,streamId:a,topic:c.topic,timestamp:No(Date.now()),attributes:c.attributes,contentHeader:{case:"byteHeader",value:new qt({name:c.name})}}),d=new bt({destinationIdentities:s,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,yt.RELIABLE);let u=0;const h=new p,m=this.engine,f=this.log,g=new WritableStream({write(e){return ei(this,void 0,void 0,function*(){const t=yield h.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+15e3);yield m.waitForBufferStatusLow(yt.RELIABLE);const i=new bt({destinationIdentities:s,value:{case:"streamChunk",value:new Ht({content:t,streamId:a,chunkIndex:No(u)})}});yield m.sendDataPacket(i,yt.RELIABLE),u+=1,n+=t.byteLength}}finally{t()}})},close(){return ei(this,void 0,void 0,function*(){const e=new Wt({streamId:a}),t=new bt({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield m.sendDataPacket(t,yt.RELIABLE)})},abort(e){f.error("Sink error:",e)}});return new Es(g,c)})}performRpc(e){return ei(this,arguments,void 0,function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:o=1e4}=e;return function*(){return new Promise((e,a)=>ei(t,void 0,void 0,function*(){var t,s,c,l;if(za(r)>15360)return void a(qa.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&yo(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void a(qa.builtIn("UNSUPPORTED_SERVER"));const d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,r,o-2e3);const u=setTimeout(()=>{this.pendingAcks.delete(d),a(qa.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(h)},2e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(u)},participantIdentity:n});const h=setTimeout(()=>{this.pendingResponses.delete(d),a(qa.builtIn("RESPONSE_TIMEOUT"))},o);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(u)),n?a(n):e(null!==t&&void 0!==t?t:"")},participantIdentity:n})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,i,r){return ei(this,void 0,void 0,function*(){const o=new bt({destinationIdentities:[e],kind:yt.RELIABLE,value:{case:"rpcRequest",value:new Rt({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(o,yt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,qa.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(e=>"video"===e.mime.split("/")[0].toLowerCase())}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach(e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Zo(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}}),!0)}setActiveAgent(e){var t,n,i,r;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(r=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Oo),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(Fo(i)||jo(i))&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))}),t}waitForPendingPublicationOfSource(e){return ei(this,void 0,void 0,function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find(t=>{let[n]=t;return n.source===e});if(t)return t[1];yield no(20)}})}}class js extends Ds{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=e=>{this.setTrack(void 0),this.emit(Er.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.visible=e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensionsAdaptiveStream=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new cn({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new _t({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Er.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?Ds.SubscriptionStatus.Unsubscribed:super.isSubscribed?Ds.SubscriptionStatus.Subscribed:Ds.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Ds.PermissionStatus.Allowed:Ds.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return void 0!==this.requestedDisabled?!this.requestedDisabled:!this.isAdaptiveStream||this.visible}get isLocal(){return!1}setEnabled(e){this.isManualOperationAllowed()&&this.requestedDisabled!==!e&&(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.requestedMaxQuality!==e&&(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.requestedVideoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.requestedVideoDimensions)||void 0===n?void 0:n.height)===e.height||(qo(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&qo(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return null!==(e=this.requestedMaxQuality)&&void 0!==e?e:qr.HIGH}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Er.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Er.VisibilityChanged,this.handleVisibilityChange),i.off(Er.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Er.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Er.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Er.VisibilityChanged,this.handleVisibilityChange),e.on(Er.Ended,this.handleEnded),this.emit(Er.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Er.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Er.Muted:Er.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Er.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Er.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return qo(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new ln({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===zr.Kind.Video){let t=this.requestedVideoDimensions;if(void 0!==this.videoDimensionsAdaptiveStream)if(t){ta(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else if(void 0!==this.requestedMaxQuality&&this.trackInfo){const e=function(e,t){var n;return null===(n=e.layers)||void 0===n?void 0:n.find(e=>e.quality===t)}(this.trackInfo,this.requestedMaxQuality);e&&ta(this.videoDimensionsAdaptiveStream,e)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):void 0!==this.requestedMaxQuality?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:qr.HIGH})),e.quality=qr.HIGH)}this.emit(Er.UpdateSettings,e)}}class Fs extends Ls{static fromParticipantInfo(e,t,n){return new Fs(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,o,a){super(t,n||"",i,r,o,a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:ht.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Er.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Zo(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Er.UpdateSubscription,e=>{e.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(e)}),e.on(Er.SubscriptionPermissionChanged,t=>{this.emit(Cr.TrackSubscriptionPermissionChanged,e,t)}),e.on(Er.SubscriptionStatusChanged,t=>{this.emit(Cr.TrackSubscriptionStatusChanged,e,t)}),e.on(Er.Subscribed,t=>{this.emit(Cr.TrackSubscribed,t,e)}),e.on(Er.Unsubscribed,t=>{this.emit(Cr.TrackUnsubscribed,t,e)}),e.on(Er.SubscriptionFailed,t=>{this.emit(Cr.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zr.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zr.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,o){let a=this.getTrackPublicationBySid(t);if(a||t.startsWith("TR")||this.trackPublications.forEach(t=>{a||e.kind!==t.kind.toString()||(a=t)}),!a)return 0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(Cr.TrackSubscriptionFailed,t)):(void 0===o&&(o=20),void setTimeout(()=>{this.addSubscribedMediaTrack(e,t,n,i,r,o-1)},150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Zo(a))),void this.emit(Cr.TrackSubscriptionFailed,t);let s;return s="video"===e.kind?new Is(e,t,i,r):new Rs(e,t,i,this.audioContext,this.audioOutput),s.source=a.source,s.isMuted=a.isMuted,s.setMediaStream(n),s.start(),a.setTrack(s),this.volumeMap.has(a.source)&&Bo(s)&&Lo(s)&&s.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach(e=>{var i,r;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const t=zr.kindFromProto(e.type);if(!t)return;o=new js(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),o.updateInfo(e),n.set(e.sid,o);const a=Array.from(this.trackPublications.values()).find(e=>e.source===(null===o||void 0===o?void 0:o.source));a&&o.source!==zr.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Zo(a),newTrack:Zo(o)})),this.addTrackPublication(o)}t.set(e.sid,o)}),this.trackPublications.forEach(e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Zo(e))),this.unpublishTrack(e.trackSid,!0))}),n.forEach(e=>{this.emit(Cr.TrackPublished,e)}),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case zr.Kind.Audio:this.audioTrackPublications.delete(e);break;case zr.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(Cr.TrackUnpublished,n)}setAudioOutput(e){return ei(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(n=>{var i;Lo(n.track)&&Bo(n.track)&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}var Bs;!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(Bs||(Bs={}));class Vs extends oi.EventEmitter{constructor(e){var t,n,i,r;if(super(),t=this,this.state=Bs.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Jn,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(e,t,n)=>ei(this,void 0,void 0,function*(){var i;if("undefined"===typeof RTCPeerConnection||!io()&&!ro())throw mo()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const r=yield this.disconnectLock.lock();if(this.state===Bs.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(Bs.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),fo(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new ys(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then(e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))}));const o=(i,a,s)=>ei(this,void 0,void 0,function*(){var c,l;this.abortController&&this.abortController.abort();const d=new AbortController;this.abortController=d,null===r||void 0===r||r();try{yield this.attemptConnection(null!==s&&void 0!==s?s:e,t,n,d),this.abortController=void 0,i()}catch(u){if(this.regionUrlProvider&&u instanceof Pr&&u.reason!==yr.Cancelled&&u.reason!==yr.NotAllowed){let e=null;try{e=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(h){if(h instanceof Pr&&(401===h.status||h.reason===yr.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void a(h)}e&&!(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(u.message,". Retrying with another region: ").concat(e),this.logContext),this.recreateEngine(),yield o(i,a,e)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Do(u)),a(u))}else{let e=it.UNKNOWN_REASON;u instanceof Pr&&(e=Do(u)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e),a(u)}}}),a=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Oo((e,t)=>{o(e,t,a)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(e,t,n,i,r,o)=>ei(this,void 0,void 0,function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"===typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=d,this.log.debug("connected to Livekit Server ".concat(Object.entries(d).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!d.version)throw new Or("unknown server version");return"0.15.1"===d.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l}),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(n){this.log.error(n instanceof Error?n.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:n}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>ei(this,void 0,void 0,function*(){var r,o;this.state===Bs.Reconnecting||this.isResuming||(null===(r=this.engine)||void 0===r?void 0:r.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(o=this.regionUrlProvider)||void 0===o?void 0:o.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Fa),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(Sr.SignalConnected)}catch(a){yield this.engine.close(),this.recreateEngine();const e=new Pr("could not establish signal connection",yr.ServerUnreachable);throw a instanceof Error&&(e.message="".concat(e.message,": ").concat(a.message)),a instanceof Pr&&(e.reason=a.reason,e.status=a.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:a})),e}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Pr("Connection attempt aborted",yr.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(s){throw yield this.engine.close(),this.recreateEngine(),s}po()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),po()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Bs.Connected),this.emit(Sr.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return ei(t,[...n],void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,r,o;const a=yield e.disconnectLock.lock();try{if(e.state===Bs.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===Bs.Connecting||e.state===Bs.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(r=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new Pr("Client initiated disconnect",yr.Cancelled)),e.connectFuture=void 0),(null===(o=e.engine)||void 0===o?void 0:o.client.isDisconnected)||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,it.CLIENT_INITIATED),e.engine=void 0}finally{a()}}()})},this.onPageLeave=()=>ei(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>ei(this,void 0,void 0,function*(){const e=[],t=Lr();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=Io();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(n),this.once(Sr.Disconnected,()=>{null===n||void 0===n||n.remove(),n=null})}e.push(n)}this.remoteParticipants.forEach(t=>{t.audioTrackPublications.forEach(t=>{t.track&&t.track.attachedElements.forEach(t=>{e.push(t)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(e=>(e.muted=!1,e.play()))]),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}}),this.startVideo=()=>ei(this,void 0,void 0,function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach(t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach(t=>{e.includes(t)||e.push(t)})});yield Promise.all(e.map(e=>e.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(Bs.Reconnecting)&&this.emit(Sr.Reconnecting)},this.handleSignalRestarted=e=>ei(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(t){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:t}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(n){return}this.setAndEmitConnectionState(Bs.Connected),this.emit(Sr.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=e=>{e.forEach(e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===ut.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)})},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach(e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}}),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),this.activeSpeakers=t,this.emitWhenConnected(Sr.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach(e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)}),e.forEach(e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))});const n=Array.from(t.values());n.sort((e,t)=>t.audioLevel-e.audioLevel),this.activeSpeakers=n,this.emitWhenConnected(Sr.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach(e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=zr.streamStateFromProto(e.state);i!==n.track.streamState&&(n.track.streamState=i,t.emit(Cr.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(Sr.TrackStreamStateChanged,n,n.track.streamState,t))})},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find(t=>t.trackPublications.has(e.trackSid));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case)this.handleStreamHeader(e.value.value,e.participantIdentity);else if("streamChunk"===e.value.case)this.handleStreamChunk(e.value.value);else if("streamTrailer"===e.value.case)this.handleStreamTrailer(e.value.value);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n)=>{this.emit(Sr.DataReceived,t.payload,e,n,t.topic),null===e||void 0===e||e.emit(Cr.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(Sr.SipDTMFReceived,t,e),null===e||void 0===e||e.emit(Cr.SipDTMFReceived,t)},this.bufferedSegments=new Map,this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null===n||void 0===n?void 0:n.trackPublications.get(t.trackId),r=function(e,t){return e.segments.map(e=>{let{id:n,text:i,language:r,startTime:o,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),d=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:d}})}(t,this.transcriptionReceivedTimes);null===i||void 0===i||i.emit(Er.TranscriptionReceived,r),null===n||void 0===n||n.emit(Cr.TranscriptionReceived,r,i),this.emit(Sr.TranscriptionReceived,r,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(t);this.emit(Sr.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(Sr.MetricsReceived,e,t)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Sr.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Sr.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Sr.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Sr.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>ei(this,void 0,void 0,function*(){var e;"iOS"!==(null===(e=Lr())||void 0===e?void 0:e.os)&&(yield this.selectDefaultDevices()),this.emit(Sr.MediaDevicesChanged)}),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(Sr.RoomMetadataChanged,e.metadata),(null===t||void 0===t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(Sr.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach(e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)})},this.onLocalParticipantMetadataChanged=e=>{this.emit(Sr.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(Sr.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(Sr.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(Sr.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(Sr.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null===e||void 0===e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>ei(this,void 0,void 0,function*(){var t,n,i,r,o,a;if(null===(t=e.track)||void 0===t||t.on(Er.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(Er.Restarted,this.onLocalTrackRestarted),null===(o=null===(r=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===r?void 0:r.onPublish)||void 0===o||o.call(r,this),this.emit(Sr.LocalTrackPublished,e,this.localParticipant),Fo(e.track)){(yield e.track.checkForSilence())&&this.emit(Sr.LocalAudioSilenceDetected,e)}const s=yield null===(a=e.track)||void 0===a?void 0:a.getDeviceId(!1),c=Jo(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(Sr.ActiveDeviceChanged,c,s))}),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(Er.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(Er.Restarted,this.onLocalTrackRestarted),this.emit(Sr.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>ei(this,void 0,void 0,function*(){const t=yield e.getDeviceId(!1),n=Jo(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(Sr.ActiveDeviceChanged,n,t))}),this.onLocalConnectionQualityChanged=e=>{this.emit(Sr.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=(e,t)=>{this.emit(Sr.MediaDevicesError,e,t)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(Sr.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(Sr.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},ja),e),this.log=Yn(null!==(n=this.options.loggerName)&&void 0!==n?n:Gn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},La),null===e||void 0===e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ua),null===e||void 0===e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Aa),null===e||void 0===e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new p,this.localParticipant=new Us("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",xo(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",xo(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",xo(this.options.audioOutput.deviceId)).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),po()){const e=new AbortController;null===(r=navigator.mediaDevices)||void 0===r||r.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),Vs.cleanupRegistry&&Vs.cleanupRegistry.register(this,()=>{e.abort()})}}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,t,n,i,r,o){return ei(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),1!==o)return void(yield this.engine.publishRpcResponse(e,t,null,qa.builtIn("UNSUPPORTED_VERSION")));const a=this.rpcHandlers.get(n);if(!a)return void(yield this.engine.publishRpcResponse(e,t,null,qa.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const o=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});za(o)>15360?(s=qa.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=o}catch(l){l instanceof qa?s=l:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),l),s=qa.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,s)})}setE2EEEnabled(e){return ei(this,void 0,void 0,function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new na(this.options.e2ee),this.e2eeManager.on(mr.ParticipantEncryptionStatusChanged,(e,t)=>{t.isLocal&&(this.isE2EEEnabled=e),this.emit(Sr.ParticipantEncryptionStatusChanged,e,t)}),this.e2eeManager.on(mr.EncryptionError,e=>this.emit(Sr.EncryptionError,e)),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return ei(this,void 0,void 0,function*(){return this.state===Bs.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(wr.RoomUpdate,n),e(t.sid))};this.engine.on(wr.RoomUpdate,n),this.once(Sr.Disconnected,()=>{this.engine.off(wr.RoomUpdate,n),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new vs(this.options),this.engine.on(wr.ParticipantUpdate,this.handleParticipantUpdates).on(wr.RoomUpdate,this.handleRoomUpdate).on(wr.SpeakersChanged,this.handleSpeakersChanged).on(wr.StreamStateChanged,this.handleStreamStateUpdate).on(wr.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(wr.SubscriptionError,this.handleSubscriptionError).on(wr.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(wr.MediaTrackAdded,(e,t,n)=>{this.onTrackAdded(e,t,n)}).on(wr.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(wr.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(wr.DataPacketReceived,this.handleDataPacket).on(wr.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Bs.SignalReconnecting)&&this.emit(Sr.SignalReconnecting)}).on(wr.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Bs.Connected)&&this.emit(Sr.Reconnected)}).on(wr.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Bs.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(wr.Restarting,this.handleRestarting).on(wr.SignalRestarted,this.handleSignalRestarted).on(wr.Offline,()=>{this.setAndEmitConnectionState(Bs.Reconnecting)&&this.emit(Sr.Reconnecting)}).on(wr.DCBufferStatusChanged,(e,t)=>{this.emit(Sr.DCBufferStatusChanged,e,t)}).on(wr.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(t=>{let{trackSid:n}=t;return n===e});t?(this.localParticipant.emit(Cr.LocalTrackSubscribed,t),this.emitWhenConnected(Sr.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)}).on(wr.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((e,t)=>{this.handleParticipantDisconnected(t,e)}),this.emit(Sr.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ra.getInstance().getDevices(e,t)}prepareConnection(e,t){return ei(this,void 0,void 0,function*(){if(this.state===Bs.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(fo(new URL(e))&&t){this.regionUrlProvider=new ys(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===Bs.Disconnected&&(this.regionUrl=n,yield fetch(_o(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(_o(e),{method:"HEAD"})}catch(n){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:n}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return ei(this,void 0,void 0,function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new Mn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new Mn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new Mn({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new Mn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>ei(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Mn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>ei(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Mn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new Mn({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>ei(this,void 0,void 0,function*(){const e=this.engine.client.onLeave;e&&e(new hn({reason:it.CLIENT_INITIATED,action:pn.RECONNECT}))});break;case"subscriber-bandwidth":if(void 0===t||"number"!==typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new Mn({scenario:{case:"subscriberBandwidth",value:No(t)}});break;case"leave-full-reconnect":n=new Mn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return ei(this,arguments,void 0,function(e,t){var n=this;let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var r,o,a,s,c,l,d;let u=!0,h=!1;const p=i?{exact:t}:t;if("audioinput"===e){h=0===n.localParticipant.audioTrackPublications.size;const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter(e=>e.source===zr.Source.Microphone);try{u=(yield Promise.all(i.map(e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(m){throw n.options.audioCaptureDefaults.deviceId=t,m}const o=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});u&&o&&(h=!0)}else if("videoinput"===e){h=0===n.localParticipant.videoTrackPublications.size;const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter(e=>e.source===zr.Source.Camera);try{u=(yield Promise.all(i.map(e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(m){throw n.options.videoCaptureDefaults.deviceId=t,m}const r=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});u&&r&&(h=!0)}else if("audiooutput"===e){if(h=!0,!ao()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");n.options.webAudioMix&&(t=null!==(a=yield ra.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==a?a:""),null!==(s=(d=n.options).audioOutput)&&void 0!==s||(d.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map(e=>e.setAudioOutput({deviceId:t})))}catch(m){throw n.options.audioOutput.deviceId=i,m}}return h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(Sr.ActiveDeviceChanged,e,t)),u}()})}setupLocalParticipantEvents(){this.localParticipant.on(Cr.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Cr.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Cr.AttributesChanged,this.onLocalAttributesChanged).on(Cr.TrackMuted,this.onLocalTrackMuted).on(Cr.TrackUnmuted,this.onLocalTrackUnmuted).on(Cr.LocalTrackPublished,this.onLocalTrackPublished).on(Cr.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Cr.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Cr.MediaDevicesError,this.onMediaDevicesError).on(Cr.AudioStreamAcquired,this.startAudio).on(Cr.ChatMessage,this.onLocalChatMessageSent).on(Cr.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===Bs.Connecting||this.state===Bs.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(Sr.Reconnected,i),this.off(Sr.Connected,i),this.off(Sr.Disconnected,r)};return this.once(Sr.Reconnected,i),this.once(Sr.Connected,i),void this.once(Sr.Disconnected,r)}if(this.state===Bs.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find(e=>e.sid===r);if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"===typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),s.addSubscribedMediaTrack(e,a,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Bs.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(t=>{var n,i,r;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop()):null===(r=t.track)||void 0===r||r.stopMonitor()}),this.localParticipant.off(Cr.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Cr.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Cr.AttributesChanged,this.onLocalAttributesChanged).off(Cr.TrackMuted,this.onLocalTrackMuted).off(Cr.TrackUnmuted,this.onLocalTrackUnmuted).off(Cr.LocalTrackPublished,this.onLocalTrackPublished).off(Cr.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Cr.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Cr.MediaDevicesError,this.onMediaDevicesError).off(Cr.AudioStreamAcquired,this.startAudio).off(Cr.ChatMessage,this.onLocalChatMessageSent).off(Cr.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"===typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),po()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Bs.Disconnected),this.emit(Sr.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(t.trackPublications.forEach(e=>{t.unpublishTrack(e.trackSid,!0)}),this.emit(Sr.ParticipantDisconnected,t),t.setDisconnected(),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleStreamHeader(e,t){return ei(this,void 0,void 0,function*(){var n;if("byteHeader"===e.contentHeader.case){const i=this.byteStreamHandlers.get(e.topic);if(!i)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let r;const o={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Mo(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:t=>{r=t,this.byteStreamControllers.set(e.streamId,{info:o,controller:r,startTime:Date.now()})}});i(new Ts(o,a,Mo(e.totalLength)),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let i;const r={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:t=>{i=t,this.textStreamControllers.set(e.streamId,{info:r,controller:i,startTime:Date.now()})}});n(new Ss(r,o,Mo(e.totalLength)),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return ei(this,void 0,void 0,function*(){var e,t,n;const i=ra.getInstance().previousDevices,r=yield ra.getInstance().getDevices(void 0,!1),o=Lr();if("Chrome"===(null===o||void 0===o?void 0:o.name)&&"iOS"!==o.os)for(let s of r){const e=i.find(e=>e.deviceId===s.deviceId);e&&""!==e.label&&e.kind===s.kind&&e.label!==s.label&&"default"===this.getActiveDevice(s.kind)&&this.emit(Sr.ActiveDeviceChanged,s.kind,s.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let s of a){const o=Qo(s),a=this.localParticipant.getTrackPublication(o);if(a&&(null===(e=a.track)||void 0===e?void 0:e.isUserProvided))continue;const c=r.filter(e=>e.kind===s),l=this.getActiveDevice(s);l===(null===(t=i.filter(e=>e.kind===s)[0])||void 0===t?void 0:t.deviceId)&&c.length>0&&(null===(n=c[0])||void 0===n?void 0:n.deviceId)!==l?yield this.switchActiveDevice(s,c[0].deviceId):"audioinput"===s&&!lo()||"videoinput"===s||!(c.length>0)||c.find(e=>e.deviceId===this.getActiveDevice(s))||"audiooutput"===s&&lo()||(yield this.switchActiveDevice(s,c[0].deviceId))}})}acquireAudioContext(){return ei(this,void 0,void 0,function*(){var e,t;if("boolean"!==typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=Go())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(e=>e.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),no(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(Sr.AudioPlaybackStatusChanged,n))})}createParticipant(e,t){var n;let i;return i=t?Fs.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new Fs(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);if(t){n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity)}return n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(Sr.ParticipantConnected,n),n.on(Cr.TrackPublished,e=>{this.emitWhenConnected(Sr.TrackPublished,e,n)}).on(Cr.TrackSubscribed,(e,t)=>{e.kind===zr.Kind.Audio?(e.on(Er.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(Er.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===zr.Kind.Video&&(e.on(Er.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(Er.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Sr.TrackSubscribed,e,t,n)}).on(Cr.TrackUnpublished,e=>{this.emit(Sr.TrackUnpublished,e,n)}).on(Cr.TrackUnsubscribed,(e,t)=>{this.emit(Sr.TrackUnsubscribed,e,t,n)}).on(Cr.TrackMuted,e=>{this.emitWhenConnected(Sr.TrackMuted,e,n)}).on(Cr.TrackUnmuted,e=>{this.emitWhenConnected(Sr.TrackUnmuted,e,n)}).on(Cr.ParticipantMetadataChanged,e=>{this.emitWhenConnected(Sr.ParticipantMetadataChanged,e,n)}).on(Cr.ParticipantNameChanged,e=>{this.emitWhenConnected(Sr.ParticipantNameChanged,e,n)}).on(Cr.AttributesChanged,e=>{this.emitWhenConnected(Sr.ParticipantAttributesChanged,e,n)}).on(Cr.ConnectionQualityChanged,e=>{this.emitWhenConnected(Sr.ConnectionQualityChanged,e,n)}).on(Cr.ParticipantPermissionsChanged,e=>{this.emitWhenConnected(Sr.ParticipantPermissionsChanged,e,n)}).on(Cr.TrackSubscriptionStatusChanged,(e,t)=>{this.emitWhenConnected(Sr.TrackSubscriptionStatusChanged,e,t,n)}).on(Cr.TrackSubscriptionFailed,(e,t)=>{this.emit(Sr.TrackSubscriptionFailed,e,n,t)}).on(Cr.TrackSubscriptionPermissionChanged,(e,t)=>{this.emitWhenConnected(Sr.TrackSubscriptionPermissionChanged,e,t,n)}).on(Cr.Active,()=>{this.emitWhenConnected(Sr.ParticipantActive,n),n.kind===ht.AGENT&&this.localParticipant.setActiveAgent(n)}),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((e,t)=>(e.push(...t.getTrackPublications()),e),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&Vo(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Br.setInterval(()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,it.STATE_MISMATCH)))},4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Br.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(Sr.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,n]=e;this.emit(t,...n)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===Bs.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===Bs.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return ei(this,void 0,void 0,function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new st({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:A.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new dt({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Sr.SignalConnected),this.emit(Sr.Connected),this.setAndEmitConnectionState(Bs.Connected),i.video){const e=new Ms(zr.Kind.Video,new gt({source:Ze.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Xe.AUDIO,name:"video-dummy"}),new ls(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Ro(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(Cr.LocalTrackPublished,e)}if(i.audio){const e=new Ms(zr.Kind.Audio,new gt({source:Ze.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Xe.AUDIO}),new $a(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Io(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(Cr.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new dt({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:ut.ACTIVE,tracks:[],joinedAt:A.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const o=Ro(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),a=new gt({source:Ze.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Xe.AUDIO});i.addSubscribedMediaTrack(o,a.sid,new MediaStream([o]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(r.audio){const e=Io(),n=new gt({source:Ze.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Xe.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==Sr.ActiveSpeakersChanged&&e!==Sr.TranscriptionReceived){const t=qs(n).filter(e=>void 0!==e);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function qs(e){return e.map(e=>{if(e)return Array.isArray(e)?qs(e):"object"===typeof e?"logContext"in e?e.logContext:void 0:e})}Vs.cleanupRegistry="undefined"!==typeof FinalizationRegistry&&new FinalizationRegistry(e=>{e()});var zs;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(zs||(zs={}));oi.EventEmitter;oi.EventEmitter;function Hs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const i=Ao(e)?e.mediaStreamTrack:e,r=i.getSettings();let o={facingMode:null!==(n=t.defaultFacingMode)&&void 0!==n?n:"user",confidence:"low"};if("facingMode"in r){const e=r.facingMode;Jn.trace("rawFacingMode",{rawFacingMode:e}),e&&"string"===typeof e&&function(e){const t=["user","environment","left","right"];return void 0===e||t.includes(e)}(e)&&(o={facingMode:e,confidence:"high"})}if(["low","medium"].includes(o.confidence)){Jn.trace("Try to get facing mode from device label: (".concat(i.label,")"));const e=function(e){var t;const n=e.trim().toLowerCase();if(""===n)return;if(Ws.has(n))return Ws.get(n);return null===(t=Array.from(Ks.entries()).find(e=>{let[t]=e;return n.includes(t)}))||void 0===t?void 0:t[1]}(i.label);void 0!==e&&(o=e)}return o}const Ws=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),Ks=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);Math.min,Math.max,Math.round,Math.floor;var Gs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Js,Ys={exports:{}},$s=Ys.exports;var Xs=(Js||(Js=1,function(e){var t,n;t=$s,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(o){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(a){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){var e;return null!==(e=null!==l&&void 0!==l?l:s)&&void 0!==e?e:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(o){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(n){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o},e.exports?e.exports=n():t.log=n()}(Ys)),Ys.exports);const Zs=Qs(Xs);var ec=function(e,t){return(ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function tc(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ec(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function nc(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())})}function ic(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(c){s=[6,c],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function rc(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function oc(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function ac(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function sc(e){return this instanceof sc?(this.v=e,this):new sc(e)}function cc(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,i){o.push([e,t,n,i])>1||s(e,t)})},t&&(i[e]=t(i[e])))}function s(e,t){try{!function(e){e.value instanceof sc?Promise.resolve(e.value.v).then(c,l):d(o[0][2],e)}(r[e](t))}catch(n){d(o[0][3],n)}}function c(e){s("next",e)}function l(e){s("throw",e)}function d(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function lc(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=rc(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}function dc(e){return"function"==typeof e}function uc(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var hc=uc(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function pc(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var mc=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,i,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=rc(o),s=a.next();!s.done;s=a.next()){s.value.remove(this)}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(dc(c))try{c()}catch(p){r=p instanceof hc?p.errors:[p]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var d=rc(l),u=d.next();!u.done;u=d.next()){var h=u.value;try{vc(h)}catch(p){r=null!==r&&void 0!==r?r:[],p instanceof hc?r=ac(ac([],oc(r)),oc(p.errors)):r.push(p)}}}catch(p){n={error:p}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(r)throw new hc(r)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)vc(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&pc(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&pc(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),fc=mc.EMPTY;function gc(e){return e instanceof mc||e&&"closed"in e&&dc(e.remove)&&dc(e.add)&&dc(e.unsubscribe)}function vc(e){dc(e)?e():e.unsubscribe()}var bc=void 0,yc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,ac([e,t],oc(n)))};function kc(e){yc(function(){throw e})}function Tc(){}function Sc(e){e()}var Cc=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,gc(t)&&t.add(n)):n.destination=Rc,n}return tc(t,e),t.create=function(e,t,n){return new Ec(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(mc),wc=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){Pc(n)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){Pc(n)}else Pc(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Pc(t)}},e}(),Ec=function(e){function t(t,n,i){var r,o=e.call(this)||this;return r=dc(t)||!t?{next:null!==t&&void 0!==t?t:void 0,error:null!==n&&void 0!==n?n:void 0,complete:null!==i&&void 0!==i?i:void 0}:t,o.destination=new wc(r),o}return tc(t,e),t}(Cc);function Pc(e){kc(e)}var Rc={closed:!0,next:Tc,error:function(e){throw e},complete:Tc},Ic="function"==typeof Symbol&&Symbol.observable||"@@observable";function Oc(e){return e}var xc=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this,r=function(e){return e&&e instanceof Cc||function(e){return e&&dc(e.next)&&dc(e.error)&&dc(e.complete)}(e)&&gc(e)}(e)?e:new Ec(e,t,n);return Sc(function(){var e=i,t=e.operator,n=e.source;r.add(t?t.call(r,n):n?i._subscribe(r):i._trySubscribe(r))}),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=_c(t))(function(t,i){var r=new Ec({next:function(t){try{e(t)}catch(n){i(n),r.unsubscribe()}},error:i,complete:t});n.subscribe(r)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ic]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(e){return 0===e.length?Oc:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=_c(e))(function(e,n){var i;t.subscribe(function(e){return i=e},function(e){return n(e)},function(){return e(i)})})},e.create=function(t){return new e(t)},e}();function _c(e){var t;return null!==(t=null!==e&&void 0!==e?e:bc)&&void 0!==t?t:Promise}function Dc(e){return function(t){if(function(e){return dc(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Mc(e,t,n,i,r){return new Nc(e,t,n,i,r)}var Nc=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=a,s._next=n?function(e){try{n(e)}catch(i){t.error(i)}}:e.prototype._next,s._error=r?function(e){try{r(e)}catch(n){t.error(n)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return tc(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Cc),Ac=uc(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Lc=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return tc(t,e),t.prototype.lift=function(e){var t=new Uc(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ac},t.prototype.next=function(e){var t=this;Sc(function(){var n,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var r=rc(t.currentObservers),o=r.next();!o.done;o=r.next()){o.value.next(e)}}catch(a){n={error:a}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;Sc(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Sc(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,i=n.hasError,r=n.isStopped,o=n.observers;return i||r?fc:(this.currentObservers=null,o.push(e),new mc(function(){t.currentObservers=null,pc(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,i=t.thrownError,r=t.isStopped;n?e.error(i):r&&e.complete()},t.prototype.asObservable=function(){var e=new xc;return e.source=this,e},t.create=function(e,t){return new Uc(e,t)},t}(xc),Uc=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return tc(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:fc},t}(Lc),jc=(function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}tc(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,i=e._value;if(t)throw n;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)}}(Lc),function(){return Date.now()}),Fc=function(e){function t(t,n){return e.call(this)||this}return tc(t,e),t.prototype.schedule=function(e,t){return this},t}(mc),Bc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,ac([e,t],oc(n)))},Vc=function(e){return clearInterval(e)},qc=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return tc(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Bc(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Vc(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,i=!1;try{this.work(e)}catch(r){i=!0,n=r||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,pc(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Fc),zc=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=jc,e}();new(function(e){function t(t,n){void 0===n&&(n=zc.now);var i=e.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return tc(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(zc))(qc);function Hc(e){return function(e){return e&&dc(e.schedule)}(function(e){return e[e.length-1]}(e))?e.pop():void 0}var Wc=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Kc(e){return dc(null==e?void 0:e.then)}function Gc(e){return dc(e[Ic])}function Qc(e){return Symbol.asyncIterator&&dc(null==e?void 0:e[Symbol.asyncIterator])}function Jc(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Yc="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function $c(e){return dc(null==e?void 0:e[Yc])}function Xc(e){return cc(this,arguments,function(){var t,n,i;return ic(this,function(r){switch(r.label){case 0:t=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,sc(t.read())];case 3:return n=r.sent(),i=n.value,n.done?[4,sc(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,sc(i)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Zc(e){return dc(null==e?void 0:e.getReader)}function el(e){if(e instanceof xc)return e;if(null!=e){if(Gc(e))return function(e){return new xc(function(t){var n=e[Ic]();if(dc(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Wc(e))return function(e){return new xc(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Kc(e))return function(e){return new xc(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,kc)})}(e);if(Qc(e))return tl(e);if($c(e))return function(e){return new xc(function(t){var n,i;try{for(var r=rc(e),o=r.next();!o.done;o=r.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}t.complete()})}(e);if(Zc(e))return function(e){return tl(Xc(e))}(e)}throw Jc(e)}function tl(e){return new xc(function(t){(function(e,t){var n,i,r,o;return nc(this,void 0,void 0,function(){var a,s;return ic(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=lc(e),c.label=1;case 1:return[4,n.next()];case 2:if((i=c.sent()).done)return[3,4];if(a=i.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),r={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}function nl(e,t,n,i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var o=t.schedule(function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(o),!r)return o}function il(e,t){return void 0===t&&(t=0),Dc(function(n,i){n.subscribe(Mc(i,function(n){return nl(i,e,function(){return i.next(n)},t)},function(){return nl(i,e,function(){return i.complete()},t)},function(n){return nl(i,e,function(){return i.error(n)},t)}))})}function rl(e,t){return void 0===t&&(t=0),Dc(function(n,i){i.add(e.schedule(function(){return n.subscribe(i)},t))})}function ol(e,t){if(!e)throw new Error("Iterable cannot be null");return new xc(function(n){nl(n,t,function(){var i=e[Symbol.asyncIterator]();nl(n,t,function(){i.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function al(e,t){if(null!=e){if(Gc(e))return function(e,t){return el(e).pipe(rl(t),il(t))}(e,t);if(Wc(e))return function(e,t){return new xc(function(n){var i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(Kc(e))return function(e,t){return el(e).pipe(rl(t),il(t))}(e,t);if(Qc(e))return ol(e,t);if($c(e))return function(e,t){return new xc(function(n){var i;return nl(n,t,function(){i=e[Yc](),nl(n,t,function(){var e,t,r;try{t=(e=i.next()).value,r=e.done}catch(o){return void n.error(o)}r?n.complete():n.next(t)},0,!0)}),function(){return dc(null==i?void 0:i.return)&&i.return()}})}(e,t);if(Zc(e))return function(e,t){return ol(Xc(e),t)}(e,t)}throw Jc(e)}function sl(e,t){return t?al(e,t):el(e)}uc(function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function cl(e,t){return Dc(function(n,i){var r=0;n.subscribe(Mc(i,function(n){i.next(e.call(t,n,r++))}))})}Array.isArray;function ll(e,t,n){return void 0===n&&(n=1/0),dc(t)?ll(function(n,i){return cl(function(e,r){return t(n,e,i,r)})(el(e(n,i)))},n):("number"==typeof t&&(n=t),Dc(function(t,i){return function(e,t,n,i,r,o,a){var s=[],c=0,l=0,d=!1,u=function(){d&&!s.length&&!c&&t.complete()},h=function(e){c++;var r=!1;el(n(e,l++)).subscribe(Mc(t,function(e){t.next(e)},function(){r=!0},void 0,function(){if(r)try{c--;for(var e=function(){var e=s.shift();a||h(e)};s.length&&c<i;)e();u()}catch(n){t.error(n)}}))};return e.subscribe(Mc(t,function(e){return c<i?h(e):s.push(e)},function(){d=!0,u()})),function(){}}(t,i,e,n)}))}function dl(){return function(e){return ll(Oc,e)}(1)}function ul(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return dl()(sl(e,Hc(e)))}function hl(e,t){return Dc(function(n,i){var r=0;n.subscribe(Mc(i,function(n){return e.call(t,n,r++)&&i.next(n)}))})}function pl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Hc(e);return Dc(function(t,i){(n?ul(e,t,n):ul(e,t)).subscribe(i)})}Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function ml(e){return!(typeof e>"u")&&(function(e){var t;return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof(null==(t=e.publication)?void 0:t.track)<"u")}(e)||function(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u")}(e))}function fl(e){return!!e&&(e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u")}function gl(e){if("string"==typeof e||"number"==typeof e)return"".concat(e);if(fl(e))return"".concat(e.participant.identity,"_").concat(e.source,"_placeholder");if(ml(e))return"".concat(e.participant.identity,"_").concat(e.publication.source,"_").concat(e.publication.trackSid);throw new Error("Can't generate a id for the given track reference: ".concat(e))}function vl(e,t){return!(typeof t>"u")&&(ml(e)?t.some(t=>t.participant.identity===e.participant.identity&&ml(t)&&t.publication.trackSid===e.publication.trackSid):!!fl(e)&&t.some(t=>t.participant.identity===e.participant.identity&&fl(t)&&t.source===e.source))}var bl=[...[Sr.ConnectionStateChanged,Sr.RoomMetadataChanged,Sr.ActiveSpeakersChanged,Sr.ConnectionQualityChanged,Sr.ParticipantConnected,Sr.ParticipantDisconnected,Sr.ParticipantPermissionsChanged,Sr.ParticipantMetadataChanged,Sr.ParticipantNameChanged,Sr.ParticipantAttributesChanged,Sr.TrackMuted,Sr.TrackUnmuted,Sr.TrackPublished,Sr.TrackUnpublished,Sr.TrackStreamStateChanged,Sr.TrackSubscriptionFailed,Sr.TrackSubscriptionPermissionChanged,Sr.TrackSubscriptionStatusChanged],Sr.LocalTrackPublished,Sr.LocalTrackUnpublished],yl=(Cr.TrackPublished,Cr.TrackUnpublished,Cr.TrackMuted,Cr.TrackUnmuted,Cr.TrackStreamStateChanged,Cr.TrackSubscribed,Cr.TrackUnsubscribed,Cr.TrackSubscriptionPermissionChanged,Cr.TrackSubscriptionFailed,Cr.LocalTrackPublished,Cr.LocalTrackUnpublished,Cr.ConnectionQualityChanged,Cr.IsSpeakingChanged,Cr.ParticipantMetadataChanged,Cr.ParticipantPermissionsChanged,Cr.TrackMuted,Cr.TrackUnmuted,Cr.TrackPublished,Cr.TrackUnpublished,Cr.TrackStreamStateChanged,Cr.TrackSubscriptionFailed,Cr.TrackSubscriptionPermissionChanged,Cr.TrackSubscriptionStatusChanged,Cr.LocalTrackPublished,Cr.LocalTrackUnpublished,Zs.getLogger("lk-components-js"));yl.setDefaultLevel("WARN");function kl(e){return"object"==typeof e}function Tl(e){return Array.isArray(e)&&e.filter(kl).length>0}function Sl(e){return"".concat("lk","-").concat(e)}function Cl(e){if(ml(e))return e.publication;{const{source:t,name:n,participant:i}=e;if(t&&n)return i.getTrackPublications().find(e=>e.source===t&&e.trackName===n);if(n)return i.getTrackPublicationByName(n);if(t)return i.getTrackPublication(t);throw new Error("At least one of source and name needs to be defined")}}function wl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new xc(t=>{const i=()=>{t.next(e)};return n.forEach(t=>{e.on(t,i)}),()=>{n.forEach(t=>{e.off(t,i)})}}).pipe(pl(e))}function El(e,t){return new xc(n=>{const i=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.next(t)};return e.on(t,i),()=>{e.off(t,i)}})}function Pl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new xc(t=>{const i=()=>{t.next(e)};return n.forEach(t=>{e.on(t,i)}),()=>{n.forEach(t=>{e.off(t,i)})}}).pipe(pl(e))}function Rl(e){return Pl(e,Cr.TrackMuted,Cr.TrackUnmuted,Cr.ParticipantPermissionsChanged,Cr.TrackPublished,Cr.TrackUnpublished,Cr.LocalTrackPublished,Cr.LocalTrackUnpublished,Cr.MediaDevicesError,Cr.TrackSubscriptionStatusChanged).pipe(cl(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:n,isScreenShareEnabled:i}=e,r=e.getTrackPublication(zr.Source.Microphone);return{isCameraEnabled:n,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:e.getTrackPublication(zr.Source.Camera),microphoneTrack:r,participant:e}}))}function Il(e){return e?Pl(e,Cr.ParticipantMetadataChanged,Cr.ParticipantNameChanged).pipe(cl(e=>{let{name:t,identity:n,metadata:i}=e;return{name:t,identity:n,metadata:i}}),pl({name:e.name,identity:e.identity,metadata:e.metadata})):void 0}function Ol(e,t){return new xc(n=>{const i=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.next(t)};return e.on(t,i),()=>{e.off(t,i)}})}function xl(e){var t,n,i,r;return Pl(e.participant,Cr.TrackMuted,Cr.TrackUnmuted,Cr.TrackSubscribed,Cr.TrackUnsubscribed,Cr.LocalTrackPublished,Cr.LocalTrackUnpublished).pipe(cl(t=>{var n,i;const r=null!=(n=e.publication)?n:t.getTrackPublication(e.source);return null==(i=null==r?void 0:r.isMuted)||i}),pl(null==(r=null!=(i=null==(t=e.publication)?void 0:t.isMuted)?i:null==(n=e.participant.getTrackPublication(e.source))?void 0:n.isMuted)||r))}function _l(e){const t=Sl("connection-quality"),n=function(e){return Ol(e,Cr.ConnectionQualityChanged).pipe(cl(e=>{let[t]=e;return t}),pl(e.connectionQuality))}(e);return{className:t,connectionQualityObserver:n}}function Dl(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=[e.localParticipant,...Array.from(e.remoteParticipants.values())],r=[];return i.forEach(e=>{t.forEach(t=>{const i=Array.from(e.trackPublications.values()).filter(e=>e.source===t&&(!n||e.track)).map(t=>({participant:e,publication:t,source:t.source}));r.push(...i)})}),{trackReferences:r,participants:i}}var Ml="".concat("lk","-user-choices"),{load:Nl,save:Al}=function(e){return{load:()=>function(e){if(typeof localStorage>"u")yl.error("Local storage is not available.");else try{const t=localStorage.getItem(e);return t?JSON.parse(t):void yl.warn("Item with key ".concat(e," does not exist in local storage."))}catch(t){return void yl.error("Error getting item from local storage: ".concat(t))}}(e),save:t=>function(e,t){if(typeof localStorage>"u")yl.error("Local storage is not available.");else try{if(t){const n=Object.fromEntries(Object.entries(t).filter(e=>{let[,t]=e;return""!==t}));localStorage.setItem(e,JSON.stringify(n))}}catch(n){yl.error("Error setting item to local storage: ".concat(n))}}(e,t)}}(Ml);const Ll=e.createContext(void 0);function Ul(){return e.useContext(Ll)}const jl=e.createContext(void 0);function Fl(){return e.useContext(jl)}function Bl(e){const t=Fl(),n=null!==e&&void 0!==e?e:t;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}const Vl=e.createContext(void 0);function ql(){return e.useContext(Vl)}function zl(e){var t;const n=ql(),i=Fl(),r=null!==(t=null!==e&&void 0!==e?e:n)&&void 0!==t?t:null==i?void 0:i.participant;if(!r)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return r}const Hl=e.createContext(void 0);function Wl(t){const n=e.useContext(Hl),i=null!==t&&void 0!==t?t:n;if(!i)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return i}const Kl=e.createContext(void 0);const Gl=["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","onEncryptionError","simulateParticipants"];function Ql(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=Ql(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function Jl(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=Ql(e))&&(i&&(i+=" "),i+=t);return i}function Yl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(const n of t)if("function"==typeof n)try{n(...arguments)}catch(e){console.error(e)}}}function $l(){const e=l({},arguments.length<=0?void 0:arguments[0]);for(let t=1;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];for(const t in n){const i=e[t],r=n[t];"function"==typeof i&&"function"==typeof r&&"o"===t[0]&&"n"===t[1]&&t.charCodeAt(2)>=65&&t.charCodeAt(2)<=90?e[t]=Yl(i,r):e[t]="className"!==t&&"UNSAFE_className"!==t||"string"!=typeof i||"string"!=typeof r?void 0!==r?r:i:Jl(i,r)}}return e}function Xl(e){return void 0!==e}function Zl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return $l(...t.filter(Xl))}function ed(e,t){return"processor"===e&&t&&"object"==typeof t&&"name"in t?t.name:"e2ee"===e&&t?"e2ee-enabled":t}const td={connect:!0,audio:!1,video:!1};const nd=e.forwardRef(function(t,n){const{room:i,htmlProps:o}=function(t){const n=l(l({},td),t),{token:i,serverUrl:o,options:a,room:s,connectOptions:c,connect:d,audio:u,video:h,screen:p,onConnected:m,onDisconnected:f,onError:g,onMediaDeviceFailure:v,onEncryptionError:b,simulateParticipants:y}=n,k=r(n,Gl);a&&s&&yl.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[T,S]=e.useState(),C=e.useRef(d);e.useEffect(()=>{S(null!==s&&void 0!==s?s:new Vs(a))},[s,JSON.stringify(a,ed)]);const w=e.useMemo(()=>{const{className:e}={className:"lk-room-container"};return $l(k,{className:e})},[k]);return e.useEffect(()=>{if(!T)return;const e=()=>{const e=T.localParticipant;yl.debug("trying to publish local tracks"),Promise.all([e.setMicrophoneEnabled(!!u,"boolean"!=typeof u?u:void 0),e.setCameraEnabled(!!h,"boolean"!=typeof h?h:void 0),e.setScreenShareEnabled(!!p,"boolean"!=typeof p?p:void 0)]).catch(e=>{yl.warn(e),null==g||g(e)})},t=(e,t)=>{const n=kr.getFailure(e);null==v||v(n,t)},n=e=>{null==b||b(e)},i=e=>{null==f||f(e)},r=()=>{null==m||m()};return T.on(Sr.SignalConnected,e).on(Sr.MediaDevicesError,t).on(Sr.EncryptionError,n).on(Sr.Disconnected,i).on(Sr.Connected,r),()=>{T.off(Sr.SignalConnected,e).off(Sr.MediaDevicesError,t).off(Sr.EncryptionError,n).off(Sr.Disconnected,i).off(Sr.Connected,r)}},[T,u,h,p,g,b,v,m,f]),e.useEffect(()=>{if(T){if(y)return void T.simulateParticipants({participants:{count:y},publish:{audio:!0,useRealTracks:!0}});if(d){if(C.current=!0,yl.debug("connecting"),!i)return void yl.debug("no token yet");if(!o)return yl.warn("no livekit url provided"),void(null==g||g(Error("no livekit url provided")));T.connect(o,i,c).catch(e=>{yl.warn(e),!0===C.current&&(null==g||g(e))})}else yl.debug("disconnecting because connect is false"),C.current=!1,T.disconnect()}},[d,i,JSON.stringify(c),T,g,o,y]),e.useEffect(()=>{if(T)return()=>{yl.info("disconnecting on onmount"),T.disconnect()}},[T]),{room:T,htmlProps:w}}(t);return e.createElement("div",l({ref:n},o),i&&e.createElement(Hl.Provider,{value:i},e.createElement(Kl.Provider,{value:t.featureFlags},t.children)))});function id(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const[r,o]=e.useState(n);return e.useEffect(()=>{if(i&&o(n),typeof window>"u"||!t)return;const e=t.subscribe(o);return()=>e.unsubscribe()},[t,i]),r}function rd(t){let{trackRef:n,props:i}=t;const r=Bl(n),o=Ul(),{className:a}=e.useMemo(()=>({className:[Sl("button"),Sl("focus-toggle-button")].join(" ")}),[]),s=e.useMemo(()=>vl(r,null==o?void 0:o.pin.state),[r,null==o?void 0:o.pin.state]);return{mergedProps:e.useMemo(()=>$l(i,{className:a,onClick:e=>{var t,n,a,c,l;null==(t=i.onClick)||t.call(i,e),s?null==(a=null==o?void 0:(n=o.pin).dispatch)||a.call(n,{msg:"clear_pin"}):null==(l=null==o?void 0:(c=o.pin).dispatch)||l.call(c,{msg:"set_pin",trackReference:r})}}),[i,a,r,s,null==o?void 0:o.pin]),inFocus:s}}function od(t){var n,i;const r=zl("string"==typeof t?(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).participant:t.participant),o="string"==typeof t?{participant:r,source:t}:t,[a,s]=e.useState(!!(null!=(n=o.publication)&&n.isMuted||null!=(i=r.getTrackPublication(o.source))&&i.isMuted));return e.useEffect(()=>{const e=xl(o).subscribe(s);return()=>e.unsubscribe()},[gl(o)]),a}function ad(t){const n=zl(t),i=e.useMemo(()=>function(e){return Ol(e,Cr.IsSpeakingChanged).pipe(cl(e=>{let[t]=e;return t}))}(n),[n]);return id(i,n.isSpeaking)}function sd(t){let{trackRef:n,onParticipantClick:i,disableSpeakingIndicator:r,htmlProps:o}=t;const a=Bl(n),s=e.useMemo(()=>{const{className:e}={className:Sl("participant-tile")};return $l(o,{className:e,onClick:e=>{var t;if(null==(t=o.onClick)||t.call(o,e),"function"==typeof i){var n;const e=null!==(n=a.publication)&&void 0!==n?n:a.participant.getTrackPublication(a.source);i({participant:a.participant,track:e})}}})},[o,i,a.publication,a.source,a.participant]),c=a.participant.getTrackPublication(zr.Source.Microphone),d=e.useMemo(()=>({participant:a.participant,source:zr.Source.Microphone,publication:c}),[c,a.participant]),u=od(a),h=od(d),p=ad(a.participant),m=function(e){if(e.publication instanceof Ms){const t=e.publication.track;if(t){const{facingMode:e}=Hs(t);return e}}return"undefined"}(a);return{elementProps:l({"data-lk-audio-muted":h,"data-lk-video-muted":u,"data-lk-speaking":!0!==r&&p,"data-lk-local-participant":a.participant.isLocal,"data-lk-source":a.source,"data-lk-facing-mode":m},s)}}function cd(t){var n,i;const r=Bl(t),{className:o,mediaMutedObserver:a}=e.useMemo(()=>function(e){let t="track-muted-indicator-camera";switch(e.source){case zr.Source.Camera:t="track-muted-indicator-camera";break;case zr.Source.Microphone:t="track-muted-indicator-microphone"}return{className:Sl(t),mediaMutedObserver:xl(e)}}(r),[gl(r)]);return{isMuted:id(a,!!(null!=(n=r.publication)&&n.isMuted||null!=(i=r.participant.getTrackPublication(r.source))&&i.isMuted)),className:o}}function ld(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[zr.Source.Camera,zr.Source.Microphone,zr.Source.ScreenShare,zr.Source.ScreenShareAudio,zr.Source.Unknown],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Wl(n.room),[r,o]=e.useState([]),[a,s]=e.useState([]),c=e.useMemo(()=>t.map(e=>kl(e)?e.source:e),[JSON.stringify(t)]);return e.useEffect(()=>{const e=function(e,t,n){var i,r;const o=null!=(i=n.additionalRoomEvents)?i:bl,a=null==(r=n.onlySubscribed)||r;return wl(e,...Array.from(new Set([Sr.ParticipantConnected,Sr.ParticipantDisconnected,Sr.ConnectionStateChanged,Sr.LocalTrackPublished,Sr.LocalTrackUnpublished,Sr.TrackPublished,Sr.TrackUnpublished,Sr.TrackSubscriptionStatusChanged,...o]).values())).pipe(cl(e=>{const n=Dl(e,t,a);return yl.debug("TrackReference[] was updated. (length ".concat(n.trackReferences.length,")"),n),n}),pl(Dl(e,t,a)))}(i,c,{additionalRoomEvents:n.updateOnlyOn,onlySubscribed:n.onlySubscribed}).subscribe(e=>{let{trackReferences:t,participants:n}=e;yl.debug("setting track bundles",t,n),o(t),s(n)});return()=>e.unsubscribe()},[i,JSON.stringify(n.onlySubscribed),JSON.stringify(n.updateOnlyOn),JSON.stringify(t)]),e.useMemo(()=>{if(Tl(t)){const e=function(e,t){const n=new Map;if(Tl(e)){const i=e.filter(e=>e.withPlaceholder).map(e=>e.source);t.forEach(e=>{const t=e.getTrackPublications().map(e=>{var t;return null==(t=e.track)?void 0:t.source}).filter(e=>void 0!==e),r=Array.from(function(e,t){const n=new Set(e);for(const i of t)n.delete(i);return n}(new Set(i),new Set(t)));r.length>0&&n.set(e.identity,r)})}return n}(t,a),n=Array.from(r);return a.forEach(t=>{var i;e.has(t.identity)&&(null!==(i=e.get(t.identity))&&void 0!==i?i:[]).forEach(e=>{if(r.find(n=>{let{participant:i,publication:r}=n;return t.identity===i.identity&&r.source===e}))return;yl.debug("Add ".concat(e," placeholder for participant ").concat(t.identity,"."));const i={participant:t,source:e};n.push(i)})}),n}return r},[r,a,t])}function dd(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=zl(t),r=Wl(n.room),o=e.useMemo(()=>function(e,t){return El(e,Sr.ParticipantEncryptionStatusChanged).pipe(hl(n=>{let[,i]=n;return(null==t?void 0:t.identity)===(null==i?void 0:i.identity)||!i&&(null==t?void 0:t.identity)===e.localParticipant.identity}),cl(e=>{let[t]=e;return t}),pl(null!=t&&t.isLocal?t.isE2EEEnabled:!(null==t||!t.isEncrypted)))}(r,i),[r,i]);return id(o,i.isLocal?i.isE2EEEnabled:!(null==i||!i.isEncrypted))}const ud=["trackRef"],hd=["participant"],pd=["trackRef","show"],md=["onTrackClick","onClick","onSubscriptionStatusChanged","trackRef","manageSubscription"],fd=["trackRef","onSubscriptionStatusChanged","volume"],gd=["trackRef","children","onParticipantClick","disableSpeakingIndicator"],vd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),e.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),bd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),yd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},e.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),kd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),Td=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),e.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),Sd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),e.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),Cd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),wd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),Ed=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},t),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),e.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),Pd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},t),e.createElement("g",{opacity:.25},e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),e.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),Rd=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},t),e.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),e.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),Id=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},t),e.createElement("g",{fill:"currentColor"},e.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),e.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),Od=t=>e.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},t),e.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},e.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"}))),xd=e.forwardRef(function(t,n){let{trackRef:i}=t,o=r(t,ud);const a=Fl(),{mergedProps:s,inFocus:c}=rd({trackRef:null!==i&&void 0!==i?i:a,props:o});return e.createElement(Ll.Consumer,null,t=>void 0!==t&&e.createElement("button",l({ref:n},s),o.children?o.children:c?e.createElement(Od,null):e.createElement(yd,null)))});function _d(t,n){switch(t){case zr.Source.Microphone:return n?e.createElement(Sd,null):e.createElement(Td,null);case zr.Source.Camera:return n?e.createElement(bd,null):e.createElement(vd,null);case zr.Source.ScreenShare:return n?e.createElement(Id,null):e.createElement(Rd,null);default:return}}const Dd=e.forwardRef(function(t,n){var i;const{className:r,quality:o}=function(){const t=zl((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).participant),{className:n,connectionQualityObserver:i}=e.useMemo(()=>_l(t),[t]);return{className:n,quality:id(i,t.connectionQuality)}}(t),a=e.useMemo(()=>l(l({},Zl(t,{className:r})),{},{"data-lk-quality":o}),[o,t,r]);return e.createElement("div",l({ref:n},a),null!==(i=t.children)&&void 0!==i?i:function(t){switch(t){case As.Excellent:return e.createElement(Cd,null);case As.Good:return e.createElement(wd,null);case As.Poor:return e.createElement(Ed,null);default:return e.createElement(Pd,null)}}(o))}),Md=e.forwardRef(function(t,n){let{participant:i}=t,o=r(t,hd);const a=zl(i),{className:s,infoObserver:c}=e.useMemo(()=>function(e){return{className:"lk-participant-name",infoObserver:Il(e)}}(a),[a]),{identity:d,name:u}=id(c,{name:a.name,identity:a.identity,metadata:a.metadata}),h=e.useMemo(()=>Zl(o,{className:s,"data-lk-participant-name":u}),[o,s,u]);return e.createElement("span",l({ref:n},h),""!==u?u:d,o.children)}),Nd=e.forwardRef(function(t,n){var i;let{trackRef:o,show:a="always"}=t,s=r(t,pd);const{className:c,isMuted:d}=cd(o),u="always"===a||"muted"===a&&d||"unmuted"===a&&!d,h=e.useMemo(()=>Zl(s,{className:c}),[c,s]);return u?e.createElement("div",l(l({ref:n},h),{},{"data-lk-muted":d}),null!==(i=s.children)&&void 0!==i?i:_d(o.source,!d)):null}),Ad=t=>e.createElement("svg",l({width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),e.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25}));function Ld(t){var n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,o]=e.useState(Cl(t)),[a,s]=e.useState(null==r?void 0:r.isMuted),[c,d]=e.useState(null==r?void 0:r.isSubscribed),[u,h]=e.useState(null==r?void 0:r.track),[p,m]=e.useState("landscape"),f=e.useRef(),{className:g,trackObserver:v}=e.useMemo(()=>function(e){const t=Cl(e),n=Rl(e.participant).pipe(cl(()=>Cl(e)),pl(t));return{className:Sl(e.source===zr.Source.Camera||e.source===zr.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}(t),[null!==(n=t.participant.sid)&&void 0!==n?n:t.participant.identity,t.source,ml(t)&&t.publication.trackSid]);return e.useEffect(()=>{const e=v.subscribe(e=>{yl.debug("update track",e),o(e),s(null==e?void 0:e.isMuted),d(null==e?void 0:e.isSubscribed),h(null==e?void 0:e.track)});return()=>null==e?void 0:e.unsubscribe()},[v]),e.useEffect(()=>{var e,n;return u&&(f.current&&u.detach(f.current),null!=(e=i.element)&&e.current&&!(t.participant.isLocal&&"audio"===(null==u?void 0:u.kind))&&u.attach(i.element.current)),f.current=null==(n=i.element)?void 0:n.current,()=>{f.current&&(null==u||u.detach(f.current))}},[u,i.element]),e.useEffect(()=>{var e,t;if("number"==typeof(null==(e=null==r?void 0:r.dimensions)?void 0:e.width)&&"number"==typeof(null==(t=null==r?void 0:r.dimensions)?void 0:t.height)){const e=r.dimensions.width>r.dimensions.height?"landscape":"portrait";m(e)}},[r]),{publication:r,isMuted:a,isSubscribed:c,track:u,elementProps:Zl(i.props,l({className:g,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":null==r?void 0:r.source},"video"===(null==r?void 0:r.kind)&&{"data-lk-orientation":p}))}}var Ud,jd;var Fd=function(){if(jd)return Ud;jd=1;var e=/^\s+|\s+$/g,t=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,i=/^0o[0-7]+$/i,r=parseInt,o="object"==typeof Gs&&Gs&&Gs.Object===Object&&Gs,a="object"==typeof self&&self&&self.Object===Object&&self,s=o||a||Function("return this")(),c=Object.prototype.toString,l=Math.max,d=Math.min,u=function(){return s.Date.now()};function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(o){if("number"==typeof o)return o;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==c.call(e)}(o))return NaN;if(h(o)){var a="function"==typeof o.valueOf?o.valueOf():o;o=h(a)?a+"":a}if("string"!=typeof o)return 0===o?o:+o;o=o.replace(e,"");var s=n.test(o);return s||i.test(o)?r(o.slice(2),s?2:8):t.test(o)?NaN:+o}return Ud=function(e,t,n){var i,r,o,a,s,c,m=0,f=!1,g=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=i,o=r;return i=r=void 0,m=t,a=e.apply(o,n)}function y(e){var n=e-c;return void 0===c||n>=t||n<0||g&&e-m>=o}function k(){var e=u();if(y(e))return T(e);s=setTimeout(k,function(e){var n=t-(e-c);return g?d(n,o-(e-m)):n}(e))}function T(e){return s=void 0,v&&i?b(e):(i=r=void 0,a)}function S(){var e=u(),n=y(e);if(i=arguments,r=this,c=e,n){if(void 0===s)return function(e){return m=e,s=setTimeout(k,t),f?b(e):a}(c);if(g)return s=setTimeout(k,t),b(c)}return void 0===s&&(s=setTimeout(k,t)),a}return t=p(t)||0,h(n)&&(f=!!n.leading,o=(g="maxWait"in n)?l(p(n.maxWait)||0,t):o,v="trailing"in n?!!n.trailing:v),S.cancel=function(){void 0!==s&&clearTimeout(s),m=0,i=c=r=s=void 0},S.flush=function(){return void 0===s?a:T(u())},S},Ud}();const Bd=Qs(Fd);function Vd(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2?arguments[2]:void 0;const r=(0,e.useRef)();!function(t){const n=(0,e.useRef)(t);n.current=t,(0,e.useEffect)(()=>()=>{n.current()},[])}(()=>{r.current&&r.current.cancel()});const o=(0,e.useMemo)(()=>{const e=Bd(t,n,i),o=function(){return e(...arguments)};return o.cancel=()=>{e.cancel()},o.isPending=()=>!!r.current,o.flush=()=>e.flush(),o},[t,n,i]);return(0,e.useEffect)(()=>{r.current=Bd(t,n,i)},[t,n,i]),o}const qd=e.forwardRef(function(t,n){let{onTrackClick:i,onClick:o,onSubscriptionStatusChanged:a,trackRef:s,manageSubscription:c}=t,d=r(t,md);const u=Bl(s),h=e.useRef(null);e.useImperativeHandle(n,()=>h.current);const p=function(){let{threshold:t=0,root:n=null,rootMargin:i="0%",freezeOnceVisible:r=!1,initialIsIntersecting:o=!1,onChange:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var s;const[c,l]=(0,e.useState)(null),[d,u]=(0,e.useState)(()=>({isIntersecting:o,entry:void 0})),h=(0,e.useRef)();h.current=a;const p=(null==(s=d.entry)?void 0:s.isIntersecting)&&r;(0,e.useEffect)(()=>{if(!c||!("IntersectionObserver"in window)||p)return;const e=new IntersectionObserver(t=>{const n=Array.isArray(e.thresholds)?e.thresholds:[e.thresholds];t.forEach(e=>{const t=e.isIntersecting&&n.some(t=>e.intersectionRatio>=t);u({isIntersecting:t,entry:e}),h.current&&h.current(t,e)})},{threshold:t,root:n,rootMargin:i});return e.observe(c),()=>{e.disconnect()}},[c,JSON.stringify(t),n,i,p,r]);const m=(0,e.useRef)(null);(0,e.useEffect)(()=>{var e;!c&&null!=(e=d.entry)&&e.target&&!r&&!p&&m.current!==d.entry.target&&(m.current=d.entry.target,u({isIntersecting:o,entry:void 0}))},[c,d.entry,r,p,o]);const f=[l,!!d.isIntersecting,d.entry];return f.ref=f[0],f.isIntersecting=f[1],f.entry=f[2],f}({root:h.current}),[m]=function(t,n,i){const r=t instanceof Function?t():t,[o,a]=(0,e.useState)(r),s=(0,e.useRef)(r),c=Vd(a,n,i);return((e,t)=>e===t)(s.current,r)||(c(r),s.current=r),[o,c]}(p,3e3);e.useEffect(()=>{c&&u.publication instanceof js&&!1===(null==m?void 0:m.isIntersecting)&&!1===(null==p?void 0:p.isIntersecting)&&u.publication.setSubscribed(!1)},[m,u,c]),e.useEffect(()=>{c&&u.publication instanceof js&&!0===(null==p?void 0:p.isIntersecting)&&u.publication.setSubscribed(!0)},[p,u,c]);const{elementProps:f,publication:g,isSubscribed:v}=Ld(u,{element:h,props:d});e.useEffect(()=>{null==a||a(!!v)},[v,a]);return e.createElement("video",l(l({ref:h},f),{},{muted:!0,onClick:e=>{null==o||o(e),null==i||i({participant:null==u?void 0:u.participant,track:g})}}))}),zd=e.forwardRef(function(t,n){let{trackRef:i,onSubscriptionStatusChanged:o,volume:a}=t,s=r(t,fd);const c=Bl(i),d=e.useRef(null);e.useImperativeHandle(n,()=>d.current);const{elementProps:u,isSubscribed:h,track:p,publication:m}=Ld(c,{element:d,props:s});return e.useEffect(()=>{null==o||o(!!h)},[h,o]),e.useEffect(()=>{void 0===p||void 0===a||(p instanceof Rs?p.setVolume(a):yl.warn("Volume can only be set on remote audio tracks."))},[a,p]),e.useEffect(()=>{void 0===m||void 0===s.muted||(m instanceof js?m.setEnabled(!s.muted):yl.warn("Can only call setEnabled on remote track publications."))},[s.muted,m,p]),e.createElement("audio",l({ref:d},u))});function Hd(t){const n=!!ql();return t.participant&&!n?e.createElement(Vl.Provider,{value:t.participant},t.children):e.createElement(e.Fragment,null,t.children)}function Wd(t){const n=!!Fl();return t.trackRef&&!n?e.createElement(jl.Provider,{value:t.trackRef},t.children):e.createElement(e.Fragment,null,t.children)}const Kd=e.forwardRef(function(t,n){let{trackRef:i,children:o,onParticipantClick:a,disableSpeakingIndicator:s}=t,c=r(t,gd);var d,u;const h=Bl(i),{elementProps:p}=sd({htmlProps:c,disableSpeakingIndicator:s,onParticipantClick:a,trackRef:h}),m=dd(h.participant),f=Ul(),g=null==(d=function(t){const n=e.useContext(Kl);if(!0===t){if(n)return n;throw Error("tried to access feature context, but none is present")}return n}())?void 0:d.autoSubscription,v=e.useCallback(e=>{h.source&&!e&&f&&f.pin.dispatch&&vl(h,f.pin.state)&&f.pin.dispatch({msg:"clear_pin"})},[h,f]);return e.createElement("div",l({ref:n,style:{position:"relative"}},p),e.createElement(Wd,{trackRef:h},e.createElement(Hd,{participant:h.participant},null!==o&&void 0!==o?o:e.createElement(e.Fragment,null,!ml(h)||"video"!==(null==(u=h.publication)?void 0:u.kind)&&h.source!==zr.Source.Camera&&h.source!==zr.Source.ScreenShare?ml(h)&&e.createElement(zd,{trackRef:h,onSubscriptionStatusChanged:v}):e.createElement(qd,{trackRef:h,onSubscriptionStatusChanged:v,manageSubscription:g}),e.createElement("div",{className:"lk-participant-placeholder"},e.createElement(Ad,null)),e.createElement("div",{className:"lk-participant-metadata"},e.createElement("div",{className:"lk-participant-metadata-item"},h.source===zr.Source.Camera?e.createElement(e.Fragment,null,m&&e.createElement(kd,{style:{marginRight:"0.25rem"}}),e.createElement(Nd,{trackRef:{participant:h.participant,source:zr.Source.Microphone},show:"muted"}),e.createElement(Md,null)):e.createElement(e.Fragment,null,e.createElement(Rd,{style:{marginRight:"0.25rem"}}),e.createElement(Md,null,"'s screen"))),e.createElement(Dd,{className:"lk-participant-metadata-item"}))),e.createElement(xd,{trackRef:h}))))});function Gd(t){let{volume:n,muted:i}=t;const r=ld([zr.Source.Microphone,zr.Source.ScreenShareAudio,zr.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(e=>!e.participant.isLocal&&e.publication.kind===zr.Kind.Audio);return e.createElement("div",{style:{display:"none"}},r.map(t=>e.createElement(zd,{key:gl(t),trackRef:t,volume:n,muted:i})))}var Qd=n(960);const Jd=e=>{let{track:t}=e;return(0,Qd.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"black",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,Qd.jsx)(Kd,{trackRef:t})})},Yd=e=>{let{participants:t,tracks:n}=e;return(0,Qd.jsx)("div",{className:"rosterLayoutWrapper",children:(0,Qd.jsx)("div",{className:"rosterLayout",children:t.map(e=>{const t=n.find(t=>t.participant.identity===e.identity&&t.publication.kind===zr.Kind.Video),i=e.isSpeaking;return(0,Qd.jsxs)("div",{className:"participant_identity ".concat(i?"speaking":""),children:[t?(0,Qd.jsx)(Kd,{trackRef:t}):(0,Qd.jsx)("div",{className:"participant_wrap",children:(0,Qd.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:(0,Qd.jsx)("path",{d:"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512l388.6 0c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304l-91.4 0z"})})}),(0,Qd.jsx)("div",{className:"participant_name",children:e.name||e.identity})]},e.identity)})})})};function $d(t){let{url:n,token:i,layout:r}=t;const[o,a]=(0,e.useState)();return n&&i?(0,Qd.jsx)(nd,{serverUrl:n,token:i,onError:a,children:o?(0,Qd.jsx)("div",{className:"error",children:o.message}):(0,Qd.jsx)(Xd,{layout:r})}):(0,Qd.jsx)("div",{className:"error",children:"missing required params url and token"})}function Xd(t){let{layout:n}=t;const r=function(){const t=e.useContext(Hl);if(!t)throw Error("tried to access room context outside of livekit room component");return t}(),[o]=(0,e.useState)(n),[a,s]=(0,e.useState)(!1),c=ld([zr.Source.ScreenShare],{onlySubscribed:!0});i.A.setRoom(r),(0,e.useEffect)(()=>{const e=Date.now(),t=setInterval(async()=>{let n=!1,o=!1,a=!1,s=!1;for(const e of Array.from(r.remoteParticipants.values()))for(const t of Array.from(e.trackPublications.values()))if(t.isSubscribed&&(a=!0),t.kind===zr.Kind.Video&&(o=!0,t.videoTrack)){const e=await t.videoTrack.getRTCStatsReport();e&&(s=Array.from(e).some(e=>"inbound-rtp"===e[1].type&&e[1].framesDecoded>0))}const c=Date.now()-e;(s||!o&&a&&c>500||c>5e3&&a)&&(n=!0),n&&(i.A.startRecording(),clearInterval(t))},100)},[]),(0,e.useEffect)(()=>{c.length>0&&c[0].publication?s(!0):s(!1)},[c]);const l=ld([zr.Source.Camera,zr.Source.ScreenShare,zr.Source.Unknown],{onlySubscribed:!0}),d=l.filter(e=>e.publication.kind===zr.Kind.Video&&e.participant.identity!==r.localParticipant.identity);let u="dark";o.endsWith("-light")&&(u="light");let h="roomContainer";u&&(h+=" ".concat(u));let p=(0,Qd.jsx)(Qd.Fragment,{});if(a){const e=d.find(e=>e.source===zr.Source.ScreenShare);e&&(p=(0,Qd.jsx)(Jd,{track:e}))}else{const e=[...Array.from(r.remoteParticipants.values()),r.localParticipant];p=(0,Qd.jsx)(Yd,{participants:e,tracks:l})}return(0,Qd.jsxs)("div",{className:h,children:[p,(0,Qd.jsx)(Gd,{})]})}const Zd=function(){return(0,Qd.jsx)("div",{className:"container",children:(0,Qd.jsx)($d,{url:"wss://ucaas-conference-oyfjembm.livekit.cloud",token:i.A.getAccessToken(),layout:i.A.getLayout()||"custom"})})},eu=document.getElementById("root");if(!eu)throw new Error("Failed to find the root element");(0,t.createRoot)(eu).render((0,Qd.jsx)(e.StrictMode,{children:(0,Qd.jsx)(Zd,{})}))})()})();
//# sourceMappingURL=main.c58ae072.js.map